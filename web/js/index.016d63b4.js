(function(){"use strict";var t={584:function(t,e,o){var n={};o.r(n),o.d(n,{copy:function(){return Mn},cut:function(){return En},paste:function(){return Bn}});var i={};o.r(i),o.d(i,{commitPreviewedConnection:function(){return Fn},connect:function(){return Ln},createConnection:function(){return Tn},cycleConnectionPreviews:function(){return jn},destroyConnection:function(){return $n},disconnect:function(){return Wn},setConnectionPreview:function(){return zn},unsetConnectionPreview:function(){return Nn}});var s={};o.r(s),o.d(s,{clearStatelessInfo:function(){return An},createImage:function(){return Un},loadDocument:function(){return Rn},print:function(){return Vn},toggleToolbox:function(){return qn}});var r={};o.r(r),o.d(r,{addFreeportItem:function(){return Gn},connectFreeport:function(){return Jn},createFreeport:function(){return Xn},removeFreeport:function(){return Yn}});var a={};o.r(a),o.d(a,{destroyGroup:function(){return ei},group:function(){return Qn},ungroup:function(){return ti}});var c={};o.r(c),o.d(c,{addItem:function(){return ii},insertItemAtPosition:function(){return si},removeElement:function(){return ai},resetItemValue:function(){return ri},setInputCount:function(){return ci},setProperties:function(){return li}});var l={};o.r(l),o.d(l,{panTo:function(){return ui},panToCenter:function(){return di}});var u={};o.r(u),o.d(u,{addPort:function(){return hi},monitorPort:function(){return bi},removePort:function(){return mi},setActivePortId:function(){return fi},setConnectablePortIds:function(){return gi},setPortValue:function(){return vi},setPortValues:function(){return Ii},togglePortMonitoring:function(){return yi},unmonitorPort:function(){return wi}});var d={};o.r(d),o.d(d,{centerAll:function(){return Di},dragItem:function(){return Zi},moveSelectionPosition:function(){return ki},setItemPortPositions:function(){return Oi},setItemPosition:function(){return _i},setSelectionPosition:function(){return Ei}});var p={};o.r(p),o.d(p,{rotate:function(){return Mi}});var h={};o.r(h),o.d(h,{createSelection:function(){return ji},deleteSelection:function(){return Ri},deselectAll:function(){return Fi},deselectItem:function(){return Bi},recycleSelection:function(){return Wi},selectAll:function(){return Ni},selectItem:function(){return zi},selectItemConnections:function(){return Ti},setSelectionState:function(){return $i},updateSelectionList:function(){return Li}});var m={};o.r(m),o.d(m,{buildCircuit:function(){return Ui},clearOscilloscope:function(){return Qi},closeOscilloscope:function(){return Ji},default:function(){return ts},onSimulationUpdate:function(){return qi},openOscilloscope:function(){return Xi},resetCircuit:function(){return Hi},start:function(){return Vi},stepThroughCircuit:function(){return Ki},stop:function(){return Ai},toggleDebugger:function(){return Gi},toggleOscilloscope:function(){return Yi}});var f={};o.r(f),o.d(f,{setGroupBoundingBox:function(){return ss},setItemBoundingBox:function(){return is},setItemSize:function(){return ns},setViewerSize:function(){return os}});var g={};o.r(g),o.d(g,{setSnapBoundaries:function(){return rs}});var v={};o.r(v),o.d(v,{applyState:function(){return ps},cacheState:function(){return us},commitCachedState:function(){return ds},commitState:function(){return ls},redo:function(){return cs},undo:function(){return as}});var y={};o.r(y),o.d(y,{bringForward:function(){return fs},bringToFront:function(){return vs},incrementZIndex:function(){return ys},sendBackward:function(){return ms},sendToBack:function(){return gs},setZIndex:function(){return bs}});var b={};o.r(b),o.d(b,{incrementZoom:function(){return Ss},setZoom:function(){return Cs}});var w=o(8262),I=o(9963),x=o(6252),S=o(3577);const C={key:0},P={key:1};function D(t,e,o,n,i,s){const r=(0,x.up)("toolbar"),a=(0,x.up)("toolbox"),c=(0,x.up)("tab-item"),l=(0,x.up)("document"),u=(0,x.up)("tab-host"),d=(0,x.up)("oscilloscope"),p=(0,x.up)("status-bar"),h=(0,x.up)("main-view");return(0,x.wg)(),(0,x.iD)(x.HY,null,[(0,x._)("div",{class:(0,S.C_)(["app__dropzone",{"app__dropzone--active":t.isDropping}])},null,2),t.activeDocumentId&&t.activeDocument?((0,x.wg)(),(0,x.j4)(h,{key:0},{top:(0,x.w5)((()=>[t.isMobile?((0,x.wg)(),(0,x.iD)("div",C,"mobile bar")):(0,x.kq)("",!0),((0,x.wg)(),(0,x.j4)(r,{key:t.activeDocumentId,store:t.activeDocument.store},null,8,["store"])),(0,x.Wm)(a,{store:t.activeDocument.store},null,8,["store"])])),middle:(0,x.w5)((()=>[(0,x.Wm)(u,null,(0,x.Nv)({default:(0,x.w5)((()=>[((0,x.wg)(),(0,x.j4)(l,{key:t.activeDocumentId,store:t.activeDocument.store,onSwitch:t.switchDocument,onOpenIntegratedCircuit:t.openIntegratedCircuit},null,8,["store","onSwitch","onOpenIntegratedCircuit"]))])),_:2},[t.isMobile?void 0:{name:"tabs",fn:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.documents,((e,o)=>((0,x.wg)(),(0,x.j4)(c,{key:o,label:e.displayName,active:t.activeDocumentId===o,dirty:e.store().isDirty,onActivate:e=>t.activateDocument(o.toString()),onClose:e=>t.closeDocument(o.toString())},null,8,["label","active","dirty","onActivate","onClose"])))),128))]))}]),1024)])),bottom:(0,x.w5)((()=>[((0,x.wg)(),(0,x.j4)(d,{key:t.activeDocumentId,store:t.activeDocument.store},null,8,["store"])),t.isMobile?(0,x.kq)("",!0):((0,x.wg)(),(0,x.j4)(p,{key:t.activeDocumentId,store:t.activeDocument.store,"is-fullscreen":t.isFullscreen,onFullscreen:t.toggleFullscreen},null,8,["store","is-fullscreen","onFullscreen"]))])),_:1})):((0,x.wg)(),(0,x.iD)("div",P," no documents open "+(0,S.zw)(t.isDropping),1))],64)}var O=o(2262);function _(t,e,o,n,i,s){const r=(0,x.up)("item"),a=(0,x.up)("connection"),c=(0,x.up)("group"),l=(0,x.up)("editor");return(0,x.wg)(),(0,x.j4)(l,{ref:"editor",zoom:t.store.zoomLevel,"grid-size":t.gridSize,tabindex:0,offset:{x:t.store.canvas.left,y:t.store.canvas.top},width:t.store.canvas.right-t.store.canvas.left,height:t.store.canvas.bottom-t.store.canvas.top,onPan:t.store.panTo,onDeselect:t.store.deselectAll,onSelection:t.store.createSelection,onZoom:t.store.setZoom,onContextmenu:t.onContextMenu,onResize:t.store.setViewerSize},{default:(0,x.w5)((()=>[(0,x._)("div",{tabindex:0,onFocus:e[0]||(e[0]=e=>t.store.recycleSelection(!1))},null,32),((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.store.baseItems,(e=>((0,x.wg)(),(0,x.iD)(x.HY,null,["type"in e?((0,x.wg)(),(0,x.j4)(r,{tabindex:0,store:t.storeDefinition,id:e.id,key:e.id,"is-selected":e.isSelected,flash:t.store.isDebugging&&t.store.isCircuitEvaluated,"z-index":e.zIndex+1e3,onContextmenu:t.onContextMenu,onOpenIntegratedCircuit:o=>t.$emit("openIntegratedCircuit",e)},null,8,["store","id","is-selected","flash","z-index","onContextmenu","onOpenIntegratedCircuit"])):((0,x.wg)(),(0,x.j4)(a,{tabindex:0,store:t.storeDefinition,id:e.id,key:`c${e.id}`,"is-selected":e.isSelected,"is-preview":t.store.connectionPreviewId===e.id,flash:t.store.isDebugging&&t.store.isCircuitEvaluated,"z-index":e.zIndex,onContextmenu:t.onContextMenu},null,8,["store","id","is-selected","is-preview","flash","z-index","onContextmenu"]))],64)))),256)),(0,x._)("div",{tabindex:0,onFocus:e[1]||(e[1]=e=>t.store.recycleSelection(!0))},null,32),((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.store.groups,(e=>((0,x.wg)(),(0,x.j4)(c,{key:e.id,id:e.id,"bounding-box":e.boundingBox,"is-selected":e.isSelected,"z-index":t.store.zIndex,zoom:t.store.zoom},null,8,["id","bounding-box","is-selected","z-index","zoom"])))),128))])),_:1},8,["zoom","grid-size","offset","width","height","onPan","onDeselect","onSelection","onZoom","onContextmenu","onResize"])}function Z(t,e,o,n,i,s){const r=(0,x.up)("wire"),a=(0,x.up)("draggable");return(0,x.wg)(),(0,x.j4)(a,{style:(0,S.j5)({zIndex:t.zIndex}),position:t.position,"is-selected":t.isSelected,"allow-touch-drag":null!==t.freeportId,onTouchhold:t.onDragStart,onDrag:t.onDrag,onDragEnd:t.onDragEnd,onSelect:e[0]||(e[0]=e=>t.selectItem(t.id,e)),onDeselect:e[1]||(e[1]=e=>t.deselectItem(t.id))},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{source:t.source,target:t.target,geometry:t.geometry,"is-selected":t.isSelected,"is-preview":t.isPreview,flash:t.flash,label:"TODO",ref:"root","data-test":"wire"},null,8,["source","target","geometry","is-selected","is-preview","flash"])])),_:1},8,["style","position","is-selected","allow-touch-drag","onTouchhold","onDrag","onDragEnd"])}var k,E=o(5934);function M(t,e,o,n,i,s){const r=(0,x.up)("resizable");return(0,x.wg)(),(0,x.j4)(r,{class:"draggable",ref:"draggable",style:(0,S.j5)(t.style),onMousedown:(0,I.iM)(t.onMouseDown,["left"]),onMouseup:t.onMouseUp,onTouchstart:t.onTouchStart,onTouchmove:t.onTouchMove,onTouchend:t.onTouchEnd,onTouchcancel:t.dragEnd,onFocus:t.onFocus},{default:(0,x.w5)((()=>[(0,x.WI)(t.$slots,"default")])),_:3},8,["style","onMousedown","onMouseup","onTouchstart","onTouchmove","onTouchend","onTouchcancel","onFocus"])}(function(t){t[t["Outer"]=0]="Outer",t[t["Inner"]=1]="Inner",t[t["Radial"]=2]="Radial",t[t["Grid"]=3]="Grid",t[t["None"]=4]="None"})(k||(k={}));var B=k;function z(t,e){return Math.round(t/e)*e}function N(t,e,o){return Math.hypot(t.x-e.x+t.y-e.y)<=o}function F(t,e){return{x:z(t.left,e)-t.left,y:z(t.top,e)-t.top}}function j(t,e,o){for(let n=0;n<t.length;n++){const i=t[n];if(N({x:i.left,y:i.top},{x:e.left,y:e.top},o))return{x:i.left-e.left,y:i.top-e.top}}return{x:0,y:0}}function T(t,e,o){const n={x:0,y:0};for(let i=0;i<t.length;i++){const s=t[i],r=Math.abs(s.top-e.bottom)<=o,a=Math.abs(s.bottom-e.top)<=o,c=Math.abs(s.left-e.right)<=o,l=Math.abs(s.right-e.left)<=o;(e.left<=s.right&&e.left>=s.left||e.right>=s.left&&e.right<=s.right||e.left<=s.left&&e.right>=s.right)&&(r&&(n.y=s.top-e.bottom),a&&(n.y=s.bottom-e.top)),(e.top<=s.bottom&&e.top>=s.top||e.bottom>=s.top&&e.bottom<=s.bottom||e.top<=s.top&&e.bottom>=s.bottom)&&(c&&(n.x=s.left-e.right),l&&(n.x=s.right-e.left))}return n}function L(t,e,o,n){switch(o){case B.Radial:return j(t,e,n);case B.Grid:return F(e,n);case B.Outer:default:return T(t,e,n)}}function $(t,e,o,n){const i=(t,e,o)=>(o.y-t.y)*(e.x-t.x)>(e.y-t.y)*(o.x-t.x);return i(t,o,n)!==i(e,o,n)&&i(t,e,o)!==i(t,e,n)}function W(t,e,o){const n={x:o.left,y:o.top},i={x:o.right,y:o.top},s={x:o.right,y:o.bottom},r={x:o.left,y:o.bottom};return $(t,e,n,i)||$(t,e,i,s)||$(t,e,s,r)||$(t,e,r,n)}function R(t,e){return!(t.left>=e.right||e.left>=t.right)&&!(t.top>=e.bottom||e.top>=t.bottom)}function A(t,e){return{left:t.left*e,top:t.top*e,bottom:t.bottom*e,right:t.right*e}}function V(t){return t.left!==t.right||t.top!==t.bottom}function U(t){return[{left:t.x,right:t.x,top:-1/0,bottom:1/0},{left:-1/0,right:1/0,top:t.y,bottom:t.y}]}function q(t){return{left:t.x,top:t.y,right:t.x,bottom:t.y}}function H(t,e,o,n){if(e%2===0)return{left:t.x,top:t.y,bottom:n+t.y,right:o+t.x};const i=t.x+o/2,s=t.y+n/2;return{left:i-n/2,top:s-o/2,right:i+n/2,bottom:s+o/2}}function K(t){return t.reduce(((t,e)=>({left:Math.min(t.left,e.left),top:Math.min(t.top,e.top),right:Math.max(t.right,e.right),bottom:Math.max(t.bottom,e.bottom)})),{left:1/0,top:1/0,right:0,bottom:0})}function G(t){const e=t.right-t.left,o=t.bottom-t.top;return{x:e/2,y:o/2}}function Y(t,e,o){const n=G(t),i=e.right-e.left,s=e.bottom-e.top;return{x:z(n.x-i/2,o),y:z(n.y-s/2,o)}}function X(t,...e){const o=Math[t](...e.map((({x:t})=>t))),n=Math[t](...e.map((({y:t})=>t)));return{x:o,y:n}}var J={isInNeighborhood:N,getRadialSnapOffset:j,getOuterSnapOffset:T,getGridSnapPosition:F,isLineIntersectingRectangle:W,scaleBoundingBox:A,isOneOrTwoDimensional:V,getLinearBoundaries:U,getPointBoundary:q,hasIntersection:R,getBoundingBox:H,getGroupBoundingBox:K,getBoundingBoxMidpoint:G,getCenteredScreenPoint:Y,getSnapOffset:L,getExtremePoint:X};const Q={ref:"resizable"};function tt(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",Q,[(0,x.WI)(t.$slots,"default")],512)}var et=o(1033),ot=(0,x.aZ)({name:"Resizable",emits:{resize:t=>!0},setup(t,{emit:e}){const o=(0,O.iH)();function n([t]){e("resize",t.target.getBoundingClientRect())}const i=new et.Z(n);return(0,x.bv)((()=>{o.value&&i.observe(o.value)})),{onSizeChanged:n,resizable:o}}}),nt=o(3744);const it=(0,nt.Z)(ot,[["render",tt]]);var st=it,rt=(0,x.aZ)({name:"Draggable",components:{Resizable:st},props:{position:{type:Object,default:()=>({x:0,y:0})},isSelected:{type:Boolean,default:!1},isMobile:{type:Boolean,default:!1},allowTouchDrag:{type:Boolean,default:!0}},emits:{dragStart:(t,e)=>!0,drag:(t,e)=>!0,dragEnd:(t,e)=>!0,select:t=>!0,deselect:()=>!0,touchhold:t=>!0},setup(t,{emit:e}){const o=(0,x.Fl)((()=>({left:`${t.position.x}px`,top:`${t.position.y}px`}))),n=(0,O.iH)();let i=0,s=!1,r=!1,a=!1,c={x:0,y:0},l={x:0,y:0},u={x:0,y:0};function d(){setTimeout((()=>{t.isSelected||e("select",!1)}))}function p({clientX:t,clientY:o}){s&&(l.x===t&&l.y===o||(l={x:t,y:o},e(a?"drag":"dragStart",l,u),a=!0,r=!0))}function h({clientX:t,clientY:e}){if(!n.value)return;const{x:o,y:i,width:r,height:c}=n.value.$el.getBoundingClientRect();l={x:t,y:e},u={x:t-(o+r/2),y:e-(i+c/2)},s=!0,a=!1}function m(){s&&(s=!1,r&&e("dragEnd",l,u))}function f(t){h(t)}function g(t){a||e("select",t.ctrlKey)}function v(t){r=!1,c={x:t.touches[0].clientX,y:t.touches[0].clientY},i=window.setTimeout((()=>{e("touchhold",t)}),500)}function y(e){const o={x:e.touches[0].clientX,y:e.touches[0].clientY};J.isInNeighborhood(c,o,5)||1!==e.touches.length||(r=!0,clearTimeout(i)),t.allowTouchDrag&&(e.stopPropagation(),e.preventDefault(),s||h(e.touches[0])),s&&p(e.touches[0])}function b(){clearTimeout(i),s?m():r||(t.isSelected?e("deselect"):e("select",!0))}return(0,x.bv)((()=>{window.addEventListener("mousemove",p),window.addEventListener("mouseup",m)})),(0,x.Jd)((()=>{window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",m)})),(0,x.m0)((()=>{t.isSelected&&n.value?.$el.focus()})),{style:o,draggable:n,onMouseDown:f,onMouseUp:g,onTouchStart:v,onTouchMove:y,onTouchEnd:b,dragEnd:m,onFocus:d}}});const at=(0,nt.Z)(rt,[["render",M]]);var ct=at;const lt=["width","height"],ut=["transform","d"],dt=["transform","d"],pt=["transform","d"],ht=["transform","d"];function mt(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("svg",{class:(0,S.C_)(["wire",{"wire--selected":t.isSelected,"wire--flash":t.flash,"wire--preview":t.isPreview}]),width:t.geometry.width,height:t.geometry.height},[(0,x._)("title",null,(0,S.zw)(t.label),1),(0,x._)("path",{class:"wire__outline",fill:"none",transform:`translate(${Math.abs(t.geometry.minX)}, ${Math.abs(t.geometry.minY)})`,d:t.geometry.path},null,8,ut),(0,x._)("path",{class:(0,S.C_)(["wire__display",{"wire__display--on":1===t.source.value,"wire__display--off":-1===t.source.value}]),fill:"none",transform:`translate(${Math.abs(t.geometry.minX)}, ${Math.abs(t.geometry.minY)})`,d:t.geometry.path},null,10,dt),t.isAnimated?((0,x.wg)(),(0,x.iD)("path",{key:0,class:"wire__animation",fill:"none",transform:`translate(${Math.abs(t.geometry.minX)}, ${Math.abs(t.geometry.minY)})`,d:t.geometry.path},null,8,pt)):(0,x.kq)("",!0),(0,x._)("path",{class:"wire__clickable",fill:"none",transform:`translate(${Math.abs(t.geometry.minX)}, ${Math.abs(t.geometry.minY)})`,d:t.geometry.path},null,8,ht)],10,lt)}var ft=(0,x.aZ)({name:"Wire",props:{isAnimated:{type:Boolean,default:!1},source:{type:Object,required:!0},target:{type:Object,required:!0},label:{type:String,default:""},isPreview:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},flash:{type:Boolean,default:!1},geometry:{type:Object,required:!0}}});const gt=(0,nt.Z)(ft,[["render",mt]]);var vt,yt=gt;(function(t){t[t["Left"]=0]="Left",t[t["Top"]=1]="Top",t[t["Right"]=2]="Right",t[t["Bottom"]=3]="Bottom"})(vt||(vt={}));var bt=vt;function wt(t,e=0){return(t+e%4+4)%4}const It=15;function xt(t,e){const o=t.position,n=e.position,{start:i,end:s}=Dt(o,n);if(i.x===s.x||i.y===s.y||s.x<=1&&i.x<=1||s.y<=1&&i.y<=1)return St(i,s);const r=Pt(t,o,n),a=Pt(e,o,n);return Ot(r,a,i,s)}function St(t,e){return{path:`M ${t.x},${t.y} L ${e.x},${e.y}`,width:Math.abs(t.x-e.x)+It,height:Math.abs(t.y-e.y)+It,minX:-It/2,minY:-It/2}}function Ct(t,e,o){switch(t){case bt.Left:return e.y>o.y?bt.Right:bt.Left;case bt.Top:return e.x<o.x?bt.Bottom:bt.Top;case bt.Right:return e.y>o.y?bt.Left:bt.Right;case bt.Bottom:return e.x<o.x?bt.Top:bt.Bottom;default:return Ct(wt(t),e,o)}}function Pt(t,e,o){let n=wt(t.orientation+t.rotation-1);return t.isFreeport&&(n=Ct(n,e,o),t.rotation%4!==1&&t.rotation%4!==2||(n=wt(n-2))),n}function Dt(t,e){return t.x<=e.x?t.y<=e.y?{start:{x:0,y:0},end:{x:Math.floor(e.x-t.x),y:Math.floor(e.y-t.y)}}:{start:{x:0,y:Math.floor(t.y-e.y)},end:{x:Math.floor(e.x-t.x),y:0}}:t.y<=e.y?{start:{x:Math.floor(t.x-e.x),y:0},end:{x:0,y:Math.floor(e.y-t.y)}}:{start:{x:Math.floor(t.x-e.x),y:Math.floor(t.y-e.y)},end:{x:0,y:0}}}function Ot(t,e,o,n){const i=o.x,s=o.y,r=n.x,a=n.y,c=Math.max(Math.abs(i-r)/2,10),l=Math.max(Math.abs(s-a)/2,10),u=[i,i+c,i,i-c][t].toFixed(3),d=[s-l,s,s+l,s][t].toFixed(3),p=[r,r+c,r,r-c][e].toFixed(3),h=[a-l,a,a+l,a][e].toFixed(3),m=["M",i.toFixed(3),s.toFixed(3),"C",u,d,p,h,r.toFixed(3),a.toFixed(3)].join(" "),f=(...t)=>t.map((t=>parseInt(t.toString(),10))),g=Math.min(...f(i,u,p,r))-It/2,v=Math.max(...f(i,u,p,r))+It/2,y=Math.min(...f(s,d,h,a))-It/2,b=Math.max(...f(s,d,h,a))+It/2,w=v-g+It,I=b-y+It;return{width:w,height:I,path:m,minX:g,minY:y}}var _t=(0,x.aZ)({name:"Connection",components:{Draggable:ct,Wire:yt},props:{isSelected:{type:Boolean,default:!1},id:{type:String,required:!0},zIndex:{type:Number,default:0},isPreview:{type:Boolean,default:!1},flash:{type:Boolean,default:!1},store:{type:Function,required:!0}},setup(t){const e=t.store(),o=(0,O.iH)(e.connections[t.id]),n=(0,O.iH)(),i=(0,x.Fl)((()=>e.ports[o.value.source])),s=(0,x.Fl)((()=>e.ports[o.value.target])),r=(0,x.Fl)((()=>J.getExtremePoint("min",i.value.position,s.value.position))),a=(0,x.Fl)((()=>xt(i.value,s.value))),c=(0,x.Fl)((()=>({y:r.value.y+a.value.minY,x:r.value.x+a.value.minX}))),l=(0,O.iH)(null);function u({touches:t}){d({x:t[0].clientX,y:t[0].clientY})}function d(t){n.value?.$el&&null===o.value.groupId&&(n.value.$el.style.opacity="0",l.value=(0,E.Z)(),navigator.vibrate(50),e.createFreeport({itemId:l.value,inputPortId:(0,E.Z)(),outputPortId:(0,E.Z)(),connectionChainId:o.value.connectionChainId,sourceId:i.value.id,targetId:s.value.id}),e.setSnapBoundaries(l.value),e.dragItem(l.value,t))}async function p(t){l.value?e.dragItem(l.value,t):d(t)}function h(){console.log("WILL DESTROY 1"),l&&(console.log("WILL DESTROY"),e.destroyConnection({source:o.value.source,target:o.value.target})),l.value=null}return{root:n,geometry:a,position:c,onDragStart:u,onDrag:p,onDragEnd:h,source:i,target:s,freeportId:l,selectItem:e.selectItem,deselectItem:e.deselectItem}}});const Zt=(0,nt.Z)(_t,[["render",Z]]);var kt=Zt;function Et(t,e,o,n,i,s){const r=(0,x.up)("properties"),a=(0,x.up)("port-item"),c=(0,x.up)("circuit-component"),l=(0,x.up)("draggable");return(0,x.wg)(),(0,x.j4)(l,{style:(0,S.j5)({transform:`rotate(${90*t.item.rotation}deg)`,outline:"none",pointerEvents:"none",zIndex:t.zIndex}),position:t.item.position,"is-selected":t.isSelected,"allow-touch-drag":t.isSelected,onResize:t.onResize,onKeydown:(0,I.D2)(t.onEscapeKey,["esc"]),onDrag:t.onDrag,onDragStart:t.onDragStart,onDragEnd:t.store.commitCachedState,onSelect:e[1]||(e[1]=e=>t.store.selectItem(t.id,e)),onDeselect:e[2]||(e[2]=e=>t.store.deselectItem(t.id)),ref:"itemRef","data-test":"item"},{default:(0,x.w5)((()=>[t.isPropertiesEnabled?((0,x.wg)(),(0,x.j4)(r,{key:0,tabindex:0,properties:t.item.properties,id:t.id,onUpdate:t.store.setProperties,onFocus:e[0]||(e[0]=e=>t.store.setActivePortId(null)),"aria-label":"Properties dialog","data-test":"properties"},null,8,["properties","id","onUpdate"])):(0,x.kq)("",!0),(0,x.Wm)(c,{type:t.item.type,subtype:t.item.subtype,ports:t.ports,properties:t.item.properties,"is-selected":t.isSelected,flash:t.flash,onChange:t.store.setPortValue},(0,x.Nv)({_:2},[(0,x.Ko)(4,((e,o)=>({name:o,fn:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.ports.filter((t=>t.orientation===o)),(e=>((0,x.wg)(),(0,x.j4)(a,{tabindex:0,store:t.$props.store,id:e.id,key:e.id,type:e.type,"is-freeport":t.item.type===t.ItemType.Freeport,position:e.position,orientation:e.orientation+t.item.rotation,"connected-port-ids":e.connectedPortIds,hue:e.isMonitored?e.hue:0,rotation:t.item.rotation,onKeypress:(0,I.D2)(t.onEscapeKey,["esc"]),onFocus:o=>t.store.setActivePortId(e.id),onBlur:o=>t.onPortBlur(e.id),onDeselect:t.focus,"data-test":"port-item"},null,8,["store","id","type","is-freeport","position","orientation","connected-port-ids","hue","rotation","onKeypress","onFocus","onBlur","onDeselect"])))),128))]))})))]),1032,["type","subtype","ports","properties","is-selected","flash","onChange"])])),_:1},8,["style","position","is-selected","allow-touch-drag","onResize","onKeydown","onDrag","onDragStart","onDragEnd"])}function Mt(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,S.C_)(["circuit-component",{"circuit-component--selected":t.isSelected,"circuit-component--flash":t.flash}])},[((0,x.wg)(),(0,x.j4)((0,x.LL)(t.type),(0,x.dG)(t.$props,{onChange:t.onChange}),null,16,["onChange"])),((0,x.wg)(),(0,x.iD)(x.HY,null,(0,x.Ko)(["left","top","right","bottom"],((e,o)=>(0,x._)("div",{key:o,class:(0,S.C_)(`circuit-component__ports circuit-component__ports--${e}`)},[(0,x.WI)(t.$slots,o)],2))),64))],2)}const Bt={class:"freeport"};function zt(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",Bt)}var Nt=(0,x.aZ)({name:"Freeport"});const Ft=(0,nt.Z)(Nt,[["render",zt]]);var jt=Ft;const Tt={class:"input-node"},Lt={key:0},$t={key:1},Wt={key:2};function Rt(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",Tt,[(0,x._)("button",{type:"button",class:(0,S.C_)(["input-node__flipper",{"input-node__flipper--on":1===t.model,"input-node__flipper--off":-1===t.model,"input-node__flipper--high-z":0===t.model}]),tabindex:0,onMousedown:e[0]||(e[0]=(0,I.iM)(((...e)=>t.onInput&&t.onInput(...e)),["stop"])),onTouchstart:e[1]||(e[1]=(0,I.iM)(((...e)=>t.onInput&&t.onInput(...e)),["stop"]))},[1===t.model?((0,x.wg)(),(0,x.iD)("span",Lt,"ON")):-1===t.model?((0,x.wg)(),(0,x.iD)("span",$t,"OFF")):((0,x.wg)(),(0,x.iD)("span",Wt,"?"))],34)])}var At=(0,x.aZ)({name:"InputNode",props:{ports:{type:Array,default:()=>[]}},emits:{change:t=>!0},setup(t,{emit:e}){const o=(0,O.iH)(0);function n(n){n.preventDefault(),n.stopPropagation(),o.value=1===o.value?-1:1,e("change",{id:t.ports[0].id,value:o.value})}return(0,x.m0)((()=>{o.value=t.ports[0]?.value||0})),{model:o,onInput:n}}});const Vt=(0,nt.Z)(At,[["render",Rt]]);var Ut=Vt;const qt={class:"integrated-circuit"},Ht={class:"integrated-circuit__wires"},Kt={class:"integrated-circuit__wires-divider"},Gt={class:"integrated-circuit__wires-divider"},Yt=(0,x._)("div",{class:"integrated-circuit__box"},[(0,x._)("div",{class:"integrated-circuit__box-inner"}," R-S Flip-Flop ")],-1);function Xt(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",qt,[(0,x._)("div",Ht,[(0,x._)("div",Kt,[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.ports.filter((t=>0===t.orientation)),(t=>((0,x.wg)(),(0,x.iD)("div",{key:t.id,class:"integrated-circuit__wire"})))),128))]),(0,x._)("div",Gt,[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.ports.filter((t=>2===t.orientation)),(t=>((0,x.wg)(),(0,x.iD)("div",{key:t.id,class:"integrated-circuit__wire"})))),128))])]),Yt])}var Jt=(0,x.aZ)({name:"IntegratedCircuit",props:{ports:{type:Array,default:()=>[]}}});const Qt=(0,nt.Z)(Jt,[["render",Xt]]);var te=Qt;const ee=(0,x._)("div",{class:"logic-gate__wire"},null,-1),oe={key:0,class:"logic-gate__wires--multiwire"},ne=(0,x._)("div",{class:"logic-gate__wires-divider"},[(0,x._)("div",{class:"logic-gate__wire"})],-1);function ie(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{style:(0,S.j5)({height:25*t.inputCount+"px"}),class:"logic-gate"},[(0,x._)("div",{style:(0,S.j5)({width:(t.inputCount,"100%")}),class:"logic-gate__wires"},[(0,x._)("div",{class:(0,S.C_)([{"logic-gate__wires-divider--multiwire":t.inputCount>2},"logic-gate__wires-divider"])},[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.inputCount-1,(t=>((0,x.wg)(),(0,x.iD)("div",{key:t,class:"logic-gate__wire"})))),128)),ee],2),t.inputCount>2?((0,x.wg)(),(0,x.iD)("div",oe)):(0,x.kq)("",!0),ne],4),((0,x.wg)(),(0,x.j4)((0,x.LL)(t.subtype),{class:"logic-gate__component"}))],4)}const se={class:"and",width:"100",height:"50",viewBox:"0 -1 100 50"},re=(0,x._)("path",{transform:"translate(20, 0)",class:"and__element",d:"M 0 0 V 48 H 24 C 36 48 48 36 48 24 C 48 12 36 0 24 0 Z"},null,-1),ae={key:0,cx:"73",cy:"24",r:"5",class:"and__negation"};function ce(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("svg",se,[re,t.isNegated?((0,x.wg)(),(0,x.iD)("circle",ae)):(0,x.kq)("",!0)])}var le=(0,x.aZ)({name:"And",props:{isNegated:{type:Boolean,default:!1}}});const ue=(0,nt.Z)(le,[["render",ce]]);var de=ue;const pe={width:"100",height:"50",viewBox:"0 -1 100 50",class:"or"},he=(0,x._)("path",{transform:"translate(10, 0)",fill:"#fff",d:"M 0 0 C 12 12 12 36 0 48 H 0 H 24 C 48 48 60 36 72 24 C 60 12 48 0 24 0 Z",class:"or__element"},null,-1),me={key:0,fill:"none",d:"M 0 0 C 12 12 12 36 0 48",class:"or__tail"},fe={key:1,cx:"88",cy:"24",r:"5",class:"or__negation"};function ge(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("svg",pe,[he,t.isXor?((0,x.wg)(),(0,x.iD)("path",me)):(0,x.kq)("",!0),t.isNegated?((0,x.wg)(),(0,x.iD)("circle",fe)):(0,x.kq)("",!0)])}var ve=(0,x.aZ)({name:"Or",props:{isNegated:{type:Boolean,default:!1},isXor:{type:Boolean,default:!1}}});const ye=(0,nt.Z)(ve,[["render",ge]]);var be=ye;function we(t,e,o,n,i,s){const r=(0,x.up)("or");return(0,x.wg)(),(0,x.j4)(r,{"is-negated":!0})}var Ie=(0,x.aZ)({name:"Nor",components:{Or:be}});const xe=(0,nt.Z)(Ie,[["render",we]]);var Se=xe;function Ce(t,e,o,n,i,s){const r=(0,x.up)("and");return(0,x.wg)(),(0,x.j4)(r,{"is-negated":!0})}var Pe=(0,x.aZ)({name:"Nand",components:{And:de}});const De=(0,nt.Z)(Pe,[["render",Ce]]);var Oe=De;function _e(t,e,o,n,i,s){const r=(0,x.up)("or");return(0,x.wg)(),(0,x.j4)(r,{"is-negated":!0,"is-xor":!0})}var Ze=(0,x.aZ)({name:"Xnor",components:{Or:be}});const ke=(0,nt.Z)(Ze,[["render",_e]]);var Ee=ke;function Me(t,e,o,n,i,s){const r=(0,x.up)("or");return(0,x.wg)(),(0,x.j4)(r,{"is-xor":!0})}var Be=(0,x.aZ)({name:"Xor",components:{Or:be}});const ze=(0,nt.Z)(Be,[["render",Me]]);var Ne=ze,Fe=(0,x.aZ)({name:"LogicGate",components:{And:de,Or:be,Nor:Se,Nand:Oe,Xnor:Ee,Xor:Ne},props:{properties:{type:Object,default:()=>({})},subtype:{subtype:String,required:!0}},setup(t){const e=(0,x.Fl)((()=>t.properties.inputCount?.value||2));return{inputCount:e}}});const je=(0,nt.Z)(Fe,[["render",ie]]);var Te=je;function Le(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,S.C_)(["output-node",{"output-node--on":1===t.value,"output-node--high-z":0===t.value}])},null,2)}var $e=(0,x.aZ)({name:"OutputNode",props:{ports:{type:Array,default:()=>[]}},setup(t){const e=(0,x.Fl)((()=>t.ports[0]?.value||0));return{value:e}}});const We=(0,nt.Z)($e,[["render",Le]]);var Re=We;const Ae={Freeport:jt,InputNode:Ut,IntegratedCircuit:te,LogicGate:Te,OutputNode:Re};var Ve=(0,x.aZ)({name:"CircuitComponent",components:Ae,emits:{change:t=>!0},props:{isSelected:{type:Boolean,default:!1},flash:{type:Boolean,default:!1},type:{type:String,required:!0},subtype:{type:String,required:!0},ports:{type:Array,default:()=>[]},properties:{type:Object,default:()=>({})}},setup(t,{emit:e}){return{onChange(t){e("change",t)}}}});const Ue=(0,nt.Z)(Ve,[["render",Mt]]);var qe=Ue;const He=["aria-hidden"],Ke={class:"properties__heading",role:"title"},Ge=(0,x.Uk)(" Properties "),Ye=["for"],Xe=["onUpdate:modelValue","id"],Je=["value"],Qe=["onUpdate:modelValue","id"],to=["onUpdate:modelValue","min","max","type","id"];function eo(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{onKeydown:[e[1]||(e[1]=(0,I.D2)((e=>t.isOpen=!0),["space"])),e[2]||(e[2]=(0,I.D2)(((...e)=>t.onKeyDown&&t.onKeyDown(...e)),["esc"]))],onClick:e[3]||(e[3]=e=>t.isOpen=!0),onContextmenu:e[4]||(e[4]=(...e)=>t.stopPropagation&&t.stopPropagation(...e)),onMousedown:e[5]||(e[5]=(...e)=>t.stopPropagation&&t.stopPropagation(...e)),onMouseup:e[6]||(e[6]=(...e)=>t.stopPropagation&&t.stopPropagation(...e)),class:"properties"},[t.isOpen?((0,x.wg)(),(0,x.iD)("div",{key:0,class:"properties__dialog","aria-hidden":!t.isOpen},[(0,x._)("div",Ke,[Ge,(0,x._)("span",{onClick:e[0]||(e[0]=e=>t.isOpen=!1),class:"properties__close"}," × ")]),((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.model,((e,o)=>((0,x.wg)(),(0,x.iD)("div",{key:o,class:"properties__entry"},[(0,x._)("label",{for:`${t.id}_${o}`},(0,S.zw)(e.label),9,Ye),e.options?(0,x.wy)(((0,x.wg)(),(0,x.iD)("select",{key:0,"onUpdate:modelValue":t=>e.value=t,id:`${t.id}_${o}`,class:"properties__input"},[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(e.options,((t,e)=>((0,x.wg)(),(0,x.iD)("option",{key:e,value:t},(0,S.zw)(e),9,Je)))),128))],8,Xe)),[[I.bM,e.value]]):"boolean"===e.type?(0,x.wy)(((0,x.wg)(),(0,x.iD)("input",{key:1,"onUpdate:modelValue":t=>e.value=t,id:`${t.id}_${o}`,type:"checkbox",class:"properties__input"},null,8,Qe)),[[I.e8,e.value]]):(0,x.wy)(((0,x.wg)(),(0,x.iD)("input",{key:2,"onUpdate:modelValue":t=>e.value=t,min:e.min,max:e.max,type:e.type,id:`${t.id}_${o}`,class:"properties__input"},null,8,to)),[[I.YZ,e.value]])])))),128))],8,He)):(0,x.kq)("",!0)],32)}var oo=o(3465),no=o.n(oo),io=(0,x.aZ)({name:"Properties",props:{properties:{type:Object,default:()=>({})},id:{type:String,default:""}},emits:["update"],data(){return{model:{},isOpen:!1}},watch:{properties:{handler(t){this.model=no()(t)},deep:!0,immediate:!0},model:{handler(t){this.$emit("update",{id:this.id,properties:t})},deep:!0}},methods:{onKeyDown(t){this.isOpen=!1,t.preventDefault(),this.$el.focus()},stopPropagation(t){t.stopPropagation()}}});const so=(0,nt.Z)(io,[["render",eo]]);var ro=so;o(6699);function ao(t,e,o,n,i,s){const r=(0,x.up)("port-handle"),a=(0,x.up)("draggable"),c=(0,x.up)("port-pivot");return(0,x.wg)(),(0,x.j4)(c,{rotation:t.rotation,onBlur:t.onBlur,onKeydown:[(0,I.D2)(t.onEscapeKey,["esc"]),e[1]||(e[1]=(0,I.D2)((e=>t.store.cycleConnectionPreviews(t.id)),["space"])),(0,I.D2)(t.store.commitPreviewedConnection,["enter"])],onContextmenu:e[2]||(e[2]=e=>t.store.setActivePortId(t.id))},{default:(0,x.w5)((()=>[t.isFreeport?((0,x.wg)(),(0,x.j4)(r,{key:1,type:t.type,hue:t.hue,active:t.store.activePortId===t.id||t.store.connectablePortIds.includes(t.id)},null,8,["type","hue","active"])):((0,x.wg)(),(0,x.j4)(a,{key:0,onDragStart:t.onDragStart,onDrag:t.onDrag,onDragEnd:t.onDragEnd,onTouchhold:t.onTouchHold,onDblclick:e[0]||(e[0]=e=>t.store.togglePortMonitoring(t.id)),tabindex:-1},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{type:t.type,hue:t.hue,active:t.store.activePortId===t.id||t.store.connectablePortIds.includes(t.id),"touch-friendly":""},null,8,["type","hue","active"])])),_:1},8,["onDragStart","onDrag","onDragEnd","onTouchhold"]))])),_:1},8,["rotation","onBlur","onKeydown"])}const co={class:"port-handle"};function lo(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",co,[(0,x._)("div",{class:(0,S.C_)(["port-handle__display",{"port-handle__display--active":t.active}])},[(0,x._)("div",{class:"port-handle__hue",style:(0,S.j5)({backgroundColor:t.backgroundColor})},null,4)],2)])}var uo=(0,x.aZ)({name:"PortHandle",props:{active:{type:Boolean,default:!1},hue:{type:Number,default:0}},setup(t){const e=(0,x.Fl)((()=>t.hue>0?`hsla(${t.hue}, var(--lightness), var(--saturation), 0.8)`:"var(--color-bg-secondary)"));return{backgroundColor:e}}});const po=(0,nt.Z)(uo,[["render",lo]]);var ho=po;function mo(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:"port-pivot",style:(0,S.j5)({transform:`rotate(-${90*t.rotation}deg)`}),onKeydown:e[0]||(e[0]=(0,I.D2)((e=>t.$emit("connect")),["space"]))},[(0,x.WI)(t.$slots,"default")],36)}var fo=(0,x.aZ)({name:"PortPivot",props:{rotation:{type:Number,default:0}}});const go=(0,nt.Z)(fo,[["render",mo]]);var vo,yo=go;(function(t){t[t["Output"]=0]="Output",t[t["Input"]=1]="Input"})(vo||(vo={}));var bo=vo,wo=(0,x.aZ)({name:"PortItem",components:{PortHandle:ho,PortPivot:yo,Draggable:ct},props:{id:{type:String,default:""},rotation:{type:Number,default:0},position:{type:Object,default:()=>({x:0,y:0})},isFreeport:{type:Boolean,default:!1},type:{type:Number,default:0},orientation:{type:Number,default:0},hue:{type:Number,default:0},connectedPortIds:{type:Object,default:[]},store:{type:Function,required:!0}},setup(t,{emit:e}){const o=t.store(),n=B.Radial;let i=null,s="",r=!1;function a(t){t.preventDefault(),t.stopPropagation(),e("deselect",t)}function c(){o.unsetConnectionPreview(),o.cachedState=null}function l(){i={itemId:(0,E.Z)()},s=(0,E.Z)(),r=!1,t.type===bo.Input?(i.outputPortId=s,i.targetId=t.id):(i.inputPortId=s,i.sourceId=t.id)}function u({x:e,y:n}){null!==i&&(r||(o.createFreeport(i,!1),o.setConnectablePortIds({portId:t.id,isDragging:!0}),o.setSnapBoundaries(s)),o.dragItem(i.itemId,{x:e,y:n},B.Radial))}function d(){null!==i&&(i.inputPortId?o.connectFreeport({portId:i.inputPortId,sourceId:t.id}):i.outputPortId&&o.connectFreeport({portId:i.outputPortId,targetId:t.id}))}function p(){navigator.vibrate(100),o.togglePortMonitoring(t.id)}return{store:o,snapMode:n,onDragStart:l,onDrag:u,onDragEnd:d,onEscapeKey:a,onBlur:c,onTouchHold:p,PortType:bo}}});const Io=(0,nt.Z)(wo,[["render",ao]]);var xo,So=Io;(function(t){t["Buffer"]="Buffer",t["CircuitNode"]="CircuitNode",t["Freeport"]="Freeport",t["InputNode"]="InputNode",t["IntegratedCircuit"]="IntegratedCircuit",t["LogicGate"]="LogicGate",t["OutputNode"]="OutputNode"})(xo||(xo={}));var Co,Po=xo;(function(t){t["None"]="None",t["Switch"]="Switch",t["PushButton"]="PushButton",t["Clock"]="Clock",t["Lightbulb"]="Lightbulb",t["Buffer"]="Buffer",t["Not"]="Not",t["Tristate"]="Tristate",t["And"]="And",t["Or"]="Or",t["Nand"]="Nand",t["Nor"]="Nor",t["Xnor"]="Xnor",t["Xor"]="Xor"})(Co||(Co={}));var Do=Co,Oo=(0,x.aZ)({name:"Item",components:{CircuitComponent:qe,Draggable:ct,PortItem:So,Properties:ro},props:{zIndex:{type:Number,default:1},isSelected:{type:Boolean,default:!1},id:{type:String,required:!0},flash:{type:Boolean,default:!1},store:{type:Function,required:!0}},setup(t){const e=t.store(),o=(0,x.Fl)((()=>e.items[t.id])),n=(0,O.iH)(),i=(0,x.Fl)((()=>e.items[t.id].portIds.map((t=>e.ports[t])))),s=(0,x.Fl)((()=>t.isSelected&&1===e.selectedItemIds.length&&o.value.type!==Po.Freeport));function r(){n.value?.$el.focus()}function a(){e.cacheState(),e.setSnapBoundaries(t.id)}function c(n,i){e.dragItem(t.id,{x:n.x-i.x-o.value.width/2*e.zoomLevel,y:n.y-i.y-o.value.height/2*e.zoomLevel})}function l(t){document.activeElement===n.value?.$el?n.value.$el.blur():t.preventDefault()}function u(t){e.activePortId===t&&e.setActivePortId(null)}function d(o){e.setItemSize({id:t.id,rect:o})}return{item:o,itemRef:n,store:e,ports:i,isPropertiesEnabled:s,focus:r,onDrag:c,onDragStart:a,onEscapeKey:l,onResize:d,onPortBlur:u,ItemSubtype:Do,ItemType:Po}}});const _o=(0,nt.Z)(Oo,[["render",Et]]);var Zo=_o;function ko(t,e,o,n,i,s){const r=(0,x.up)("selector"),a=(0,x.up)("resizable");return(0,x.wg)(),(0,x.j4)(a,{onMousewheel:t.onMouseWheel,onMousedown:(0,I.iM)(t.onMouseDown,["right"]),onTouchstart:t.onTouchStart,onTouchmove:t.onTouchMove,onTouchend:t.onTouchEnd,onResize:e[0]||(e[0]=e=>t.$emit("resize",e)),class:"editor"},{default:(0,x.w5)((()=>[(0,x._)("div",{style:(0,S.j5)(t.style),class:"editor__grid"},[(0,x.Wm)(r,{zoom:t.zoom,onSelectionStart:t.onSelectionStart,onSelectionEnd:t.onSelectionEnd,ref:"selector"},null,8,["zoom","onSelectionStart","onSelectionEnd"]),(0,x.WI)(t.$slots,"default")],4)])),_:3},8,["onMousewheel","onMousedown","onTouchstart","onTouchmove","onTouchend"])}function Eo(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{onMousedown:e[0]||(e[0]=(0,I.iM)(((...e)=>t.onMouseDown&&t.onMouseDown(...e)),["left","self"])),class:"selector",ref:"selector"},[t.hasSelection?((0,x.wg)(),(0,x.iD)("div",{key:0,style:(0,S.j5)(t.style),class:"selector__selection"},null,4)):(0,x.kq)("",!0)],544)}var Mo=(0,x.aZ)({name:"Selector",emits:{selectionStart:t=>!0,selectionEnd:t=>!0},props:{zoom:{type:Number,default:1}},setup(t,{emit:e}){const o=(0,O.iH)({x:0,y:0}),n=(0,O.iH)({x:0,y:0}),i=(0,O.iH)(null),s=(0,O.iH)(!1),r=()=>({left:Math.min(o.value.x,n.value.x),top:Math.min(o.value.y,n.value.y),width:Math.abs(o.value.x-n.value.x),height:Math.abs(o.value.y-n.value.y)}),a=(0,x.Fl)((()=>{const t=r();return{left:`${t.left}px`,top:`${t.top}px`,width:`${t.width}px`,height:`${t.height}px`}}));function c(e){if(!i.value)return{x:0,y:0};const{top:o,left:n}=i.value.getBoundingClientRect(),s=(e.x-n)/t.zoom,r=(e.y-o)/t.zoom;return{x:s,y:r}}function l(){const{left:t,top:o,width:n,height:i}=r();e("selectionEnd",{left:t,top:o,bottom:i+o,right:t+n})}function u(t){const i=c(t);s.value=!0,o.value=i,n.value=i,e("selectionStart",t)}function d(t){s.value&&(n.value=c(t))}function p(){s.value&&(l(),s.value=!1,o.value.x=0,o.value.y=0,n.value.x=0,n.value.y=0)}return(0,x.bv)((()=>{window.addEventListener("mousemove",d),window.addEventListener("mouseup",p)})),(0,x.Jd)((()=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",p)})),{selector:i,hasSelection:s,style:a,onMouseDown:u}}});const Bo=(0,nt.Z)(Mo,[["render",Eo]]);var zo=Bo,No=(0,x.aZ)({name:"Editor",emits:{resize:t=>!0,pan:t=>!0,selection:t=>!0,deselect:()=>!0,zoom:t=>!0,contextmenu:t=>!0},components:{Selector:zo,Resizable:st},props:{zoom:{type:Number,default:1},gridSize:{type:Number,default:0},width:{type:Number,default:0},height:{type:Number,default:0},offset:{type:Object,default:()=>({x:0,y:0})}},setup(t,{emit:e}){let o={x:0,y:0},n={x:0,y:0},i={y:0,x:0},s=0,r=0,a=0,c=0,l=!1,u=0,d=1;const p=(0,O.iH)(null),h=(0,x.Fl)((()=>({backgroundSize:`${t.gridSize}px ${t.gridSize}px`,transform:`scale(${t.zoom})`,left:`${t.offset.x}px`,top:`${t.offset.y}px`,width:`${t.width}px`,height:`${t.height}px`})));function m({touches:t}){const e=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.hypot(e,o)}function f(e,c){l=!0,o={x:e-t.offset.x,y:c-t.offset.y},i={x:e,y:c},n={x:e,y:c},s=0,r=0,clearInterval(a)}function g(t,i){if(l){const a=n.x-t,l=n.y-i;e("pan",{x:Math.min(t-o.x,0),y:Math.min(i-o.y,0)}),s=Math.hypot(a,l),r=Math.atan2(l,a),n={x:t,y:i},c=Date.now()}}function v(){let o=0,n=Date.now(),i=.25;const l=()=>{const c=s*(1-o),l=c*Math.cos(r)*i,u=c*Math.sin(r)*i;o=(Date.now()-n)/500,e("pan",{x:Math.min(t.offset.x-l,0),y:Math.min(t.offset.y-u,0)}),o>=1&&clearInterval(a)};Date.now()-c<100&&(a=window.setInterval(l))}function y(t){f(t.x,t.y),t.preventDefault(),t.stopPropagation()}function b(t){g(t.x,t.y)}function w(t){if(l){if(l=!1,2===t.button&&J.isInNeighborhood(t,i,5))return e("contextmenu",t),t.stopPropagation(),void t.preventDefault();v()}}function I(e){const{clientX:o,clientY:n}=e.touches[0];e.targetTouches.length>1?(u=m(e),d=t.zoom):f(o,n),e.preventDefault(),e.stopPropagation()}function S(t){const{clientX:o,clientY:n}=t.touches[0];if(t.preventDefault(),t.stopPropagation(),t.targetTouches.length>1&&t.changedTouches.length>1){const o=m(t),n=Math.max(Math.min(d*(o/u),4),.1);t.touches[1].clientX,t.touches[1].clientY;e("zoom",{zoom:n})}else g(o,n)}function C(t){t.target===p.value?.$el&&e("deselect"),l&&v(),l=!1,u=0}function P(o){const{deltaY:n,x:i,y:s,shiftKey:r}=o;if(!r)return;const a=n<0?1:-1,c=t.zoom+a/10;e("zoom",{zoom:c,point:{x:i,y:s}})}function D(t){t.shiftKey||e("deselect")}function _(t){e("selection",t)}return(0,x.bv)((()=>{window.addEventListener("mousemove",b),window.addEventListener("mouseup",w)})),(0,x.Jd)((()=>{window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",w)})),{selector:p,style:h,onTouchStart:I,onTouchMove:S,onTouchEnd:C,onMouseDown:y,onMouseMove:b,onMouseWheel:P,onSelectionStart:D,onSelectionEnd:_}}});const Fo=(0,nt.Z)(No,[["render",ko]]);var jo=Fo;function To(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,S.C_)(["group",{"group--is-selected":t.isSelected}]),tabindex:-1,style:(0,S.j5)({position:"absolute",left:`${t.boundingBox.left}px`,top:`${t.boundingBox.top}px`,width:t.boundingBox.right-t.boundingBox.left+"px",height:t.boundingBox.bottom-t.boundingBox.top+"px",zIndex:t.zIndex})},null,6)}var Lo=(0,x.aZ)({name:"Group",props:{boundingBox:{type:Object,required:!0},id:{type:String,required:!0},isSelected:{type:Boolean,default:!1},zIndex:{type:Number,default:0},zoom:{type:Number,default:1}}});const $o=(0,nt.Z)(Lo,[["render",To]]);var Wo=$o;function Ro(t,e=[]){const o=t();let n=[{label:"&Undo",enabled:o.canUndo,accelerator:"CommandOrControl+Z",click:o.undo},{type:"separator"},{role:"cut",enabled:o.hasSelection},{role:"copy",enabled:o.hasSelection},{role:"paste",enabled:o.hasSelection},{label:"Delete",accelerator:"Delete",enabled:o.hasSelection,click:o.deleteSelection},{type:"separator"},{role:"selectAll",enabled:o.baseItems.length>0}];return o.selectedItemIds.length>0&&(n.push({type:"separator"}),n.push({label:"&Rotate",submenu:[{label:"Rotate 90° &CW",accelerator:"CmdOrCtrl+R",click:()=>o.rotate(1)},{label:"Rotate 90° CC&W",accelerator:"CmdOrCtrl+Shift+R",click:()=>o.rotate(-1)}]})),o.hasSelection&&(n.push({type:"separator"}),n.push({label:"&Bring to Front",submenu:[{label:"&Bring to Front",click:()=>o.setZIndex(o.zIndex)},{label:"Bring &Forward",click:()=>o.incrementZIndex(1)}]}),n.push({label:"&Send to Back",submenu:[{label:"&Send to Back",click:()=>o.setZIndex(o.zIndex)},{label:"Send &Backward",click:()=>o.incrementZIndex(-1)}]})),o.canGroup&&n.push({label:"&Group",submenu:[{label:"&Group"},{label:"&Ungroup",enabled:o.canUngroup}]}),e.length>0&&(n.push({type:"separator"}),n=n.concat(e)),1===o.selectedItemIds.length&&(n.push({type:"separator"}),n.push({label:"&Item Properties"})),o.activePortId&&(n.push({type:"separator"}),n.push({type:"checkbox",label:"Show in &Oscilloscope",checked:!0})),n}function Ao(t){t();return[{label:"&Grid",submenu:[{label:"&Show grid"},{type:"separator"},{label:"Snap to &grid"},{label:"Snap to &elements"}]}]}function Vo(t){return Ro(t,Ao(t).concat({type:"separator"}))}var Uo=o(9306),qo=o.n(Uo);function Ho(t,e,o,n,i="printer-friendly"){const s=e.cloneNode(!0),r=o.right-o.left+2*n,a=o.bottom-o.top+2*n;for(let c=0;c<s.children.length;c++){const t=s.children[c],e=parseInt(t.style.left.replace("px",""),10)+n,i=parseInt(t.style.top.replace("px",""),10)+n;t.style.left=e-o.left+"px",t.style.top=i-o.top+"px"}return s.style["zoom"]=t.toString(),s.style.width=`${r}px`,s.style.height=`${a}px`,s.style.position="relative",s.style.top="0",s.style.left="0",s.style.background="none",i&&s.classList.add(i),{printArea:s,width:r,height:a}}function Ko(t,e){const o=document.createElement("iframe");o.name="print",o.style.width="1px",o.style.height="1px",o.style.opacity="0",o.style.position="absolute",o.style.top="0px",o.style.left="0px",document.body.appendChild(o);const n=o.contentWindow;if(n){const o=document.createElement("style");o.appendChild(document.createTextNode(`\n      @page {\n        size: ${e.map((t=>`${t}in`)).join(" ")};\n        margin: 0in;\n      }\n    `)),n.document.head.append(o),n.document.body.appendChild(t)}return o}async function Go(t,e){document.body.appendChild(t);const o=await qo()[e](t);return t.remove(),o}async function Yo(t){return new Promise((e=>{setTimeout((()=>{if(!t)return e();t.addEventListener("afterprint",(()=>e())),t.print()}))}))}async function Xo(t,e,o){const{printArea:n,width:i,height:s}=Ho(1/t,e,o,20),r=await Jo.createImage(n,"toPng"),a=[8.5,11],c=96*Math.min(...a),l=96*Math.max(...a),u=new Image;let d=1;if(u.src=r,i>c||i>l||s>c||s>l){const t=i>s;d=t?l/i:l/s,t&&a.reverse()}u.style.width=`${Math.floor(i*d)}px`,u.style.height=`${Math.floor(s*d)}px`;const p=Jo.createPrintFrame(u,a);await Jo.printWindow(p?.contentWindow),p?.remove()}const Jo={createPrintArea:Ho,createPrintFrame:Ko,createImage:Go,printImage:Xo,printWindow:Yo};var Qo=Jo,tn=JSON.parse('{"groups":{},"connections":{"switch1_nor1_conn":{"id":"switch1_nor1_conn","connectionChainId":"switch1_nor1_conn","source":"switchOutputPort1","target":"nor1InputPort1","isSelected":false,"groupId":null,"zIndex":7},"switch2_nor2_conn":{"id":"switch2_nor2_conn","connectionChainId":"switch2_nor2_conn","source":"switchOutputPort2","target":"nor2InputPort1","isSelected":false,"groupId":null,"zIndex":8},"nor1_nor2_conn":{"id":"nor1_nor2_conn","connectionChainId":"nor1_nor2_conn","source":"nor1OutputPort1","target":"nor2InputPort2","isSelected":false,"groupId":null,"zIndex":9},"nor2_nor1_conn":{"id":"nor2_nor1_conn","connectionChainId":"nor2_nor1_conn","source":"nor2OutputPort1","target":"nor1InputPort2","isSelected":false,"groupId":null,"zIndex":10},"nor1_lightbulb1_conn":{"id":"nor1_lightbulb1_conn","connectionChainId":"nor1_lightbulb1_conn","source":"nor1OutputPort1","target":"lightbulbInputPort1","isSelected":false,"groupId":null,"zIndex":11},"nor2_lightbulb2_conn":{"id":"nor2_lightbulb2_conn","connectionChainId":"nor2_lightbulb2_conn","source":"nor2OutputPort1","target":"lightbulbInputPort2","isSelected":false,"groupId":null,"zIndex":12}},"ports":{"nor1InputPort1":{"id":"nor1InputPort1","elementId":"nor1","name":"Input Port 1","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"nor1InputPort2":{"id":"nor1InputPort2","elementId":"nor1","name":"Input Port 2","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"nor1OutputPort1":{"id":"nor1OutputPort1","elementId":"nor1","name":"Output Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":0,"rotation":0,"orientation":2,"value":0,"isFreeport":false},"nor2InputPort1":{"id":"nor2InputPort1","elementId":"nor2","name":"Input Port 1","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"nor2InputPort2":{"id":"nor2InputPort2","elementId":"nor2","name":"Input Port 2","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"nor2OutputPort1":{"id":"nor2OutputPort1","elementId":"nor2","name":"Output Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":0,"rotation":0,"orientation":2,"value":0,"isFreeport":false},"switchOutputPort1":{"id":"switchOutputPort1","elementId":"switch1","name":"Output Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":0,"rotation":0,"orientation":2,"value":0,"isFreeport":false},"switchOutputPort2":{"id":"switchOutputPort2","elementId":"switch2","name":"Output Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":0,"rotation":0,"orientation":2,"value":0,"isFreeport":false},"lightbulbInputPort1":{"id":"lightbulbInputPort1","elementId":"lightbulb1","name":"Input Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"lightbulbInputPort2":{"id":"lightbulbInputPort2","elementId":"lightbulb2","name":"Input Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false}},"items":{"nor1":{"id":"nor1","type":"LogicGate","subtype":"Nor","portIds":["nor1InputPort1","nor1InputPort2","nor1OutputPort1"],"position":{"x":300,"y":300},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"inputCount":{"label":"Input count","value":2,"type":"number","min":2},"showInOscilloscope":{"label":"Show in oscilloscope","value":true,"type":"boolean"}},"groupId":null,"zIndex":1,"width":100,"height":150},"nor2":{"id":"nor2","type":"LogicGate","subtype":"Nor","portIds":["nor2InputPort2","nor2InputPort1","nor2OutputPort1"],"position":{"x":300,"y":500},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"inputCount":{"label":"Input count","value":2,"type":"number","min":2},"showInOscilloscope":{"label":"Show in oscilloscope","value":true,"type":"boolean"}},"groupId":null,"zIndex":2,"width":120,"height":51},"switch1":{"id":"switch1","type":"InputNode","subtype":"Clock","portIds":["switchOutputPort1"],"position":{"x":100,"y":300},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"name":{"label":"Name","value":"","type":"text"},"startValue":{"label":"Start value","value":-1,"type":"number","options":{"True":1,"Hi-Z":0,"False":-1}},"showInOscilloscope":{"label":"Show in oscilloscope","value":true,"type":"boolean"}},"groupId":null,"zIndex":3,"width":40,"height":40},"switch2":{"id":"switch2","type":"InputNode","subtype":"Switch","portIds":["switchOutputPort2"],"position":{"x":100,"y":500},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"name":{"label":"Name","value":"","type":"text"},"startValue":{"label":"Start value","value":1,"type":"number","options":{"True":1,"Hi-Z":0,"False":-1}},"showInOscilloscope":{"label":"Show in oscilloscope","value":true,"type":"boolean"}},"groupId":null,"zIndex":4,"width":40,"height":40},"lightbulb1":{"id":"lightbulb1","type":"OutputNode","subtype":"Lightbulb","portIds":["lightbulbInputPort1"],"position":{"x":700,"y":300},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"name":{"label":"Name","value":"","type":"text"},"showInOscilloscope":{"label":"Show in oscilloscope","value":true,"type":"boolean"}},"groupId":null,"zIndex":5,"width":40,"height":40},"lightbulb2":{"id":"lightbulb2","type":"OutputNode","subtype":"Lightbulb","portIds":["lightbulbInputPort2"],"position":{"x":700,"y":500},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"name":{"label":"Name","value":"","type":"text"},"showInOscilloscope":{"label":"Show in oscilloscope","value":true,"type":"boolean"}},"groupId":null,"zIndex":6,"width":40,"height":40}}}'),en=o(2482);o(1703);class on{constructor(t,e){(0,en.Z)(this,"node",void 0),(0,en.Z)(this,"id",void 0),this.node=t,this.id=e}}var nn=on;const sn={TRUE:1,FALSE:-1,UNKNOWN:0};var rn=sn;class an{constructor(t,e=[]){(0,en.Z)(this,"inputValues",{}),(0,en.Z)(this,"outputs",[]),(0,en.Z)(this,"isValueChanged",!0),(0,en.Z)(this,"forceContinue",!1),(0,en.Z)(this,"name",void 0),(0,en.Z)(this,"value",rn.UNKNOWN),(0,en.Z)(this,"newValue",rn.UNKNOWN),(0,en.Z)(this,"events",[]),(0,en.Z)(this,"setValue",(t=>{this.newValue=t})),(0,en.Z)(this,"invokeEvent",((t,e)=>{this.events.forEach((o=>{o.eventType===t&&o.callback(e)}))})),(0,en.Z)(this,"eval",(()=>this.value)),(0,en.Z)(this,"valueCount",(t=>Object.values(this.inputValues).filter((e=>e===t)).length)),(0,en.Z)(this,"updateOutputs",(t=>{this.outputs.forEach((({node:e,id:o})=>{e.update(t,o)}))})),(0,en.Z)(this,"update",((t,e)=>{this.inputValues[e]=t,this.newValue=this.eval()})),(0,en.Z)(this,"propagate",(()=>{let t=[];return this.value!==this.newValue&&(this.isValueChanged=!0,this.value=this.newValue,this.updateOutputs(this.newValue),this.invokeEvent("change",this.newValue),this.outputs.forEach((({node:e})=>{e.forceContinue?t=t.concat(e.propagate()):t.push(e)}))),t})),(0,en.Z)(this,"reset",(()=>{this.value=rn.UNKNOWN,this.newValue=rn.UNKNOWN,this.invokeEvent("change",this.newValue)})),(0,en.Z)(this,"on",((t,e)=>{this.events.push({eventType:t,callback:e})})),(0,en.Z)(this,"getProjectedValue",(()=>this.eval()||this.newValue||this.value)),this.name=t,this.inputValues=e.reduce(((t,e)=>({...t,[e]:rn.UNKNOWN})),{})}}var cn=an;class ln extends cn{constructor(...t){super(...t),(0,en.Z)(this,"reset",(()=>{}))}}var un=ln;class dn extends cn{constructor(...t){super(...t),(0,en.Z)(this,"update",(t=>{this.newValue!==t&&(this.newValue=t,this.invokeEvent("change",t))}))}}var pn=dn;class hn{constructor(){(0,en.Z)(this,"queue",[]),(0,en.Z)(this,"nodes",[]),(0,en.Z)(this,"inputNodes",[]),(0,en.Z)(this,"addNode",(t=>{t instanceof un&&(this.inputNodes.push(t),this.enqueue(t)),this.nodes.push(t)})),(0,en.Z)(this,"removeNode",(t=>{if(t instanceof un){const e=this.inputNodes.findIndex((({name:e})=>e===t.name));-1!==e&&this.inputNodes.splice(e,1)}const e=this.nodes.findIndex((({name:e})=>e===t.name));-1!==e&&(this.removeNodeOutputs(t),this.nodes.splice(e,1)),this.next()})),(0,en.Z)(this,"addConnection",((t,e,o)=>{t.outputs.push(new nn(e,o)),t.value=rn.UNKNOWN,this.enqueue(t)})),(0,en.Z)(this,"removeConnection",((t,e)=>{t.outputs.concat().forEach((({node:o,id:n},i)=>{e===o&&(e.update(rn.UNKNOWN,n),t.outputs.splice(i,1),this.enqueue(e))}))})),(0,en.Z)(this,"removeNodeOutputs",(t=>{for(let e=0;e<t.outputs.length;e++)this.removeConnection(t,t.outputs[e].node)})),(0,en.Z)(this,"enqueue",((...t)=>{t.forEach((t=>{~this.queue.indexOf(t)||this.queue.push(t)}))})),(0,en.Z)(this,"dequeue",(t=>{const e=this.queue.indexOf(t);~e&&this.queue.splice(e,1)})),(0,en.Z)(this,"reset",(()=>{this.nodes.forEach((t=>t.reset()))})),(0,en.Z)(this,"next",(()=>{let t=!1,e=[];while(this.queue.length>0){const o=this.queue.shift();o&&(e=e.concat(o.propagate()),this.dequeue(o),o.isValueChanged&&(t=!0),o.forceContinue&&(this.enqueue(...e),e=[]))}t&&this.enqueue(...e)})),(0,en.Z)(this,"isComplete",(()=>{let t=!0;return 0===this.queue.length||(this.queue.forEach((e=>{const o=e.getProjectedValue();o===e.value||e instanceof pn||(t=!1)})),t&&(this.queue=[]),t)}))}}var mn=hn;class fn extends cn{constructor(...t){super(...t),(0,en.Z)(this,"eval",(()=>this.valueCount(rn.TRUE)?rn.FALSE:this.valueCount(rn.UNKNOWN)?rn.UNKNOWN:rn.TRUE))}}var gn=fn;class vn extends cn{constructor(...t){super(...t),(0,en.Z)(this,"forceContinue",!0),(0,en.Z)(this,"update",(t=>{const e=Object.keys(this.inputValues).pop();e&&(this.inputValues[e]=t,this.newValue=this.eval())})),(0,en.Z)(this,"eval",(()=>Object.values(this.inputValues).pop()||rn.UNKNOWN))}}var yn=vn;var bn=o(4279);class wn{constructor(t,e,o,n){(0,en.Z)(this,"id",void 0),(0,en.Z)(this,"name",void 0),(0,en.Z)(this,"width",0),(0,en.Z)(this,"lastY",0),(0,en.Z)(this,"segments",[]),(0,en.Z)(this,"hue",0),(0,en.Z)(this,"initialize",(t=>{const e={x:1,y:1};1===t?(e.y=0,this.lastY=1):(e.y=1,this.lastY=0),this.addSegment(e),this.updateWidth()})),(0,en.Z)(this,"reset",(()=>{this.segments=[],this.width=0,this.initialize(1===this.lastY?0:1)})),(0,en.Z)(this,"update",(t=>{this.drawPulseConstant()})),(0,en.Z)(this,"addSegment",(t=>{const e=this.segments[this.segments.length-1];!e&&t.x>0?this.segments.push({x:0,y:t.y}):e&&e.x!==t.x&&e.y!==t.y&&this.segments.pop(),this.segments.push(t),this.updateWidth()})),(0,en.Z)(this,"drawPulseChange",(t=>{const{x:e}=this.segments[this.segments.length-1],o=t===rn.TRUE?0:1;this.updateWidth(),this.addSegment({x:e,y:o})})),(0,en.Z)(this,"drawPulseConstant",(()=>{const t=this.segments[this.segments.length-1],e=this.lastY!==t.y?t:this.segments.pop();e&&(this.updateWidth(),this.addSegment({x:e.x+1,y:e.y})),this.lastY=t.y})),(0,en.Z)(this,"truncateSegments",(t=>{if(t>this.width)return;const e=this.width-t;let o=0;for(let n=0;n<this.segments.length;n++){const{x:t,y:i}=this.segments[n];if(t>e){o=t-e,this.segments.splice(0,n),this.segments.unshift({x:0,y:i});break}}for(let n=1;n<this.segments.length;n++){const{x:t,y:o}=this.segments[n];this.segments[n]={x:t-e,y:o}}this.updateWidth()})),(0,en.Z)(this,"updateWidth",(()=>{this.width=this.segments.slice(-1)[0]?.x||0})),this.id=t,this.name=e,this.hue=n,this.initialize(o)}}class In{constructor(t,e,o){(0,en.Z)(this,"id",(0,E.Z)()),(0,en.Z)(this,"name",void 0),(0,en.Z)(this,"signal",0),(0,en.Z)(this,"lastUpdate",void 0),(0,en.Z)(this,"interval",0),(0,en.Z)(this,"emitter",new bn.TinyEmitter),(0,en.Z)(this,"on",((t,e)=>{this.emitter.on(t,e)})),(0,en.Z)(this,"update",(t=>{t>=this.lastUpdate+this.interval&&(this.signal=-1===this.signal?1:-1,this.lastUpdate=t,this.emitter.emit("change",this.signal))})),this.name=t,this.signal=o,this.interval=e,this.lastUpdate=-e}}class xn{constructor(){(0,en.Z)(this,"isPaused",!0),(0,en.Z)(this,"waves",{}),(0,en.Z)(this,"refreshRate",20),(0,en.Z)(this,"lastUpdateTime",Date.now()),(0,en.Z)(this,"timeMsElapsed",0),(0,en.Z)(this,"timeMsOffset",0),(0,en.Z)(this,"emitter",new bn.TinyEmitter),(0,en.Z)(this,"start",(()=>{if(!this.isPaused)return;const t=this.lastUpdateTime%this.refreshRate;this.lastUpdateTime=Date.now()+t,this.isPaused=!1,this.tick()})),(0,en.Z)(this,"stop",(()=>{this.isPaused=!0})),(0,en.Z)(this,"clear",(()=>{Object.values(this.waves).forEach((t=>{t instanceof wn&&t.reset()}))})),(0,en.Z)(this,"computeWaveGeometry",(t=>{const e={},o=t=>t.map((({x:t,y:e})=>`${t},${e}`));for(const n in t)if(t[n]instanceof wn){const i=t[n],s=o(i.segments);e[n]={points:s.join(" "),width:i.width,hue:i.hue}}return e})),(0,en.Z)(this,"on",((t,e)=>{this.emitter.on(t,e)})),(0,en.Z)(this,"broadcast",(()=>{const t=window.screen.width,e=1e3/this.refreshRate,o=t/e;this.timeMsElapsed>=this.timeMsOffset+o/2*1e3&&(this.timeMsOffset=this.timeMsElapsed,Object.values(this.waves).forEach((e=>{e instanceof wn&&e.truncateSegments(t)}))),this.emitter.emit("change",this.computeWaveGeometry(this.waves))})),(0,en.Z)(this,"tick",(()=>{if(this.isPaused)return;const t=Date.now(),e=1e4;let o=!1;if(t>=this.lastUpdateTime+e)return this.stop(),void this.start();while(t>=this.lastUpdateTime+this.refreshRate){const e=Math.min(this.refreshRate,t-this.lastUpdateTime);o=!0,this.timeMsElapsed+=e,this.lastUpdateTime+=e,this.update()}o&&this.broadcast(),requestAnimationFrame(this.tick)})),(0,en.Z)(this,"update",(()=>{Object.values(this.waves).forEach((t=>t.update(this.timeMsElapsed)))})),(0,en.Z)(this,"add",(t=>{this.waves.hasOwnProperty(t.id)||(this.waves[t.id]=t,0===this.timeMsElapsed&&this.broadcast())})),(0,en.Z)(this,"remove",(({id:t})=>{delete this.waves[t],0===Object.keys(this.waves).length&&(this.stop(),this.clear())}))}}function Sn(t,e,o){switch(t){case Do.And:return new gn(e,o);default:return new gn(e,o)}}function Cn({id:t,type:e,subtype:o},n){switch(e){case Po.CircuitNode:return new cn(t,n);case Po.InputNode:return new un(t,n);case Po.LogicGate:return Sn(o,t,n);case Po.Buffer:case Po.Freeport:return new yn(t,n);default:return new pn(t,n)}}var Pn={getLogicGateNode:Sn,getCircuitNode:Cn};class Dn{constructor(t,e,o){(0,en.Z)(this,"nodes",{}),(0,en.Z)(this,"waves",{}),(0,en.Z)(this,"clocks",{}),(0,en.Z)(this,"valueMap",{}),(0,en.Z)(this,"circuit",new mn),(0,en.Z)(this,"oscillator",new xn),(0,en.Z)(this,"emitter",new bn.TinyEmitter),(0,en.Z)(this,"isPaused",!0),(0,en.Z)(this,"oscillogram",{}),(0,en.Z)(this,"addElements",((t,e,o)=>{t.forEach((t=>this.addNode(t,o))),e.forEach((t=>this.addConnection(t.source,t.target)))})),(0,en.Z)(this,"on",((t,e)=>{this.emitter.on(t,e)})),(0,en.Z)(this,"emit",(()=>{this.emitter.emit("change",this.valueMap,this.oscillogram)})),(0,en.Z)(this,"pause",(()=>{this.oscillator.stop(),this.isPaused=!0})),(0,en.Z)(this,"unpause",(()=>{this.isPaused=!1,this.oscillator.start(),this.emit()})),(0,en.Z)(this,"step",((t=0)=>{if(this.isPaused)return;this.circuit.next();const e=this.circuit.queue.length>0;if(t>1e4)throw new Error("An infinite loop detected!");e&&this.step(++t),this.emit()})),(0,en.Z)(this,"canContinue",!1),(0,en.Z)(this,"nextState",null),(0,en.Z)(this,"isDebug",!1),(0,en.Z)(this,"nextValueMap",{}),(0,en.Z)(this,"startDebugging",(()=>{this.isDebug=!0,this.pause(),this.computeNextState()})),(0,en.Z)(this,"stopDebugging",(()=>{this.advance(),this.isDebug=!1,this.nextState=null,this.unpause()})),(0,en.Z)(this,"advance",(()=>{const t=Object.keys(this.nextValueMap);t.length>0?t.forEach((t=>this.updatePortValue(t,this.nextValueMap[t]))):this.nextState&&(this.valueMap=JSON.parse(this.nextState)),this.nextValueMap={},this.computeNextState(),this.emit()})),(0,en.Z)(this,"computeNextState",(()=>{const t=JSON.stringify(this.valueMap);this.circuit.next();const e=JSON.stringify(this.valueMap);this.nextState=t!==e?e:null,this.canContinue=null!==this.nextState})),(0,en.Z)(this,"setOutputValue",((t,e)=>{this.valueMap[t]=e,this.emit()})),(0,en.Z)(this,"updatePortValue",((t,e)=>{this.nodes[t].setValue(e),this.circuit.enqueue(this.nodes[t]),this.waves[t]?.drawPulseChange(e)})),(0,en.Z)(this,"enqueuePortValueChange",((t,e)=>{this.nextValueMap[t]=e,this.canContinue=Object.keys(this.nextValueMap).reduce(((t,e)=>t||this.valueMap[e]!==this.nextValueMap[e]),!1),this.emit()})),(0,en.Z)(this,"setPortValue",((t,e)=>{if(this.isDebug)return this.enqueuePortValueChange(t,e);this.nodes[t]&&this.nodes[t].value!==e&&(this.updatePortValue(t,e),this.step())})),(0,en.Z)(this,"addIntegratedCircuit",(t=>{if(!t.integratedCircuit)return;const{items:e,connections:o,ports:n}=t.integratedCircuit;Object.values(e).forEach((t=>{this.addNode(t,n,!0)})),Object.values(o).forEach((t=>{this.addConnection(t.source,t.target)}))})),(0,en.Z)(this,"addNode",((t,e,o=!1)=>{if(0===t.portIds.length)return;if(t.integratedCircuit)return this.addIntegratedCircuit(t);const n=t.portIds.filter((t=>e[t].type===bo.Input)),i=t.portIds.filter((t=>e[t].type===bo.Output)),s=Pn.getCircuitNode(t,n);o&&(s.forceContinue=!0),t.portIds.forEach((t=>this.addPort(t,s))),t.type===Po.InputNode&&t.subtype===Do.Clock&&this.addClock(i[0]),this.circuit.addNode(s),t.portIds.forEach((t=>{const o=e[t];o.isMonitored&&this.monitorPort(t,o.value,o.hue)}))})),(0,en.Z)(this,"removeNode",(t=>{const e=t=>t.integratedCircuit?Object.values(t.integratedCircuit.items).reduce(((t,o)=>o.integratedCircuit?t.concat(e(o)).concat(o.portIds):t.concat(o.portIds)),[]):[];t.portIds.concat(e(t)).forEach((t=>{const e=this.nodes[t];e&&(this.circuit.removeNode(e),this.removePort(t))})),this.emit()})),(0,en.Z)(this,"addClock",(t=>{this.clocks[t]=new In(t,1e3,1),this.clocks[t].on("change",(e=>{this.setPortValue(t,e)})),this.oscillator.add(this.clocks[t])})),(0,en.Z)(this,"addPort",((t,e)=>{this.nodes[t]=e,e.on("change",(e=>{this.setOutputValue(t,e),this.waves[t]?.drawPulseChange(e)}))})),(0,en.Z)(this,"removePort",(t=>{this.clocks[t]&&this.oscillator.remove(this.clocks[t]),this.unmonitorPort(t),delete this.nodes[t],delete this.valueMap[t],delete this.clocks[t],delete this.waves[t]})),(0,en.Z)(this,"addConnection",((t,e)=>{this.nodes[t]&&this.nodes[e]&&this.circuit.addConnection(this.nodes[t],this.nodes[e],e)})),(0,en.Z)(this,"removeConnection",((t,e)=>{this.nodes[t]&&this.nodes[e]&&this.circuit.removeConnection(this.nodes[t],this.nodes[e])})),(0,en.Z)(this,"monitorPort",((t,e,o)=>{this.waves[t]||(this.waves[t]=new wn(t,t,e,o),this.oscillator.add(this.waves[t]))})),(0,en.Z)(this,"unmonitorPort",(t=>{this.waves[t]&&(this.oscillator.remove(this.waves[t]),this.oscillator.broadcast()),delete this.waves[t],delete this.oscillator.waves[t],delete this.oscillogram[t]})),this.addElements(t,e,o),this.oscillator.on("change",(t=>{this.oscillogram=t,this.emit()}))}}const On=()=>({undoStack:[],redoStack:[],simulation:new Dn([],[],{}),oscillogram:{},taxonomyCounts:{},zoomLevel:1,zIndex:1,oscilloscopeHeight:200,isOscilloscopeOpen:!1,isCircuitEvaluated:!1,isDebugging:!1,isDirty:!1,hasLoaded:!1,isPrinting:!1,isCreatingImage:!1,isToolboxOpen:!1,viewport:new DOMRect,canvas:{top:0,left:0,bottom:0,right:0},snapBoundaries:[],connectablePortIds:[],selectedConnectionIds:[],selectedItemIds:[],selectedPortIndex:-1,cachedState:null,activeFreeportId:null,activePortId:null,connectionPreviewId:null,items:{},connections:{},ports:{},groups:{}});function _n(t,e={}){let{items:o,connections:n,ports:i,groups:s}=no()(t);function r(t){return Object.values(t).forEach((o=>{const n=o.id,i=(0,E.Z)();e[n]=i,t[i]=no()(o),delete t[n]})),t}function a(t,o){return Object.values(t).forEach((t=>{t.groupId=null!==t.groupId?e[t.groupId]:null})),Object.values(o).forEach((t=>{t.groupId=null!==t.groupId?e[t.groupId]:null})),{connections:t,items:o}}function c(t){return Object.values(t).forEach((o=>{const n=o.id,i=(0,E.Z)();e[n]=i,t[i]=no()(o),t[i].id=i,t[i].source=e[t[i].source],t[i].target=e[t[i].target],delete t[n]})),t}function l(t){return Object.values(t).forEach((o=>{t[o.id].connectionChainId=e[t[o.id].connectionChainId]})),t}function u(t){return Object.values(t).forEach((o=>{const n=o.id,i=(0,E.Z)();e[n]=i,t[i]=no()(o),o.integratedCircuit?t[i].integratedCircuit={serializedState:o.integratedCircuit.serializedState,..._n(no()(o.integratedCircuit),e)}:t[i].id=i,t[i].portIds=o.portIds.map((t=>e[t])),delete t[n]})),t}function d(t){return Object.values(t).forEach((o=>{t[o.id].elementId=e[o.elementId]})),t}function p(t){return Object.values(t).forEach((o=>{const n=o.id,i=(0,E.Z)();e[n]=i,t[i]=no()(o),t[i].id=i,delete t[n]})),t}return i=p(i),o=u(o),i=d(i),n=c(n),n=l(n),s=r(s),{...a(n,o),ports:i,groups:s}}function Zn(t){if(!t.integratedCircuit)return t;const{items:e}=_n({items:{[t.id]:t},connections:{},ports:{},groups:{}});return Object.values(e)[0]}var kn={mapStandardCircuitIds:_n,mapIntegratedCircuitIds:Zn};function En(){this.copy(),this.deleteSelection()}function Mn(){if(!this.hasSelection)return;const t={},e={};this.selectedItemIds.forEach((o=>{t[o]=this.items[o],t[o].portIds.forEach((t=>{e[t]=this.ports[t]}))}));const o=Object.values(this.connections).reduce(((t,o)=>(e[o.source]&&e[o.target]&&(t[o.id]=o),t)),{}),n=Object.values(this.groups).filter((({isSelected:t})=>t)).reduce(((t,e)=>({...t,[e.id]:e})),{}),i={items:t,ports:e,connections:o,groups:n,pasteCount:1};window.api.copy(JSON.stringify(i))}function Bn(){try{const t=window.api.paste(),e=JSON.parse(t),o=kn.mapStandardCircuitIds(e);this.commitState(),this.deselectAll(),Object.keys(o.ports).forEach((t=>{o.ports[t].value=0})),Object.values(o.items).forEach((t=>{t.position.x+=20*e.pasteCount,t.position.y+=20*e.pasteCount,t.isSelected=!1,this.addItem({item:t,ports:o.ports}),this.setSelectionState({id:t.id,value:!0})})),Object.values(o.connections).forEach((t=>this.connect(t))),Object.values(o.groups).forEach((t=>{this.groups[t.id]=t,this.setGroupBoundingBox(t.id),this.setSelectionState({id:t.id,value:!0})}));const n={...JSON.parse(t),pasteCount:e.pasteCount+1};window.api.copy(JSON.stringify(n))}catch(t){console.log("ERROR: ",t)}}function zn(t){if(this.activePortId&&t){let e=this.activePortId,o=t;this.ports[this.activePortId].type===bo.Input&&(e=t,o=this.activePortId);const n=(0,E.Z)();this.unsetConnectionPreview(),this.connect({source:e,target:o,id:n}),this.connectionPreviewId=n}}function Nn(){this.connectionPreviewId&&this.disconnect(this.connections[this.connectionPreviewId]),this.connectionPreviewId=null}function Fn(){if(this.connectionPreviewId){const{source:t,target:e}=this.connections[this.connectionPreviewId];this.disconnect({source:t,target:e}),this.commitState(),this.connect({source:t,target:e}),this.connectionPreviewId=null}}function jn(t){t&&t!==this.activePortId&&this.setActivePortId(t);let e=this.selectedPortIndex+1;e<=0&&(e=0),e>=this.connectablePortIds.length&&(e=-1);const o=this.connectablePortIds[e];o&&!this.ports[t]?.connectedPortIds.includes(o)?this.setConnectionPreview(o):(0===this.connectablePortIds.length&&window.api.beep(),this.unsetConnectionPreview()),this.selectedPortIndex=e}function Tn(t){const e=t.id||(0,E.Z)();this.connections[e]={...t,id:e,connectionChainId:t.connectionChainId||e,groupId:null,zIndex:++this.zIndex,isSelected:!1},this.ports[t.source].connectedPortIds.push(t.target),this.ports[t.target].connectedPortIds.push(t.source)}function Ln(t){this.createConnection(t),this.simulation.addConnection(t.source,t.target),this.simulation.circuit.next()}function $n({source:t,target:e}){const o=Object.values(this.connections).find((o=>o.source===t&&o.target===e));if(o){const n=this.ports[t].connectedPortIds.findIndex((t=>t===e)),i=this.ports[e].connectedPortIds.findIndex((e=>e===t));this.ports[t].connectedPortIds.splice(n,1),this.ports[e].connectedPortIds.splice(i,1),delete this.connections[o.id]}}function Wn({source:t,target:e}){this.simulation.removeConnection(t,e),this.simulation.circuit.next(),this.destroyConnection({source:t,target:e})}function Rn(t){this.applyState(t),this.resetCircuit()}function An(){this.unsetConnectionPreview(),this.connectablePortIds=[],this.selectedConnectionIds=[],this.selectedItemIds=[],this.selectedPortIndex=-1,this.cachedState=null,this.activePortId=null,this.connectionPreviewId=null}function Vn(){this.isPrinting=!0}function Un(){this.isCreatingImage=!0}function qn(){this.isToolboxOpen=!this.isToolboxOpen}function Hn(t,e,o,n,i,s=[]){return{id:t,name:"",type:e,subtype:o,portIds:s.map((({id:t})=>t)),groupId:null,rotation:0,boundingBox:{top:0,left:0,right:n,bottom:i},position:{x:0,y:0},zIndex:0,width:n,height:i,isSelected:!1,properties:{}}}function Kn(t,e,o,n,i){return{id:e,orientation:o,name:i,position:{x:0,y:0},type:n,rotation:0,elementId:t,value:0,hue:0,isMonitored:!1,isFreeport:!1,connectedPortIds:[]}}function Gn({itemId:t,inputPortId:e,outputPortId:o,value:n=0}){const i=[];o&&(this.ports[o]=Kn(t,o,bt.Left,bo.Output,o),this.ports[o].value=n,this.ports[o].isFreeport=!0,i.push(this.ports[o])),e&&(this.ports[e]=Kn(t,e,bt.Right,bo.Input,e),this.ports[e].value=n,this.ports[e].isFreeport=!0,i.push(this.ports[e])),this.items[t]=Hn(t,Po.Freeport,Do.None,1,1,i),this.items[t].zIndex=this.zIndex++,this.simulation.addNode(this.items[t],this.ports,!0)}function Yn(t){const e=this.items[t];let o="",n="";Object.values(this.connections).forEach((t=>{t.target===e.portIds[0]&&(o=t.source),t.source===e.portIds[1]&&(n=t.target)})),o&&this.disconnect({source:o,target:e.portIds[0]}),n&&this.disconnect({source:e.portIds[1],target:n}),o&&n&&this.connect({source:o,target:n}),this.removeElement(t)}function Xn(t,e=!0){if(this.items[t.itemId])return;t.sourceId&&t.targetId&&this.commitState(),this.deselectAll(),this.addFreeportItem(t),this.setItemBoundingBox(t.itemId),this.activeFreeportId=t.itemId;let o=[];t.sourceId&&t.inputPortId&&o.push({source:t.sourceId,target:t.inputPortId}),t.targetId&&t.outputPortId&&o.push({source:t.outputPortId,target:t.targetId}),o.forEach((o=>{this.createConnection({...o,connectionChainId:t.connectionChainId}),e&&this.simulation.addConnection(o.source,o.target)})),t.sourceId&&t.targetId&&this.simulation.removeConnection(t.sourceId,t.targetId),t.sourceId&&t.targetId&&(this.deselectAll(),this.setSelectionState({id:t.itemId,value:!0}),this.incrementZIndex(1)),this.simulation.circuit.next()}function Jn({sourceId:t,targetId:e,portId:o}){const n=this.ports[o],i=Object.values(this.ports).find((t=>t.id!==o&&this.connectablePortIds.includes(t.id)&&J.isInNeighborhood(t.position,n.position,10)));i?t?(this.disconnect({source:t,target:o}),this.connect({source:t,target:i.id})):e&&(this.disconnect({source:o,target:e}),this.connect({source:i.id,target:e})):this.disconnect({source:t||o,target:e||o});const s=Object.values(this.items).find((({portIds:t})=>t.includes(o)));s&&this.removeElement(s.id),this.clearStatelessInfo()}function Qn(){this.commitState();const t=(0,E.Z)(),e=Object.values(this.items).filter((({isSelected:t})=>t)),o=e.reduce(((t,e)=>t.concat(e.portIds)),[]),n=Object.values(this.connections).filter((t=>o.includes(t.source)&&o.includes(t.target)&&t.isSelected));e.forEach((t=>t.groupId&&this.destroyGroup(t.groupId))),n.forEach((t=>t.groupId&&this.destroyGroup(t.groupId)));const i=[...e,...n].reduce(((t,e)=>Math.max(e.zIndex,t)),0),s={id:t,itemIds:e.map((({id:t})=>t)),connectionIds:n.map((({id:t})=>t)),isSelected:!0,boundingBox:{left:0,top:0,right:0,bottom:0},position:{x:0,y:0},zIndex:i};this.groups[t]=s,s.itemIds.forEach((t=>{this.items[t].groupId=s.id})),s.connectionIds.forEach((t=>{this.connections[t].groupId=s.id})),this.setZIndex(i),this.setGroupBoundingBox(t)}function ti(){this.commitState();for(const t in this.groups)this.groups[t].isSelected&&this.destroyGroup(t)}function ei(t){const e=this.groups[t];e.itemIds.forEach((t=>{this.items[t].groupId=null,this.selectedItemIds.push(t)})),e.connectionIds.forEach((t=>{this.connections[t].groupId=null,this.selectedConnectionIds.push(t)})),delete this.groups[t]}function oi(t,e,o,n){return{x:(o.x-e.x-t.left)/n,y:(o.y-e.y-t.top)/n}}function ni(t,e){const o=[t.type];return t.subtype!==Do.None&&o.push(t.subtype),o.push(e.toString()),o.join(" ")}function ii({item:t,ports:e}){const o=t.integratedCircuit?.ports||e;t.portIds.forEach((t=>{const e=o[t];e&&(this.ports[e.id]=e,e.isMonitored&&this.monitorPort(e.id))}));const n=`${t.type}_${t.subtype}`;this.taxonomyCounts[n]||(this.taxonomyCounts[n]=0),t.name=ni(t,++this.taxonomyCounts[n]),this.items[t.id]=t,this.items[t.id].zIndex=++this.zIndex,this.simulation.addNode(t,this.ports),this.resetItemValue(t)}function si({item:t,ports:e},o=null){if(!o){const t=J.getBoundingBoxMidpoint(this.viewport);o={x:t.x+this.viewport.left,y:t.y+this.viewport.top}}const n=oi(this.canvas,this.viewport,o,this.zoomLevel);n.x-=t.width/2,n.y-=t.height/2,t.position=n,this.commitState(),this.addItem({item:t,ports:e.reduce(((t,e)=>({...t,[e.id]:e})),{})}),this.setItemBoundingBox(t.id),this.setItemPortPositions(t.id),this.setSelectionState({id:t.id,value:!0})}function ri(t){const e=t.properties?.startValue;if(!e)return;const o=e.value;t.portIds.forEach((t=>this.setPortValue({id:t,value:o})))}function ai(t){const e=this.items[t];this.simulation.removeNode(e),e.portIds.forEach((t=>this.removePort(t))),delete this.items[t]}function ci({id:t,count:e}){const o=this.items[t],n=o.properties.inputCount.value;if(n>e)this.items[t].portIds.filter((t=>this.ports[t].type===bo.Input)).slice(e).forEach((t=>this.removePort(t)));else for(let i=n;i<e;i++){const e=(0,E.Z)();this.addPort(t,{id:e,name:"",connectedPortIds:[],type:bo.Input,elementId:t,virtualElementId:t,orientation:bt.Left,isFreeport:!1,isMonitored:!1,hue:0,position:{x:0,y:0},rotation:0,value:0})}}function li({id:t,properties:e}){const o=this.items[t];for(const n in e){const i=e[n];if(o.properties[n].value!==i.value){switch(n){case"inputCount":this.setInputCount({id:t,count:i.value});break}this.items[t].properties[n].value=i.value}}}function ui(t){const e=t.x-this.canvas.left,o=t.y-this.canvas.top;this.canvas.left+=e,this.canvas.right+=e,this.canvas.top+=o,this.canvas.bottom+=o}function di(){const t=J.getBoundingBoxMidpoint(this.canvas);this.panTo({x:this.viewport.width/2-t.x,y:this.viewport.height/2-t.y})}function pi(t,e,o){const{connectionIds:n,freeportIds:i}=Object.values(t).reduce((({connectionIds:t,freeportIds:n},i)=>{if(o===i.connectionChainId){const o=e[i.source],s=e[i.target];t.add(i.id),o?.isFreeport&&n.add(o.elementId),s?.isFreeport&&n.add(s.elementId)}return{connectionIds:t,freeportIds:n}}),{connectionIds:new Set,freeportIds:new Set});return{connectionIds:Array.from(n),freeportIds:Array.from(i)}}function hi(t,e){const o=Object.values(this.simulation.nodes).find((({name:e})=>this.items[t].portIds.includes(e)));this.ports[e.id]=e,this.items[t].portIds.push(e.id),o?this.simulation.addPort(e.id,o):this.simulation.addNode(this.items[t],this.ports)}function mi(t){Object.values(this.connections).filter((({source:e,target:o})=>e===t||o===t)).forEach((t=>{const{connectionIds:e,freeportIds:o}=pi(Object.values(this.connections),this.ports,t.connectionChainId);e.forEach((t=>{const{source:e,target:o}=this.connections[t];this.simulation.removeConnection(e,o),delete this.connections[t]})),o.forEach((t=>{this.items[t].portIds.forEach((t=>{delete this.ports[t],this.simulation.removePort(t)})),delete this.items[t]}))}));const e=this.ports[t];if(e){const o=this.items[e.elementId];if(!o)return;const n=o.portIds.findIndex((e=>e===t));-1!==n&&this.items[o.id].portIds.splice(n,1),delete this.ports[t],this.simulation.removePort(t)}}function fi(t){this.activePortId!==t&&(t?this.setConnectablePortIds({portId:t}):this.connectablePortIds=[],this.activePortId=t,this.selectedPortIndex=-1)}function gi({portId:t,isDragging:e}){const o=this.ports[t];if(o.isFreeport)return;const n=Object.values(this.connections).reduce(((t,e)=>t.concat([e.source,e.target])),[]);e&&n.splice(-2);const i=o.type===bo.Output?t=>t.type===bo.Input&&!t.isFreeport&&!n.includes(t.id)&&t.elementId!==o.elementId:t=>t.type===bo.Output&&!t.isFreeport&&!n.includes(o.id)&&t.elementId!==o.elementId;this.connectablePortIds=Object.values(this.ports).filter(i).map((({id:t})=>t))}function vi({id:t,value:e}){this.simulation.setPortValue(t,e)}function yi(t){this.ports[t].isMonitored?this.unmonitorPort(t):this.monitorPort(t)}function bi(t){const e=this.ports[t];e.hue=e.hue||~~(360*Math.random()),e.isMonitored=!0,this.simulation.monitorPort(t,e.value,e.hue),this.isOscilloscopeOpen=!0}function wi(t){const e=this.ports[t];e.isMonitored=!1,this.simulation.unmonitorPort(t),this.isOscilloscopeOpen=Object.keys(this.oscillogram).length>0}function Ii(t){for(const e in t)this.ports[e]&&(this.ports[e].value=t[e])}function xi(t,e=0){return(t+e%4+4)%4}function Si(t,e,o){const n=t.right-t.left,i=t.bottom-t.top,s=t.left+n/2,r=t.top+i/2,a=e.position.x,c=e.position.y,l=a+e.width/2,u=c+e.height/2,d=Math.hypot(s-l,r-u),p=Math.atan2(u-r,l-s),h=90*o*(Math.PI/180)+p,m=d*Math.cos(h)+s,f=d*Math.sin(h)+r;return{x:m-e.width/2,y:f-e.height/2}}function Ci(t,e,o,n){const{left:i,top:s,bottom:r,right:a}=o.boundingBox,c=(t.orientation+o.rotation)%2===0?Math.floor((r-s)/e.length):Math.floor((a-i)/e.length),l=c*(n+1)-c/2;switch(xi(t.orientation+o.rotation)){case bt.Left:return{x:i,y:s+l};case bt.Top:return{x:a-l,y:s};case bt.Right:return{x:a,y:r-l};case bt.Bottom:default:return{x:i+l,y:r}}}var Pi={rotate:xi,getGroupedItemRotatedPosition:Si,getRotatedPortPosition:Ci};function Di(){const t=Object.values(this.items).map((({boundingBox:t})=>t)),e=J.getGroupBoundingBox(t),{x:o,y:n}=J.getCenteredScreenPoint(this.canvas,e,20),i=o-e.left,s=n-e.top;Object.values(this.items).forEach((t=>{this.setItemPosition({id:t.id,position:{x:t.position.x+i,y:t.position.y+s}})}))}function Oi(t){const e=this.items[t];if(!e)return;const o=e.portIds.reduce(((t,o)=>{const n=this.ports[o];if(n){const o=Pi.rotate(n.orientation+e.rotation);t.get(o)?.push(n)}return t}),new Map([[bt.Left,[]],[bt.Top,[]],[bt.Right,[]],[bt.Bottom,[]]])),n=(t=[])=>{t.forEach(((o,n)=>{this.ports[o.id].position=Pi.getRotatedPortPosition(o,t,e,n)}))};n(o.get(bt.Left)),n(o.get(bt.Top)),n(o.get(bt.Right)),n(o.get(bt.Bottom))}function _i({id:t,position:e}){const o=this.items[t],n={x:e.x-o.position.x,y:e.y-o.position.y};this.items[t].position=e,this.setItemBoundingBox(t),o.portIds.forEach((t=>{const e=this.ports[t];this.ports[t].position={x:e.position.x+n.x,y:e.position.y+n.y}}))}function Zi(t,e,o){const{x:n,y:i}=oi(this.canvas,this.viewport,e,this.zoom),{width:s,height:r,rotation:a}=this.items[t],c=J.getBoundingBox({x:n,y:i},a,s,r),l=J.getSnapOffset(this.snapBoundaries,c,o||B.Outer,15);this.setSelectionPosition({id:t,position:{x:n+l.x,y:i+l.y}})}function ki(t){const e=this.selectedItemIds[0];if(e){const o=this.items[e],n={x:o.position.x+t.x,y:o.position.y+t.y};this.commitState(),this.setSelectionPosition({id:e,position:n})}}function Ei({id:t,position:e}){const o=this.items[t],n={x:e.x-o.position.x,y:e.y-o.position.y},i=new Set;if(this.setSelectionState({id:t,value:!0}),o.type===Po.Freeport)return this.setItemPosition({id:t,position:e});this.selectedItemIds.forEach((t=>{const e=this.items[t],o={x:e.position.x+n.x,y:e.position.y+n.y};e.groupId&&i.add(e.groupId),this.setItemPosition({id:t,position:o})})),i.forEach(this.setGroupBoundingBox)}function Mi(t){this.commitState();const e=Object.values(this.items).filter((({isSelected:t})=>t)),o=e.map((({boundingBox:t})=>t)),n=J.getGroupBoundingBox(o),i=new Set;e.forEach((e=>{const o=Pi.rotate(e.rotation+t);e.groupId&&i.add(e.groupId),this.items[e.id].rotation=o,this.items[e.id].portIds.forEach((t=>{this.ports[t].rotation=o})),this.setItemPosition({id:e.id,position:Pi.getGroupedItemRotatedPosition(n,e,t)}),this.setItemPortPositions(e.id)})),i.forEach((t=>{this.setGroupBoundingBox(t)}))}function Bi(t){this.setSelectionState({id:t,value:!1})}function zi(t,e=!1){e||this.deselectAll(),this.setSelectionState({id:t,value:!0})}function Ni(){this.clearStatelessInfo();for(let t in this.connections)this.connections[t].isSelected=!0,this.selectedConnectionIds.push(t);for(let t in this.items)this.items[t].isSelected=!0,this.selectedItemIds.push(t)}function Fi(){this.clearStatelessInfo();for(let t in this.connections)this.connections[t].isSelected=!1,this.selectedConnectionIds=[];for(let t in this.items)this.items[t].isSelected=!1,this.selectedItemIds.push(t),this.selectedItemIds=[]}function ji(t){if(!J.isOneOrTwoDimensional(t))return;const e=Object.keys(this.items).filter((e=>J.hasIntersection(t,this.items[e].boundingBox))),o=Object.keys(this.connections).filter((e=>{const o=this.connections[e],n=this.ports[o.source],i=this.ports[o.target];return J.isLineIntersectingRectangle(n.position,i.position,t)}));e.concat(o).forEach((t=>{this.updateSelectionList({id:t,isSelected:!0})})),this.selectItemConnections(e)}function Ti(t){const e=t.reduce(((t,e)=>t.concat(this.items[e].portIds)),[]);for(let o in this.connections){const t=this.connections[o];e.includes(t.source)&&e.includes(t.target)&&this.updateSelectionList({id:o,isSelected:!0})}}function Li({id:t,isSelected:e}){const o=(t,o)=>{const n=this[o].findIndex((e=>e===t));e&&-1===n&&this[o].push(t),e||-1===n||this[o].splice(n,1)};if(this.items[t])this.items[t].isSelected=e,o(t,"selectedItemIds");else if(this.connections[t]){const{connectionChainId:n}=this.connections[t],{connectionIds:i,freeportIds:s}=pi(Object.values(this.connections),this.ports,n);i.forEach((t=>{this.connections[t].isSelected=e,o(t,"selectedConnectionIds")})),s.forEach((t=>{this.items[t].isSelected=e,o(t,"selectedItemIds")}))}}function $i({id:t,value:e}){const o=this.items[t]||this.connections[t],n=e;if(o&&o.isSelected!==n)if(o.groupId){const{itemIds:t,connectionIds:e}=this.groups[o.groupId];t.concat(e).forEach((t=>{this.updateSelectionList({id:t,isSelected:n})})),this.updateSelectionList({id:o.groupId,isSelected:n})}else this.updateSelectionList({id:t,isSelected:n})}function Wi(t){const e=t?this.baseItems[0]:this.baseItems.slice(-1)[0];e&&(this.deselectAll(),this.setSelectionState({id:e.id,value:!0}))}function Ri(){if(!this.hasSelection)return;this.commitState();const t=Object.values(this.items).filter((({isSelected:t,type:e})=>t&&e!==Po.Freeport)),e=t.map((({id:t})=>t));Object.values(this.connections).filter((t=>{const o=this.ports[t.source],n=this.ports[t.target];if(o&&n)return e.includes(o.elementId)||e.includes(n.elementId)})).forEach((({id:t})=>this.setSelectionState({id:t,value:!0}))),Object.values(this.connections).filter((({isSelected:t})=>t)).forEach((t=>{this.disconnect({source:t.source,target:t.target})})),t.forEach((t=>this.removeElement(t.id))),Object.values(this.items).filter((({isSelected:t,type:e})=>t&&e===Po.Freeport)).forEach((t=>this.removeFreeport(t.id)))}function Ai(){this.simulation.pause()}function Vi(){this.isDebugging||this.simulation.unpause()}function Ui(){this.simulation.oscillator?.stop();const t=new Dn(Object.values(this.items),Object.values(this.connections),this.ports);t.on("change",((t,e)=>{for(const o in t)this.ports[o]&&(this.ports[o].value=t[o]);this.isCircuitEvaluated=!this.simulation.canContinue,this.oscillogram=e})),this.simulation=t}function qi(t,e){for(const o in t)this.ports[o]&&(this.ports[o].value=t[o]);this.isCircuitEvaluated=!this.simulation.canContinue,this.oscillogram=e}function Hi(){const t=Object.values(this.items),e=Object.values(this.connections);Object.values(this.ports).forEach((t=>{t.value=0})),this.simulation.oscillator?.stop(),this.simulation=new Dn(t,e,this.ports),this.simulation.on("change",this.onSimulationUpdate),Object.values(this.items).forEach((({properties:t,portIds:e})=>{t?.startValue&&e.forEach((e=>this.setPortValue({id:e,value:t.startValue.value})))})),this.simulation.unpause(),this.isDebugging&&(this.simulation.startDebugging(),this.isCircuitEvaluated=!this.simulation.canContinue)}function Ki(){this.simulation.advance(),this.isCircuitEvaluated=!this.simulation.canContinue}function Gi(){this.isDebugging?this.simulation.stopDebugging():this.simulation.startDebugging(),this.isDebugging=!this.isDebugging}function Yi(){this.isOscilloscopeOpen?this.closeOscilloscope():this.openOscilloscope()}function Xi(){Object.values(this.ports).forEach((t=>{t.isMonitored&&this.simulation.monitorPort(t.id,t.value,t.hue)})),this.isOscilloscopeOpen=!0}function Ji(t){this.isOscilloscopeOpen&&(Object.keys(this.ports).forEach(this.simulation.unmonitorPort),this.simulation.oscillator.clear(),this.isOscilloscopeOpen=!1,t&&(this.oscilloscopeHeight=t))}function Qi(){this.simulation.oscillator.clear()}var ts={stop:Ai,start:Vi,buildCircuit:Ui,onSimulationUpdate:qi,resetCircuit:Hi,toggleDebugger:Gi,stepThroughCircuit:Ki,toggleOscilloscope:Yi,openOscilloscope:Xi,closeOscilloscope:Ji,clearOscilloscope:Qi};const es=.1;function os(t){this.viewport=t,this.canvas.right=screen.width/es,this.canvas.bottom=screen.height/es,!this.hasLoaded&&t.width>0&&t.height>0&&(this.hasLoaded=!0,this.centerAll(),this.panToCenter())}function ns({rect:t,id:e}){const o=this.items[e],n=t.width/this.zoomLevel,i=t.height/this.zoomLevel,s=o.position.x+o.width/2,r=o.position.y+o.height/2,a=s-n/2,c=r-i/2;this.items[e].position={x:a,y:c},this.items[e].width=n,this.items[e].height=i,this.setItemBoundingBox(e),this.setItemPortPositions(e),this.items[e].groupId&&this.setGroupBoundingBox(this.items[e].groupId)}function is(t){if(!this.items[t])return;const{position:e,rotation:o,width:n,height:i}=this.items[t];this.items[t].boundingBox=J.getBoundingBox(e,o,n,i)}function ss(t){if(!this.groups[t])return;const e=this.groups[t].itemIds.map((t=>this.items[t].boundingBox));this.groups[t].boundingBox=J.getGroupBoundingBox(e)}function rs(t){this.snapBoundaries=(()=>{if(this.connectablePortIds.length)return this.connectablePortIds.filter((e=>e!==t)).map((t=>J.getPointBoundary(this.ports[t].position)));const e=this.items[t];if(e&&!e.groupId){if(e.type!==Po.Freeport)return Object.values(this.items).filter((e=>e.id!==t&&e.type!==Po.Freeport)).map((t=>t.boundingBox));if(e.portIds.length>1)return Object.values(this.connections).reduce(((t,o)=>e.portIds.includes(o.source)?t.concat(J.getLinearBoundaries(this.ports[o.target].position)):e.portIds.includes(o.target)?t.concat(J.getLinearBoundaries(this.ports[o.source].position)):t),[])}return[]})()}function as(){const t=this.undoStack.slice(-1).pop();t&&(this.redoStack.push(JSON.stringify({connections:this.connections,items:this.items,ports:this.ports,groups:this.groups})),this.applyState(t),this.undoStack.pop(),this.isDirty=!0)}function cs(){const t=this.redoStack.slice(-1).pop();t&&(this.undoStack.push(JSON.stringify({connections:this.connections,items:this.items,ports:this.ports,groups:this.groups})),this.applyState(t),this.redoStack.pop(),this.isDirty=!0)}function ls(){this.cacheState(),this.commitCachedState()}function us(){this.cachedState=JSON.stringify({connections:this.connections,items:this.items,ports:this.ports,groups:this.groups})}function ds(){this.cachedState&&(this.undoStack.push(this.cachedState.toString()),this.cachedState=null,this.redoStack=[],this.isDirty=!0)}function ps(t){const e=JSON.parse(t),{items:o,connections:n,ports:i,groups:s}=e;function r(t,e){const o=Object.keys(t),n=Object.keys(e);return o.filter((t=>!n.includes(t)))}const a=r(this.items,o),c=r(this.connections,n),l=r(o,this.items),u=r(n,this.connections);c.forEach((t=>this.disconnect(this.connections[t]))),a.forEach((t=>this.removeElement(t))),this.ports=i,this.items=o,this.groups=s,l.forEach((t=>{this.addItem({item:o[t],ports:i})})),u.forEach((t=>this.connect(n[t]))),this.simulation.step()}function hs(t,e){return t.zIndex>e.zIndex?1:t.zIndex<e.zIndex?-1:0}function ms(){this.commitState(),this.incrementZIndex(-1)}function fs(){this.commitState(),this.incrementZIndex(1)}function gs(){this.commitState(),this.setZIndex(1)}function vs(){this.commitState(),this.setZIndex(this.zIndex)}function ys(t){const e=Object.values(this.items),o=Object.values(this.connections),n=e.concat(o).sort(hs),i=n.filter((({isSelected:t})=>t)).map((({id:t})=>t));t>0&&i.reverse();const s=[];i.forEach((e=>{const o=n.findIndex((t=>t.id===e)),i=o+t;if(i<0||i>=n.length)s.push(n[o].id);else if(!s.includes(n[i]?.id)){const t=n[o];n.splice(o,1),n.splice(i,0,t)}})),n.forEach(((t,e)=>{t.zIndex=e+1})),this.zIndex=Object.keys(n).length}function bs(t){const e=Object.values(this.items),o=Object.values(this.connections);let n=e.concat(o).sort(hs);const i=n.filter((({isSelected:t})=>t));for(let s=0;s<n.length;s++)n[s].isSelected&&(n.splice(s,1),s--);n.splice(t-1,0,...i),n.forEach(((t,e)=>{t.zIndex=e+1})),this.zIndex=Object.keys(n).length}const ws=.1,Is=2,xs=.1;function Ss(t=1){this.setZoom({zoom:this.zoomLevel+xs*t})}function Cs({zoom:t,point:e}){t<ws&&(t=ws),t>Is&&(t=Is),t=Math.round(100*t)/100,e||(e=J.getBoundingBoxMidpoint(this.viewport),e.x+=this.viewport.left,e.y+=this.viewport.top);const o=oi(this.canvas,this.viewport,e,this.zoomLevel),n={x:o.x*t,y:o.y*t},i={x:e.x-this.viewport.x,y:e.y-this.viewport.y};this.panTo({x:Math.round(Math.min(i.x-n.x,0)),y:Math.round(Math.min(i.y-n.y,0))}),this.zoomLevel=t}function Ps(t){const{ports:e,items:o,connections:n,groups:i}=no()(t),s=Hn((0,E.Z)(),Po.IntegratedCircuit,"Flip flop",400,400);return Object.values(o).forEach((t=>{if(t.type!==Po.InputNode&&t.type!==Po.OutputNode)return;const o=t.type===Po.InputNode?bo.Output:bo.Input,n=t.type===Po.InputNode?bt.Left:bt.Right;t.portIds.filter((t=>e[t].type===o)).forEach((o=>{const i=(0,E.Z)();e[i]={...no()(e[o]),type:t.type===Po.InputNode?bo.Input:bo.Output,id:i,elementId:t.id,orientation:n},t.portIds.push(i),s.portIds.push(i)})),t.type=Po.Buffer})),s.integratedCircuit={items:o,connections:n,ports:e,groups:i,serializedState:JSON.stringify({items:t.items,connections:t.connections,ports:t.ports,groups:t.groups})},s}const Ds=t=>(0,w.Q_)({id:t,state:On,getters:{baseItems(t){return Object.values(t.connections).concat(Object.values(t.items)).sort(hs)},zoom(t){return t.zoomLevel},hasSelection(t){return t.selectedItemIds.length>0||t.selectedConnectionIds.length>0},hasSelectedItems(t){return t.selectedItemIds.length>0},selectedGroupIds(t){const e=new Set;return t.selectedItemIds.forEach((o=>e.add(t.items[o]?.groupId))),Array.from(e)},canGroup(){return this.selectedGroupIds.length>1||null===[].slice.call(this.selectedGroupIds)[0]},canUngroup(){return!![].slice.call(this.selectedGroupIds).find((t=>!!t))},canUndo(t){return t.undoStack.length>0},canRedo(t){return t.redoStack.length>0}},actions:{...n,...i,...s,...r,...a,...c,...l,...u,...d,...p,...h,...m,...g,...f,...v,...y,...b,async saveIntegratedCircuit(){const t=Ps(this.$state),e=kn.mapIntegratedCircuitIds(t);this.insertItemAtPosition({item:e,ports:[]}),this.setItemBoundingBox(e.id),this.setItemPortPositions(e.id),this.setSelectionState({id:e.id,value:!0})}}});var Os=o(8764),_s=o(5733),Zs=o.n(_s);class ks{static async open(t){const e=new(Zs()),o=window.api.openFile(t),{files:n}=await e.loadAsync(o),i=await n.content.async("text");return i}static async writeBlob(t,e){const o=await e.arrayBuffer(),n=Os.lW.from(o);window.api.saveFile(t,n)}static async save(t,e){const o=new(Zs());o.file("content",JSON.stringify(e));const n=await o.generateAsync({type:"blob"});this.writeBlob(t,n)}}function Es(t){return t.split("\\").pop()?.split("/").pop()||""}const Ms=(0,w.Q_)({id:"root",state:()=>({documents:{},clipboard:null,activeDocumentId:null,canExit:!1,isFullscreen:!1}),getters:{hasOpenDocuments(t){return Object.keys(t.documents).length>0},activeDocument(t){return t.activeDocumentId?t.documents[t.activeDocumentId]:null}},actions:{openIntegratedCircuit(t){t.integratedCircuit&&this.openDocument("",t.integratedCircuit.serializedState,t.id,t.name)},async saveImage(t){if(this.activeDocument)try{const e=this.activeDocument.displayName.replace(/\.[^/.]+$/,""),o=`${e}.png`,n=window.api.showSaveFileDialog([{name:"PNG Image",extensions:[".png"]}],o);if(!n)return;await ks.writeBlob(n,t)}catch(e){console.log("ERROR: ",e),window.api.showMessageBox({message:"An error occurred while trying to save the image.",title:"Error",type:"error"})}},newDocument(){const t=(0,E.Z)(),e=Ds(t),o=e();o.resetCircuit(),this.documents[t]={fileName:"Untitled Circuit",displayName:"Untitled Circuit",store:e},this.activateDocument(t)},async closeAll(){if(this.activeDocumentId){const t=await this.closeDocument(this.activeDocumentId);return await new Promise((t=>setTimeout(t))),!!t&&this.closeAll()}return!0},printActiveDocument(){this.activeDocument&&(this.activeDocument.store().isPrinting=!0)},async closeDocument(t){const e=this.documents[t],o=e.store();let n=!0;if(this.activateDocument(t),o.isDirty){const t=window.api.showMessageBox({message:`Save changes to ${e.fileName}?`,title:"Confirm",buttons:["Yes","No","Cancel"]});if(0===t&&(n=await this.saveActiveDocument()),2===t)return!1}delete this.documents[t],this.activeDocumentId=null;const i=Object.keys(this.documents).pop();return i&&this.activateDocument(i),n},async saveActiveDocument(t=!1){try{if(!this.activeDocument)return!0;if(!this.activeDocument.filePath||t){const t=this.activeDocument.fileName||`${this.activeDocument.fileName}.alfx`,e=window.api.showSaveFileDialog([{name:"Aristotle Logic Circuit (*.alfx)",extensions:["alfx"]}],t);if(!e)return!0;if(e){const t=Es(e);this.activeDocument.filePath=e,this.activeDocument.fileName=t,this.activeDocument.displayName=t}}if(!this.activeDocument.filePath)return!0;const e=this.activeDocument.store();return ks.save(this.activeDocument.filePath,{items:e.items,connections:e.connections,groups:e.groups,ports:e.ports}),e.isDirty=!1,!0}catch(e){return window.api.showMessageBox({message:"An error occurred while trying to save the file.",title:"Error",type:"error"}),!1}},async selectDocument(){const t=window.api.showOpenFileDialog([{name:"Aristotle Logic Circuit (*.alfx)",extensions:["alfx"]}]);for(let e=0;e<t.length;e++)await this.openDocumentFromPath(t[e])},async openDocumentFromPath(t){try{const e=await ks.open(t);e&&this.openDocument(t,e,(0,E.Z)())}catch(e){console.log("ERR",e),window.api.showMessageBox({message:`Could not open ${t}. The file is not a valid Aristotle circuit.`,title:"Error",type:"error"})}},openDocument(t,e,o,n=""){if(this.documents[o])return this.activateDocument(o);const i=Ds(o),s=i(),r=Es(t);s.loadDocument(e),this.documents[o]={fileName:r,filePath:t,displayName:n||r,store:i},this.activateDocument(o)},switchDocument(t){const e=Object.keys(this.documents),o=e.findIndex((t=>this.activeDocumentId===t));let n=o+t;0!==e.length&&(-1===o||n>=e.length?n=0:n<0&&(n=e.length-1),this.activateDocument(e[n]))},pauseActivity(){this.activeDocument?.store().stop()},resumeActivity(){this.activeDocument?.store().start()},activateDocument(t){this.pauseActivity(),this.activeDocumentId=t,this.resumeActivity()},openTestDocuments(){this.openDocument("flip-flop.alfx",JSON.stringify(tn),(0,E.Z)(),"flip-flop.alfx")},navigateDocumentList(t){const e=Object.keys(this.documents),o=e.findIndex((t=>t===this.activeDocumentId));let n=o+t;n<0&&(n=e.length-1),n>=e.length&&(n=0),this.activateDocument(e[n])},toggleFullscreen(){this.isFullscreen=!this.isFullscreen,window.api.setFullscreen(this.isFullscreen)}}});var Bs=(0,x.aZ)({name:"Document",components:{Group:Wo,Editor:jo,Connection:kt,Item:Zo},props:{store:{type:Function,required:!0}},setup(t){const e=t.store(),o=Ms(),n=(0,O.iH)();let i=1,s={};function r(t){if(n.value){const o=Object.values(e.items).map((({boundingBox:t})=>t)),i=J.getGroupBoundingBox(o),s=n.value.$el.querySelector(".editor__grid");t(s,i)}}async function a(){r((async(t,o)=>{await Qo.printImage(e.zoom,t,o),e.isPrinting=!1}))}async function c(){r((async(t,n)=>{const{printArea:i}=Qo.createPrintArea(1/e.zoom,t,n,20,""),s=await Qo.createImage(i,"toBlob");await o.saveImage(s),e.isCreatingImage=!1}))}function l(t){return function(o){o.target instanceof HTMLInputElement||(e[t](),o.preventDefault())}}function u(t){if(!(t.target instanceof HTMLInputElement))switch(t.key){case"Escape":return e.deselectAll();case"a":return t.ctrlKey&&e.selectAll();default:return h(t)}}function d(t){s[t.key]=!1,i=1}function p(e){window.api.showContextMenu(Vo(t.store)),e.preventDefault(),e.stopPropagation()}function h(t){const o=(()=>{switch(t.key){case"ArrowLeft":return{x:-1,y:0};case"ArrowUp":return{x:0,y:-1};case"ArrowRight":return{x:1,y:0};case"ArrowDown":return{x:0,y:1}}})();if(o){const t=Math.min(i,10);e.moveSelectionPosition({x:o.x*t,y:o.y*t}),i*=1.05}}function m(){s={}}return(0,x.m0)((()=>{e.isPrinting&&a(),e.isCreatingImage&&c()})),(0,x.bv)((()=>{document.addEventListener("keydown",u),document.addEventListener("keyup",d),document.addEventListener("cut",l("cut")),document.addEventListener("copy",l("copy")),document.addEventListener("paste",l("paste")),window.addEventListener("blur",m)})),(0,x.Jd)((()=>{document.removeEventListener("keydown",u),document.removeEventListener("keyup",d),document.addEventListener("cut",l("cut")),document.addEventListener("copy",l("copy")),document.addEventListener("paste",l("paste")),window.removeEventListener("blur",m)})),{store:e,editor:n,storeDefinition:t.store,onKeyDown:u,onKeyUp:d,onContextMenu:p,clearKeys:m,gridSize:20}}});const zs=(0,nt.Z)(Bs,[["render",_]]);var Ns=zs;const Fs={class:"toolbar"},js={class:"toolbar__fixed"},Ts={class:"toolbar__left"},Ls={class:"toolbar__right"};function $s(t,e,o,n,i,s){const r=(0,x.up)("toolbar-button"),a=(0,x.up)("toolbar-separator"),c=(0,x.up)("scroll-fade");return(0,x.wg)(),(0,x.iD)("div",Fs,[(0,x._)("div",js,[(0,x.Wm)(r,{icon:t.faScrewdriverWrench,text:"Toolbox","is-toolbox":"",onClick:t.store.toggleToolbox,active:t.store.isToolboxOpen},null,8,["icon","onClick","active"]),(0,x.Wm)(a)]),(0,x.Wm)(c,{class:"toolbar__scrollable"},{default:(0,x.w5)((()=>[(0,x._)("div",Ts,[(0,x.Wm)(r,{icon:t.faFolderOpen,text:"Open"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faFile,text:"New"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faSave,text:"Save"},null,8,["icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{onClick:t.store.undo,disabled:!t.store.canUndo,icon:t.faReply,text:"Undo"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(r,{onClick:t.store.redo,disabled:!t.store.canRedo,icon:t.faShare,text:"Redo"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{onClick:e[0]||(e[0]=e=>t.store.rotate(1)),disabled:!t.store.hasSelectedItems,icon:t.faRotateForward,text:"Rotate"},null,8,["disabled","icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{onClick:t.store.group,disabled:!t.store.canGroup,icon:t.faObjectGroup,text:"Group"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(r,{onClick:t.store.ungroup,disabled:!t.store.canUngroup,icon:t.faObjectUngroup,text:"Ungroup"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{icon:t.faScissors,text:"Cut"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faCopy,text:"Copy"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faPaste,text:"Paste"},null,8,["icon"]),(0,x.Wm)(r,{onClick:t.store.deleteSelection,disabled:!t.store.hasSelection,icon:t.faBan,text:"Delete"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{onClick:t.store.saveIntegratedCircuit,icon:t.faMicrochip,text:"Build IC"},null,8,["onClick","icon"])]),(0,x._)("div",Ls,[(0,x.Wm)(r,{icon:t.faBug,active:t.store.isDebugging,onClick:t.store.toggleDebugger,text:"Debug"},null,8,["icon","active","onClick"]),(0,x.Wm)(a),(0,x.Wm)(r,{icon:t.faArrowsRotate,onClick:t.store.resetCircuit,text:"Reset"},null,8,["icon","onClick"]),(0,x.Wm)(r,{icon:t.faForwardStep,disabled:!t.store.isDebugging||t.store.isCircuitEvaluated,onClick:t.store.stepThroughCircuit,text:"Next"},null,8,["icon","disabled","onClick"]),(0,x.Wm)(a),(0,x.Wm)(r,{icon:t.faWaveSquare,disabled:t.store.isDebugging,active:!t.store.isDebugging&&t.store.isOscilloscopeOpen,onClick:t.store.toggleOscilloscope,text:"Monitor"},null,8,["icon","disabled","active","onClick"])])])),_:1})])}var Ws=o(6024),Rs=o(1436);const As={class:"toolbar-button__text"};function Vs(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.iD)("button",{tabindex:0,class:(0,S.C_)([{"toolbar-button--active":t.active&&!t.isToolbox,"toolbar-button--toolbox":t.active&&t.isToolbox,"toolbar-button--disabled":t.disabled},"toolbar-button"]),role:"button",onClick:e[0]||(e[0]=(...e)=>t.onClick&&t.onClick(...e))},[t.icon?((0,x.wg)(),(0,x.j4)(r,{key:0,icon:t.icon,class:"toolbar-button__icon"},null,8,["icon"])):((0,x.wg)(),(0,x.j4)(r,{key:1,icon:t.faUser,class:"toolbar-button__icon"},null,8,["icon"])),(0,x._)("div",As,(0,S.zw)(t.text),1)],2)}const Us=["viewBox"],qs=["d"];function Hs(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",viewBox:`0 0 ${t.width} ${t.height}`},[(0,x._)("path",{fill:"currentColor",d:t.svgPath},null,8,qs)],8,Us)}var Ks=(0,x.aZ)({name:"Icon",props:{icon:{type:Object,required:!0}},setup(t){const e=(0,x.Fl)((()=>t.icon.icon[0])),o=(0,x.Fl)((()=>t.icon.icon[1])),n=(0,x.Fl)((()=>t.icon.icon[4]));return{width:e,height:o,svgPath:n}}});const Gs=(0,nt.Z)(Ks,[["render",Hs]]);var Ys=Gs,Xs=(0,x.aZ)({name:"ToolbarButton",components:{Icon:Ys},data(){return{faUser:Rs.ILF}},emits:{click:t=>!0},props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},isToolbox:{type:Boolean,default:!1},icon:{type:Object,default:null},text:{type:String,default:""}},setup(t,{emit:e}){function o(o){o.stopPropagation(),o.preventDefault(),t.disabled||e("click",o)}return{onClick:o}}});const Js=(0,nt.Z)(Xs,[["render",Vs]]);var Qs=Js;const tr={class:"toolbar-separator"};function er(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",tr)}var or=(0,x.aZ)({name:"ToolbarSeparator"});const nr=(0,nt.Z)(or,[["render",er]]);var ir=nr;function sr(t,e,o,n,i,s){const r=(0,x.up)("resizable");return(0,x.wg)(),(0,x.j4)(r,{ref:"scroll",class:(0,S.C_)(["scroll-fade",{"scrollbar-fade--show-scrollbar":!t.hideScrollbar}]),style:(0,S.j5)(`--mask-image-content: linear-gradient(to right, ${t.gradientStyle})`),onScroll:t.onChange,onResize:t.onChange},{default:(0,x.w5)((()=>[(0,x.WI)(t.$slots,"default")])),_:3},8,["class","style","onScroll","onResize"])}var rr=(0,x.aZ)({name:"ScrollFade",components:{Resizable:st},props:{hideScrollbar:{type:Boolean,default:!1}},setup(){const t="transparent, black var(--mask-width)",e="black calc(100% - var(--mask-width)), transparent",o=(0,O.iH)(),n=(0,O.iH)("");function i(o){const{scrollWidth:i,scrollLeft:s,clientWidth:r}=o;if(i>r){const o=[];return s>0&&o.push(t),s+r<i&&o.push(e),n.value=o.join(", "),o.join(", ")}return"transparent transparent"}function s(){o.value&&(n.value=i(o.value.$el))}return{onChange:s,gradientStyle:n,scroll:o}}});const ar=(0,nt.Z)(rr,[["render",sr]]);var cr=ar,lr=(0,x.aZ)({name:"Toolbar",components:{ToolbarButton:Qs,ToolbarSeparator:ir,ScrollFade:cr},data(){return{faScrewdriverWrench:Rs.eDR,faFolderOpen:Ws.cC_,faFile:Ws.gMD,faSave:Ws.r6l,faScissors:Rs.EQg,faCopy:Ws.kZ_,faPaste:Ws.O4,faObjectGroup:Ws.tU8,faObjectUngroup:Ws.B7S,faRotateBackward:Rs.ptP,faRotateForward:Rs.fbl,faReply:Rs.Lh7,faShare:Rs.zBy,faMicrochip:Rs.zvy,faBan:Rs.gPx,faArrowsRotate:Rs.T80,faBug:Rs.QLU,faForwardStep:Rs.Jwg,faWaveSquare:Rs.fQK}},props:{store:{type:Function,required:!0}},setup(t){const e=t.store(),o=(0,x.Fl)((()=>e.simulation.circuit.isComplete()));return{store:e,isComplete:o}}});const ur=(0,nt.Z)(lr,[["render",$s]]);var dr=ur;function pr(t,e,o,n,i,s){const r=(0,x.up)("toolbox-item"),a=(0,x.up)("toolbox-layout");return(0,x.wg)(),(0,x.j4)(a,{"is-open":t.isToolboxOpen},(0,x.Nv)({_:2},[(0,x.Ko)(t.factories,((e,o)=>({name:o,fn:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(e,((e,o)=>((0,x.wg)(),(0,x.j4)(r,{factory:e,key:o,label:o,zoom:t.zoom,onDrop:t.onDrop},null,8,["factory","label","zoom","onDrop"])))),128))]))})))]),1032,["is-open"])}const hr={class:"toolbox-item__parent"},mr={class:"toolbox-item__label"};function fr(t,e,o,n,i,s){const r=(0,x.up)("circuit-component"),a=(0,x.up)("resizable"),c=(0,x.up)("draggable");return(0,x.wg)(),(0,x.j4)(c,{class:"toolbox-item",tabindex:0,onDragStart:t.onDragStart,onDrag:t.onDrag,onDragEnd:t.onDragEnd,onClick:e[2]||(e[2]=e=>t.$emit("drop",t.factory))},{default:(0,x.w5)((()=>[(0,x._)("div",hr,[(0,x.Wm)(a,{class:"toolbox-item__preview",ref:"preview",onResize:e[1]||(e[1]=e=>t.onSizeChanged(e,"preview"))},{default:(0,x.w5)((()=>[(0,x.Wm)(a,{class:"toolbox-item__inner",ref:"selectable",style:(0,S.j5)({zoom:t.zoom}),onResize:e[0]||(e[0]=e=>t.onSizeChanged(e,"selectable"))},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{type:t.item.type,subtype:t.item.subtype,ports:t.ports,properties:t.item.properties},null,8,["type","subtype","ports","properties"])])),_:1},8,["style"])])),_:1},512)]),(0,x._)("div",mr,(0,S.zw)(t.item.subtype),1)])),_:1},8,["onDragStart","onDrag","onDragEnd"])}var gr=(0,x.aZ)({name:"ToolboxItem",components:{CircuitComponent:qe,Draggable:ct,Resizable:st},emits:{drop:(t,e)=>!0},props:{factory:{type:Function,required:!0},zoom:{type:Number,default:1}},setup(t,{emit:e}){const o=(0,O.iH)(),n=(0,O.iH)(1),{item:i,ports:s}=t.factory(),r={selectable:new DOMRect,preview:new DOMRect};let a=null;function c(t,e){r[e]=t;const o=r.selectable,i=r.preview,s=Math.max(o.width/i.width,o.height/i.height);n.value=Math.min(1/s,1)}function l(){const e=r.selectable;a=o.value?.$el.cloneNode(!0),a.style.position="absolute",a.style["zoom"]=`${t.zoom}`,a.style.width=`${e.width}px`,a.style.height=`${e.height}px`}function u({x:e,y:o}){if(!a)return;document.body.contains(a)||document.body.appendChild(a);const{width:n,height:i}=a.getBoundingClientRect();a.style.left=(e-n/2*t.zoom)/t.zoom+"px",a.style.top=(o-i/2*t.zoom)/t.zoom+"px"}function d(o){a&&document.body.contains(a)&&(a.remove(),a=null,e("drop",t.factory,o))}return{onDragStart:l,onDrag:u,onDragEnd:d,onSizeChanged:c,item:i,ports:s,zoom:n,selectable:o}}});const vr=(0,nt.Z)(gr,[["render",fr]]);var yr=vr;const br=["onClick"];function wr(t,e,o,n,i,s){const r=(0,x.up)("scroll-fade");return(0,x.wg)(),(0,x.iD)("div",{ref:"toolbox",class:(0,S.C_)(["toolbox-layout",{"toolbox-layout--open":t.isOpen}]),style:(0,S.j5)({height:`${t.height}px`})},[(0,x.Wm)(r,{class:"toolbox-layout__categories","hide-scrollbar":!0},{default:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.categories,(e=>((0,x.wg)(),(0,x.iD)("div",{class:(0,S.C_)(["toolbox-layout__badge",{"toolbox-layout__badge--active":e===t.selected}]),key:e,onClick:o=>t.select(e)},(0,S.zw)(e),11,br)))),128))])),_:1}),(0,x.Wm)(r,{class:"toolbox-layout__items"},{default:(0,x.w5)((()=>[t.selected?((0,x.wg)(),(0,x.iD)("div",{key:t.selected,class:"toolbox-layout__fade-in"},[(0,x.WI)(t.$slots,t.selected)])):(0,x.kq)("",!0)])),_:3})],6)}var Ir=(0,x.aZ)({name:"Toolbox",components:{ScrollFade:cr},props:{isOpen:{type:Boolean,default:!1}},setup(t,{slots:e}){const o=(0,O.iH)(null),n=(0,O.iH)(null),i=(0,x.Fl)((()=>Object.keys(e))),s=(0,x.Fl)((()=>t.isOpen?n.value?.scrollHeight:0));function r(t){o.value=t}return r(i.value[0]),{categories:i,selected:o,select:r,height:s,toolbox:n}}});const xr=(0,nt.Z)(Ir,[["render",wr]]);var Sr=xr;const Cr=(t,e,o,n={})=>{const i=(0,E.Z)(),s=[Kn(i,(0,E.Z)(),bt.Right,bo.Output,"Output Port")],r=Hn(i,Po.InputNode,t,e,o,s);return r.properties={...n,startValue:{label:"Start value",value:-1,type:"number",options:{True:1,"Hi-Z":0,False:-1}}},{item:r,ports:s}};var Pr=Cr;const Dr=()=>Pr(Do.Clock,60,60,{interval:{label:"Interval",value:1e3,type:"number",min:100}});var Or=Dr;function _r(){const t=(0,E.Z)(),e=[Kn(t,(0,E.Z)(),bt.Left,bo.Input,"Input Port")],o=Hn(t,Po.OutputNode,Do.Lightbulb,40,40,e);return{item:o,ports:e}}function Zr(t,e,o){const n=(0,E.Z)(),i=[Kn(n,(0,E.Z)(),0,1,"Input Port 1"),Kn(n,(0,E.Z)(),0,1,"Input Port 2"),Kn(n,(0,E.Z)(),2,0,"Output Port")],s=Hn(n,Po.LogicGate,t,e,o,i);return s.properties={inputCount:{label:"Input count",value:2,type:"number",min:2},showInOscilloscope:{label:"Show in oscilloscope",value:!1,type:"boolean"}},{item:s,ports:i}}var kr={[Po.InputNode]:{[Do.Switch]:Pr.bind(void 0,Do.Switch,60,60),[Do.Clock]:Or},[Po.OutputNode]:{[Do.Lightbulb]:_r},[Po.LogicGate]:{[Do.And]:Zr.bind(void 0,Do.And,140,50),[Do.Nand]:Zr.bind(void 0,Do.Nand,140,50),[Do.Xnor]:Zr.bind(void 0,Do.Xnor,140,50),[Do.Nor]:Zr.bind(void 0,Do.Nor,140,50),[Do.Or]:Zr.bind(void 0,Do.Or,140,50)}},Er=(0,x.aZ)({name:"Toolbox",components:{ScrollFade:cr,ToolboxItem:yr,ToolboxLayout:Sr},props:{store:{type:Function,required:!0}},setup(t){const e=t.store(),o=(0,x.Fl)((()=>e.zoom)),n=(0,x.Fl)((()=>e.isToolboxOpen));function i(t,o){e.insertItemAtPosition(t(),o)}return{factories:kr,zoom:o,isToolboxOpen:n,onDrop:i}}});const Mr=(0,nt.Z)(Er,[["render",pr]]);var Br=Mr;const zr={class:"tab-item__label"};function Nr(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,S.C_)([{"tab-item--active":t.active,"tab-item--dirty":t.dirty},"tab-item"]),onMousedown:e[1]||(e[1]=e=>t.$emit("activate")),onTouchstart:e[2]||(e[2]=e=>t.$emit("activate"))},[(0,x._)("div",zr,(0,S.zw)(t.label)+(0,S.zw)(t.dirty?"*":""),1),(0,x._)("div",{class:"tab-item__close",onClick:e[0]||(e[0]=(0,I.iM)((e=>t.$emit("close")),["stop"]))}," ✖ ")],34)}var Fr=(0,x.aZ)({name:"TabItem",props:{active:{type:Boolean,default:!1},label:{type:String,required:!0},dirty:{type:Boolean,default:!1}}});const jr=(0,nt.Z)(Fr,[["render",Nr]]);var Tr=jr;const Lr={class:"tab-host"},$r={class:"tab-host__list"};function Wr(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",Lr,[(0,x._)("div",$r,[(0,x.WI)(t.$slots,"tabs")]),(0,x.WI)(t.$slots,"default")])}var Rr=(0,x.aZ)({name:"TabHost"});const Ar=(0,nt.Z)(Rr,[["render",Wr]]);var Vr=Ar;const Ur={key:0};function qr(t,e,o,n,i,s){const r=(0,x.up)("oscilloscope-title-bar"),a=(0,x.up)("oscilloscope-timeline"),c=(0,x.up)("oscilloscope-viewer");return t.isOscilloscopeOpen?((0,x.wg)(),(0,x.j4)(c,{key:0,modelValue:t.oscilloscopeHeight,"onUpdate:modelValue":e[0]||(e[0]=e=>t.oscilloscopeHeight=e),"collapse-height":40,onCollapse:t.closeOscilloscope},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{clearable:t.hasWaves,onClear:t.clearOscilloscope},null,8,["clearable","onClear"]),t.hasWaves?((0,x.wg)(),(0,x.j4)(a,{key:1,oscillogram:t.oscillogram},null,8,["oscillogram"])):((0,x.wg)(),(0,x.iD)("div",Ur," no waves to observe "))])),_:1},8,["modelValue","onCollapse"])):(0,x.kq)("",!0)}const Hr={class:"oscilloscope-timeline"},Kr={class:"oscilloscope-timeline__list",ref:"list"},Gr=["width","viewBox"],Yr=["points","stroke"];function Xr(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",Hr,[(0,x._)("div",Kr,[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.oscillogram,((t,e)=>((0,x.wg)(),(0,x.iD)("div",{key:e,style:(0,S.j5)({color:`hsla(${t.hue}, var(--lightness), var(--saturation), 0.8)`}),class:"oscilloscope-timeline__label"},(0,S.zw)(e),5)))),128))],512),(0,x._)("div",{class:"oscilloscope-timeline__display",ref:"timeline",onWheel:e[0]||(e[0]=(...e)=>t.onWheel&&t.onWheel(...e))},[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.oscillogram,((e,o)=>((0,x.wg)(),(0,x.iD)("div",{style:(0,S.j5)({width:`${t.totalWidth}px`}),key:o,class:"oscilloscope-timeline__item"},[(0,x._)("div",{style:(0,S.j5)({width:`${e.width}px`}),class:"oscilloscope-timeline__svg"},[((0,x.wg)(),(0,x.iD)("svg",{width:e.width,viewBox:`0 0 ${e.width} 1`,preserveAspectRatio:"none"},[(0,x._)("polyline",{points:e.points,stroke:`hsla(${e.hue}, var(--lightness), var(--saturation), 0.8)`,"stroke-width":"2",fill:"none","vector-effect":"non-scaling-stroke"},null,8,Yr)],8,Gr))],4)],4)))),128))],544)])}var Jr=(0,x.aZ)({name:"OscilloscopeTimeline",props:{oscillogram:{type:Object,required:!0}},computed:{totalWidth(){return Object.values(this.oscillogram).reduce(((t,{width:e})=>Math.max(e,t)),0)}},mounted(){const t=this.$refs.timeline,e=this.$refs.list;this.scrollToNextInterval(),e.addEventListener("scroll",this.onTimelineScroll),t.addEventListener("scroll",this.onTimelineScroll)},beforeUnmount(){const t=this.$refs.timeline,e=this.$refs.list;e.removeEventListener("scroll",this.onTimelineScroll),t.removeEventListener("scroll",this.onTimelineScroll)},methods:{onWheel(t){const e=this.$refs.timeline;e.scrollTop+=t.deltaY/10,t.preventDefault()},scrollToNextInterval(){const t=this.$refs.timeline;t.scrollLeft=t.scrollWidth},onTimelineScroll(){const t=this.$refs.list,e=this.$refs.timeline;e&&(t.scrollTop=e.scrollTop)}},watch:{oscillogram:{handler(){this.scrollToNextInterval()},deep:!0}}});const Qr=(0,nt.Z)(Jr,[["render",Xr]]);var ta=Qr;const ea={class:"oscilloscope-title-bar"},oa=(0,x._)("div",{class:"oscilloscope-title-bar__title"},"Oscilloscope",-1),na={class:"oscilloscope-title-bar__actions"},ia=["disabled"];function sa(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.iD)("div",ea,[oa,(0,x._)("div",na,[(0,x._)("button",{class:"oscilloscope-title-bar__button",title:"Clear oscilloscope",disabled:!t.clearable,onClick:e[0]||(e[0]=e=>t.$emit("clear"))},[(0,x.Wm)(r,{icon:t.faBan},null,8,["icon"])],8,ia),(0,x._)("button",{class:"oscilloscope-title-bar__button",title:"Close",onClick:e[1]||(e[1]=e=>t.$emit("close"))},[(0,x.Wm)(r,{icon:t.faClose},null,8,["icon"])])])])}var ra=(0,x.aZ)({name:"OscilloscopeTitleBar",components:{Icon:Ys},props:{clearable:{type:Boolean,default:!0}},setup(){return{faBan:Rs.gPx,faClose:Rs.YIN}}});const aa=(0,nt.Z)(ra,[["render",sa]]);var ca=aa;function la(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{ref:"viewer",class:"oscilloscope-viewer",style:(0,S.j5)({height:`${t.height}px`})},[(0,x._)("div",{class:"oscilloscope-viewer__touch-resizer",onTouchstart:e[1]||(e[1]=(...e)=>t.onTouchStart&&t.onTouchStart(...e)),onTouchmove:e[2]||(e[2]=(...e)=>t.onTouchMove&&t.onTouchMove(...e)),onTouchcancel:e[3]||(e[3]=(...e)=>t.onMouseUp&&t.onMouseUp(...e)),onTouchend:e[4]||(e[4]=(...e)=>t.onMouseUp&&t.onMouseUp(...e))},[(0,x._)("div",{class:"oscilloscope-viewer__mouse-resizer",onMousedown:e[0]||(e[0]=(...e)=>t.onMouseDown&&t.onMouseDown(...e))},null,32)],32),(0,x.WI)(t.$slots,"default")],4)}var ua=(0,x.aZ)({name:"OscilloscopeViewer",props:{collapseHeight:{type:Number,default:20},modelValue:{type:Number,required:!0}},setup(t,{emit:e}){const o=(0,O.iH)(t.modelValue),n=(0,O.iH)();let i=0,s=0,r=!1;function a(t){i=o.value,s=t.clientY,r=!0}function c(t){a(t.touches[0])}function l(a){if(!r||!n.value)return;const c=n.value.parentElement?.getBoundingClientRect();o.value+=Math.min(s-a.clientY,c?.height||1/0),s=a.clientY,o.value<=t.collapseHeight?e("collapse",i):e("update:modelValue",o.value)}function u(t){l(t.touches[0])}function d(){r=!1}return(0,x.bv)((()=>{window.addEventListener("mousemove",l),window.addEventListener("mouseup",d)})),(0,x.Ah)((()=>{window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",d)})),{onMouseDown:a,onMouseUp:d,onTouchStart:c,onTouchMove:u,height:o,viewer:n}}});const da=(0,nt.Z)(ua,[["render",la]]);var pa=da,ha=(0,x.aZ)({name:"Oscilloscope",components:{OscilloscopeTimeline:ta,OscilloscopeTitleBar:ca,OscilloscopeViewer:pa},props:{store:{type:Function,required:!0}},setup(t){const e=t.store(),o=(0,O.iH)(e.oscilloscopeHeight),n=(0,x.Fl)((()=>e.isOscilloscopeOpen)),i=(0,x.Fl)((()=>e.oscillogram)),s=(0,x.Fl)((()=>Object.keys(i).length>0));return{hasWaves:s,oscillogram:i,oscilloscopeHeight:o,isOscilloscopeOpen:n,clearOscilloscope:e.clearOscilloscope,closeOscilloscope:e.closeOscilloscope}}});const ma=(0,nt.Z)(ha,[["render",qr]]);var fa=ma;const ga={key:0},va={key:1},ya={key:2};function ba(t,e,o,n,i,s){const r=(0,x.up)("icon"),a=(0,x.up)("status-bar-button"),c=(0,x.up)("status-bar-zoom"),l=(0,x.up)("status-bar-viewer");return(0,x.wg)(),(0,x.j4)(l,null,{left:(0,x.w5)((()=>[t.isPrinting?((0,x.wg)(),(0,x.iD)("span",ga,"Printing...")):t.isCreatingImage?((0,x.wg)(),(0,x.iD)("span",va,"Rendering image...")):((0,x.wg)(),(0,x.iD)("span",ya,"Ready"))])),right:(0,x.w5)((()=>[(0,x.Wm)(a,{title:"Zoom out",disabled:t.store.zoomLevel<=.1,onClick:e[0]||(e[0]=e=>t.store.incrementZoom(-1))},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{icon:t.faMinus},null,8,["icon"])])),_:1},8,["disabled"]),(0,x.Wm)(c,{type:"range",class:"status-bar__range",min:0,step:10,max:200,zoom:t.store.zoomLevel,onZoom:e[1]||(e[1]=e=>t.store.setZoom({zoom:e}))},null,8,["zoom"]),(0,x.Wm)(a,{title:"Zoom in",disabled:t.store.zoomLevel>=2,onClick:e[2]||(e[2]=e=>t.store.incrementZoom(1))},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{icon:t.faPlus},null,8,["icon"])])),_:1},8,["disabled"]),(0,x.Wm)(a,{width:"3em",onClick:e[3]||(e[3]=e=>t.store.setZoom({zoom:1}))},{default:(0,x.w5)((()=>[(0,x.Uk)((0,S.zw)(t.zoomPercent)+"% ",1)])),_:1}),(0,x.Wm)(a,{title:"Toggle fullscreen",onClick:e[4]||(e[4]=e=>t.$emit("fullscreen"))},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{icon:t.isFullscreen?t.faCompress:t.faExpand},null,8,["icon"])])),_:1})])),_:1})}const wa=["disabled","title"];function Ia(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("button",{class:"status-bar-button",disabled:t.disabled,title:t.title,style:(0,S.j5)({width:t.width})},[(0,x.WI)(t.$slots,"default")],12,wa)}var xa=(0,x.aZ)({name:"StatusBarButton",props:{disabled:{type:Boolean,default:!1},title:{type:String,default:""},width:{type:String,default:"2em"}}});const Sa=(0,nt.Z)(xa,[["render",Ia]]);var Ca=Sa;const Pa={class:"status-bar-viewer"},Da={class:"status-bar-viewer__left"},Oa={class:"status-bar-viewer__right"};function _a(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",Pa,[(0,x._)("div",Da,[(0,x.WI)(t.$slots,"left")]),(0,x._)("div",Oa,[(0,x.WI)(t.$slots,"right")])])}var Za=(0,x.aZ)({name:"StatusBarViewer"});const ka=(0,nt.Z)(Za,[["render",_a]]);var Ea=ka;const Ma=["step","min","max","value"];function Ba(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("input",{type:"range",class:"status-bar-zoom",step:t.step,min:t.min,max:t.max,value:t.value,onInput:e[0]||(e[0]=(...e)=>t.onInput&&t.onInput(...e))},null,40,Ma)}var za=(0,x.aZ)({name:"StatusBarZoom",components:{Icon:Ys},props:{zoom:{type:Number,required:!0},min:{type:Number,default:0},max:{type:Number,default:200},step:{type:Number,default:10}},setup(t,{emit:e}){const o=(0,x.Fl)((()=>Math.round(100*t.zoom)));function n(t){const o=t.target,n=parseFloat(o.value);e("zoom",n/100)}return{onInput:n,value:o}}});const Na=(0,nt.Z)(za,[["render",Ba]]);var Fa=Na,ja=(0,x.aZ)({name:"StatusBar",components:{Icon:Ys,StatusBarButton:Ca,StatusBarViewer:Ea,StatusBarZoom:Fa},props:{store:{type:Function,required:!0},isFullscreen:{type:Boolean,default:!1}},setup(t){const e=t.store(),o=(0,x.Fl)((()=>e.isPrinting)),n=(0,x.Fl)((()=>e.isCreatingImage)),i=(0,x.Fl)((()=>Math.round(100*e.zoomLevel)));return{store:e,isPrinting:o,isCreatingImage:n,zoomPercent:i,faMinus:Rs.Kl4,faPlus:Rs.r8p,faExpand:Rs.TL5,faCompress:Rs.Qj4}}});const Ta=(0,nt.Z)(ja,[["render",ba]]);var La=Ta;function $a(){const t=Ms(),e=null!==t.activeDocumentId,o=Object.keys(t.documents),n=t.activeDocument?.store(),i=[{label:"&New Circuit",accelerator:"CommandOrControl+N",click:t.newDocument},{type:"separator"},{label:"&Open Circuit",accelerator:"CommandOrControl+O",click:t.selectDocument},{label:"Open &Integrated Circuit",accelerator:"CommandOrControl+Shift+O",click:t.selectDocument},{type:"separator"},{label:"Save",enabled:e,accelerator:"CommandOrControl+S",click:()=>t.saveActiveDocument()},{label:"Save As...",enabled:e,accelerator:"CommandOrControl+Shift+S",click:()=>t.saveActiveDocument(!0)},{label:"Save All",enabled:e,accelerator:"CommandOrControl+Shift+A",click:()=>console.log("root store save all")},{type:"separator"},{label:"Print",enabled:e,accelerator:"CommandOrControl+P",click:()=>n?.print()},{type:"separator"},{label:"Export...",enabled:e,submenu:[{label:"Integrated Circuit",accelerator:"CommandOrControl+Shift+E",click:()=>console.log("export IC")},{label:"PNG Image",accelerator:"CommandOrControl+Shift+I",click:()=>n?.createImage()}]},{type:"separator"},{label:"Preferences",submenu:[{label:"Global Preferences",accelerator:"CommandOrControl+,",click:()=>console.log("global prefs")},{label:"Document Preferences",accelerator:"CommandOrControl+Shift+,",click:()=>console.log("doc prefs")}]}];if(Object.keys(t.documents).length>1){const e=[{label:"Previous File",accelerator:"Ctrl+Shift+Tab",click:()=>t.switchDocument(-1)},{label:"Next File",accelerator:"Ctrl+Tab",click:()=>t.switchDocument(1)},{type:"separator"}];for(let n=0;n<o.length;n++)e.push({type:"checkbox",label:t.documents[o[n]].displayName,checked:t.activeDocumentId===o[n],click:()=>t.activateDocument(o[n])});i.push({type:"separator"}),i.push({label:"Switch to...",submenu:e})}return i.push({type:"separator"}),i.push({label:"Close Document",accelerator:"CmdOrCtrl+W",enabled:e,click:()=>t.closeDocument(t.activeDocumentId)}),i.push({type:"separator"}),i.push({label:"Exit",accelerator:"CmdOrCtrl+Q",click:()=>window.close()}),i}function Wa(t){const e=t(),o=[];let n=!1;for(let s=1;s<=8;s++){const t=25*s/100,i=e.zoomLevel===t;n=n||i,o.push({type:"checkbox",checked:i,label:100*t+"%",accelerator:1===t?"CommandOrControl+0":void 0,click:()=>e.setZoom({zoom:t})})}n||o.unshift({type:"checkbox",checked:!0,label:"Custom"});const i=[{label:"&Zoom In",accelerator:"CommandOrControl+=",enabled:e.zoomLevel<2,click:()=>e.incrementZoom(1)},{label:"&Zoom Out",accelerator:"CommandOrControl+-",enabled:e.zoomLevel>.1,click:()=>e.incrementZoom(-1)},{label:"&Zoom...",submenu:o},{type:"separator"},{label:"&Pan to Center",accelerator:"CommandOrControl+;",click:e.panToCenter},{type:"separator"}];return i.concat(Ao(t))}function Ra(){const t=Ms(),e=[{label:"File",submenu:$a()}];return t.activeDocument&&(e.push({label:"Edit",submenu:Ro(t.activeDocument.store)}),e.push({label:"View",submenu:Wa(t.activeDocument.store).concat([{type:"separator"},{type:"checkbox",click:t.toggleFullscreen,checked:t.isFullscreen,accelerator:"F11",label:"Fullscreen"}])})),e}const Aa={class:"main-view"},Va={class:"main-view__top"},Ua={class:"main-view__middle"},qa={class:"main-view__bottom"};function Ha(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",Aa,[(0,x._)("div",Va,[(0,x.WI)(t.$slots,"top")]),(0,x._)("div",Ua,[(0,x.WI)(t.$slots,"middle")]),(0,x._)("div",qa,[(0,x.WI)(t.$slots,"bottom")])])}var Ka=(0,x.aZ)({name:"MainView"});const Ga=(0,nt.Z)(Ka,[["render",Ha]]);var Ya=Ga;var Xa=!1,Ja=(0,x.aZ)({name:"App",components:{Document:Ns,Toolbar:dr,TabItem:Tr,TabHost:Vr,Toolbox:Br,Oscilloscope:fa,StatusBar:La,MainView:Ya},setup(){const t=Ms(),{activeDocument:e,activeDocumentId:o,documents:n,hasOpenDocuments:i,isFullscreen:s}=(0,w.Jk)(t),r=(0,O.iH)(!1);function a(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),r.value=!0}async function c(e){e.stopPropagation(),e.preventDefault();const o=e.dataTransfer?.files;if(o)for(let n=0;n<o.length;n++)await t.openDocumentFromPath(o[n].path);r.value=!1}function l(){r.value=!1}function u(t){t.ctrlKey&&"R"===t.key.toUpperCase()&&window.location.reload()}return i.value||t.openTestDocuments(),(0,x.m0)((()=>window.api.setApplicationMenu(Ra()))),(0,x.m0)((()=>{document.title=t.activeDocument?`${t.activeDocument.displayName} - Aristotle`:"Aristotle"})),window.api.onBeforeClose(t.closeAll),window.api.onOpenFile(t.openDocumentFromPath),(0,x.bv)((()=>{document.addEventListener("keydown",u),document.addEventListener("dragover",a),document.addEventListener("dragleave",l),document.addEventListener("drop",c)})),(0,x.Jd)((()=>{document.removeEventListener("keydown",u),document.removeEventListener("dragover",a),document.removeEventListener("dragleave",l),document.removeEventListener("drop",c)})),{activeDocument:e,activeDocumentId:o,documents:n,hasOpenDocuments:i,isDropping:r,isFullscreen:s,toggleFullscreen:t.toggleFullscreen,activateDocument:t.activateDocument,closeDocument:t.closeDocument,switchDocument:t.switchDocument,openIntegratedCircuit:t.openIntegratedCircuit}},data(){return{horizontal:!1,lastPosition:0,toolboxWidth:20,oscilloscopeHeight:80,isMobile:Xa}}});const Qa=(0,nt.Z)(Ja,[["render",D]]);var tc=Qa;window.api||(window.api={showContextMenu(){},setApplicationMenu(){},showOpenFileDialog(){return[]},showSaveFileDialog(){return""},showMessageBox(){return 0},beep(){},quit(){},copy(){},paste(){return""},onBeforeClose(){},onOpenFile(){},openFile(){return""},saveFile(){},setFullscreen(){}}),(0,I.ri)(tc).use((0,w.WB)()).mount("#app")}},e={};function o(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(s.exports,s,s.exports,o),s.loaded=!0,s.exports}o.m=t,function(){var t=[];o.O=function(e,n,i,s){if(!n){var r=1/0;for(u=0;u<t.length;u++){n=t[u][0],i=t[u][1],s=t[u][2];for(var a=!0,c=0;c<n.length;c++)(!1&s||r>=s)&&Object.keys(o.O).every((function(t){return o.O[t](n[c])}))?n.splice(c--,1):(a=!1,s<r&&(r=s));if(a){t.splice(u--,1);var l=i();void 0!==l&&(e=l)}}return e}s=s||0;for(var u=t.length;u>0&&t[u-1][2]>s;u--)t[u]=t[u-1];t[u]=[n,i,s]}}(),function(){o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,{a:e}),e}}(),function(){o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){o.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={826:0};o.O.j=function(e){return 0===t[e]};var e=function(e,n){var i,s,r=n[0],a=n[1],c=n[2],l=0;if(r.some((function(e){return 0!==t[e]}))){for(i in a)o.o(a,i)&&(o.m[i]=a[i]);if(c)var u=c(o)}for(e&&e(n);l<r.length;l++)s=r[l],o.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return o.O(u)},n=self["webpackChunkaristotle"]=self["webpackChunkaristotle"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=o.O(void 0,[998],(function(){return o(584)}));n=o.O(n)})();
//# sourceMappingURL=index.016d63b4.js.map