(function(){"use strict";var t={2020:function(t,e,o){var n={};o.r(n),o.d(n,{copy:function(){return pi},cut:function(){return di},paste:function(){return hi}});var i={};o.r(i),o.d(i,{commitPreviewedConnection:function(){return fi},connect:function(){return bi},createConnection:function(){return yi},cycleConnectionPreviews:function(){return vi},destroyConnection:function(){return wi},disconnect:function(){return Ii},setConnectionPreview:function(){return mi},unsetConnectionPreview:function(){return gi}});var s={};o.r(s),o.d(s,{clearBaseItems:function(){return _i},clearStatelessInfo:function(){return Di},createImage:function(){return Si},loadDocument:function(){return xi},print:function(){return Ci}});var r={};o.r(r),o.d(r,{addFreeportItem:function(){return Zi},connectFreeport:function(){return Ei},createFreeport:function(){return Bi},disconnectFreeport:function(){return ki}});var a={};o.r(a),o.d(a,{destroyGroup:function(){return Ni},group:function(){return Mi},ungroup:function(){return zi}});var c={};o.r(c),o.d(c,{addItem:function(){return ji},insertItemAtPosition:function(){return Li},removeElement:function(){return Wi},resetItemValue:function(){return Ti},setInputCount:function(){return $i},setProperties:function(){return Ri}});var l={};o.r(l),o.d(l,{panDelta:function(){return Ai},panTo:function(){return Vi},panToCenter:function(){return Ui}});var u={};o.r(u),o.d(u,{addPort:function(){return Hi},monitorPort:function(){return Qi},removePort:function(){return Ki},setActivePortId:function(){return Yi},setConnectablePortIds:function(){return Gi},setPortValue:function(){return Xi},togglePortMonitoring:function(){return Ji},unmonitorPort:function(){return ts}});var d={};o.r(d),o.d(d,{centerAll:function(){return es},dragItem:function(){return is},moveSelectionPosition:function(){return ss},setItemPosition:function(){return ns},setPortRelativePosition:function(){return os},setSelectionPosition:function(){return rs}});var p={};o.r(p),o.d(p,{rotate:function(){return us}});var h={};o.r(h),o.d(h,{createSelection:function(){return gs},deleteSelection:function(){return ws},deselectAll:function(){return ms},deselectItem:function(){return ds},recycleSelection:function(){return bs},selectAll:function(){return hs},selectItem:function(){return ps},selectItemConnections:function(){return fs},setSelectionState:function(){return ys},updateSelectionList:function(){return vs}});var m={};o.r(m),o.d(m,{clearOscilloscope:function(){return ks},closeOscilloscope:function(){return Zs},onError:function(){return Cs},onSimulationUpdate:function(){return xs},openOscilloscope:function(){return Os},resetCircuit:function(){return Ss},stepThroughCircuit:function(){return Ds},toggleDebugger:function(){return _s},toggleOscillatorRecording:function(){return Is},toggleOscilloscope:function(){return Ps}});var g={};o.r(g),o.d(g,{setGroupBoundingBox:function(){return Fs},setItemBoundingBox:function(){return Ns},setItemSize:function(){return zs},setViewerSize:function(){return Ms},updateCanvasSize:function(){return Es}});var f={};o.r(f),o.d(f,{setSnapBoundaries:function(){return js}});var v={};o.r(v),o.d(v,{applyState:function(){return Vs},cacheState:function(){return $s},commitCachedState:function(){return Rs},commitState:function(){return Ws},redo:function(){return Ts},undo:function(){return Ls}});var y={};o.r(y),o.d(y,{bringForward:function(){return qs},bringToFront:function(){return Ks},incrementZIndex:function(){return Ys},sendBackward:function(){return Us},sendToBack:function(){return Hs},setZIndex:function(){return Gs}});var b={};o.r(b),o.d(b,{incrementZoom:function(){return tr},setZoom:function(){return er}});var w=o(8262),I=o(9963),x=o(6252),C=o(3577);const S={key:0},D={key:1};function _(t,e,o,n,i,s){const r=(0,x.up)("toolbar"),a=(0,x.up)("toolbox"),c=(0,x.up)("tab-item"),l=(0,x.up)("document"),u=(0,x.up)("tab-host"),d=(0,x.up)("oscilloscope"),p=(0,x.up)("status-bar"),h=(0,x.up)("main-view"),m=(0,x.up)("builder-view");return(0,x.wg)(),(0,x.iD)(x.HY,null,[(0,x._)("div",{class:(0,C.C_)(["app__dropzone",{"app__dropzone--active":t.isDropping}])},null,2),t.activeDocumentId&&t.activeDocument?((0,x.wg)(),(0,x.j4)(h,{key:0,"is-blurred":t.isDialogOpen,onContextmenu:t.onContextMenu},{top:(0,x.w5)((()=>[t.isMobile?((0,x.wg)(),(0,x.iD)("div",S,"mobile bar")):(0,x.kq)("",!0),((0,x.wg)(),(0,x.j4)(r,{key:t.activeDocumentId,store:t.activeDocument.store},null,8,["store"])),(0,x.Wm)(a,{"is-open":t.isToolboxOpen,store:t.activeDocument.store},null,8,["is-open","store"])])),middle:(0,x.w5)((()=>[(0,x.Wm)(u,null,(0,x.Nv)({default:(0,x.w5)((()=>[((0,x.wg)(),(0,x.j4)(l,{key:t.activeDocumentId,store:t.activeDocument.store,onSwitch:t.switchDocument,onOpenIntegratedCircuit:t.openIntegratedCircuit},null,8,["store","onSwitch","onOpenIntegratedCircuit"]))])),_:2},[t.isMobile?void 0:{name:"tabs",fn:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.documents,((e,o)=>((0,x.wg)(),(0,x.j4)(c,{key:o,label:e.displayName,active:t.activeDocumentId===o,dirty:e.store().isDirty,onActivate:e=>t.activateDocument(o.toString()),onClose:e=>t.closeDocument(o.toString())},null,8,["label","active","dirty","onActivate","onClose"])))),128))]))}]),1024)])),bottom:(0,x.w5)((()=>[((0,x.wg)(),(0,x.j4)(d,{key:t.activeDocumentId,store:t.activeDocument.store},null,8,["store"])),t.isMobile?(0,x.kq)("",!0):((0,x.wg)(),(0,x.j4)(p,{key:t.activeDocumentId,store:t.activeDocument.store,"is-fullscreen":t.isFullscreen,onFullscreen:t.toggleFullscreen},null,8,["store","is-fullscreen","onFullscreen"]))])),_:1},8,["is-blurred","onContextmenu"])):((0,x.wg)(),(0,x.iD)("div",D," no documents open "+(0,C.zw)(t.isDropping),1)),t.isBuilderOpen?((0,x.wg)(),(0,x.j4)(m,{key:2})):(0,x.kq)("",!0)],64)}var P=o(2262);function O(t,e,o,n,i,s){const r=(0,x.up)("item"),a=(0,x.up)("connection"),c=(0,x.up)("group"),l=(0,x.up)("editor");return(0,x.wg)(),(0,x.j4)(l,{ref:"editor",zoom:t.store.zoomLevel,"grid-size":t.gridSize,tabindex:0,offset:{x:t.store.canvas.left,y:t.store.canvas.top},width:t.store.canvas.right-t.store.canvas.left,height:t.store.canvas.bottom-t.store.canvas.top,onPan:t.store.panTo,onDeselect:t.store.deselectAll,onSelection:t.store.createSelection,onZoom:t.store.setZoom,onContextmenu:t.onContextMenu,onResize:t.store.setViewerSize},{default:(0,x.w5)((()=>[(0,x._)("div",{tabindex:0,onFocus:e[0]||(e[0]=e=>t.store.recycleSelection(!1))},null,32),t.store.hasLoaded?((0,x.wg)(!0),(0,x.iD)(x.HY,{key:0},(0,x.Ko)(t.store.baseItems,(e=>((0,x.wg)(),(0,x.iD)(x.HY,null,["type"in e?((0,x.wg)(),(0,x.j4)(r,{tabindex:0,store:t.storeDefinition,id:e.id,key:e.id,"is-selected":e.isSelected,flash:t.store.isDebugging&&t.store.isCircuitEvaluated,"z-index":e.zIndex+1e3,onContextmenu:t.onContextMenu},null,8,["store","id","is-selected","flash","z-index","onContextmenu"])):((0,x.wg)(),(0,x.j4)(a,{tabindex:0,store:t.storeDefinition,id:e.id,key:`c${e.id}`,"is-selected":e.isSelected,"is-preview":t.store.connectionPreviewId===e.id,flash:t.store.isDebugging&&t.store.isCircuitEvaluated,"z-index":e.zIndex,onContextmenu:t.onContextMenu},null,8,["store","id","is-selected","is-preview","flash","z-index","onContextmenu"]))],64)))),256)):(0,x.kq)("",!0),(0,x._)("div",{tabindex:0,onFocus:e[1]||(e[1]=e=>t.store.recycleSelection(!0))},null,32),((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.store.groups,(e=>((0,x.wg)(),(0,x.j4)(c,{key:e.id,id:e.id,"bounding-box":e.boundingBox,"is-selected":e.isSelected,"z-index":t.store.zIndex,zoom:t.store.zoom},null,8,["id","bounding-box","is-selected","z-index","zoom"])))),128))])),_:1},8,["zoom","grid-size","offset","width","height","onPan","onDeselect","onSelection","onZoom","onContextmenu","onResize"])}function Z(t,e,o,n,i,s){const r=(0,x.up)("wire"),a=(0,x.up)("draggable");return(0,x.wg)(),(0,x.j4)(a,{style:(0,C.j5)({zIndex:t.zIndex}),position:t.position,"is-selected":t.isSelected,"allow-touch-drag":null!==t.freeportId,onTouchhold:t.onDragStart,onDrag:t.onDrag,onDragEnd:t.onDragEnd,onSelect:e[0]||(e[0]=e=>t.selectItem(t.id,e)),onDeselect:e[1]||(e[1]=e=>t.deselectItem(t.id)),onContextmenu:t.onContextMenu},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{source:t.source,target:t.target,geometry:t.geometry,"is-selected":t.isSelected,"is-preview":t.isPreview,flash:t.flash,label:"TODO",ref:"root","data-test":"wire"},null,8,["source","target","geometry","is-selected","is-preview","flash"])])),_:1},8,["style","position","is-selected","allow-touch-drag","onTouchhold","onDrag","onDragEnd","onContextmenu"])}var k,B=o(5934);function E(t,e,o,n,i,s){const r=(0,x.up)("resizable");return(0,x.wg)(),(0,x.j4)(r,{class:"draggable",ref:"draggable",style:(0,C.j5)(t.style),onMousedown:(0,I.iM)(t.onMouseDown,["left"]),onMouseup:t.onMouseUp,onTouchstart:t.onTouchStart,onTouchmove:t.onTouchMove,onTouchend:t.onTouchEnd,onTouchcancel:t.dragEnd,onFocus:t.onFocus},{default:(0,x.w5)((()=>[(0,x.WI)(t.$slots,"default")])),_:3},8,["style","onMousedown","onMouseup","onTouchstart","onTouchmove","onTouchend","onTouchcancel","onFocus"])}(function(t){t[t["Outer"]=0]="Outer",t[t["Inner"]=1]="Inner",t[t["Radial"]=2]="Radial",t[t["Grid"]=3]="Grid",t[t["None"]=4]="None"})(k||(k={}));var M=k;function z(t,e){return Math.round(t/e)*e}function N(t,e,o){return Math.hypot(t.x-e.x,t.y-e.y)<=o}function F(t,e){return{x:z(t.left,e)-t.left,y:z(t.top,e)-t.top}}function j(t,e,o){for(let n=0;n<t.length;n++){const i=t[n];if(N({x:i.left,y:i.top},{x:e.left,y:e.top},o))return{x:i.left-e.left,y:i.top-e.top}}return{x:0,y:0}}function L(t,e,o){const n={x:0,y:0};for(let i=0;i<t.length;i++){const s=t[i],r=Math.abs(s.top-e.bottom)<=o,a=Math.abs(s.bottom-e.top)<=o,c=Math.abs(s.left-e.right)<=o,l=Math.abs(s.right-e.left)<=o;(e.left<=s.right&&e.left>=s.left||e.right>=s.left&&e.right<=s.right||e.left<=s.left&&e.right>=s.right)&&(r&&(n.y=s.top-e.bottom),a&&(n.y=s.bottom-e.top)),(e.top<=s.bottom&&e.top>=s.top||e.bottom>=s.top&&e.bottom<=s.bottom||e.top<=s.top&&e.bottom>=s.bottom)&&(c&&(n.x=s.left-e.right),l&&(n.x=s.right-e.left))}return n}function T(t,e,o,n){switch(o){case M.Radial:return j(t,e,n);case M.Grid:return F(e,n);case M.Outer:default:return L(t,e,n)}}function W(t,e,o,n){const i=(t,e,o)=>(o.y-t.y)*(e.x-t.x)>(e.y-t.y)*(o.x-t.x);return i(t,o,n)!==i(e,o,n)&&i(t,e,o)!==i(t,e,n)}function $(t,e,o){const n={x:o.left,y:o.top},i={x:o.right,y:o.top},s={x:o.right,y:o.bottom},r={x:o.left,y:o.bottom};return W(t,e,n,i)||W(t,e,i,s)||W(t,e,s,r)||W(t,e,r,n)}function R(t,e){return!(t.left>=e.right||e.left>=t.right)&&!(t.top>=e.bottom||e.top>=t.bottom)}function V(t,e){return{left:t.left*e,top:t.top*e,bottom:t.bottom*e,right:t.right*e}}function A(t){return t.left!==t.right||t.top!==t.bottom}function U(t){return[{left:t.x,right:t.x,top:-1/0,bottom:1/0},{left:-1/0,right:1/0,top:t.y,bottom:t.y}]}function q(t){return{left:t.x,top:t.y,right:t.x,bottom:t.y}}function H(t,e,o,n){if(e%2===0)return{left:t.x,top:t.y,bottom:n+t.y,right:o+t.x};const i=t.x+o/2,s=t.y+n/2;return{left:i-n/2,top:s-o/2,right:i+n/2,bottom:s+o/2}}function K(t){return t.reduce(((t,e)=>({left:Math.min(t.left,e.left),top:Math.min(t.top,e.top),right:Math.max(t.right,e.right),bottom:Math.max(t.bottom,e.bottom)})),{left:1/0,top:1/0,right:0,bottom:0})}function Y(t){const e=t.right-t.left,o=t.bottom-t.top;return{x:e/2,y:o/2}}function G(t,e,o){const n=Y(t),i=e.right-e.left,s=e.bottom-e.top;return{x:z(n.x-i/2,o),y:z(n.y-s/2,o)}}function X(t,...e){const o=Math[t](...e.map((({x:t})=>t))),n=Math[t](...e.map((({y:t})=>t)));return{x:o,y:n}}var J={isInNeighborhood:N,getRadialSnapOffset:j,getOuterSnapOffset:L,getGridSnapPosition:F,isLineIntersectingRectangle:$,scaleBoundingBox:V,isOneOrTwoDimensional:A,getLinearBoundaries:U,getPointBoundary:q,hasIntersection:R,getBoundingBox:H,getGroupBoundingBox:K,getBoundingBoxMidpoint:Y,getCenteredScreenPoint:G,getSnapOffset:T,getExtremePoint:X};const Q={ref:"resizable"};function tt(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",Q,[(0,x.WI)(t.$slots,"default")],512)}var et=o(1033),ot=(0,x.aZ)({name:"Resizable",emits:{resize:t=>!0},setup(t,{emit:e}){const o=(0,P.iH)();function n([t]){e("resize",t.target.getBoundingClientRect())}const i=new et.Z(n);return(0,x.bv)((()=>{o.value&&i.observe(o.value)})),{onSizeChanged:n,resizable:o}}}),nt=o(3744);const it=(0,nt.Z)(ot,[["render",tt]]);var st=it,rt=(0,x.aZ)({name:"Draggable",components:{Resizable:st},props:{position:{type:Object,default:()=>({x:0,y:0})},isSelected:{type:Boolean,default:!1},isMobile:{type:Boolean,default:!1},allowTouchDrag:{type:Boolean,default:!0}},emits:{dragStart:(t,e)=>!0,drag:(t,e)=>!0,dragEnd:(t,e)=>!0,select:t=>!0,deselect:()=>!0,touchhold:t=>!0},setup(t,{emit:e}){const o=(0,x.Fl)((()=>({left:`${t.position.x}px`,top:`${t.position.y}px`}))),n=(0,P.iH)();let i=0,s=!1,r=!1,a=!1,c={x:0,y:0},l={x:0,y:0},u={x:0,y:0};function d(){setTimeout((()=>{t.isSelected||e("select",!1)}))}function p({clientX:t,clientY:o}){s&&(l.x===t&&l.y===o||(l={x:t,y:o},e(a?"drag":"dragStart",l,u),a=!0,r=!0))}function h({clientX:t,clientY:e}){if(!n.value)return;const{x:o,y:i,width:r,height:c}=n.value.$el.getBoundingClientRect();l={x:t,y:e},u={x:t-(o+r/2),y:e-(i+c/2)},s=!0,a=!1}function m(){s&&(s=!1,r&&e("dragEnd",l,u))}function g(t){h(t)}function f(t){s&&(t.stopImmediatePropagation(),t.preventDefault(),p(t))}function v(t){}function y(t){r=!1,c={x:t.touches[0].clientX,y:t.touches[0].clientY},i=window.setTimeout((()=>{e("touchhold",t)}),500)}function b(e){const o={x:e.touches[0].clientX,y:e.touches[0].clientY};J.isInNeighborhood(c,o,5)||1!==e.touches.length||(r=!0,clearTimeout(i)),t.allowTouchDrag&&(e.stopPropagation(),e.preventDefault(),s||h(e.touches[0])),s&&p(e.touches[0])}function w(){clearTimeout(i),s?m():r||(t.isSelected?e("deselect"):e("select",!0))}return(0,x.bv)((()=>{window.addEventListener("mousemove",f),window.addEventListener("mouseup",m)})),(0,x.Jd)((()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",m)})),(0,x.m0)((()=>{t.isSelected&&n.value?.$el.focus()})),{style:o,draggable:n,onMouseDown:g,onMouseUp:v,onTouchStart:y,onTouchMove:b,onTouchEnd:w,dragEnd:m,onFocus:d}}});const at=(0,nt.Z)(rt,[["render",E]]);var ct=at;const lt=["width","height"],ut=["transform","d"],dt=["transform","d"],pt=["transform","d"],ht=["transform","d"];function mt(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("svg",{class:(0,C.C_)(["wire",{"wire--selected":t.isSelected,"wire--flash":t.flash,"wire--preview":t.isPreview}]),width:t.geometry.width,height:t.geometry.height},[(0,x._)("title",null,(0,C.zw)(t.label),1),(0,x._)("path",{class:"wire__outline",fill:"none",transform:`translate(${Math.abs(t.geometry.minX)}, ${Math.abs(t.geometry.minY)})`,d:t.geometry.path},null,8,ut),(0,x._)("path",{class:(0,C.C_)(["wire__display",{"wire__display--on":1===t.source.value,"wire__display--off":-1===t.source.value}]),fill:"none",transform:`translate(${Math.abs(t.geometry.minX)}, ${Math.abs(t.geometry.minY)})`,d:t.geometry.path},null,10,dt),t.isAnimated?((0,x.wg)(),(0,x.iD)("path",{key:0,class:"wire__animation",fill:"none",transform:`translate(${Math.abs(t.geometry.minX)}, ${Math.abs(t.geometry.minY)})`,d:t.geometry.path},null,8,pt)):(0,x.kq)("",!0),(0,x._)("path",{class:"wire__clickable",fill:"none",transform:`translate(${Math.abs(t.geometry.minX)}, ${Math.abs(t.geometry.minY)})`,d:t.geometry.path},null,8,ht)],10,lt)}var gt=(0,x.aZ)({name:"Wire",props:{isAnimated:{type:Boolean,default:!1},source:{type:Object,required:!0},target:{type:Object,required:!0},label:{type:String,default:""},isPreview:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},flash:{type:Boolean,default:!1},geometry:{type:Object,required:!0}}});const ft=(0,nt.Z)(gt,[["render",mt]]);var vt,yt=ft;(function(t){t[t["Left"]=0]="Left",t[t["Top"]=1]="Top",t[t["Right"]=2]="Right",t[t["Bottom"]=3]="Bottom"})(vt||(vt={}));var bt=vt;function wt(t,e=0){return(t+e%4+4)%4}const It=15;function xt(t,e){const o=t.position,n=e.position,{start:i,end:s}=_t(o,n);if(i.x===s.x||i.y===s.y||s.x<=1&&i.x<=1||s.y<=1&&i.y<=1)return Ct(i,s);const r=Dt(t,o,n),a=Dt(e,o,n);return Pt(r,a,i,s)}function Ct(t,e){return{path:`M ${t.x},${t.y} L ${e.x},${e.y}`,width:Math.abs(t.x-e.x)+It,height:Math.abs(t.y-e.y)+It,minX:-It/2,minY:-It/2}}function St(t,e,o){switch(t){case bt.Left:return e.y>o.y?bt.Right:bt.Left;case bt.Top:return e.x<o.x?bt.Bottom:bt.Top;case bt.Right:return e.y>o.y?bt.Left:bt.Right;case bt.Bottom:return e.x<o.x?bt.Top:bt.Bottom;default:return St(wt(t),e,o)}}function Dt(t,e,o){let n=wt(t.orientation+t.rotation-1);return t.isFreeport&&(n=St(n,e,o),t.rotation%4!==1&&t.rotation%4!==2||(n=wt(n-2))),n}function _t(t,e){return t.x<=e.x?t.y<=e.y?{start:{x:0,y:0},end:{x:Math.floor(e.x-t.x),y:Math.floor(e.y-t.y)}}:{start:{x:0,y:Math.floor(t.y-e.y)},end:{x:Math.floor(e.x-t.x),y:0}}:t.y<=e.y?{start:{x:Math.floor(t.x-e.x),y:0},end:{x:0,y:Math.floor(e.y-t.y)}}:{start:{x:Math.floor(t.x-e.x),y:Math.floor(t.y-e.y)},end:{x:0,y:0}}}function Pt(t,e,o,n){const i=o.x,s=o.y,r=n.x,a=n.y,c=Math.max(Math.abs(i-r)/2,10),l=Math.max(Math.abs(s-a)/2,10),u=[i,i+c,i,i-c][t].toFixed(3),d=[s-l,s,s+l,s][t].toFixed(3),p=[r,r+c,r,r-c][e].toFixed(3),h=[a-l,a,a+l,a][e].toFixed(3),m=["M",i.toFixed(3),s.toFixed(3),"C",u,d,p,h,r.toFixed(3),a.toFixed(3)].join(" "),g=(...t)=>t.map((t=>parseInt(t.toString(),10))),f=Math.min(...g(i,u,p,r))-It/2,v=Math.max(...g(i,u,p,r))+It/2,y=Math.min(...g(s,d,h,a))-It/2,b=Math.max(...g(s,d,h,a))+It/2,w=v-f+It,I=b-y+It;return{width:w,height:I,path:m,minX:f,minY:y}}function Ot(t,e=[]){const o=t();let n=[{label:"&Undo",enabled:o.canUndo,accelerator:"CommandOrControl+Z",click:o.undo},{type:"separator"},{role:"cut",enabled:o.hasSelection},{role:"copy",enabled:o.hasSelection},{role:"paste",enabled:o.hasSelection},{label:"Delete",accelerator:"Delete",enabled:o.hasSelection,click:o.deleteSelection},{type:"separator"},{role:"selectAll",enabled:o.baseItems.length>0}];return o.selectedItemIds.length>0&&(n.push({type:"separator"}),n.push({label:"&Rotate",submenu:[{label:"Rotate 90° &CW",accelerator:"CmdOrCtrl+R",click:()=>o.rotate(1)},{label:"Rotate 90° CC&W",accelerator:"CmdOrCtrl+Shift+R",click:()=>o.rotate(-1)}]})),o.hasSelection&&(n.push({type:"separator"}),n.push({label:"&Bring to Front",submenu:[{label:"&Bring to Front",click:()=>o.setZIndex(o.zIndex)},{label:"Bring &Forward",click:()=>o.incrementZIndex(1)}]}),n.push({label:"&Send to Back",submenu:[{label:"&Send to Back",click:()=>o.setZIndex(o.zIndex)},{label:"Send &Backward",click:()=>o.incrementZIndex(-1)}]})),o.canGroup&&n.push({label:"&Group",submenu:[{label:"&Group"},{label:"&Ungroup",enabled:o.canUngroup}]}),e.length>0&&(n.push({type:"separator"}),n=n.concat(e)),1===o.selectedItemIds.length&&(n.push({type:"separator"}),n.push({label:"&Item Properties"})),o.activePortId&&(n.push({type:"separator"}),n.push({type:"checkbox",label:"Show in &Oscilloscope",checked:!0})),n}function Zt(t){t();return[{label:"&Grid",submenu:[{label:"&Show grid"},{type:"separator"},{label:"Snap to &grid"},{label:"Snap to &elements"}]}]}function kt(t){return Ot(t,Zt(t).concat({type:"separator"}))}var Bt=(0,x.aZ)({name:"Connection",components:{Draggable:ct,Wire:yt},props:{isSelected:{type:Boolean,default:!1},id:{type:String,required:!0},zIndex:{type:Number,default:0},isPreview:{type:Boolean,default:!1},flash:{type:Boolean,default:!1},store:{type:Function,required:!0}},setup(t){const e=t.store(),o=(0,P.iH)(e.connections[t.id]),n=(0,P.iH)(),i=(0,x.Fl)((()=>e.ports[o.value.source])),s=(0,x.Fl)((()=>e.ports[o.value.target])),r=(0,x.Fl)((()=>J.getExtremePoint("min",i.value.position,s.value.position))),a=(0,x.Fl)((()=>xt(i.value,s.value))),c=(0,x.Fl)((()=>({y:r.value.y+a.value.minY,x:r.value.x+a.value.minX}))),l=(0,P.iH)(null);function u({touches:t}){d({x:t[0].clientX,y:t[0].clientY})}function d(t){n.value?.$el&&null===o.value.groupId&&(n.value.$el.style.opacity="0",l.value=(0,B.Z)(),navigator.vibrate(20),e.createFreeport({itemId:l.value,inputPortId:(0,B.Z)(),outputPortId:(0,B.Z)(),connectionChainId:o.value.connectionChainId,sourceId:i.value.id,targetId:s.value.id,value:i.value.value}),e.setSnapBoundaries(l.value),e.dragItem(l.value,t))}async function p(t){l.value?e.dragItem(l.value,t):d(t)}function h(){l&&e.destroyConnection({source:o.value.source,target:o.value.target}),l.value=null}function m(){t.isSelected||e.selectItem(t.id),window.api.showContextMenu(kt(t.store))}return{root:n,geometry:a,position:c,onDragStart:u,onDrag:p,onDragEnd:h,onContextMenu:m,source:i,target:s,freeportId:l,selectItem:e.selectItem,deselectItem:e.deselectItem}}});const Et=(0,nt.Z)(Bt,[["render",Z]]);var Mt=Et;function zt(t,e,o,n,i,s){const r=(0,x.up)("properties"),a=(0,x.up)("port-item"),c=(0,x.up)("circuit-component"),l=(0,x.up)("draggable");return(0,x.wg)(),(0,x.j4)(l,{style:(0,C.j5)({outline:"none",pointerEvents:"none",zIndex:t.zIndex}),position:t.item.position,"is-selected":t.isSelected,"allow-touch-drag":t.isSelected,onResize:t.onResize,onKeydown:(0,I.D2)(t.onEscapeKey,["esc"]),onDrag:t.onDrag,onDragStart:t.onDragStart,onContextmenu:t.onContextMenu,onDblclick:t.revealCustomCircuit,onTouchhold:t.revealCustomCircuit,onDragEnd:t.store.commitCachedState,onSelect:e[1]||(e[1]=e=>t.store.selectItem(t.id,e)),onDeselect:e[2]||(e[2]=e=>t.store.deselectItem(t.id)),ref:"itemRef","data-test":"item"},{default:(0,x.w5)((()=>[t.isPropertiesEnabled?((0,x.wg)(),(0,x.j4)(r,{key:0,properties:t.item.properties,id:t.id,viewport:t.viewport,onUpdate:t.store.setProperties,onFocus:e[0]||(e[0]=e=>t.store.setActivePortId(null)),onPan:t.store.panDelta,"aria-label":"Properties dialog","data-test":"properties"},null,8,["properties","id","viewport","onUpdate","onPan"])):(0,x.kq)("",!0),(0,x.Wm)(c,{type:t.item.type,subtype:t.item.subtype,name:t.item.name,ports:t.ports,properties:t.item.properties,"is-selected":t.isSelected,flash:t.flash,style:(0,C.j5)({transform:`rotate(${90*t.item.rotation}deg)`}),onSignal:t.store.setPortValue},(0,x.Nv)({_:2},[(0,x.Ko)(4,((e,o)=>({name:o,fn:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.ports.filter((t=>t.orientation===o)),(e=>((0,x.wg)(),(0,x.j4)(a,{tabindex:0,store:t.$props.store,id:e.id,key:`${e.id}_${t.portUpdates}`,title:e.name,type:e.type,position:e.position,orientation:e.orientation+t.item.rotation,"connected-port-ids":e.connectedPortIds,hue:e.isMonitored?e.hue:0,rotation:t.item.rotation,onKeypress:(0,I.D2)(t.onEscapeKey,["esc"]),onFocus:o=>t.store.setActivePortId(e.id),onBlur:o=>t.onPortBlur(e.id),onDeselect:t.focus,"data-test":"port-item"},null,8,["store","id","title","type","position","orientation","connected-port-ids","hue","rotation","onKeypress","onFocus","onBlur","onDeselect"])))),128))]))})))]),1032,["type","subtype","name","ports","properties","is-selected","flash","style","onSignal"])])),_:1},8,["style","position","is-selected","allow-touch-drag","onResize","onKeydown","onDrag","onDragStart","onContextmenu","onDblclick","onTouchhold","onDragEnd"])}function Nt(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(["circuit-component",{"circuit-component--selected":t.isSelected,"circuit-component--flash":t.flash,"circuit-component--custom":t.subtype===t.ItemSubtype.CustomCircuit}])},[((0,x.wg)(),(0,x.j4)((0,x.LL)(t.type),(0,x.dG)(t.$props,{onSignal:t.onChange}),null,16,["onSignal"])),t.type!==t.ItemType.Freeport?((0,x.wg)(),(0,x.iD)(x.HY,{key:0},(0,x.Ko)(["left","top","right","bottom"],((e,o)=>(0,x._)("div",{key:o,class:(0,C.C_)([`circuit-component__ports--${e}`,"circuit-component__ports"])},[(0,x.WI)(t.$slots,o)],2))),64)):(0,x.kq)("",!0)],2)}function Ft(t,e,o,n,i,s){const r=(0,x.up)("port-handle");return(0,x.wg)(),(0,x.j4)(r)}const jt={class:"port-handle"};function Lt(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",jt,[(0,x._)("div",{class:(0,C.C_)(["port-handle__display",{"port-handle__display--active":t.active}])},[(0,x._)("div",{class:"port-handle__hue",style:(0,C.j5)({backgroundColor:t.backgroundColor})},null,4)],2)])}var Tt=(0,x.aZ)({name:"PortHandle",props:{active:{type:Boolean,default:!1},hue:{type:Number,default:0}},setup(t){const e=(0,x.Fl)((()=>t.hue>0?`hsla(${t.hue}, var(--lightness), var(--saturation), 0.8)`:"var(--color-bg-secondary)"));return{backgroundColor:e}}});const Wt=(0,nt.Z)(Tt,[["render",Lt]]);var $t=Wt,Rt=(0,x.aZ)({name:"Freeport",components:{PortHandle:$t}});const Vt=(0,nt.Z)(Rt,[["render",Ft]]);var At=Vt;const Ut={class:"input-node"},qt={key:0},Ht={key:1},Kt={key:2};function Yt(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",Ut,[(0,x._)("button",{type:"button",class:(0,C.C_)(["input-node__flipper",{"input-node__flipper--on":1===t.model,"input-node__flipper--off":-1===t.model,"input-node__flipper--high-z":0===t.model}]),tabindex:0,onMousedown:e[0]||(e[0]=(0,I.iM)(((...e)=>t.onInput&&t.onInput(...e)),["stop"])),onTouchstart:e[1]||(e[1]=(0,I.iM)(((...e)=>t.onInput&&t.onInput(...e)),["stop"]))},[1===t.model?((0,x.wg)(),(0,x.iD)("span",qt,"ON")):-1===t.model?((0,x.wg)(),(0,x.iD)("span",Ht,"OFF")):((0,x.wg)(),(0,x.iD)("span",Kt,"?"))],34)])}var Gt=(0,x.aZ)({name:"InputNode",props:{ports:{type:Array,default:()=>[]}},emits:{signal:t=>!0},setup(t,{emit:e}){const o=(0,P.iH)(0);function n(n){n.preventDefault(),n.stopPropagation(),o.value=1===o.value?-1:1,e("signal",{id:t.ports[0].id,value:o.value})}return(0,x.m0)((()=>{o.value=t.ports[0]?.value||0})),{model:o,onInput:n}}});const Xt=(0,nt.Z)(Gt,[["render",Yt]]);var Jt=Xt;function Qt(t,e,o,n,i,s){return(0,x.wg)(),(0,x.j4)((0,x.LL)(t.subtype),(0,C.vs)((0,x.F4)(t.$props)),null,16)}const te={class:"custom-circuit"},ee={class:"custom-circuit__center"},oe={class:"custom-circuit__name"};function ne(t,e,o,n,i,s){const r=(0,x.up)("custom-circuit-port-zone");return(0,x.wg)(),(0,x.iD)("div",te,[(0,x.Wm)(r,{ports:t.ports.filter((t=>1===t.orientation)),orientation:"horizontal",type:"top"},null,8,["ports"]),(0,x._)("div",ee,[(0,x.Wm)(r,{ports:t.ports.filter((t=>0===t.orientation)),orientation:"vertical",type:"left"},null,8,["ports"]),(0,x._)("div",oe,(0,C.zw)(t.name),1),(0,x.Wm)(r,{ports:t.ports.filter((t=>2===t.orientation)),orientation:"vertical",type:"right"},null,8,["ports"])]),(0,x.Wm)(r,{ports:t.ports.filter((t=>3===t.orientation)),orientation:"horizontal",type:"bottom"},null,8,["ports"])])}function ie(t,e,o,n,i,s){const r=(0,x.up)("custom-circuit-port");return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(`custom-circuit-port-zone custom-circuit-port-zone--${t.orientation}`)},[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.ports,(e=>((0,x.wg)(),(0,x.iD)("div",{key:e.id,class:(0,C.C_)([`custom-circuit-port-zone__io--${t.type}`,"custom-circuit-port-zone__io"])},[(0,x.Wm)(r,{label:e.name,type:t.type},null,8,["label","type"])],2)))),128))],2)}const se={class:"custom-circuit-port"},re={class:"custom-circuit-port__label"};function ae(t,e,o,n,i,s){const r=(0,x.up)("port-wire");return(0,x.wg)(),(0,x.iD)("div",se,[(0,x._)("div",re,(0,C.zw)(t.label),1),(0,x.Wm)(r,{type:t.type},null,8,["type"])])}const ce={class:"wire__port"};function le(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(`wire wire--${t.type}`)},[(0,x._)("div",{class:(0,C.C_)(`wire__connector wire__connector--${t.type}`)},null,2),(0,x._)("div",ce,[(0,x.WI)(t.$slots,"default")])],2)}var ue=(0,x.aZ)({name:"PortWire",props:{type:{type:String,default:"top"}}});const de=(0,nt.Z)(ue,[["render",le]]);var pe=de,he=(0,x.aZ)({name:"CustomCircuitPort",components:{PortWire:pe},props:{label:{type:String,default:""},type:{type:String,required:!0}}});const me=(0,nt.Z)(he,[["render",ae]]);var ge=me,fe=(0,x.aZ)({name:"CustomCircuitPortZone",components:{CustomCircuitPort:ge},props:{ports:{type:Array,default:()=>[]},orientation:{type:String,required:!0},type:{type:String,required:!0}}});const ve=(0,nt.Z)(fe,[["render",ie]]);var ye=ve,be=(0,x.aZ)({name:"CustomCircuit",components:{CustomCircuitPortZone:ye},props:{ports:{type:Array,default:()=>[]},name:{type:String,default:"circuit"}}});const we=(0,nt.Z)(be,[["render",ne]]);var Ie=we;const xe={class:"digit"},Ce={width:"58",height:"98"},Se=["d"];function De(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",xe,[((0,x.wg)(),(0,x.iD)("svg",Ce,[(0,x._)("g",null,[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.segments,((t,e)=>((0,x.wg)(),(0,x.iD)("path",{key:e,style:(0,C.j5)(t.style),d:t.path},null,12,Se)))),128))])]))])}const _e={" ":[0,0,0,0,0,0,0],0:[1,1,1,1,1,1,0],1:[0,0,1,1,0,0,0],2:[0,1,1,0,1,1,1],3:[0,1,1,1,1,0,1],4:[1,0,1,1,0,0,1],5:[1,1,0,1,1,0,1],6:[1,1,0,1,1,1,1],7:[0,1,1,1,0,0,0],8:[1,1,1,1,1,1,1],9:[1,1,1,1,0,0,1],a:[1,1,1,1,0,1,1],b:[1,0,0,1,1,1,1],c:[1,1,0,0,1,1,0],d:[0,0,1,1,1,1,1],e:[1,1,0,0,1,1,1],f:[1,1,0,0,0,1,1]},Pe=["M 8,10 L 12,14 L 12,42 L 8,46 L 4,42 L 4,14 L 8,10 z","M 10,8 L 14,4 L 42,4 L 46,8 L 42,12 L 14,12 L 10,8 z","M 48,10 L 52,14 L 52,42 L 48,46 L 44,42 L 44,14 L 48,10 z","M 48,50 L 52,54 L 52,82 L 48,86 L 44,82 L 44,54 L 48,50 z","M 10,88 L 14,84 L 42,84 L 46,88 L 42,92 L 14,92 L 10,88 z","M 8,50 L 12,54 L 12,82 L 8,86 L 4,82 L 4,54 L 8,50 z","M 10,48 L 14,44 L 42,44 L 46,48 L 42,52 L 14,52 L 10,48 z"];var Oe=(0,x.aZ)({name:"DigitDisplay",props:{ports:{type:Array,default:()=>[]}},setup(t){const e=(0,x.Fl)((()=>{const e=t.ports.map((t=>1===t.value?1:0)).join(""),o=parseInt(e,2).toString(16).toLowerCase();return _e[o].map(((t,e)=>{const o=t?"on":"bg-tertiary";return{path:Pe[e],style:{fill:`var(--color-${o})`}}}))}));return{segments:e}}});const Ze=(0,nt.Z)(Oe,[["render",De]]);var ke=Ze;const Be={CustomCircuit:Ie,DigitDisplay:ke};var Ee=(0,x.aZ)({name:"IntegratedCircuit",components:Be,props:{ports:{type:Array,default:()=>[]},subtype:{type:String,required:!0},name:{type:String,default:""}}});const Me=(0,nt.Z)(Ee,[["render",Qt]]);var ze=Me;const Ne=(0,x._)("div",{class:"logic-gate__wire"},null,-1),Fe={key:0,class:"logic-gate__wires--multiwire"},je=(0,x._)("div",{class:"logic-gate__wires-divider"},[(0,x._)("div",{class:"logic-gate__wire"})],-1);function Le(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{style:(0,C.j5)({height:25*t.inputCount+"px"}),class:"logic-gate"},[(0,x._)("div",{style:(0,C.j5)({width:(t.inputCount,"100%")}),class:"logic-gate__wires"},[(0,x._)("div",{class:(0,C.C_)([{"logic-gate__wires-divider--multiwire":t.inputCount>2},"logic-gate__wires-divider"])},[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.inputCount-1,(t=>((0,x.wg)(),(0,x.iD)("div",{key:t,class:"logic-gate__wire"})))),128)),Ne],2),t.inputCount>2?((0,x.wg)(),(0,x.iD)("div",Fe)):(0,x.kq)("",!0),je],4),((0,x.wg)(),(0,x.j4)((0,x.LL)(t.subtype),{class:"logic-gate__component"}))],4)}const Te={class:"and",width:"100",height:"50",viewBox:"0 -1 100 50"},We=(0,x._)("path",{transform:"translate(20, 0)",class:"and__element",d:"M 0 0 V 48 H 24 C 36 48 48 36 48 24 C 48 12 36 0 24 0 Z"},null,-1),$e={key:0,cx:"73",cy:"24",r:"5",class:"and__negation"};function Re(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("svg",Te,[We,t.isNegated?((0,x.wg)(),(0,x.iD)("circle",$e)):(0,x.kq)("",!0)])}var Ve=(0,x.aZ)({name:"And",props:{isNegated:{type:Boolean,default:!1}}});const Ae=(0,nt.Z)(Ve,[["render",Re]]);var Ue=Ae;const qe={width:"100",height:"50",viewBox:"0 -1 100 50",class:"or"},He=(0,x._)("path",{transform:"translate(10, 0)",fill:"#fff",d:"M 0 0 C 12 12 12 36 0 48 H 0 H 24 C 48 48 60 36 72 24 C 60 12 48 0 24 0 Z",class:"or__element"},null,-1),Ke={key:0,fill:"none",d:"M 0 0 C 12 12 12 36 0 48",class:"or__tail"},Ye={key:1,cx:"88",cy:"24",r:"5",class:"or__negation"};function Ge(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("svg",qe,[He,t.isXor?((0,x.wg)(),(0,x.iD)("path",Ke)):(0,x.kq)("",!0),t.isNegated?((0,x.wg)(),(0,x.iD)("circle",Ye)):(0,x.kq)("",!0)])}var Xe=(0,x.aZ)({name:"Or",props:{isNegated:{type:Boolean,default:!1},isXor:{type:Boolean,default:!1}}});const Je=(0,nt.Z)(Xe,[["render",Ge]]);var Qe=Je;function to(t,e,o,n,i,s){const r=(0,x.up)("or");return(0,x.wg)(),(0,x.j4)(r,{"is-negated":!0})}var eo=(0,x.aZ)({name:"Nor",components:{Or:Qe}});const oo=(0,nt.Z)(eo,[["render",to]]);var no=oo;function io(t,e,o,n,i,s){const r=(0,x.up)("buffer");return(0,x.wg)(),(0,x.j4)(r,{"is-negated":!0})}const so={class:"buffer",width:"100",height:"50",viewBox:"0 -1 100 50"},ro=(0,x._)("path",{class:"buffer__element",transform:"translate(40, 0)",stroke:"#000","stroke-width":"2",fill:"#fff",d:"M 0 0 V 48 L 36 24 Z"},null,-1),ao={key:0,class:"buffer__negation",stroke:"#000","stroke-width":"2",cx:"88",cy:"24",r:"5",fill:"#fff"};function co(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("svg",so,[ro,t.isNegated?((0,x.wg)(),(0,x.iD)("circle",ao)):(0,x.kq)("",!0)])}var lo=(0,x.aZ)({name:"Buffer",props:{isNegated:{type:Boolean,default:!1}}});const uo=(0,nt.Z)(lo,[["render",co]]);var po=uo,ho=(0,x.aZ)({name:"Not",components:{Buffer:po}});const mo=(0,nt.Z)(ho,[["render",io]]);var go=mo;function fo(t,e,o,n,i,s){const r=(0,x.up)("and");return(0,x.wg)(),(0,x.j4)(r,{"is-negated":!0})}var vo=(0,x.aZ)({name:"Nand",components:{And:Ue}});const yo=(0,nt.Z)(vo,[["render",fo]]);var bo=yo;function wo(t,e,o,n,i,s){const r=(0,x.up)("or");return(0,x.wg)(),(0,x.j4)(r,{"is-negated":!0,"is-xor":!0})}var Io=(0,x.aZ)({name:"Xnor",components:{Or:Qe}});const xo=(0,nt.Z)(Io,[["render",wo]]);var Co=xo;function So(t,e,o,n,i,s){const r=(0,x.up)("or");return(0,x.wg)(),(0,x.j4)(r,{"is-xor":!0})}var Do=(0,x.aZ)({name:"Xor",components:{Or:Qe}});const _o=(0,nt.Z)(Do,[["render",So]]);var Po=_o,Oo=(0,x.aZ)({name:"LogicGate",components:{And:Ue,Or:Qe,Nor:no,Not:go,Nand:bo,Xnor:Co,Xor:Po},props:{properties:{type:Object,default:()=>({})},subtype:{subtype:String,required:!0}},setup(t){const e=(0,x.Fl)((()=>t.properties.inputCount?.value||2));return{inputCount:e}}});const Zo=(0,nt.Z)(Oo,[["render",Le]]);var ko=Zo;function Bo(t,e,o,n,i,s){return(0,x.wg)(),(0,x.j4)((0,x.LL)(t.subtype),(0,C.vs)((0,x.F4)(t.$props)),null,16)}const Eo=["title"];function Mo(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(["lightbulb",`lightbulb--${t.modifier}`]),title:t.ports[0]?.value},null,10,Eo)}var zo=(0,x.aZ)({name:"Lightbulb",props:{ports:{type:Array,default:()=>[]}},setup(t){const e=(0,x.Fl)((()=>{switch(t.ports[0]?.value){case 1:return"on";case-1:return"off";default:return"high-z"}}));return{modifier:e}}});const No=(0,nt.Z)(zo,[["render",Mo]]);var Fo=No;const jo={Lightbulb:Fo};var Lo=(0,x.aZ)({name:"OutputNode",components:jo,props:{ports:{type:Array,default:()=>[]},subtype:{type:String,required:!0}}});const To=(0,nt.Z)(Lo,[["render",Bo]]);var Wo,$o=To;(function(t){t["Buffer"]="Buffer",t["CircuitNode"]="CircuitNode",t["Freeport"]="Freeport",t["InputNode"]="InputNode",t["IntegratedCircuit"]="IntegratedCircuit",t["LogicGate"]="LogicGate",t["OutputNode"]="OutputNode"})(Wo||(Wo={}));var Ro,Vo=Wo;(function(t){t["None"]="None",t["CustomCircuit"]="CustomCircuit",t["Switch"]="Switch",t["PushButton"]="PushButton",t["Clock"]="Clock",t["Lightbulb"]="Lightbulb",t["DigitDisplay"]="DigitDisplay",t["Buffer"]="Buffer",t["Not"]="Not",t["Tristate"]="Tristate",t["And"]="And",t["Or"]="Or",t["Nand"]="Nand",t["Nor"]="Nor",t["Xnor"]="Xnor",t["Xor"]="Xor"})(Ro||(Ro={}));var Ao=Ro;const Uo={Freeport:At,InputNode:Jt,IntegratedCircuit:ze,LogicGate:ko,OutputNode:$o};var qo=(0,x.aZ)({name:"CircuitComponent",components:Uo,emits:{signal:t=>!0},props:{isSelected:{type:Boolean,default:!1},flash:{type:Boolean,default:!1},type:{type:String,required:!0},subtype:{type:String,required:!0},name:{type:String,default:""},ports:{type:Array,default:()=>[]},properties:{type:Object,default:()=>({})}},setup(t,{emit:e}){return{onChange(t){e("signal",t)},ItemType:Vo,ItemSubtype:Ao}}});const Ho=(0,nt.Z)(qo,[["render",Nt]]);var Ko=Ho;const Yo=["aria-hidden"],Go={class:"properties__heading",role:"title"},Xo=(0,x.Uk)(" Properties "),Jo=["for"],Qo=["onUpdate:modelValue","id"],tn=["value"],en=["onUpdate:modelValue","id"],on=["onUpdate:modelValue","min","max","type","id"];function nn(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.iD)("div",{onContextmenu:e[3]||(e[3]=(...e)=>t.stopPropagation&&t.stopPropagation(...e)),onMousedown:e[4]||(e[4]=(...e)=>t.stopPropagation&&t.stopPropagation(...e)),onMouseup:e[5]||(e[5]=(...e)=>t.stopPropagation&&t.stopPropagation(...e)),onKeydown:e[6]||(e[6]=(0,I.D2)(((...e)=>t.onKeyDown&&t.onKeyDown(...e)),["esc"])),class:"properties"},[t.isOpen?((0,x.wg)(),(0,x.iD)("div",{key:0,class:"properties__dialog",ref:"propertiesRef","aria-hidden":!t.isOpen},[(0,x._)("div",Go,[Xo,(0,x.Wm)(r,{tabindex:0,icon:t.faClose,onClick:t.close,role:"button",class:"properties__close"},null,8,["icon","onClick"])]),((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.model,((o,n)=>((0,x.wg)(),(0,x.iD)("div",{key:n,class:"properties__entry"},[(0,x._)("label",{for:`${t.id}_${n}`,class:"properties__label"},(0,C.zw)(o.label),9,Jo),o.options?(0,x.wy)(((0,x.wg)(),(0,x.iD)("select",{key:0,"onUpdate:modelValue":t=>o.value=t,id:`${t.id}_${n}`,class:"properties__input",onChange:e[0]||(e[0]=(...e)=>t.onChange&&t.onChange(...e))},[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(o.options,((t,e)=>((0,x.wg)(),(0,x.iD)("option",{key:e,value:t},(0,C.zw)(e),9,tn)))),128))],40,Qo)),[[I.bM,o.value]]):"boolean"===o.type?(0,x.wy)(((0,x.wg)(),(0,x.iD)("input",{key:1,"onUpdate:modelValue":t=>o.value=t,id:`${t.id}_${n}`,type:"checkbox",class:"properties__input",onChange:e[1]||(e[1]=(...e)=>t.onChange&&t.onChange(...e))},null,40,en)),[[I.e8,o.value]]):(0,x.wy)(((0,x.wg)(),(0,x.iD)("input",{key:2,"onUpdate:modelValue":t=>o.value=t,min:o.min,max:o.max,type:o.type,id:`${t.id}_${n}`,class:"properties__input",onChange:e[2]||(e[2]=(...e)=>t.onChange&&t.onChange(...e))},null,40,on)),[[I.YZ,o.value]])])))),128))],8,Yo)):((0,x.wg)(),(0,x.j4)(r,{key:1,onKeydown:(0,I.D2)(t.openProperties,["space"]),onClick:t.openProperties,tabindex:0,icon:t.faWrench,class:"properties__icon"},null,8,["onKeydown","onClick","icon"]))],32)}var sn=o(1436),rn=o(3465),an=o.n(rn);const cn=["viewBox"],ln=["d"];function un(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",viewBox:`0 0 ${t.width} ${t.height}`},[(0,x._)("path",{fill:"currentColor",d:t.svgPath},null,8,ln)],8,cn)}var dn=(0,x.aZ)({name:"Icon",props:{icon:{type:Object,required:!0}},setup(t){const e=(0,x.Fl)((()=>t.icon.icon[0])),o=(0,x.Fl)((()=>t.icon.icon[1])),n=(0,x.Fl)((()=>t.icon.icon[4]));return{width:e,height:o,svgPath:n}}});const pn=(0,nt.Z)(dn,[["render",un]]);var hn=pn,mn=(0,x.aZ)({name:"Properties",components:{Icon:hn},props:{properties:{type:Object,default:()=>({})},id:{type:String,default:""},viewport:{type:Object,required:!0}},emits:{update:(t,e)=>!0,pan:(t,e)=>!0},setup(t,{emit:e}){const o=(0,P.iH)(),n=(0,P.iH)(!1),i=(0,P.iH)(an()(t.properties));function s(t){n.value=!1,t.preventDefault()}function r(t){s(t),o.value?.focus()}function a(t){t.stopPropagation()}function c(){e("update",t.id,i.value)}function l(){n.value=!0,(0,x.Y3)((()=>{if(!o.value)return;const{bottom:n,right:i}=o.value.getBoundingClientRect(),s=Math.max(i-t.viewport.right,0),r=Math.max(n-t.viewport.bottom,0);(s>0||r>0)&&e("pan",{x:-s,y:-r},!0)}))}return(0,x.YP)(t.properties,(t=>{i.value=an()(t)}),{deep:!0}),{faClose:sn.YIN,faWrench:sn.klh,model:i,isOpen:n,propertiesRef:o,close:s,onKeyDown:r,onChange:c,openProperties:l,stopPropagation:a}}});const gn=(0,nt.Z)(mn,[["render",nn]]);var fn=gn;o(6699);function vn(t,e,o,n,i,s){const r=(0,x.up)("port-handle"),a=(0,x.up)("draggable"),c=(0,x.up)("port-pivot");return(0,x.wg)(),(0,x.j4)(c,{rotation:t.rotation,onBlur:t.onBlur,onKeydown:[(0,I.D2)(t.onEscapeKey,["esc"]),e[0]||(e[0]=(0,I.D2)((e=>t.store.cycleConnectionPreviews(t.id)),["space"])),(0,I.D2)(t.store.commitPreviewedConnection,["enter"])],onResize:t.onResize,onContextmenu:e[1]||(e[1]=e=>t.store.setActivePortId(t.id))},{default:(0,x.w5)((()=>[t.isFreeport?((0,x.wg)(),(0,x.j4)(r,{key:1,type:t.type,hue:t.hue,active:t.store.activePortId===t.id||t.store.connectablePortIds.includes(t.id)},null,8,["type","hue","active"])):((0,x.wg)(),(0,x.j4)(a,{key:0,onDragStart:t.onDragStart,onDrag:t.onDrag,onDragEnd:t.onDragEnd,onTouchhold:t.onTouchHold,onDblclick:t.onDoubleClick,tabindex:-1},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{type:t.type,hue:t.hue,active:t.store.activePortId===t.id||t.store.connectablePortIds.includes(t.id),"touch-friendly":""},null,8,["type","hue","active"])])),_:1},8,["onDragStart","onDrag","onDragEnd","onTouchhold","onDblclick"]))])),_:1},8,["rotation","onBlur","onKeydown","onResize"])}function yn(t,e,o,n,i,s){const r=(0,x.up)("resizable");return(0,x.wg)(),(0,x.j4)(r,{class:"port-pivot",style:(0,C.j5)({transform:`rotate(-${90*t.rotation}deg)`}),onKeydown:e[0]||(e[0]=(0,I.D2)((e=>t.$emit("connect")),["space"]))},{default:(0,x.w5)((()=>[(0,x.WI)(t.$slots,"default")])),_:3},8,["style"])}var bn=(0,x.aZ)({name:"PortPivot",components:{Resizable:st},props:{rotation:{type:Number,default:0}}});const wn=(0,nt.Z)(bn,[["render",yn]]);var In,xn=wn;(function(t){t[t["Output"]=0]="Output",t[t["Input"]=1]="Input"})(In||(In={}));var Cn=In,Sn=(0,x.aZ)({name:"PortItem",components:{PortHandle:$t,PortPivot:xn,Draggable:ct,Resizable:st},props:{id:{type:String,default:""},rotation:{type:Number,default:0},position:{type:Object,default:()=>({x:0,y:0})},isFreeport:{type:Boolean,default:!1},type:{type:Number,default:0},orientation:{type:Number,default:0},hue:{type:Number,default:0},connectedPortIds:{type:Object,default:[]},store:{type:Function,required:!0}},setup(t,{emit:e}){const o=t.store(),n=M.Radial;let i=null,s="",r=!1;function a(t){t.preventDefault(),t.stopPropagation(),e("deselect",t)}function c(){o.unsetConnectionPreview(),o.cachedState=null}function l(){i={itemId:(0,B.Z)()},s=(0,B.Z)(),r=!1,t.type===Cn.Input?(i.outputPortId=s,i.targetId=t.id):(i.inputPortId=s,i.sourceId=t.id)}function u({x:e,y:n}){null!==i&&(r||(o.createFreeport(i,!1),o.setConnectablePortIds({portId:t.id,isDragging:!0}),o.setSnapBoundaries(s)),o.dragItem(i.itemId,{x:e,y:n},M.Radial))}function d(){null!==i&&(i.inputPortId?o.connectFreeport({portId:i.inputPortId,sourceId:t.id}):i.outputPortId&&o.connectFreeport({portId:i.outputPortId,targetId:t.id}))}function p(e){e.stopPropagation(),e.preventDefault(),navigator.vibrate(100),o.togglePortMonitoring(t.id)}function h(e){o.setPortRelativePosition(e,t.id)}function m(e){e.stopPropagation(),e.preventDefault(),o.togglePortMonitoring(t.id)}return{store:o,snapMode:n,onDragStart:l,onDrag:u,onDragEnd:d,onEscapeKey:a,onBlur:c,onTouchHold:p,onResize:h,onDoubleClick:m,PortType:Cn}}});const Dn=(0,nt.Z)(Sn,[["render",vn]]);var _n=Dn,Pn=JSON.parse('{"groups":{},"connections":{"switch1_nor1_conn":{"id":"switch1_nor1_conn","connectionChainId":"switch1_nor1_conn","source":"switchOutputPort1","target":"nor1InputPort1","isSelected":false,"groupId":null,"zIndex":7},"switch2_nor2_conn":{"id":"switch2_nor2_conn","connectionChainId":"switch2_nor2_conn","source":"switchOutputPort2","target":"nor2InputPort1","isSelected":false,"groupId":null,"zIndex":8},"nor1_nor2_conn":{"id":"nor1_nor2_conn","connectionChainId":"nor1_nor2_conn","source":"nor1OutputPort1","target":"nor2InputPort2","isSelected":false,"groupId":null,"zIndex":9},"nor2_nor1_conn":{"id":"nor2_nor1_conn","connectionChainId":"nor2_nor1_conn","source":"nor2OutputPort1","target":"nor1InputPort2","isSelected":false,"groupId":null,"zIndex":10},"nor1_lightbulb1_conn":{"id":"nor1_lightbulb1_conn","connectionChainId":"nor1_lightbulb1_conn","source":"nor1OutputPort1","target":"lightbulbInputPort1","isSelected":false,"groupId":null,"zIndex":11},"nor2_lightbulb2_conn":{"id":"nor2_lightbulb2_conn","connectionChainId":"nor2_lightbulb2_conn","source":"nor2OutputPort1","target":"lightbulbInputPort2","isSelected":false,"groupId":null,"zIndex":12}},"ports":{"nor1InputPort1":{"id":"nor1InputPort1","elementId":"nor1","name":"Input Port 1","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"nor1InputPort2":{"id":"nor1InputPort2","elementId":"nor1","name":"Input Port 2","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"nor1OutputPort1":{"id":"nor1OutputPort1","elementId":"nor1","name":"Output Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":0,"rotation":0,"orientation":2,"value":0,"isFreeport":false},"nor2InputPort1":{"id":"nor2InputPort1","elementId":"nor2","name":"Input Port 1","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"nor2InputPort2":{"id":"nor2InputPort2","elementId":"nor2","name":"Input Port 2","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"nor2OutputPort1":{"id":"nor2OutputPort1","elementId":"nor2","name":"Output Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":0,"rotation":0,"orientation":2,"value":0,"isFreeport":false},"switchOutputPort1":{"id":"switchOutputPort1","elementId":"switch1","name":"Output Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":0,"rotation":0,"orientation":2,"value":0,"isFreeport":false},"switchOutputPort2":{"id":"switchOutputPort2","elementId":"switch2","name":"Output Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":0,"rotation":0,"orientation":2,"value":0,"isFreeport":false},"lightbulbInputPort1":{"id":"lightbulbInputPort1","elementId":"lightbulb1","name":"Input Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"lightbulbInputPort2":{"id":"lightbulbInputPort2","elementId":"lightbulb2","name":"Input Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false}},"items":{"nor1":{"id":"nor1","type":"LogicGate","subtype":"Nor","portIds":["nor1InputPort1","nor1InputPort2","nor1OutputPort1"],"position":{"x":300,"y":300},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"inputCount":{"label":"Input count","value":2,"type":"number","min":2}},"groupId":null,"zIndex":1,"width":100,"height":150},"nor2":{"id":"nor2","type":"LogicGate","subtype":"Nor","portIds":["nor2InputPort2","nor2InputPort1","nor2OutputPort1"],"position":{"x":300,"y":500},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"inputCount":{"label":"Input count","value":2,"type":"number","min":2}},"groupId":null,"zIndex":2,"width":120,"height":51},"switch1":{"id":"switch1","type":"InputNode","subtype":"Clock","portIds":["switchOutputPort1"],"position":{"x":100,"y":300},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"name":{"label":"Name","value":"","type":"text"},"interval":{"label":"Interval","value":1000,"type":"number","min":100,"step":100},"startValue":{"label":"Start value","value":-1,"type":"number","options":{"True":1,"Hi-Z":0,"False":-1}}},"groupId":null,"zIndex":3,"width":40,"height":40},"switch2":{"id":"switch2","type":"InputNode","subtype":"Switch","portIds":["switchOutputPort2"],"position":{"x":100,"y":500},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"name":{"label":"Name","value":"","type":"text"},"startValue":{"label":"Start value","value":1,"type":"number","options":{"True":1,"Hi-Z":0,"False":-1}}},"groupId":null,"zIndex":4,"width":40,"height":40},"lightbulb1":{"id":"lightbulb1","type":"OutputNode","subtype":"Lightbulb","portIds":["lightbulbInputPort1"],"position":{"x":700,"y":300},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"name":{"label":"Name","value":"","type":"text"}},"groupId":null,"zIndex":5,"width":40,"height":40},"lightbulb2":{"id":"lightbulb2","type":"OutputNode","subtype":"Lightbulb","portIds":["lightbulbInputPort2"],"position":{"x":700,"y":500},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"name":{"label":"Name","value":"","type":"text"}},"groupId":null,"zIndex":6,"width":40,"height":40}}}'),On=o(2482);class Zn{constructor(t,e){(0,On.Z)(this,"node",void 0),(0,On.Z)(this,"id",void 0),this.node=t,this.id=e}}var kn=Zn;const Bn={TRUE:1,FALSE:-1,UNKNOWN:0};var En=Bn;class Mn{constructor(t,e=[]){(0,On.Z)(this,"inputValues",{}),(0,On.Z)(this,"outputs",[]),(0,On.Z)(this,"isValueChanged",!0),(0,On.Z)(this,"forceContinue",!1),(0,On.Z)(this,"name",void 0),(0,On.Z)(this,"value",En.UNKNOWN),(0,On.Z)(this,"newValue",En.UNKNOWN),(0,On.Z)(this,"events",[]),(0,On.Z)(this,"setValue",(t=>{this.newValue=t})),(0,On.Z)(this,"invokeEvent",((t,e,o)=>{this.events.forEach((n=>{n.eventType===t&&n.callback(e,o)}))})),(0,On.Z)(this,"eval",(()=>this.value)),(0,On.Z)(this,"valueCount",(t=>Object.values(this.inputValues).filter((e=>e===t)).length)),(0,On.Z)(this,"updateOutputs",(t=>{const e=[];this.outputs.forEach((({node:o,id:n})=>{o.update(t,n),e.push(n)})),this.invokeEvent("change",t,e)})),(0,On.Z)(this,"update",((t,e)=>{this.inputValues[e]=t,this.newValue=this.eval(),this.invokeEvent("change",this.newValue,this.outputs.map((({id:t})=>t)))})),(0,On.Z)(this,"propagate",(()=>{let t=[];return this.value!==this.newValue&&(this.isValueChanged=!0,this.value=this.newValue,this.updateOutputs(this.newValue),this.outputs.forEach((({node:e})=>{e.forceContinue?t=t.concat(e.propagate()):t.push(e)}))),t})),(0,On.Z)(this,"reset",(()=>{this.value=En.UNKNOWN,this.newValue=En.UNKNOWN,this.invokeEvent("change",this.newValue,this.outputs.map((({id:t})=>t)))})),(0,On.Z)(this,"on",((t,e)=>{this.events.push({eventType:t,callback:e})})),(0,On.Z)(this,"getProjectedValue",(()=>this.eval()||this.newValue||this.value)),this.name=t,this.inputValues=e.reduce(((t,e)=>({...t,[e]:En.UNKNOWN})),{})}}var zn=Mn;class Nn extends zn{constructor(...t){super(...t),(0,On.Z)(this,"reset",(()=>{}))}}var Fn=Nn;class jn extends zn{constructor(...t){super(...t),(0,On.Z)(this,"update",(t=>{this.newValue!==t&&(this.newValue=t,this.invokeEvent("change",this.newValue,[]))}))}}var Ln=jn;class Tn{constructor(){(0,On.Z)(this,"queue",[]),(0,On.Z)(this,"nodes",[]),(0,On.Z)(this,"inputNodes",[]),(0,On.Z)(this,"addNode",(t=>{t instanceof Fn&&(this.inputNodes.push(t),this.enqueue(t)),this.nodes.push(t)})),(0,On.Z)(this,"removeNode",(t=>{if(t instanceof Fn){const e=this.inputNodes.findIndex((({name:e})=>e===t.name));-1!==e&&this.inputNodes.splice(e,1)}const e=this.nodes.findIndex((({name:e})=>e===t.name));-1!==e&&(this.removeNodeOutputs(t),this.nodes.splice(e,1)),this.next()})),(0,On.Z)(this,"addConnection",((t,e,o,n=En.UNKNOWN)=>{t.outputs.push(new kn(e,o)),t.value=n,n||this.enqueue(t)})),(0,On.Z)(this,"removeConnection",((t,e,o=En.UNKNOWN)=>{t.outputs.concat().forEach((({node:n,id:i},s)=>{e===n&&(e.update(o,i),t.outputs.splice(s,1),this.enqueue(e))}))})),(0,On.Z)(this,"removeNodeOutputs",(t=>{for(let e=0;e<t.outputs.length;e++)this.removeConnection(t,t.outputs[e].node)})),(0,On.Z)(this,"enqueue",((...t)=>{t.forEach((t=>{~this.queue.indexOf(t)||this.queue.push(t)}))})),(0,On.Z)(this,"dequeue",(t=>{const e=this.queue.indexOf(t);~e&&this.queue.splice(e,1)})),(0,On.Z)(this,"reset",(()=>{this.nodes.forEach((t=>t.reset()))})),(0,On.Z)(this,"next",(()=>{let t=!1,e=[];while(this.queue.length>0){const o=this.queue.shift();o&&(e=e.concat(o.propagate()),this.dequeue(o),o.isValueChanged&&(t=!0),o.forceContinue&&(this.enqueue(...e),e=[]))}t&&this.enqueue(...e)})),(0,On.Z)(this,"isComplete",(()=>{let t=!0;return 0===this.queue.length||(this.queue.forEach((e=>{const o=e.getProjectedValue();o===e.value||e instanceof Ln||(t=!1)})),t&&(this.queue=[]),t)}))}}var Wn=Tn;class $n extends zn{constructor(...t){super(...t),(0,On.Z)(this,"eval",(()=>this.valueCount(En.TRUE)?En.FALSE:this.valueCount(En.UNKNOWN)?En.UNKNOWN:En.TRUE))}}var Rn=$n;class Vn extends zn{constructor(...t){super(...t),(0,On.Z)(this,"eval",(()=>this.valueCount(En.TRUE)?En.TRUE:this.valueCount(En.UNKNOWN)?En.UNKNOWN:En.FALSE))}}var An=Vn;class Un extends zn{constructor(...t){super(...t),(0,On.Z)(this,"forceContinue",!0),(0,On.Z)(this,"update",(t=>{const e=Object.keys(this.inputValues).pop();e&&(this.inputValues[e]=t,this.newValue=this.eval())})),(0,On.Z)(this,"eval",(()=>Object.values(this.inputValues).pop()||En.UNKNOWN))}}var qn=Un;var Hn=o(4279);class Kn{constructor(t,e,o,n){(0,On.Z)(this,"id",void 0),(0,On.Z)(this,"name",void 0),(0,On.Z)(this,"width",0),(0,On.Z)(this,"lastY",0),(0,On.Z)(this,"segments",[]),(0,On.Z)(this,"hue",0),(0,On.Z)(this,"initialize",(t=>{const e={x:1,y:1};1===t?(e.y=0,this.lastY=1):(e.y=1,this.lastY=0),this.addSegment(e),this.updateWidth()})),(0,On.Z)(this,"reset",(()=>{this.segments=[],this.width=0,this.initialize(1===this.lastY?0:1)})),(0,On.Z)(this,"update",(t=>{this.drawPulseConstant()})),(0,On.Z)(this,"addSegment",(t=>{const e=this.segments[this.segments.length-1];!e&&t.x>0?this.segments.push({x:0,y:t.y}):e&&e.x!==t.x&&e.y!==t.y&&this.segments.pop(),this.segments.push(t),this.updateWidth()})),(0,On.Z)(this,"drawPulseChange",(t=>{const{x:e}=this.segments[this.segments.length-1],o=t===En.TRUE?0:1;this.updateWidth(),this.addSegment({x:e,y:o})})),(0,On.Z)(this,"drawPulseConstant",(()=>{const t=this.segments[this.segments.length-1],e=this.lastY!==t.y?t:this.segments.pop();e&&(this.updateWidth(),this.addSegment({x:e.x+1,y:e.y})),this.lastY=t.y})),(0,On.Z)(this,"truncateSegments",(t=>{if(t>this.width)return;const e=this.width-t;let o=0;for(let n=0;n<this.segments.length;n++){const{x:t,y:i}=this.segments[n];if(t>e){o=t-e,this.segments.splice(0,n),this.segments.unshift({x:0,y:i});break}}for(let n=1;n<this.segments.length;n++){const{x:t,y:o}=this.segments[n];this.segments[n]={x:t-e,y:o}}this.updateWidth()})),(0,On.Z)(this,"updateWidth",(()=>{this.width=this.segments.slice(-1)[0]?.x||0})),this.id=t,this.name=e,this.hue=n,this.initialize(o)}}class Yn{constructor(t,e,o){(0,On.Z)(this,"id",(0,B.Z)()),(0,On.Z)(this,"name",void 0),(0,On.Z)(this,"signal",0),(0,On.Z)(this,"interval",0),(0,On.Z)(this,"lastUpdate",void 0),(0,On.Z)(this,"emitter",new Hn.TinyEmitter),(0,On.Z)(this,"isStopped",!1),(0,On.Z)(this,"on",((t,e)=>{this.emitter.on(t,e)})),(0,On.Z)(this,"stop",(()=>{this.isStopped=!0})),(0,On.Z)(this,"start",(()=>{this.isStopped=!1})),(0,On.Z)(this,"update",(t=>{!this.isStopped&&t>=this.lastUpdate+this.interval&&(this.signal=-1===this.signal?1:-1,this.lastUpdate=t,this.emitter.emit("change",this.signal))})),this.name=t,this.signal=o,this.interval=e,this.lastUpdate=-e}}class Gn{constructor(){(0,On.Z)(this,"isPaused",!0),(0,On.Z)(this,"waves",{}),(0,On.Z)(this,"refreshRate",20),(0,On.Z)(this,"lastUpdateTime",Date.now()),(0,On.Z)(this,"timeMsElapsed",0),(0,On.Z)(this,"timeMsOffset",0),(0,On.Z)(this,"emitter",new Hn.TinyEmitter),(0,On.Z)(this,"start",(()=>{if(!this.isPaused)return;const t=this.lastUpdateTime%this.refreshRate;this.lastUpdateTime=Date.now()+t,this.isPaused=!1,this.tick()})),(0,On.Z)(this,"stop",(()=>{this.isPaused=!0})),(0,On.Z)(this,"clear",(()=>{Object.values(this.waves).forEach((t=>{t instanceof Kn&&t.reset()}))})),(0,On.Z)(this,"computeWaveGeometry",(t=>{const e={},o=t=>t.map((({x:t,y:e})=>`${t},${e}`));for(const n in t)if(t[n]instanceof Kn){const i=t[n],s=o(i.segments);e[n]={points:s.join(" "),width:i.width,hue:i.hue}}return e})),(0,On.Z)(this,"on",((t,e)=>{this.emitter.on(t,e)})),(0,On.Z)(this,"broadcast",(()=>{const t=window.screen.width,e=1e3/this.refreshRate,o=t/e;this.timeMsElapsed>=this.timeMsOffset+o/2*1e3&&(this.timeMsOffset=this.timeMsElapsed,Object.values(this.waves).forEach((e=>{e instanceof Kn&&e.truncateSegments(t)}))),this.emitter.emit("change",this.computeWaveGeometry(this.waves))})),(0,On.Z)(this,"tick",(()=>{if(this.isPaused)return;const t=Date.now(),e=1e4;let o=!1;if(t>=this.lastUpdateTime+e)return this.stop(),void this.start();while(t>=this.lastUpdateTime+this.refreshRate){const e=Math.min(this.refreshRate,t-this.lastUpdateTime);o=!0,this.timeMsElapsed+=e,this.lastUpdateTime+=e,this.update()}o&&this.broadcast(),requestAnimationFrame(this.tick)})),(0,On.Z)(this,"update",(()=>{Object.values(this.waves).forEach((t=>t.update(this.timeMsElapsed)))})),(0,On.Z)(this,"add",(t=>{this.waves.hasOwnProperty(t.id)||(this.waves[t.id]=t,0===this.timeMsElapsed&&this.broadcast())})),(0,On.Z)(this,"remove",(({id:t})=>{delete this.waves[t],0===Object.keys(this.waves).length&&(this.stop(),this.clear())}))}}class Xn extends zn{constructor(...t){super(...t),(0,On.Z)(this,"eval",(()=>Object.values(this.inputValues).reduce(((t,e)=>t&&e===En.TRUE),!0)?En.TRUE:En.FALSE))}}var Jn=Xn;class Qn extends zn{constructor(...t){super(...t),(0,On.Z)(this,"eval",(()=>Object.values(this.inputValues).reduce(((t,e)=>t||e===En.FALSE),!1)?En.TRUE:En.FALSE))}}var ti=Qn;class ei extends zn{constructor(...t){super(...t),(0,On.Z)(this,"eval",(()=>{const t=Object.values(this.inputValues).pop();switch(t){case En.TRUE:return En.FALSE;case En.FALSE:return En.TRUE;default:return En.UNKNOWN}}))}}var oi=ei;function ni(t,e,o){switch(t){case Ao.And:return new Jn(e,o);case Ao.Nand:return new ti(e,o);case Ao.Or:return new An(e,o);case Ao.Nor:return new Rn(e,o);case Ao.Not:return new oi(e,o);default:return new Rn(e,o)}}function ii({id:t,type:e,subtype:o},n){switch(e){case Vo.CircuitNode:return new zn(t,n);case Vo.InputNode:return new Fn(t,n);case Vo.LogicGate:return ni(o,t,n);case Vo.Buffer:case Vo.Freeport:return new qn(t,n);default:return new Ln(t,n)}}var si={getLogicGateNode:ni,getCircuitNode:ii};class ri{constructor(t,e,o){(0,On.Z)(this,"nodes",{}),(0,On.Z)(this,"waves",{}),(0,On.Z)(this,"clocks",{}),(0,On.Z)(this,"valueMap",{}),(0,On.Z)(this,"circuit",new Wn),(0,On.Z)(this,"oscillator",new Gn),(0,On.Z)(this,"emitter",new Hn.TinyEmitter),(0,On.Z)(this,"oscillogram",{}),(0,On.Z)(this,"canContinue",!1),(0,On.Z)(this,"nextState",null),(0,On.Z)(this,"isDebug",!1),(0,On.Z)(this,"nextValueMap",{}),(0,On.Z)(this,"addElements",((t,e,o)=>{t.forEach((t=>this.addNode(t,o))),e.forEach((t=>this.addConnection(t.source,t.target)))})),(0,On.Z)(this,"onChange",(t=>{this.emitter.on("change",t)})),(0,On.Z)(this,"onError",(t=>{this.emitter.on("error",t)})),(0,On.Z)(this,"emit",(()=>{this.emitter.emit("change",this.valueMap)})),(0,On.Z)(this,"step",((t=0)=>{this.circuit.next();const e=this.circuit.queue.length>0;t>1e3&&this.emitter.emit("error","INFINITE_LOOP"),e&&this.step(++t),this.isDebug||this.emit()})),(0,On.Z)(this,"toggleClocks",(t=>{Object.values(this.clocks).forEach((e=>e[t]()))})),(0,On.Z)(this,"start",(()=>{this.isDebug||this.toggleClocks("start"),this.oscillator.start()})),(0,On.Z)(this,"stop",(()=>{this.toggleClocks("stop"),this.oscillator.stop()})),(0,On.Z)(this,"startDebugging",(()=>{this.isDebug=!0,this.computeNextState(),this.toggleClocks("stop")})),(0,On.Z)(this,"stopDebugging",(()=>{this.isDebug=!1,this.advanceDebuggerStep(),this.nextState=null,this.toggleClocks("start")})),(0,On.Z)(this,"advanceDebuggerStep",(()=>{if(!this.isDebug)return this.step();const t=Object.keys(this.nextValueMap);t.length>0?t.forEach((t=>this.updatePortValue(t,this.nextValueMap[t]))):this.nextState&&(this.valueMap=JSON.parse(this.nextState)),this.nextValueMap={},this.computeNextState(),this.emit()})),(0,On.Z)(this,"computeNextState",(()=>{const t=JSON.stringify(this.valueMap);this.circuit.next();const e=JSON.stringify(this.valueMap);this.nextState=t!==e?e:null,this.canContinue=null!==this.nextState})),(0,On.Z)(this,"updatePortValue",((t,e)=>{this.nodes[t].setValue(e),this.circuit.enqueue(this.nodes[t]),this.waves[t]?.drawPulseChange(e)})),(0,On.Z)(this,"enqueuePortValueChange",((t,e)=>{this.nextValueMap[t]=e,this.canContinue=Object.keys(this.nextValueMap).reduce(((t,e)=>t||this.valueMap[e]!==this.nextValueMap[e]),!1)})),(0,On.Z)(this,"setPortValue",((t,e)=>{if(this.isDebug)return this.enqueuePortValueChange(t,e);this.nodes[t]&&this.nodes[t].value!==e&&(this.updatePortValue(t,e),this.step())})),(0,On.Z)(this,"addIntegratedCircuit",(t=>{if(!t.integratedCircuit)return;const{items:e,connections:o,ports:n}=t.integratedCircuit;Object.values(e).forEach((t=>{this.addNode(t,n)})),Object.values(o).forEach((t=>{this.addConnection(t.source,t.target)}))})),(0,On.Z)(this,"addNode",((t,e,o=!1)=>{if(0===t.portIds.length)return;if(t.integratedCircuit)return this.addIntegratedCircuit(t);const n=t.portIds.filter((t=>e[t].type===Cn.Input)),i=t.portIds.filter((t=>e[t].type===Cn.Output)),s=si.getCircuitNode(t,n);o&&(s.forceContinue=!0),t.portIds.forEach((t=>this.addPort(t,s))),s.on("change",((t,e)=>{e.concat(i).forEach((e=>{this.valueMap[e]=t,this.waves[e]?.drawPulseChange(t)}))})),t.type===Vo.InputNode&&t.subtype===Ao.Clock&&this.addClock(i[0],t.properties.interval?.value),this.circuit.addNode(s),t.portIds.forEach((t=>{const o=e[t];o.isMonitored&&this.monitorPort(t,o.value,o.hue)}))})),(0,On.Z)(this,"removeNode",(t=>{const e=t=>t.integratedCircuit?Object.values(t.integratedCircuit.items).reduce(((t,o)=>o.integratedCircuit?t.concat(e(o)).concat(o.portIds):t.concat(o.portIds)),[]):[];t.portIds.concat(e(t)).forEach((t=>{const e=this.nodes[t];e&&(this.circuit.removeNode(e),this.removePort(t))})),this.emit()})),(0,On.Z)(this,"addClock",((t,e=1e3)=>{this.clocks[t]=new Yn(t,e,1),this.clocks[t].on("change",(e=>{this.setPortValue(t,e)})),this.oscillator.add(this.clocks[t])})),(0,On.Z)(this,"setClockInterval",((t,e)=>{this.clocks[t]&&(this.clocks[t].interval=e)})),(0,On.Z)(this,"addPort",((t,e)=>{this.nodes[t]=e})),(0,On.Z)(this,"removePort",(t=>{this.clocks[t]&&this.oscillator.remove(this.clocks[t]),this.unmonitorPort(t),delete this.nodes[t],delete this.valueMap[t],delete this.clocks[t],delete this.waves[t]})),(0,On.Z)(this,"addConnection",((t,e,o)=>{this.nodes[t]&&this.nodes[e]&&(this.circuit.addConnection(this.nodes[t],this.nodes[e],e,o),this.advanceDebuggerStep())})),(0,On.Z)(this,"removeConnection",((t,e,o)=>{this.nodes[t]&&this.nodes[e]&&(this.circuit.removeConnection(this.nodes[t],this.nodes[e],o),this.advanceDebuggerStep())})),(0,On.Z)(this,"monitorPort",((t,e,o)=>{this.waves[t]||(this.waves[t]=new Kn(t,t,e,o),this.oscillator.add(this.waves[t]))})),(0,On.Z)(this,"unmonitorPort",(t=>{this.waves[t]&&(this.oscillator.remove(this.waves[t]),this.oscillator.broadcast()),delete this.waves[t],delete this.oscillator.waves[t],delete this.oscillogram[t]})),this.addElements(t,e,o)}}const ai=()=>({undoStack:[],redoStack:[],simulation:new ri([],[],{}),oscillogram:{},itemNames:[],zoomLevel:1,zIndex:1,oscilloscopeHeight:200,isOscilloscopeOpen:!1,isOscilloscopeRecording:!0,isCircuitEvaluated:!1,isDebugging:!1,isDirty:!1,hasLoaded:!1,isPrinting:!1,isCreatingImage:!1,animatePan:!1,debugger:{timeout:0,hasUpdated:!1},viewport:new DOMRect,canvas:{top:0,left:0,bottom:0,right:0},snapBoundaries:[],connectablePortIds:[],selectedConnectionIds:[],selectedItemIds:[],selectedPortIndex:-1,cachedState:null,activeFreeportId:null,activePortId:null,connectionPreviewId:null,items:{},connections:{},ports:{},groups:{}});function ci(t,e={}){let{items:o,connections:n,ports:i,groups:s}=an()(t);function r(t){return Object.values(t).forEach((o=>{const n=o.id,i=(0,B.Z)();e[n]=i,t[i]=an()(o),delete t[n]})),t}function a(t,o){return Object.values(t).forEach((t=>{t.groupId=null!==t.groupId?e[t.groupId]:null})),Object.values(o).forEach((t=>{t.groupId=null!==t.groupId?e[t.groupId]:null})),{connections:t,items:o}}function c(t){return Object.values(t).forEach((o=>{const n=o.id,i=(0,B.Z)();e[n]=i,t[i]=an()(o),t[i].id=i,t[i].source=e[t[i].source],t[i].target=e[t[i].target],delete t[n]})),t}function l(t){return Object.values(t).forEach((o=>{t[o.id].connectionChainId=e[t[o.id].connectionChainId]})),t}function u(t){return Object.values(t).forEach((o=>{const n=o.id,i=(0,B.Z)();e[n]=i,t[i]=an()(o),o.integratedCircuit?t[i].integratedCircuit={serializedState:o.integratedCircuit.serializedState,...ci(an()(o.integratedCircuit),e)}:t[i].id=i,t[i].portIds=o.portIds.map((t=>e[t])),delete t[n]})),t}function d(t){return Object.values(t).forEach((o=>{t[o.id].elementId=e[o.elementId]})),t}function p(t){return Object.values(t).forEach((o=>{const n=o.id,i=(0,B.Z)();e[n]=i,t[i]=an()(o),t[i].id=i,delete t[n]})),t}return i=p(i),o=u(o),i=d(i),n=c(n),n=l(n),s=r(s),{...a(n,o),ports:i,groups:s}}function li(t){if(!t.integratedCircuit)return t;const{items:e}=ci({items:{[t.id]:t},connections:{},ports:{},groups:{}}),o=Object.values(e)[0];return o.id=(0,B.Z)(),o}var ui={mapStandardCircuitIds:ci,mapIntegratedCircuitIds:li};function di(){this.copy(),this.deleteSelection()}function pi(){if(!this.hasSelection)return;const t={},e={};this.selectedItemIds.forEach((o=>{t[o]=this.items[o],t[o].portIds.forEach((t=>{e[t]=this.ports[t]}))}));const o=Object.values(this.connections).reduce(((t,o)=>(e[o.source]&&e[o.target]&&(t[o.id]=o),t)),{}),n=Object.values(this.groups).filter((({isSelected:t})=>t)).reduce(((t,e)=>({...t,[e.id]:e})),{}),i={items:t,ports:e,connections:o,groups:n,pasteCount:1};window.api.copy(JSON.stringify(i))}function hi(){try{const t=window.api.paste(),e=JSON.parse(t),o=ui.mapStandardCircuitIds(e);this.commitState(),this.deselectAll(),Object.keys(o.ports).forEach((t=>{o.ports[t].value=0})),Object.values(o.items).forEach((t=>{t.position.x+=20*e.pasteCount,t.position.y+=20*e.pasteCount,t.isSelected=!1,this.addItem({item:t,ports:o.ports}),this.setSelectionState({id:t.id,value:!0})})),Object.values(o.connections).forEach((t=>this.connect(t))),Object.values(o.groups).forEach((t=>{this.groups[t.id]=t,this.setGroupBoundingBox(t.id),this.setSelectionState({id:t.id,value:!0})}));const n={...JSON.parse(t),pasteCount:e.pasteCount+1};window.api.copy(JSON.stringify(n))}catch(t){console.log("ERROR: ",t)}}function mi(t){if(this.activePortId&&t){let e=this.activePortId,o=t;this.ports[this.activePortId].type===Cn.Input&&(e=t,o=this.activePortId);const n=(0,B.Z)();this.unsetConnectionPreview(),this.connect({source:e,target:o,id:n}),this.connectionPreviewId=n}}function gi(){this.connectionPreviewId&&this.disconnect(this.connections[this.connectionPreviewId]),this.connectionPreviewId=null}function fi(){if(this.connectionPreviewId){const{source:t,target:e}=this.connections[this.connectionPreviewId];this.disconnect({source:t,target:e}),this.commitState(),this.connect({source:t,target:e}),this.connectionPreviewId=null}}function vi(t){t&&t!==this.activePortId&&this.setActivePortId(t);let e=this.selectedPortIndex+1;e<=0&&(e=0),e>=this.connectablePortIds.length&&(e=-1);const o=this.connectablePortIds[e];o&&!this.ports[t]?.connectedPortIds.includes(o)?this.setConnectionPreview(o):(0===this.connectablePortIds.length&&window.api.beep(),this.unsetConnectionPreview()),this.selectedPortIndex=e}function yi(t){const e=t.id||(0,B.Z)();this.connections[e]={...t,id:e,connectionChainId:t.connectionChainId||e,groupId:null,zIndex:++this.zIndex,isSelected:!1},this.ports[t.source].connectedPortIds.push(t.target),this.ports[t.target].connectedPortIds.push(t.source)}function bi(t){this.createConnection(t),this.simulation.addConnection(t.source,t.target),this.simulation.circuit.next()}function wi({source:t,target:e}){const o=Object.values(this.connections).find((o=>o.source===t&&o.target===e));if(o){const n=this.ports[t].connectedPortIds.findIndex((t=>t===e)),i=this.ports[e].connectedPortIds.findIndex((e=>e===t));this.ports[t].connectedPortIds.splice(n,1),this.ports[e].connectedPortIds.splice(i,1),delete this.connections[o.id]}}function Ii({source:t,target:e}){this.simulation.removeConnection(t,e),this.simulation.circuit.next(),this.destroyConnection({source:t,target:e})}function xi(t){const e=JSON.parse(t),o=e.integratedCircuit?JSON.stringify(e.integratedCircuit):t;this.applyState(o),this.resetCircuit()}function Ci(){this.isPrinting=!0}function Si(){this.isCreatingImage=!0}function Di(){this.unsetConnectionPreview(),this.connectablePortIds=[],this.selectedConnectionIds=[],this.selectedItemIds=[],this.selectedPortIndex=-1,this.cachedState=null,this.activePortId=null,this.connectionPreviewId=null}function _i(t,e,o){const n=t.reduce(((t,e)=>t.concat(this.items[e].portIds)),[]),i=new Set;Object.values(this.connections).forEach((({source:t,target:e,connectionChainId:o})=>{(n.includes(t)||n.includes(e))&&i.add(o)}));const s=Object.values(this.connections).filter((({connectionChainId:t})=>i.has(t))).concat(e.map((t=>this.connections[t])));s.forEach((t=>{this.disconnect(t),this.ports[t.source]?.isFreeport&&this.removeElement(this.ports[t.source].elementId)})),t.forEach(this.removeElement),o.forEach((t=>{delete this.groups[t]}))}function Pi(t,e,o,n,i,s=[]){return{id:t,name:"",type:e,subtype:o,portIds:s.map((({id:t})=>t)),groupId:null,rotation:0,boundingBox:{top:0,left:0,right:n,bottom:i},position:{x:0,y:0},zIndex:0,width:n,height:i,isSelected:!1,properties:{name:{type:"text",label:"Name",value:""}}}}function Oi(t,e,o,n,i){return{id:e,orientation:o,name:i,position:{x:0,y:0},type:n,rotation:0,elementId:t,value:0,hue:0,isMonitored:!1,isFreeport:!1,connectedPortIds:[]}}function Zi({itemId:t,inputPortId:e,outputPortId:o,value:n=0}){const i=[];o&&(this.ports[o]=Oi(t,o,bt.Left,Cn.Output,o),this.ports[o].value=n,this.ports[o].isFreeport=!0,i.push(this.ports[o])),e&&(this.ports[e]=Oi(t,e,bt.Right,Cn.Input,e),this.ports[e].value=n,this.ports[e].isFreeport=!0,i.push(this.ports[e])),this.items[t]=Pi(t,Vo.Freeport,Ao.None,1,1,i),this.items[t].zIndex=this.zIndex++,this.simulation.addNode(this.items[t],this.ports,!0)}function ki(t){const e=this.items[t];let o="",n="";Object.values(this.connections).forEach((t=>{t.target===e.portIds[1]&&(o=t.source),t.source===e.portIds[0]&&(n=t.target)})),o&&this.disconnect({source:o,target:e.portIds[1]}),n&&this.disconnect({source:e.portIds[0],target:n}),o&&n&&this.connect({source:o,target:n})}function Bi(t,e=!0){if(this.items[t.itemId])return;t.sourceId&&t.targetId&&this.commitState(),this.deselectAll(),this.addFreeportItem(t),this.setItemBoundingBox(t.itemId),this.activeFreeportId=t.itemId;let o=[];t.sourceId&&t.inputPortId&&o.push({source:t.sourceId,target:t.inputPortId}),t.targetId&&t.outputPortId&&o.push({source:t.outputPortId,target:t.targetId}),o.forEach((o=>{this.createConnection({...o,connectionChainId:t.connectionChainId}),e&&this.simulation.addConnection(o.source,o.target,this.ports[o.source].value)})),t.sourceId&&t.targetId&&this.simulation.removeConnection(t.sourceId,t.targetId,this.ports[t.sourceId].value),t.sourceId&&t.targetId&&(this.deselectAll(),this.setSelectionState({id:t.itemId,value:!0}),this.incrementZIndex(1)),this.simulation.circuit.next()}function Ei({sourceId:t,targetId:e,portId:o}){const n=this.ports[o],i=Object.values(this.ports).find((t=>t.id!==o&&this.connectablePortIds.includes(t.id)&&J.isInNeighborhood(t.position,n.position,10)));i?t?(this.disconnect({source:t,target:o}),this.connect({source:t,target:i.id})):e&&(this.disconnect({source:o,target:e}),this.connect({source:i.id,target:e})):this.disconnect({source:t||o,target:e||o});const s=Object.values(this.items).find((({portIds:t})=>t.includes(o)));s&&this.removeElement(s.id),this.clearStatelessInfo()}function Mi(){this.commitState();const t=(0,B.Z)(),e=Object.values(this.items).filter((({isSelected:t})=>t)),o=e.reduce(((t,e)=>t.concat(e.portIds)),[]),n=Object.values(this.connections).filter((t=>o.includes(t.source)&&o.includes(t.target)&&t.isSelected));e.forEach((t=>t.groupId&&this.destroyGroup(t.groupId))),n.forEach((t=>t.groupId&&this.destroyGroup(t.groupId)));const i=[...e,...n].reduce(((t,e)=>Math.max(e.zIndex,t)),0),s={id:t,itemIds:e.map((({id:t})=>t)),connectionIds:n.map((({id:t})=>t)),isSelected:!0,boundingBox:{left:0,top:0,right:0,bottom:0},position:{x:0,y:0},zIndex:i};this.groups[t]=s,s.itemIds.forEach((t=>{this.items[t].groupId=s.id})),s.connectionIds.forEach((t=>{this.connections[t].groupId=s.id})),this.setZIndex(i),this.setGroupBoundingBox(t)}function zi(){this.commitState();for(const t in this.groups)this.groups[t].isSelected&&this.destroyGroup(t)}function Ni(t){const e=this.groups[t];e.itemIds.forEach((t=>{this.items[t].groupId=null,this.selectedItemIds.push(t)})),e.connectionIds.forEach((t=>{this.connections[t].groupId=null,this.selectedConnectionIds.push(t)})),delete this.groups[t]}function Fi(t,e,o,n){return{x:(o.x-e.x-t.left)/n,y:(o.y-e.y-t.top)/n}}function ji({item:t,ports:e}){const o=t.integratedCircuit?.ports||e;t.portIds.forEach((t=>{const e=o[t];e&&(this.ports[e.id]=e,e.isMonitored&&this.monitorPort(e.id))}));let n=t.name,i=0;while(this.itemNames.includes(n))n=`${t.name} ${++i}`;t.name=n,this.items[t.id]=t,this.items[t.id].zIndex=++this.zIndex,this.simulation.addNode(t,this.ports),this.resetItemValue(t),this.setProperties(t.id,t.properties),this.setItemBoundingBox(t.id)}function Li({item:t,ports:e},o=null){if(!o){const t=J.getBoundingBoxMidpoint(this.viewport);o={x:t.x+this.viewport.left,y:t.y+this.viewport.top}}const n=Fi(this.canvas,this.viewport,o,this.zoomLevel);n.x-=t.width/2,n.y-=t.height/2,t.position=n,this.commitState(),this.addItem({item:t,ports:e.reduce(((t,e)=>({...t,[e.id]:e})),{})}),this.setItemBoundingBox(t.id),this.setSelectionState({id:t.id,value:!0})}function Ti(t){const e=t.properties?.startValue;if(!e)return;const o=e.value;t.portIds.forEach((t=>this.setPortValue({id:t,value:o})))}function Wi(t){const e=this.items[t];if(!e)return;e.type===Vo.Freeport&&this.disconnectFreeport(t),this.simulation.removeNode(e);const o=[...e.portIds];o.forEach((t=>this.removePort(t))),delete this.items[t]}function $i(t,e){const o=this.items[t],n=o.properties.inputCount.value;if(n>e)this.items[t].portIds.filter((t=>this.ports[t].type===Cn.Input)).slice(e).forEach((t=>this.removePort(t)));else for(let i=n;i<e;i++){const e=(0,B.Z)();this.addPort(t,{id:e,name:"",connectedPortIds:[],type:Cn.Input,elementId:t,virtualElementId:t,orientation:bt.Left,isFreeport:!1,isMonitored:!1,hue:0,position:{x:0,y:0},rotation:0,value:0})}}function Ri(t,e){const o=this.items[t];for(const n in e){const i=e[n];if(o.properties[n].value!==i.value){switch(this.commitState(),n){case"inputCount":this.setInputCount(t,i.value);break;case"interval":this.simulation.setClockInterval(o.portIds.slice(-1)[0],i.value);break}this.items[t].properties[n].value=i.value}}}function Vi(t,e=!1){this.panDelta({x:t.x-this.canvas.left,y:t.y-this.canvas.top},e)}function Ai(t,e=!1){this.animatePan=e;const o={...this.canvas},n=(e=0)=>{const i=t=>1-(1-t)*(1-t),s=i(e/100),r=t.x*s,a=t.y*s;this.canvas.left=o.left+r,this.canvas.right=o.right+r,this.canvas.top=o.top+a,this.canvas.bottom=o.bottom+a,e<100&&this.animatePan?requestAnimationFrame(n.bind(this,e+5)):this.animatePan=!1};e?requestAnimationFrame(n.bind(this,0)):(this.canvas.left+=t.x,this.canvas.right+=t.x,this.canvas.top+=t.y,this.canvas.bottom+=t.y)}function Ui(){const t=J.getBoundingBoxMidpoint(this.canvas),e={x:this.viewport.width/2-t.x,y:this.viewport.height/2-t.y};this.panTo(e)}function qi(t,e,o){const{connectionIds:n,freeportIds:i}=Object.values(t).reduce((({connectionIds:t,freeportIds:n},i)=>{if(o===i.connectionChainId){const o=e[i.source],s=e[i.target];t.add(i.id),o?.isFreeport&&n.add(o.elementId),s?.isFreeport&&n.add(s.elementId)}return{connectionIds:t,freeportIds:n}}),{connectionIds:new Set,freeportIds:new Set});return{connectionIds:Array.from(n),freeportIds:Array.from(i)}}function Hi(t,e){const o=Object.values(this.simulation.nodes).find((({name:e})=>this.items[t].portIds.includes(e)));this.ports[e.id]=e,this.items[t].portIds.push(e.id),o?this.simulation.addPort(e.id,o):this.simulation.addNode(this.items[t],this.ports)}function Ki(t){if(!this.items[this.ports[t]?.elementId])return;Object.values(this.connections).filter((({source:e,target:o})=>e===t||o===t)).forEach((t=>{const{connectionIds:e,freeportIds:o}=qi(Object.values(this.connections),this.ports,t.connectionChainId);e.forEach((t=>this.disconnect(this.connections[t]))),o.forEach((t=>{this.items[t].portIds.forEach((t=>{delete this.ports[t],this.simulation.removePort(t)})),delete this.items[t]}))})),this.simulation.removePort(t);const e=this.ports[t].elementId,o=this.items[e].portIds.indexOf(t);-1!==o&&this.items[e].portIds.splice(o,1),delete this.ports[t]}function Yi(t){this.activePortId!==t&&(t?this.setConnectablePortIds({portId:t}):this.connectablePortIds=[],this.activePortId=t,this.selectedPortIndex=-1)}function Gi({portId:t,isDragging:e}){const o=this.ports[t];if(o.isFreeport)return;const n=Object.values(this.connections).reduce(((t,e)=>t.concat([e.source,e.target])),[]);e&&n.splice(-2);const i=o.type===Cn.Output?t=>t.type===Cn.Input&&!t.isFreeport&&!n.includes(t.id)&&t.elementId!==o.elementId:t=>t.type===Cn.Output&&!t.isFreeport&&!n.includes(o.id)&&t.elementId!==o.elementId;this.connectablePortIds=Object.values(this.ports).filter(i).map((({id:t})=>t))}function Xi({id:t,value:e}){this.simulation.setPortValue(t,e),this.isDebugging&&(this.isCircuitEvaluated=!this.simulation.canContinue)}function Ji(t){this.ports[t].isMonitored?this.unmonitorPort(t):this.monitorPort(t)}function Qi(t){const e=this.ports[t];e.hue=e.hue||~~(360*Math.random()),e.isMonitored=!0,this.simulation.monitorPort(t,e.value,e.hue),this.isOscilloscopeOpen=!0}function ts(t){const e=this.ports[t];e.isMonitored=!1,this.simulation.unmonitorPort(t),this.isOscilloscopeOpen=Object.keys(this.oscillogram).length>0}function es(){const t=Object.values(this.items).map((({boundingBox:t})=>t)),e=J.getGroupBoundingBox(t),{x:o,y:n}=J.getCenteredScreenPoint(this.canvas,e,20),i=o-e.left,s=n-e.top;Object.values(this.items).forEach((t=>{this.setItemPosition({id:t.id,position:{x:t.position.x+i,y:t.position.y+s}})}))}function os(t,e){const o=this.ports[e];o.position=Fi(this.canvas,this.viewport,t,this.zoom)}function ns({id:t,position:e}){const o=this.items[t],n={x:e.x-o.position.x,y:e.y-o.position.y};this.items[t].position=e,this.setItemBoundingBox(t),o.portIds.forEach((t=>{const e=this.ports[t];this.ports[t].position={x:e.position.x+n.x,y:e.position.y+n.y}}))}function is(t,e,o){const{x:n,y:i}=Fi(this.canvas,this.viewport,e,this.zoom),{width:s,height:r,rotation:a}=this.items[t],c=J.getBoundingBox({x:n,y:i},a,s,r),l=J.getSnapOffset(this.snapBoundaries,c,o||M.Outer,15);this.setSelectionPosition({id:t,position:{x:n+l.x,y:i+l.y}})}function ss(t){const e=this.selectedItemIds[0];if(e){const o=this.items[e],n={x:o.position.x+t.x,y:o.position.y+t.y};this.commitState(),this.setSelectionPosition({id:e,position:n})}}function rs({id:t,position:e}){const o=this.items[t],n={x:e.x-o.position.x,y:e.y-o.position.y},i=new Set;if(this.setSelectionState({id:t,value:!0}),o.type===Vo.Freeport)return this.setItemPosition({id:t,position:e});this.selectedItemIds.forEach((t=>{const e=this.items[t],o={x:e.position.x+n.x,y:e.position.y+n.y};e.groupId&&i.add(e.groupId),this.setItemPosition({id:t,position:o})})),i.forEach(this.setGroupBoundingBox)}function as(t,e=0){return(t+e%4+4)%4}function cs(t,e,o){const n=t.right-t.left,i=t.bottom-t.top,s=t.left+n/2,r=t.top+i/2,a=e.position.x,c=e.position.y,l=a+e.width/2,u=c+e.height/2,d=Math.hypot(s-l,r-u),p=Math.atan2(u-r,l-s),h=90*o*(Math.PI/180)+p,m=d*Math.cos(h)+s,g=d*Math.sin(h)+r;return{x:m-e.width/2,y:g-e.height/2}}var ls={rotate:as,getGroupedItemRotatedPosition:cs};function us(t){this.commitState();const e=Object.values(this.items).filter((({isSelected:t})=>t)),o=e.map((({boundingBox:t})=>t)),n=J.getGroupBoundingBox(o),i=new Set;e.forEach((e=>{const o=ls.rotate(e.rotation+t);e.groupId&&i.add(e.groupId),this.items[e.id].rotation=o,this.items[e.id].portIds.forEach((t=>{this.ports[t].rotation=o})),this.setItemPosition({id:e.id,position:ls.getGroupedItemRotatedPosition(n,e,t)})})),i.forEach((t=>{this.setGroupBoundingBox(t)}))}function ds(t){this.setSelectionState({id:t,value:!1})}function ps(t,e=!1){e||this.deselectAll(),this.setSelectionState({id:t,value:!0})}function hs(){this.clearStatelessInfo();for(let t in this.connections)this.connections[t].isSelected=!0,this.selectedConnectionIds.push(t);for(let t in this.items)this.items[t].isSelected=!0,this.selectedItemIds.push(t)}function ms(){this.clearStatelessInfo();for(let t in this.connections)this.connections[t].isSelected=!1,this.selectedConnectionIds=[];for(let t in this.items)this.items[t].isSelected=!1,this.selectedItemIds.push(t),this.selectedItemIds=[]}function gs(t){if(!J.isOneOrTwoDimensional(t))return;const e=Object.keys(this.items).filter((e=>J.hasIntersection(t,this.items[e].boundingBox))),o=Object.keys(this.connections).filter((e=>{const o=this.connections[e],n=this.ports[o.source],i=this.ports[o.target];return J.isLineIntersectingRectangle(n.position,i.position,t)}));e.concat(o).forEach((t=>{this.updateSelectionList({id:t,isSelected:!0})})),this.selectItemConnections(e)}function fs(t){const e=t.reduce(((t,e)=>t.concat(this.items[e].portIds)),[]);for(let o in this.connections){const t=this.connections[o];e.includes(t.source)&&e.includes(t.target)&&this.updateSelectionList({id:o,isSelected:!0})}}function vs({id:t,isSelected:e}){const o=(t,o)=>{const n=this[o].findIndex((e=>e===t));e&&-1===n&&this[o].push(t),e||-1===n||this[o].splice(n,1)};if(this.items[t])this.items[t].isSelected=e,o(t,"selectedItemIds");else if(this.connections[t]){const{connectionChainId:n}=this.connections[t],{connectionIds:i,freeportIds:s}=qi(Object.values(this.connections),this.ports,n);i.forEach((t=>{this.connections[t].isSelected=e,o(t,"selectedConnectionIds")})),s.forEach((t=>{this.items[t].isSelected=e,o(t,"selectedItemIds")}))}}function ys({id:t,value:e}){const o=this.items[t]||this.connections[t],n=e;if(o&&o.isSelected!==n)if(o.groupId){const{itemIds:t,connectionIds:e}=this.groups[o.groupId];t.concat(e).forEach((t=>{this.updateSelectionList({id:t,isSelected:n})})),this.updateSelectionList({id:o.groupId,isSelected:n})}else this.updateSelectionList({id:t,isSelected:n})}function bs(t){const e=t?this.baseItems[0]:this.baseItems.slice(-1)[0];e&&(this.deselectAll(),this.setSelectionState({id:e.id,value:!0}))}function ws(){this.hasSelection&&(this.commitState(),this.clearBaseItems(this.selectedItemIds,this.selectedConnectionIds,this.selectedGroupIds.filter((t=>null!==t))),this.deselectAll())}function Is(){this.simulation.oscillator.isPaused?this.simulation.oscillator.start():this.simulation.oscillator.stop(),this.isOscilloscopeRecording=!this.simulation.oscillator.isPaused}function xs(t){for(const e in t)if(this.ports[e]){const o=this.ports[e],n=this.items[o.elementId];n&&o.value!==t[e]&&(this.debugger.hasUpdated=!0),o.value=t[e]}this.isCircuitEvaluated=!this.simulation.canContinue,clearTimeout(this.debugger.timeout),this.debugger.timeout=window.setTimeout((()=>{!this.debugger.hasUpdated&&this.simulation.canContinue&&this.isDebugging&&(this.debugger.hasUpdated=!1,this.simulation.advanceDebuggerStep())}))}function Cs(t){window.api.showMessageBox({message:"An infinite loop was detected! Entering debugger mode.",type:"error"}),this.isDebugging=!0,this.simulation.startDebugging()}function Ss(){const t=Object.values(this.items),e=Object.values(this.connections);Object.values(this.ports).forEach((t=>{t.value=0})),this.simulation.stop(),this.simulation=new ri(t,e,this.ports),this.simulation.onChange(this.onSimulationUpdate),this.simulation.onError(this.onError),this.simulation.oscillator.on("change",(t=>{this.oscillogram=t})),Object.values(this.items).forEach((({properties:t,portIds:e})=>{t?.startValue&&e.forEach((e=>this.setPortValue({id:e,value:t.startValue.value})))})),this.simulation.start(),this.isDebugging&&(this.simulation.startDebugging(),this.isCircuitEvaluated=!this.simulation.canContinue)}function Ds(){this.debugger.hasUpdated=!1,this.simulation.advanceDebuggerStep(),this.isCircuitEvaluated=!this.simulation.canContinue}function _s(){this.isDebugging?this.simulation.stopDebugging():this.simulation.startDebugging(),this.isDebugging=!this.isDebugging}function Ps(){this.isOscilloscopeOpen?this.closeOscilloscope():this.openOscilloscope()}function Os(){Object.values(this.ports).forEach((t=>{t.isMonitored&&this.simulation.monitorPort(t.id,t.value,t.hue)})),this.isOscilloscopeOpen=!0}function Zs(t){this.isOscilloscopeOpen&&(Object.keys(this.ports).forEach(this.simulation.unmonitorPort),this.simulation.oscillator.clear(),this.isOscilloscopeOpen=!1,t&&(this.oscilloscopeHeight=t))}function ks(){this.simulation.oscillator.clear()}const Bs=.1;function Es(){const t=Object.values(this.items).map((t=>t.boundingBox)),e=J.getGroupBoundingBox(t),o=e.right-e.left,n=e.bottom-e.top,i=this.canvas.right-this.canvas.left,s=this.canvas.bottom-this.canvas.top;(o>i||n>s)&&(this.canvas={left:0,top:0,right:2*o,bottom:2*n},this.centerAll(),this.panToCenter()),setTimeout((()=>{this.setZoom({zoom:Math.min(this.viewport.width/o,this.viewport.height/n,1)})}))}function Ms(t){this.viewport=t,this.canvas.right=screen.width/Bs,this.canvas.bottom=screen.height/Bs,!this.hasLoaded&&t.width>0&&t.height>0&&(this.hasLoaded=!0,this.updateCanvasSize(),this.centerAll(),this.panToCenter())}function zs({rect:t,id:e}){const o=this.items[e],n=t.width/this.zoomLevel,i=t.height/this.zoomLevel,s=o.position.x+o.width/2,r=o.position.y+o.height/2,a=s-n/2,c=r-i/2;this.items[e].position={x:a,y:c},this.items[e].width=n,this.items[e].height=i,this.setItemBoundingBox(e),this.items[e].groupId&&this.setGroupBoundingBox(this.items[e].groupId)}function Ns(t){if(!this.items[t])return;const{position:e,rotation:o,width:n,height:i}=this.items[t];this.items[t].boundingBox=J.getBoundingBox(e,o,n,i)}function Fs(t){if(!this.groups[t])return;const e=this.groups[t].itemIds.map((t=>this.items[t].boundingBox));this.groups[t].boundingBox=J.getGroupBoundingBox(e)}function js(t){this.snapBoundaries=(()=>{if(this.connectablePortIds.length)return this.connectablePortIds.filter((e=>e!==t)).map((t=>J.getPointBoundary(this.ports[t].position)));const e=this.items[t];if(e&&!e.groupId){if(e.type!==Vo.Freeport)return Object.values(this.items).filter((e=>e.id!==t&&e.type!==Vo.Freeport)).map((t=>t.boundingBox));if(e.portIds.length>1)return Object.values(this.connections).reduce(((t,o)=>e.portIds.includes(o.source)?t.concat(J.getLinearBoundaries(this.ports[o.target].position)):e.portIds.includes(o.target)?t.concat(J.getLinearBoundaries(this.ports[o.source].position)):t),[])}return[]})()}function Ls(){const t=this.undoStack.slice(-1).pop();t&&(this.redoStack.push(JSON.stringify({connections:this.connections,items:this.items,ports:this.ports,groups:this.groups})),this.applyState(t),this.undoStack.pop(),this.isDirty=!0)}function Ts(){const t=this.redoStack.slice(-1).pop();t&&(this.undoStack.push(JSON.stringify({connections:this.connections,items:this.items,ports:this.ports,groups:this.groups})),this.applyState(t),this.redoStack.pop(),this.isDirty=!0)}function Ws(){this.cacheState(),this.commitCachedState()}function $s(){this.cachedState=JSON.stringify({connections:this.connections,items:this.items,ports:this.ports,groups:this.groups})}function Rs(){this.cachedState&&(this.undoStack.push(this.cachedState.toString()),this.cachedState=null,this.redoStack=[],this.isDirty=!0)}function Vs(t){const e=JSON.parse(t),{items:o,connections:n,ports:i,groups:s}=e;function r(t,e){const o=Object.keys(t),n=Object.keys(e);return o.filter((t=>!n.includes(t)))}const a=r(this.items,o),c=r(this.connections,n),l=r(o,this.items),u=r(n,this.connections);this.clearBaseItems(a,c,[]),this.ports=i,this.items=o,this.groups=s,l.forEach((t=>{this.addItem({item:o[t],ports:i})})),u.forEach((t=>this.connect(n[t]))),this.stepThroughCircuit()}function As(t,e){return t.zIndex>e.zIndex?1:t.zIndex<e.zIndex?-1:0}function Us(){this.commitState(),this.incrementZIndex(-1)}function qs(){this.commitState(),this.incrementZIndex(1)}function Hs(){this.commitState(),this.setZIndex(1)}function Ks(){this.commitState(),this.setZIndex(this.zIndex)}function Ys(t){const e=Object.values(this.items),o=Object.values(this.connections),n=e.concat(o).sort(As),i=n.filter((({isSelected:t})=>t)).map((({id:t})=>t));t>0&&i.reverse();const s=[];i.forEach((e=>{const o=n.findIndex((t=>t.id===e)),i=o+t;if(i<0||i>=n.length)s.push(n[o].id);else if(!s.includes(n[i]?.id)){const t=n[o];n.splice(o,1),n.splice(i,0,t)}})),n.forEach(((t,e)=>{t.zIndex=e+1})),this.zIndex=Object.keys(n).length}function Gs(t){const e=Object.values(this.items),o=Object.values(this.connections);let n=e.concat(o).sort(As);const i=n.filter((({isSelected:t})=>t));for(let s=0;s<n.length;s++)n[s].isSelected&&(n.splice(s,1),s--);n.splice(t-1,0,...i),n.forEach(((t,e)=>{t.zIndex=e+1})),this.zIndex=Object.keys(n).length}const Xs=.1,Js=2,Qs=.1;function tr(t=1){this.setZoom({zoom:this.zoomLevel+Qs*t})}function er({zoom:t,point:e}){t<Xs&&(t=Xs),t>Js&&(t=Js),t=Math.round(100*t)/100,e||(e=J.getBoundingBoxMidpoint(this.viewport),e.x+=this.viewport.left,e.y+=this.viewport.top);const o=Fi(this.canvas,this.viewport,e,this.zoomLevel),n={x:o.x*t,y:o.y*t},i={x:e.x-this.viewport.x,y:e.y-this.viewport.y};this.panTo({x:Math.round(Math.min(i.x-n.x,0)),y:Math.round(Math.min(i.y-n.y,0))}),this.zoomLevel=t}const or=t=>(0,w.Q_)({id:t,state:ai,getters:{baseItems(t){return Object.values(t.connections).concat(Object.values(t.items)).sort(As)},zoom(t){return t.zoomLevel},hasSelection(t){return t.selectedItemIds.length>0||t.selectedConnectionIds.length>0},hasSelectedItems(t){return t.selectedItemIds.length>0},selectedGroupIds(t){const e=new Set;return t.selectedItemIds.forEach((o=>e.add(t.items[o]?.groupId))),Array.from(e)},canGroup(){return this.selectedGroupIds.length>1||null===[].slice.call(this.selectedGroupIds)[0]},canUngroup(){return!![].slice.call(this.selectedGroupIds).find((t=>!!t))},canUndo(t){return t.undoStack.length>0},canRedo(t){return t.redoStack.length>0}},actions:{...n,...i,...s,...r,...a,...c,...l,...u,...d,...p,...h,...m,...f,...g,...v,...y,...b}});function nr(t,e,o,n,i=Ao.CustomCircuit){const{ports:s,items:r,connections:a,groups:c}=an()(t),l=Pi((0,B.Z)(),Vo.IntegratedCircuit,i,o,n);return Object.values(r).forEach((t=>{const e=t.portIds.map((t=>s[t]));let o=0;const n=e.reduce(((t,e)=>void 0===t||t===e.type?e.type:null),void 0);if("number"!==typeof n)return;const i=n===Cn.Input?bt.Right:bt.Left;e.filter((t=>t.type===n)).forEach((r=>{const a=(0,B.Z)(),c=t.properties.name?.value||t.name;s[a]={...an()(r),type:n===Cn.Input?Cn.Output:Cn.Input,name:e.length>1?`${c} ${o++}`:c,id:a,elementId:t.id,orientation:i,value:0},t.portIds.push(a),l.portIds.push(a)})),t.type=Vo.Buffer})),l.name=e,l.integratedCircuit={items:r,connections:a,ports:s,groups:c,serializedState:JSON.stringify({items:t.items,connections:t.connections,ports:t.ports,groups:t.groups})},l}var ir=o(8764),sr=o(5733),rr=o.n(sr);class ar{static async open(t){const e=new(rr()),o=window.api.openFile(t),{files:n}=await e.loadAsync(o),i=await n.content.async("text");return i}static async writeBlob(t,e){const o=await e.arrayBuffer(),n=ir.lW.from(o);window.api.saveFile(t,n)}static async save(t,e){const o=new(rr());o.file("content",JSON.stringify(e));const n=await o.generateAsync({type:"blob"});this.writeBlob(t,n)}}const cr=(0,w.Q_)("integratedCircuit",{state:()=>({isBuilderOpen:!1,model:null,factories:{},resolve:()=>{}}),actions:{launchBuilder(t){return this.isBuilderOpen=!0,this.model=nr(t,"My integrated circuit",400,400),new Promise((t=>{this.resolve=t}))},async loadLibrary(){const t=window.api.getFilePaths("../../Desktop","aicx");for(let e=0;e<t.length;e++)await this.loadCircuit(t[e])},async loadCircuit(t){try{const e=await ar.open(t),o=JSON.parse(e);this.factories[o.name]=()=>{const t=ui.mapIntegratedCircuitIds(o),e=t.portIds.map((e=>t.integratedCircuit?.ports[e]));return{item:t,ports:e}}}catch(e){console.log(e),window.api.showMessageBox({message:`Could not load ${t} into the integrated circuit library. The file is not a valid Aristotle circuit.`,title:"Error",type:"error"})}},async save(){if(this.model){try{const t=`${this.model.name}.aicx`,e=window.api.showSaveFileDialog([{name:"Aristotle Integrated Circuit (*.aicx)",extensions:["aicx"]}],t);if(!e)return;await ar.save(e,this.model),await this.loadCircuit(e),window.api.showMessageBox({message:"Integrated circuit successfully created. You can find it in the toolbox.",title:"Success",type:"info"})}catch(t){window.api.showMessageBox({message:"An error occurred while trying to save the integrated circuit.",title:"Error",type:"error"})}this.close()}},close(){this.resolve(),this.isBuilderOpen=!0}}});function lr(t){return t.split("\\").pop()?.split("/").pop()||""}const ur=(0,w.Q_)({id:"root",state:()=>({documents:{},clipboard:null,activeDocumentId:null,canExit:!1,isFullscreen:!1,isBuilderOpen:!1,isToolboxOpen:!1}),getters:{hasOpenDocuments(t){return Object.keys(t.documents).length>0},activeDocument(t){return t.activeDocumentId?t.documents[t.activeDocumentId]:null},isDialogOpen(t){return t.isBuilderOpen}},actions:{async launchIntegratedCircuitBuilder(){const t=cr(),e=this.activeDocument;if(e){this.isBuilderOpen=!0;try{await t.launchBuilder(e.store().$state);const o=e.store(),n=ui.mapIntegratedCircuitIds(t.model);o.insertItemAtPosition({item:n,ports:[]}),o.setItemBoundingBox(n.id),o.setSelectionState({id:n.id,value:!0})}catch(o){window.api.showMessageBox({message:"That's okay."})}this.isBuilderOpen=!1}},openIntegratedCircuit(t){t.integratedCircuit&&this.openDocument("",t.integratedCircuit.serializedState,t.id,t.name)},async saveImage(t){if(this.activeDocument)try{const e=this.activeDocument.displayName.replace(/\.[^/.]+$/,""),o=`${e}.png`,n=window.api.showSaveFileDialog([{name:"PNG Image",extensions:[".png"]}],o);if(!n)return;await ar.writeBlob(n,t)}catch(e){console.log("ERROR: ",e),window.api.showMessageBox({message:"An error occurred while trying to save the image.",title:"Error",type:"error"})}},newDocument(){const t=(0,B.Z)(),e=or(t),o=e();o.resetCircuit(),this.documents[t]={fileName:"Untitled Circuit",displayName:"Untitled Circuit",store:e},this.activateDocument(t)},async closeAll(){if(this.activeDocumentId){const t=await this.closeDocument(this.activeDocumentId);return await new Promise((t=>setTimeout(t))),!!t&&this.closeAll()}return!0},printActiveDocument(){this.activeDocument&&(this.activeDocument.store().isPrinting=!0)},async closeDocument(t){const e=this.documents[t],o=e.store();let n=!0;if(this.activateDocument(t),o.isDirty){const t=window.api.showMessageBox({message:`Save changes to ${e.fileName}?`,title:"Confirm",buttons:["Yes","No","Cancel"]});if(0===t&&(n=await this.saveActiveDocument()),2===t)return!1}this.activeDocumentId=null,o.simulation.stop(),o.$reset(),o.$dispose(),delete this.documents[t];const i=Object.keys(this.documents).pop();return i&&this.activateDocument(i),n},async saveActiveDocument(t=!1){try{if(!this.activeDocument)return!0;if(!this.activeDocument.filePath||t){const t=this.activeDocument.fileName||`${this.activeDocument.fileName}.alfx`,e=window.api.showSaveFileDialog([{name:"Aristotle Logic Circuit (*.alfx)",extensions:["alfx"]}],t);if(!e)return!0;if(e){const t=lr(e);this.activeDocument.filePath=e,this.activeDocument.fileName=t,this.activeDocument.displayName=t}}if(!this.activeDocument.filePath)return!0;const e=this.activeDocument.store();return ar.save(this.activeDocument.filePath,{items:e.items,connections:e.connections,groups:e.groups,ports:e.ports}),e.isDirty=!1,!0}catch(e){return window.api.showMessageBox({message:"An error occurred while trying to save the file.",title:"Error",type:"error"}),!1}},async selectDocument(){const t=window.api.showOpenFileDialog([{name:"Aristotle Logic Circuit (*.alfx)",extensions:["alfx"]},{name:"Aristotle Integrated Circuit (*.aicx)",extensions:["aicx"]}]);for(let e=0;e<t.length;e++)await this.openDocumentFromPath(t[e])},async openDocumentFromPath(t){try{const e=await ar.open(t);e&&this.openDocument(t,e,(0,B.Z)())}catch(e){console.log(e),window.api.showMessageBox({message:`Could not open ${t}. The file is not a valid Aristotle circuit.`,title:"Error",type:"error"})}},openDocument(t,e,o,n=""){if(this.documents[o])return this.activateDocument(o);const i=or(o),s=i(),r=lr(t);s.loadDocument(e),this.documents[o]={fileName:r,filePath:/^.*.aicx$/i.test(t)?void 0:t,displayName:n||r,store:i},this.activateDocument(o)},switchDocument(t){const e=Object.keys(this.documents),o=e.findIndex((t=>this.activeDocumentId===t));let n=o+t;0!==e.length&&(-1===o||n>=e.length?n=0:n<0&&(n=e.length-1),this.activateDocument(e[n]))},pauseActivity(){this.activeDocument?.store().simulation.stop()},resumeActivity(){this.activeDocument?.store().simulation.start()},activateDocument(t){this.pauseActivity(),this.activeDocumentId=t,this.resumeActivity()},openTestDocuments(){this.openDocument("flip-flop.alfx",JSON.stringify(Pn),(0,B.Z)(),"flip-flop.alfx"),cr().loadLibrary()},navigateDocumentList(t){const e=Object.keys(this.documents),o=e.findIndex((t=>t===this.activeDocumentId));let n=o+t;n<0&&(n=e.length-1),n>=e.length&&(n=0),this.activateDocument(e[n])},toggleFullscreen(){this.isFullscreen=!this.isFullscreen,window.api.setFullscreen(this.isFullscreen)},toggleToolbox(){this.isToolboxOpen=!this.isToolboxOpen}}});var dr=(0,x.aZ)({name:"Item",components:{CircuitComponent:Ko,Draggable:ct,PortItem:_n,Properties:fn},props:{zIndex:{type:Number,default:1},isSelected:{type:Boolean,default:!1},id:{type:String,required:!0},flash:{type:Boolean,default:!1},store:{type:Function,required:!0}},setup(t,{emit:e}){const o=t.store(),n=(0,x.Fl)((()=>o.items[t.id])),i=(0,x.Fl)((()=>o.viewport)),s=(0,P.iH)(),r=(0,P.iH)(0);(0,x.YP)((()=>n.value?.rotation),(()=>r.value++)),(0,x.YP)((()=>n.value?.properties.inputCount?.value),(()=>r.value++));const a=(0,x.Fl)((()=>o.items[t.id].portIds.map((t=>o.ports[t])))),c=(0,x.Fl)((()=>t.isSelected&&1===o.selectedItemIds.length&&n.value.type!==Vo.Freeport));function l(){s.value?.$el.focus()}function u(){n.value?.subtype===Ao.CustomCircuit&&ur().openIntegratedCircuit(n.value)}function d(){o.cacheState(),o.setSnapBoundaries(t.id)}function p(e,i){o.dragItem(t.id,{x:e.x-i.x-n.value.width/2*o.zoomLevel,y:e.y-i.y-n.value.height/2*o.zoomLevel})}function h(t){document.activeElement===s.value?.$el?s.value.$el.blur():t.preventDefault()}function m(t){o.activePortId===t&&o.setActivePortId(null)}function g(e){o.setItemSize({id:t.id,rect:e})}function f(){t.isSelected||o.selectItem(t.id),window.api.showContextMenu(kt(t.store))}return{item:n,itemRef:s,store:o,ports:a,viewport:i,isPropertiesEnabled:c,portUpdates:r,focus:l,onDrag:p,onDragStart:d,onEscapeKey:h,onResize:g,onPortBlur:m,onContextMenu:f,revealCustomCircuit:u,ItemSubtype:Ao,ItemType:Vo}}});const pr=(0,nt.Z)(dr,[["render",zt]]);var hr=pr;function mr(t,e,o,n,i,s){const r=(0,x.up)("selector"),a=(0,x.up)("resizable");return(0,x.wg)(),(0,x.j4)(a,{onMousewheel:t.onMouseWheel,onMousedown:(0,I.iM)(t.onMouseDown,["right"]),onTouchstart:t.onTouchStart,onTouchmove:t.onTouchMove,onTouchend:t.onTouchEnd,onResize:e[0]||(e[0]=e=>t.$emit("resize",e)),class:"editor"},{default:(0,x.w5)((()=>[(0,x._)("div",{style:(0,C.j5)(t.style),class:"editor__grid"},[(0,x.Wm)(r,{zoom:t.zoom,onSelectionStart:t.onSelectionStart,onSelectionEnd:t.onSelectionEnd,ref:"selector"},null,8,["zoom","onSelectionStart","onSelectionEnd"]),(0,x.WI)(t.$slots,"default")],4)])),_:3},8,["onMousewheel","onMousedown","onTouchstart","onTouchmove","onTouchend"])}function gr(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{onMousedown:e[0]||(e[0]=(0,I.iM)(((...e)=>t.onMouseDown&&t.onMouseDown(...e)),["left","self"])),class:"selector",ref:"selector"},[t.hasSelection?((0,x.wg)(),(0,x.iD)("div",{key:0,style:(0,C.j5)(t.style),class:"selector__selection"},null,4)):(0,x.kq)("",!0)],544)}var fr=(0,x.aZ)({name:"Selector",emits:{selectionStart:t=>!0,selectionEnd:t=>!0},props:{zoom:{type:Number,default:1}},setup(t,{emit:e}){const o=(0,P.iH)({x:0,y:0}),n=(0,P.iH)({x:0,y:0}),i=(0,P.iH)(null),s=(0,P.iH)(!1),r=()=>({left:Math.min(o.value.x,n.value.x),top:Math.min(o.value.y,n.value.y),width:Math.abs(o.value.x-n.value.x),height:Math.abs(o.value.y-n.value.y)}),a=(0,x.Fl)((()=>{const t=r();return{left:`${t.left}px`,top:`${t.top}px`,width:`${t.width}px`,height:`${t.height}px`}}));function c(e){if(!i.value)return{x:0,y:0};const{top:o,left:n}=i.value.getBoundingClientRect(),s=(e.x-n)/t.zoom,r=(e.y-o)/t.zoom;return{x:s,y:r}}function l(){const{left:t,top:o,width:n,height:i}=r();e("selectionEnd",{left:t,top:o,bottom:i+o,right:t+n})}function u(t){const i=c(t);s.value=!0,o.value=i,n.value=i,e("selectionStart",t)}function d(t){s.value&&(n.value=c(t))}function p(){s.value&&(l(),s.value=!1,o.value.x=0,o.value.y=0,n.value.x=0,n.value.y=0)}return(0,x.bv)((()=>{window.addEventListener("mousemove",d),window.addEventListener("mouseup",p)})),(0,x.Jd)((()=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",p)})),{selector:i,hasSelection:s,style:a,onMouseDown:u}}});const vr=(0,nt.Z)(fr,[["render",gr]]);var yr=vr,br=(0,x.aZ)({name:"Editor",emits:{resize:t=>!0,pan:(t,e)=>!0,selection:t=>!0,deselect:()=>!0,zoom:t=>!0,contextmenu:t=>!0},components:{Selector:yr,Resizable:st},props:{zoom:{type:Number,default:1},gridSize:{type:Number,default:0},width:{type:Number,default:0},height:{type:Number,default:0},offset:{type:Object,default:()=>({x:0,y:0})},animatePan:{type:Boolean,default:!1}},setup(t,{emit:e}){let o={x:0,y:0},n={x:0,y:0},i={y:0,x:0},s=0,r=0,a=!1,c=0,l=1;const u=(0,P.iH)(null),d=(0,x.Fl)((()=>({backgroundSize:`${t.gridSize}px ${t.gridSize}px`,transform:`scale(${t.zoom})`,left:`${t.offset.x}px`,top:`${t.offset.y}px`,width:`${t.width}px`,height:`${t.height}px`})));function p({touches:t}){const e=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.hypot(e,o)}function h(e,c){a=!0,o={x:e-t.offset.x,y:c-t.offset.y},i={x:e,y:c},n={x:e,y:c},s=0,r=0}function m(t,i){if(a){const a=n.x-t,c=n.y-i;e("pan",{x:Math.min(t-o.x,0),y:Math.min(i-o.y,0)}),s=Math.hypot(a,c),r=Math.atan2(c,a),n={x:t,y:i}}}function g(){const o=2,n=s*Math.cos(r)*o,i=s*Math.sin(r)*o;e("pan",{x:Math.min(t.offset.x-n,0),y:Math.min(t.offset.y-i,0)},!0)}function f(t){h(t.x,t.y),t.preventDefault(),t.stopPropagation()}function v(t){m(t.x,t.y)}function y(t){a&&(a=!1,2===t.button&&J.isInNeighborhood(t,i,5)?e("contextmenu",t):g())}function b(e){const{clientX:o,clientY:n}=e.touches[0];e.targetTouches.length>1?(c=p(e),l=t.zoom):h(o,n),e.preventDefault(),e.stopPropagation()}function w(t){const{clientX:o,clientY:n}=t.touches[0];if(t.preventDefault(),t.stopPropagation(),t.targetTouches.length>1&&t.changedTouches.length>1){const i=p(t),s=Math.max(Math.min(l*(i/c),4),.1),r={x:(o+t.touches[1].clientX)/2,y:(n+t.touches[1].clientY)/2};e("zoom",{zoom:s,point:r})}else 0===c&&m(o,n)}function I(t){t.target===u.value?.$el&&e("deselect"),a&&g(),a=!1,c=0}function C(o){const{deltaY:n,x:i,y:s,shiftKey:r}=o;if(!r)return;const a=n<0?1:-1,c=t.zoom+a/10;e("zoom",{zoom:c,point:{x:i,y:s}})}function S(t){t.shiftKey||e("deselect")}function D(t){e("selection",t)}return(0,x.bv)((()=>{window.addEventListener("mousemove",v),window.addEventListener("mouseup",y)})),(0,x.Jd)((()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",y)})),{selector:u,style:d,onTouchStart:b,onTouchMove:w,onTouchEnd:I,onMouseDown:f,onMouseMove:v,onMouseWheel:C,onSelectionStart:S,onSelectionEnd:D}}});const wr=(0,nt.Z)(br,[["render",mr]]);var Ir=wr;function xr(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(["group",{"group--is-selected":t.isSelected}]),tabindex:-1,style:(0,C.j5)({position:"absolute",left:`${t.boundingBox.left}px`,top:`${t.boundingBox.top}px`,width:t.boundingBox.right-t.boundingBox.left+"px",height:t.boundingBox.bottom-t.boundingBox.top+"px",zIndex:t.zIndex})},null,6)}var Cr=(0,x.aZ)({name:"Group",props:{boundingBox:{type:Object,required:!0},id:{type:String,required:!0},isSelected:{type:Boolean,default:!1},zIndex:{type:Number,default:0},zoom:{type:Number,default:1}}});const Sr=(0,nt.Z)(Cr,[["render",xr]]);var Dr=Sr,_r=o(9306),Pr=o.n(_r);function Or(t,e,o,n,i="printer-friendly"){const s=e.cloneNode(!0),r=o.right-o.left+2*n,a=o.bottom-o.top+2*n;for(let c=0;c<s.children.length;c++){const t=s.children[c],e=parseInt(t.style.left.replace("px",""),10)+n,i=parseInt(t.style.top.replace("px",""),10)+n;t.style.left=e-o.left+"px",t.style.top=i-o.top+"px"}return s.style["zoom"]=t.toString(),s.style.width=`${r}px`,s.style.height=`${a}px`,s.style.position="relative",s.style.top="0",s.style.left="0",s.style.background="none",i&&s.classList.add(i),{printArea:s,width:r,height:a}}function Zr(t,e){const o=document.createElement("iframe");o.name="print",o.style.width="1px",o.style.height="1px",o.style.opacity="0",o.style.position="absolute",o.style.top="0px",o.style.left="0px",document.body.appendChild(o);const n=o.contentWindow;if(n){const o=document.createElement("style");o.appendChild(document.createTextNode(`\n      @page {\n        size: ${e.map((t=>`${t}in`)).join(" ")};\n        margin: 0in;\n      }\n    `)),n.document.head.append(o),n.document.body.appendChild(t)}return o}async function kr(t,e){document.body.appendChild(t);const o=await Pr()[e](t);return t.remove(),o}async function Br(t){return new Promise((e=>{setTimeout((()=>{if(!t)return e();t.addEventListener("afterprint",(()=>e())),t.print()}))}))}async function Er(t,e,o){const{printArea:n,width:i,height:s}=Or(1/t,e,o,20),r=await Mr.createImage(n,"toPng"),a=[8.5,11],c=96*Math.min(...a),l=96*Math.max(...a),u=new Image;let d=1;if(u.src=r,i>c||i>l||s>c||s>l){const t=i>s;d=t?l/i:l/s,t&&a.reverse()}u.style.width=`${Math.floor(i*d)}px`,u.style.height=`${Math.floor(s*d)}px`;const p=Mr.createPrintFrame(u,a);await Mr.printWindow(p?.contentWindow),p?.remove()}const Mr={createPrintArea:Or,createPrintFrame:Zr,createImage:kr,printImage:Er,printWindow:Br};var zr=Mr,Nr=(0,x.aZ)({name:"Document",components:{Group:Dr,Editor:Ir,Connection:Mt,Item:hr},props:{store:{type:Function,required:!0}},setup(t){const e=t.store(),o=ur(),n=(0,P.iH)(),i=(0,P.iH)(0);let s=1,r={};function a(t){if(n.value){const o=Object.values(e.items).map((({boundingBox:t})=>t)),i=J.getGroupBoundingBox(o),s=n.value.$el.querySelector(".editor__grid");t(s,i)}}async function c(){a((async(t,o)=>{await zr.printImage(e.zoom,t,o),e.isPrinting=!1}))}async function l(){a((async(t,n)=>{const{printArea:i}=zr.createPrintArea(1/e.zoom,t,n,20,""),s=await zr.createImage(i,"toBlob");await o.saveImage(s),e.isCreatingImage=!1}))}function u(t){return function(o){o.target instanceof HTMLInputElement||(e[t](),o.preventDefault())}}function d(t){if(!(t.target instanceof HTMLInputElement))switch(t.key){case"Escape":return e.deselectAll();case"a":return t.ctrlKey&&e.selectAll();default:return m(t)}}function p(t){r[t.key]=!1,s=1}function h(e){window.api.showContextMenu(kt(t.store)),e.preventDefault(),e.stopPropagation()}function m(t){const o=(()=>{switch(t.key){case"ArrowLeft":return{x:-1,y:0};case"ArrowUp":return{x:0,y:-1};case"ArrowRight":return{x:1,y:0};case"ArrowDown":return{x:0,y:1}}})();if(o){const t=Math.min(s,10);e.moveSelectionPosition({x:o.x*t,y:o.y*t}),s*=1.05}}function g(){r={}}return(0,x.m0)((()=>{e.isPrinting&&c(),e.isCreatingImage&&l()})),(0,x.bv)((()=>{document.addEventListener("keydown",d),document.addEventListener("keyup",p),document.addEventListener("cut",u("cut")),document.addEventListener("copy",u("copy")),document.addEventListener("paste",u("paste")),window.addEventListener("blur",g)})),(0,x.Jd)((()=>{document.removeEventListener("keydown",d),document.removeEventListener("keyup",p),document.addEventListener("cut",u("cut")),document.addEventListener("copy",u("copy")),document.addEventListener("paste",u("paste")),window.removeEventListener("blur",g)})),{store:e,editor:n,updates:i,storeDefinition:t.store,onKeyDown:d,onKeyUp:p,onContextMenu:h,clearKeys:g,gridSize:20}}});const Fr=(0,nt.Z)(Nr,[["render",O]]);var jr=Fr;const Lr={class:"toolbar"},Tr={class:"toolbar__fixed"},Wr={class:"toolbar__left"},$r={class:"toolbar__right"};function Rr(t,e,o,n,i,s){const r=(0,x.up)("toolbar-button"),a=(0,x.up)("toolbar-separator"),c=(0,x.up)("scroll-fade");return(0,x.wg)(),(0,x.iD)("div",Lr,[(0,x._)("div",Tr,[(0,x.Wm)(r,{icon:t.faScrewdriverWrench,text:"Toolbox","is-toolbox":"",onClick:t.rootStore.toggleToolbox,active:t.rootStore.isToolboxOpen},null,8,["icon","onClick","active"]),(0,x.Wm)(a)]),(0,x.Wm)(c,{class:"toolbar__scrollable"},{default:(0,x.w5)((()=>[(0,x._)("div",Wr,[(0,x.Wm)(r,{icon:t.faFolderOpen,text:"Open"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faFile,text:"New"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faSave,text:"Save"},null,8,["icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{onClick:t.documentStore.undo,disabled:!t.documentStore.canUndo,icon:t.faReply,text:"Undo"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(r,{onClick:t.documentStore.redo,disabled:!t.documentStore.canRedo,icon:t.faShare,text:"Redo"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{onClick:e[0]||(e[0]=e=>t.documentStore.rotate(1)),disabled:!t.documentStore.hasSelectedItems,icon:t.faRotateForward,text:"Rotate"},null,8,["disabled","icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{onClick:t.documentStore.group,disabled:!t.documentStore.canGroup,icon:t.faObjectGroup,text:"Group"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(r,{onClick:t.documentStore.ungroup,disabled:!t.documentStore.canUngroup,icon:t.faObjectUngroup,text:"Ungroup"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{icon:t.faScissors,text:"Cut"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faCopy,text:"Copy"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faPaste,text:"Paste"},null,8,["icon"]),(0,x.Wm)(r,{onClick:t.documentStore.deleteSelection,disabled:!t.documentStore.hasSelection,icon:t.faBan,text:"Delete"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{onClick:t.rootStore.launchIntegratedCircuitBuilder,icon:t.faMicrochip,text:"Export"},null,8,["onClick","icon"])]),(0,x._)("div",$r,[(0,x.Wm)(r,{icon:t.faBug,active:t.documentStore.isDebugging,onClick:t.documentStore.toggleDebugger,text:"Debug"},null,8,["icon","active","onClick"]),(0,x.Wm)(a),(0,x.Wm)(r,{icon:t.faArrowsRotate,onClick:t.documentStore.resetCircuit,text:"Reset"},null,8,["icon","onClick"]),(0,x.Wm)(r,{icon:t.faForwardStep,disabled:!t.documentStore.isDebugging||t.documentStore.isCircuitEvaluated,onClick:t.documentStore.stepThroughCircuit,text:"Next"},null,8,["icon","disabled","onClick"]),(0,x.Wm)(a),(0,x.Wm)(r,{icon:t.faWaveSquare,disabled:t.documentStore.isDebugging,active:!t.documentStore.isDebugging&&t.documentStore.isOscilloscopeOpen,onClick:t.documentStore.toggleOscilloscope,text:"Analyze"},null,8,["icon","disabled","active","onClick"])])])),_:1})])}var Vr=o(6024);const Ar={class:"toolbar-button__text"};function Ur(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.iD)("button",{tabindex:0,class:(0,C.C_)([{"toolbar-button--active":t.active&&!t.isToolbox,"toolbar-button--toolbox":t.active&&t.isToolbox,"toolbar-button--disabled":t.disabled},"toolbar-button"]),role:"button",onClick:e[0]||(e[0]=(...e)=>t.onClick&&t.onClick(...e))},[t.icon?((0,x.wg)(),(0,x.j4)(r,{key:0,icon:t.icon,class:"toolbar-button__icon"},null,8,["icon"])):((0,x.wg)(),(0,x.j4)(r,{key:1,icon:t.faUser,class:"toolbar-button__icon"},null,8,["icon"])),(0,x._)("div",Ar,(0,C.zw)(t.text),1)],2)}var qr=(0,x.aZ)({name:"ToolbarButton",components:{Icon:hn},data(){return{faUser:sn.ILF}},emits:{click:t=>!0},props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},isToolbox:{type:Boolean,default:!1},icon:{type:Object,default:null},text:{type:String,default:""}},setup(t,{emit:e}){function o(o){o.stopPropagation(),o.preventDefault(),t.disabled||e("click",o)}return{onClick:o}}});const Hr=(0,nt.Z)(qr,[["render",Ur]]);var Kr=Hr;const Yr={class:"toolbar-separator"};function Gr(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",Yr)}var Xr=(0,x.aZ)({name:"ToolbarSeparator"});const Jr=(0,nt.Z)(Xr,[["render",Gr]]);var Qr=Jr;function ta(t,e,o,n,i,s){const r=(0,x.up)("resizable");return(0,x.wg)(),(0,x.j4)(r,{ref:"scroll",class:(0,C.C_)(["scroll-fade",{"scrollbar-fade--show-scrollbar":!t.hideScrollbar}]),style:(0,C.j5)(`--mask-image-content: linear-gradient(to right, ${t.gradientStyle})`),onScroll:t.onChange,onResize:t.onChange},{default:(0,x.w5)((()=>[(0,x.WI)(t.$slots,"default")])),_:3},8,["class","style","onScroll","onResize"])}var ea=(0,x.aZ)({name:"ScrollFade",components:{Resizable:st},props:{hideScrollbar:{type:Boolean,default:!1}},setup(){const t="transparent, black var(--mask-width)",e="black calc(100% - var(--mask-width)), transparent",o=(0,P.iH)(),n=(0,P.iH)("");function i(o){const{scrollWidth:i,scrollLeft:s,clientWidth:r}=o;if(i>r){const o=[];return s>0&&o.push(t),s+r<i&&o.push(e),n.value=o.join(", "),o.join(", ")}return"transparent transparent"}function s(){o.value&&(n.value=i(o.value.$el))}return{onChange:s,gradientStyle:n,scroll:o}}});const oa=(0,nt.Z)(ea,[["render",ta]]);var na=oa,ia=(0,x.aZ)({name:"Toolbar",components:{ToolbarButton:Kr,ToolbarSeparator:Qr,ScrollFade:na},data(){return{faScrewdriverWrench:sn.eDR,faFolderOpen:Vr.cC_,faFile:Vr.gMD,faSave:Vr.r6l,faScissors:sn.EQg,faCopy:Vr.kZ_,faPaste:Vr.O4,faObjectGroup:Vr.tU8,faObjectUngroup:Vr.B7S,faRotateBackward:sn.ptP,faRotateForward:sn.fbl,faReply:sn.Lh7,faShare:sn.zBy,faMicrochip:sn.zvy,faBan:sn.gPx,faArrowsRotate:sn.T80,faBug:sn.QLU,faForwardStep:sn.Jwg,faWaveSquare:sn.fQK}},props:{store:{type:Function,required:!0}},setup(t){const e=ur(),o=t.store(),n=(0,x.Fl)((()=>o.simulation.circuit.isComplete()));return{rootStore:e,documentStore:o,isComplete:n}}});const sa=(0,nt.Z)(ia,[["render",Rr]]);var ra=sa;function aa(t,e,o,n,i,s){const r=(0,x.up)("toolbox-item"),a=(0,x.up)("toolbox-layout");return(0,x.wg)(),(0,x.j4)(a,{"is-open":t.isOpen},(0,x.Nv)({_:2},[(0,x.Ko)(t.factories,((e,o)=>({name:o,fn:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(e,((e,o)=>((0,x.wg)(),(0,x.j4)(r,{factory:e,key:o,label:o,zoom:t.zoom,onDrop:t.onDrop},null,8,["factory","label","zoom","onDrop"])))),128))]))})))]),1032,["is-open"])}const ca={class:"toolbox-item__parent"},la={class:"toolbox-item__label"};function ua(t,e,o,n,i,s){const r=(0,x.up)("circuit-component"),a=(0,x.up)("resizable"),c=(0,x.up)("draggable");return(0,x.wg)(),(0,x.j4)(c,{class:"toolbox-item",tabindex:0,onTouchhold:t.onDragStart,onDrag:t.onDrag,onDragEnd:t.onDragEnd,onClick:e[2]||(e[2]=e=>t.$emit("drop",t.factory)),"allow-touch-drag":t.isDragging},{default:(0,x.w5)((()=>[(0,x._)("div",ca,[(0,x.Wm)(a,{class:"toolbox-item__preview",ref:"preview",onResize:e[1]||(e[1]=e=>t.onSizeChanged(e,"preview"))},{default:(0,x.w5)((()=>[(0,x.Wm)(a,{class:"toolbox-item__inner",ref:"selectable",style:(0,C.j5)({zoom:t.zoom}),onResize:e[0]||(e[0]=e=>t.onSizeChanged(e,"selectable"))},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{type:t.item.type,subtype:t.item.subtype,ports:t.ports,properties:t.item.properties},null,8,["type","subtype","ports","properties"])])),_:1},8,["style"])])),_:1},512)]),(0,x._)("div",la,(0,C.zw)(t.item.name||t.item.subtype),1)])),_:1},8,["onTouchhold","onDrag","onDragEnd","allow-touch-drag"])}var da=(0,x.aZ)({name:"ToolboxItem",components:{CircuitComponent:Ko,Draggable:ct,Resizable:st},emits:{drop:(t,e)=>!0},props:{factory:{type:Function,required:!0},zoom:{type:Number,default:1}},setup(t,{emit:e}){const o=(0,P.iH)(),n=(0,P.iH)(!1),i=(0,P.iH)(1),{item:s,ports:r}=t.factory(),a={selectable:new DOMRect,preview:new DOMRect};let c=null;function l(t,e){a[e]=t;const o=a.selectable,n=a.preview,s=Math.max(o.width/n.width,o.height/n.height);i.value=Math.min(1/s,1)}function u(){const e=a.selectable;c=o.value?.$el.cloneNode(!0),c.style.position="absolute",c.style["zoom"]=`${t.zoom}`,c.style.width=`${e.width}px`,c.style.height=`${e.height}px`,n.value=!0,navigator.vibrate(20)}function d({x:e,y:o}){if(!c)return u();document.body.contains(c)||document.body.appendChild(c);const{width:n,height:i}=c.getBoundingClientRect();c.style.left=(e-n/2*t.zoom)/t.zoom+"px",c.style.top=(o-i/2*t.zoom)/t.zoom+"px"}function p(o){c&&(c.remove(),c=null,n.value=!1,e("drop",t.factory,o))}return{onDragStart:u,onDrag:d,onDragEnd:p,onSizeChanged:l,item:s,ports:r,zoom:i,selectable:o,isDragging:n}}});const pa=(0,nt.Z)(da,[["render",ua]]);var ha=pa;const ma=["onClick"];function ga(t,e,o,n,i,s){const r=(0,x.up)("scroll-fade");return(0,x.wg)(),(0,x.iD)("div",{ref:"toolbox",class:(0,C.C_)(["toolbox-layout",{"toolbox-layout--open":t.isOpen}]),style:(0,C.j5)({height:`${t.height}px`})},[(0,x.Wm)(r,{class:"toolbox-layout__categories","hide-scrollbar":!0},{default:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.categories,(e=>((0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(["toolbox-layout__badge",{"toolbox-layout__badge--active":e===t.selected}]),key:e,onClick:o=>t.select(e)},(0,C.zw)(e),11,ma)))),128))])),_:1}),(0,x.Wm)(r,{class:"toolbox-layout__items"},{default:(0,x.w5)((()=>[(0,x.WI)(t.$slots,t.selected)])),_:3})],6)}var fa=(0,x.aZ)({name:"Toolbox",components:{ScrollFade:na},props:{isOpen:{type:Boolean,default:!1}},setup(t,{slots:e}){const o=(0,P.iH)(null),n=(0,P.iH)(null),i=(0,x.Fl)((()=>Object.keys(e))),s=(0,x.Fl)((()=>t.isOpen?n.value?.scrollHeight:0));function r(t){o.value=t}return r(i.value[0]),{categories:i,selected:o,select:r,height:s,toolbox:n}}});const va=(0,nt.Z)(fa,[["render",ga]]);var ya=va;const ba=(t,e,o,n={})=>{const i=(0,B.Z)(),s=[Oi(i,(0,B.Z)(),bt.Right,Cn.Output,"Output Port")],r=Pi(i,Vo.InputNode,t,e,o,s);return r.properties={...r.properties,...n,startValue:{label:"Start value",value:-1,type:"number",options:{True:1,"Hi-Z":0,False:-1}}},{item:r,ports:s}};var wa=ba;const Ia=()=>wa(Ao.Clock,60,60,{interval:{label:"Interval",value:1e3,type:"number",min:100,step:100}});var xa=Ia;function Ca(){const t=[],e=Array(4).fill("").reduce(((e,o,n)=>{const i=(0,B.Z)(),s=(0,B.Z)(),r=Oi(s,i,bt.Left,Cn.Output,`Input Port ${n+1}`),a=Pi(s,Vo.InputNode,Ao.Switch,0,0,[r]);return t.push(r),{connections:{},groups:{},items:{...e.items,[s]:a},ports:{...e.ports,[i]:r}}}),{connections:{},ports:{},items:{},groups:{}}),o=nr(e,"Digit Display",40,40,Ao.DigitDisplay);return{item:o,ports:t}}function Sa(){const t=(0,B.Z)(),e=[Oi(t,(0,B.Z)(),bt.Left,Cn.Input,"Input Port")],o=Pi(t,Vo.OutputNode,Ao.Lightbulb,40,40,e);return{item:o,ports:e}}function Da(t,e,o,n=2){const i=(0,B.Z)(),s=Array(n).fill("").map(((t,e)=>Oi(i,(0,B.Z)(),0,1,`Input Port ${e}`))).concat(Oi(i,(0,B.Z)(),2,0,"Output Port")),r=Pi(i,Vo.LogicGate,t,e,o,s);return r.properties={...r.properties,inputCount:{label:"Input count",value:n,type:"number",min:n},showInOscilloscope:{label:"Show in oscilloscope",value:!1,type:"boolean"}},{item:r,ports:s}}var _a={[Vo.InputNode]:{[Ao.Switch]:wa.bind(void 0,Ao.Switch,60,60),[Ao.Clock]:xa},[Vo.OutputNode]:{[Ao.Lightbulb]:Sa,[Ao.DigitDisplay]:Ca},[Vo.LogicGate]:{[Ao.And]:Da.bind(void 0,Ao.And,140,50),[Ao.Nand]:Da.bind(void 0,Ao.Nand,140,50),[Ao.Xnor]:Da.bind(void 0,Ao.Xnor,140,50),[Ao.Nor]:Da.bind(void 0,Ao.Nor,140,50),[Ao.Or]:Da.bind(void 0,Ao.Or,140,50),[Ao.Not]:Da.bind(void 0,Ao.Not,140,50,1)}},Pa=(0,x.aZ)({name:"Toolbox",components:{ScrollFade:na,ToolboxItem:ha,ToolboxLayout:ya},props:{store:{type:Function,required:!0},isOpen:{type:Boolean,default:!1}},setup(t){const e=t.store(),o=cr(),n=(0,x.Fl)((()=>e.zoom)),i=(0,x.Fl)((()=>o.factories));function s(t,o){e.insertItemAtPosition(t(),o)}return{factories:{..._a,[Vo.IntegratedCircuit]:i.value},zoom:n,onDrop:s}}});const Oa=(0,nt.Z)(Pa,[["render",aa]]);var Za=Oa;const ka={class:"tab-item__icon"},Ba={class:"tab-item__label"};function Ea(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)([{"tab-item--active":t.active,"tab-item--dirty":t.dirty},"tab-item"]),onMousedown:e[1]||(e[1]=e=>t.$emit("activate")),onTouchstart:e[2]||(e[2]=e=>t.$emit("activate"))},[(0,x._)("div",ka,[(0,x.Wm)(r,{icon:t.faCodeBranch},null,8,["icon"])]),(0,x._)("div",Ba,(0,C.zw)(t.label)+(0,C.zw)(t.dirty?"*":""),1),(0,x._)("div",{class:"tab-item__icon tab-item__icon--close",onClick:e[0]||(e[0]=(0,I.iM)((e=>t.$emit("close")),["stop"]))},[(0,x.Wm)(r,{icon:t.faClose},null,8,["icon"])])],34)}var Ma=(0,x.aZ)({name:"TabItem",components:{Icon:hn},props:{active:{type:Boolean,default:!1},label:{type:String,required:!0},dirty:{type:Boolean,default:!1}},setup(){return{faClose:sn.YIN,faCodeBranch:sn.mh3}}});const za=(0,nt.Z)(Ma,[["render",Ea]]);var Na=za;const Fa={class:"tab-host"},ja={class:"tab-host__list"};function La(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",Fa,[(0,x._)("div",ja,[(0,x.WI)(t.$slots,"tabs")]),(0,x.WI)(t.$slots,"default")])}var Ta=(0,x.aZ)({name:"TabHost"});const Wa=(0,nt.Z)(Ta,[["render",La]]);var $a=Wa;const Ra={key:0};function Va(t,e,o,n,i,s){const r=(0,x.up)("oscilloscope-title-bar"),a=(0,x.up)("oscilloscope-timeline"),c=(0,x.up)("oscilloscope-viewer");return t.isOscilloscopeOpen?((0,x.wg)(),(0,x.j4)(c,{key:0,modelValue:t.oscilloscopeHeight,"onUpdate:modelValue":e[0]||(e[0]=e=>t.oscilloscopeHeight=e),"collapse-height":40,onCollapse:t.closeOscilloscope},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{clearable:t.hasWaves,"is-recording":t.isOscilloscopeRecording,onClear:t.clearOscilloscope,onToggle:t.toggleOscillatorRecording},null,8,["clearable","is-recording","onClear","onToggle"]),t.hasWaves?((0,x.wg)(),(0,x.j4)(a,{key:1,oscillogram:t.oscillogram},null,8,["oscillogram"])):((0,x.wg)(),(0,x.iD)("div",Ra," no waves to observe "))])),_:1},8,["modelValue","onCollapse"])):(0,x.kq)("",!0)}const Aa={class:"oscilloscope-timeline"},Ua={class:"oscilloscope-timeline__list",ref:"list"},qa=["width","viewBox"],Ha=["points","stroke"];function Ka(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",Aa,[(0,x._)("div",Ua,[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.oscillogram,((t,e)=>((0,x.wg)(),(0,x.iD)("div",{key:e,style:(0,C.j5)({color:`hsla(${t.hue}, var(--lightness), var(--saturation), 0.8)`}),class:"oscilloscope-timeline__label"},(0,C.zw)(e),5)))),128))],512),(0,x._)("div",{class:"oscilloscope-timeline__display",ref:"timeline",onWheel:e[0]||(e[0]=(...e)=>t.onWheel&&t.onWheel(...e))},[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.oscillogram,((e,o)=>((0,x.wg)(),(0,x.iD)("div",{style:(0,C.j5)({width:`${t.totalWidth}px`}),key:o,class:"oscilloscope-timeline__item"},[(0,x._)("div",{style:(0,C.j5)({width:`${e.width}px`}),class:"oscilloscope-timeline__svg"},[((0,x.wg)(),(0,x.iD)("svg",{width:e.width,viewBox:`0 0 ${e.width} 1`,preserveAspectRatio:"none"},[(0,x._)("polyline",{points:e.points,stroke:`hsla(${e.hue}, var(--lightness), var(--saturation), 0.8)`,"stroke-width":"2",fill:"none","vector-effect":"non-scaling-stroke"},null,8,Ha)],8,qa))],4)],4)))),128))],544)])}var Ya=(0,x.aZ)({name:"OscilloscopeTimeline",props:{oscillogram:{type:Object,required:!0}},computed:{totalWidth(){return Object.values(this.oscillogram).reduce(((t,{width:e})=>Math.max(e,t)),0)}},mounted(){const t=this.$refs.timeline,e=this.$refs.list;this.scrollToNextInterval(),e.addEventListener("scroll",this.onTimelineScroll),t.addEventListener("scroll",this.onTimelineScroll)},beforeUnmount(){const t=this.$refs.timeline,e=this.$refs.list;e.removeEventListener("scroll",this.onTimelineScroll),t.removeEventListener("scroll",this.onTimelineScroll)},methods:{onWheel(t){const e=this.$refs.timeline;e.scrollTop+=t.deltaY/10,t.preventDefault()},scrollToNextInterval(){const t=this.$refs.timeline;t.scrollLeft=t.scrollWidth},onTimelineScroll(){const t=this.$refs.list,e=this.$refs.timeline;e&&(t.scrollTop=e.scrollTop)}},watch:{oscillogram:{handler(){this.scrollToNextInterval()},deep:!0}}});const Ga=(0,nt.Z)(Ya,[["render",Ka]]);var Xa=Ga;const Ja={class:"oscilloscope-title-bar"},Qa=(0,x._)("div",{class:"oscilloscope-title-bar__title"},"Oscilloscope",-1),tc={class:"oscilloscope-title-bar__actions"},ec=["disabled"];function oc(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.iD)("div",Ja,[Qa,(0,x._)("div",tc,[(0,x._)("button",{class:"oscilloscope-title-bar__button",title:"Close",onClick:e[0]||(e[0]=e=>t.$emit("close"))},[(0,x.Wm)(r,{icon:t.faClose},null,8,["icon"])]),(0,x._)("button",{class:"oscilloscope-title-bar__button",title:"Clear oscilloscope",disabled:!t.clearable,onClick:e[1]||(e[1]=e=>t.$emit("clear"))},[(0,x.Wm)(r,{icon:t.faBan},null,8,["icon"])],8,ec),(0,x._)("button",{class:"oscilloscope-title-bar__button",title:"Close",onClick:e[2]||(e[2]=e=>t.$emit("toggle"))},[(0,x.Wm)(r,{icon:t.isRecording?t.faPause:t.faPlay},null,8,["icon"])])])])}var nc=(0,x.aZ)({name:"OscilloscopeTitleBar",components:{Icon:hn},props:{clearable:{type:Boolean,default:!0},isRecording:{type:Boolean,default:!0}},setup(){return{faBan:sn.gPx,faClose:sn.YIN,faPause:sn.XQY,faPlay:sn.zc}}});const ic=(0,nt.Z)(nc,[["render",oc]]);var sc=ic;function rc(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{ref:"viewer",class:"oscilloscope-viewer",style:(0,C.j5)({height:`${t.height}px`})},[(0,x._)("div",{class:"oscilloscope-viewer__touch-resizer",onTouchstart:e[1]||(e[1]=(...e)=>t.onTouchStart&&t.onTouchStart(...e)),onTouchmove:e[2]||(e[2]=(...e)=>t.onTouchMove&&t.onTouchMove(...e)),onTouchcancel:e[3]||(e[3]=(...e)=>t.onMouseUp&&t.onMouseUp(...e)),onTouchend:e[4]||(e[4]=(...e)=>t.onMouseUp&&t.onMouseUp(...e))},[(0,x._)("div",{class:"oscilloscope-viewer__mouse-resizer",onMousedown:e[0]||(e[0]=(...e)=>t.onMouseDown&&t.onMouseDown(...e))},null,32)],32),(0,x.WI)(t.$slots,"default")],4)}var ac=(0,x.aZ)({name:"OscilloscopeViewer",props:{collapseHeight:{type:Number,default:20},modelValue:{type:Number,required:!0}},setup(t,{emit:e}){const o=(0,P.iH)(t.modelValue),n=(0,P.iH)();let i=0,s=0,r=!1;function a(t){i=o.value,s=t.clientY,r=!0}function c(t){a(t.touches[0])}function l(a){if(!r||!n.value)return;const c=n.value.parentElement?.getBoundingClientRect();o.value+=Math.min(s-a.clientY,c?.height||1/0),s=a.clientY,o.value<=t.collapseHeight?e("collapse",i):e("update:modelValue",o.value)}function u(t){l(t.touches[0])}function d(){r=!1}return(0,x.bv)((()=>{window.addEventListener("mousemove",l),window.addEventListener("mouseup",d)})),(0,x.Ah)((()=>{window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",d)})),{onMouseDown:a,onMouseUp:d,onTouchStart:c,onTouchMove:u,height:o,viewer:n}}});const cc=(0,nt.Z)(ac,[["render",rc]]);var lc=cc,uc=(0,x.aZ)({name:"Oscilloscope",components:{OscilloscopeTimeline:Xa,OscilloscopeTitleBar:sc,OscilloscopeViewer:lc},props:{store:{type:Function,required:!0}},setup(t){const e=t.store(),{oscilloscopeHeight:o,isOscilloscopeOpen:n,isOscilloscopeRecording:i,oscillogram:s}=(0,w.Jk)(e),{clearOscilloscope:r,closeOscilloscope:a,toggleOscillatorRecording:c}=e,l=(0,x.Fl)((()=>Object.keys(e.oscillogram).length>0));return{hasWaves:l,oscillogram:s,oscilloscopeHeight:o,isOscilloscopeOpen:n,isOscilloscopeRecording:i,clearOscilloscope:r,closeOscilloscope:a,toggleOscillatorRecording:c}}});const dc=(0,nt.Z)(uc,[["render",Va]]);var pc=dc;const hc={key:0},mc={key:1},gc={key:2};function fc(t,e,o,n,i,s){const r=(0,x.up)("icon"),a=(0,x.up)("status-bar-button"),c=(0,x.up)("status-bar-zoom"),l=(0,x.up)("status-bar-viewer");return(0,x.wg)(),(0,x.j4)(l,null,{left:(0,x.w5)((()=>[t.isPrinting?((0,x.wg)(),(0,x.iD)("span",hc,"Printing...")):t.isCreatingImage?((0,x.wg)(),(0,x.iD)("span",mc,"Rendering image...")):((0,x.wg)(),(0,x.iD)("span",gc,"Ready"))])),right:(0,x.w5)((()=>[(0,x.Wm)(a,{title:"Zoom out",disabled:t.store.zoomLevel<=.1,onClick:e[0]||(e[0]=e=>t.store.incrementZoom(-1))},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{icon:t.faMinus},null,8,["icon"])])),_:1},8,["disabled"]),(0,x.Wm)(c,{type:"range",class:"status-bar__range",min:0,step:10,max:200,zoom:t.store.zoomLevel,onZoom:e[1]||(e[1]=e=>t.store.setZoom({zoom:e}))},null,8,["zoom"]),(0,x.Wm)(a,{title:"Zoom in",disabled:t.store.zoomLevel>=2,onClick:e[2]||(e[2]=e=>t.store.incrementZoom(1))},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{icon:t.faPlus},null,8,["icon"])])),_:1},8,["disabled"]),(0,x.Wm)(a,{width:"3em",onClick:e[3]||(e[3]=e=>t.store.setZoom({zoom:1}))},{default:(0,x.w5)((()=>[(0,x.Uk)((0,C.zw)(t.zoomPercent)+"% ",1)])),_:1}),(0,x.Wm)(a,{title:"Toggle fullscreen",onClick:e[4]||(e[4]=e=>t.$emit("fullscreen"))},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{icon:t.isFullscreen?t.faCompress:t.faExpand},null,8,["icon"])])),_:1})])),_:1})}const vc=["disabled","title"];function yc(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("button",{class:"status-bar-button",disabled:t.disabled,title:t.title,style:(0,C.j5)({width:t.width})},[(0,x.WI)(t.$slots,"default")],12,vc)}var bc=(0,x.aZ)({name:"StatusBarButton",props:{disabled:{type:Boolean,default:!1},title:{type:String,default:""},width:{type:String,default:"2em"}}});const wc=(0,nt.Z)(bc,[["render",yc]]);var Ic=wc;const xc={class:"status-bar-viewer"},Cc={class:"status-bar-viewer__left"},Sc={class:"status-bar-viewer__right"};function Dc(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",xc,[(0,x._)("div",Cc,[(0,x.WI)(t.$slots,"left")]),(0,x._)("div",Sc,[(0,x.WI)(t.$slots,"right")])])}var _c=(0,x.aZ)({name:"StatusBarViewer"});const Pc=(0,nt.Z)(_c,[["render",Dc]]);var Oc=Pc;const Zc=["step","min","max","value"];function kc(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("input",{type:"range",class:"status-bar-zoom",step:t.step,min:t.min,max:t.max,value:t.value,onInput:e[0]||(e[0]=(...e)=>t.onInput&&t.onInput(...e))},null,40,Zc)}var Bc=(0,x.aZ)({name:"StatusBarZoom",components:{Icon:hn},props:{zoom:{type:Number,required:!0},min:{type:Number,default:0},max:{type:Number,default:200},step:{type:Number,default:10}},setup(t,{emit:e}){const o=(0,x.Fl)((()=>Math.round(100*t.zoom)));function n(t){const o=t.target,n=parseFloat(o.value);e("zoom",n/100)}return{onInput:n,value:o}}});const Ec=(0,nt.Z)(Bc,[["render",kc]]);var Mc=Ec,zc=(0,x.aZ)({name:"StatusBar",components:{Icon:hn,StatusBarButton:Ic,StatusBarViewer:Oc,StatusBarZoom:Mc},props:{store:{type:Function,required:!0},isFullscreen:{type:Boolean,default:!1}},setup(t){const e=t.store(),o=(0,x.Fl)((()=>e.isPrinting)),n=(0,x.Fl)((()=>e.isCreatingImage)),i=(0,x.Fl)((()=>Math.round(100*e.zoomLevel)));return{store:e,isPrinting:o,isCreatingImage:n,zoomPercent:i,faMinus:sn.Kl4,faPlus:sn.r8p,faExpand:sn.TL5,faCompress:sn.Qj4}}});const Nc=(0,nt.Z)(zc,[["render",fc]]);var Fc=Nc;function jc(){const t=ur(),e=null!==t.activeDocumentId,o=Object.keys(t.documents),n=t.activeDocument?.store(),i=[{label:"&New Circuit",accelerator:"CommandOrControl+N",click:t.newDocument},{type:"separator"},{label:"&Open Circuit",accelerator:"CommandOrControl+O",click:t.selectDocument},{label:"Open &Integrated Circuit",accelerator:"CommandOrControl+Shift+O",click:t.selectDocument},{type:"separator"},{label:"Save",enabled:e,accelerator:"CommandOrControl+S",click:()=>t.saveActiveDocument()},{label:"Save As...",enabled:e,accelerator:"CommandOrControl+Shift+S",click:()=>t.saveActiveDocument(!0)},{label:"Save All",enabled:e,accelerator:"CommandOrControl+Shift+A",click:()=>console.log("root store save all")},{type:"separator"},{label:"Print",enabled:e,accelerator:"CommandOrControl+P",click:()=>n?.print()},{type:"separator"},{label:"Export...",enabled:e,submenu:[{label:"Integrated Circuit",accelerator:"CommandOrControl+Shift+E",click:()=>console.log("export IC")},{label:"PNG Image",accelerator:"CommandOrControl+Shift+I",click:()=>n?.createImage()}]},{type:"separator"},{label:"Preferences",submenu:[{label:"Global Preferences",accelerator:"CommandOrControl+,",click:()=>console.log("global prefs")},{label:"Document Preferences",accelerator:"CommandOrControl+Shift+,",click:()=>console.log("doc prefs")}]}];if(Object.keys(t.documents).length>1){const e=[{label:"Previous File",accelerator:"Ctrl+Shift+Tab",click:()=>t.switchDocument(-1)},{label:"Next File",accelerator:"Ctrl+Tab",click:()=>t.switchDocument(1)},{type:"separator"}];for(let n=0;n<o.length;n++)e.push({type:"checkbox",label:t.documents[o[n]].displayName,checked:t.activeDocumentId===o[n],click:()=>t.activateDocument(o[n])});i.push({type:"separator"}),i.push({label:"Switch to...",submenu:e})}return i.push({type:"separator"}),i.push({label:"Close Document",accelerator:"CmdOrCtrl+W",enabled:e,click:()=>t.closeDocument(t.activeDocumentId)}),i.push({type:"separator"}),i.push({label:"Exit",accelerator:"CmdOrCtrl+Q",click:()=>window.close()}),i}function Lc(t){const e=t(),o=[];let n=!1;for(let s=1;s<=8;s++){const t=25*s/100,i=e.zoomLevel===t;n=n||i,o.push({type:"checkbox",checked:i,label:100*t+"%",accelerator:1===t?"CommandOrControl+0":void 0,click:()=>e.setZoom({zoom:t})})}n||o.unshift({type:"checkbox",checked:!0,label:"Custom"});const i=[{label:"&Zoom In",accelerator:"CommandOrControl+=",enabled:e.zoomLevel<2,click:()=>e.incrementZoom(1)},{label:"&Zoom Out",accelerator:"CommandOrControl+-",enabled:e.zoomLevel>.1,click:()=>e.incrementZoom(-1)},{label:"&Zoom...",submenu:o},{type:"separator"},{label:"&Pan to Center",accelerator:"CommandOrControl+;",click:e.panToCenter},{type:"separator"}];return i.concat(Zt(t))}function Tc(){const t=ur();if(t.isDialogOpen)return[{label:"File",submenu:[{label:"Exit"}]}];const e=[{label:"File",submenu:jc()}];return t.activeDocument&&(e.push({label:"Edit",submenu:Ot(t.activeDocument.store)}),e.push({label:"View",submenu:Lc(t.activeDocument.store).concat([{type:"separator"},{type:"checkbox",click:t.toggleFullscreen,checked:t.isFullscreen,accelerator:"F11",label:"Fullscreen"}])})),e}const Wc={class:"main-view__top"},$c={class:"main-view__middle"},Rc={class:"main-view__bottom"};function Vc(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(["main-view",{"main-view--blurred":t.isBlurred}])},[(0,x._)("div",Wc,[(0,x.WI)(t.$slots,"top")]),(0,x._)("div",$c,[(0,x.WI)(t.$slots,"middle")]),(0,x._)("div",Rc,[(0,x.WI)(t.$slots,"bottom")])],2)}var Ac=(0,x.aZ)({name:"MainView",props:{isBlurred:{type:Boolean,default:!1}}});const Uc=(0,nt.Z)(Ac,[["render",Vc]]);var qc=Uc;var Hc=!1;const Kc={class:"builder-canvas"};function Yc(t,e,o,n,i,s){const r=(0,x.up)("builder"),a=(0,x.up)("modal-button"),c=(0,x.up)("modal");return(0,x.wg)(),(0,x.j4)(c,{modelValue:t.isBuilderOpen,"onUpdate:modelValue":[e[1]||(e[1]=e=>t.isBuilderOpen=e),t.close],title:"Build Circuit"},{buttons:(0,x.w5)((()=>[(0,x.Wm)(a,{text:"Cancel",onClick:t.close,inverted:""},null,8,["onClick"]),(0,x.Wm)(a,{text:"Save",onClick:t.save},null,8,["onClick"])])),default:(0,x.w5)((()=>[(0,x._)("div",Kc,[(0,x.Wm)(r,{modelValue:t.item,"onUpdate:modelValue":e[0]||(e[0]=e=>t.item=e)},null,8,["modelValue"])])])),_:1},8,["modelValue","onUpdate:modelValue"])}const Gc={class:"builder__center"};function Xc(t,e,o,n,i,s){const r=(0,x.up)("builder-drop-zone"),a=(0,x.up)("builder-editable-label"),c=(0,x.up)("container");return(0,x.wg)(),(0,x.j4)(c,{class:"builder"},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{type:"top","get-child-payload":t.getCardPayload("top"),ports:t.ports.top.children,onDrop:t.onWireDrop},null,8,["get-child-payload","ports","onDrop"]),(0,x._)("div",Gc,[(0,x.Wm)(r,{type:"left","get-child-payload":t.getCardPayload("left"),ports:t.ports.left.children,onDrop:t.onWireDrop},null,8,["get-child-payload","ports","onDrop"]),(0,x.Wm)(a,{modelValue:t.item.name,"onUpdate:modelValue":e[0]||(e[0]=e=>t.item.name=e)},null,8,["modelValue"]),(0,x.Wm)(r,{type:"right","get-child-payload":t.getCardPayload("right"),ports:t.ports.right.children,onDrop:t.onWireDrop},null,8,["get-child-payload","ports","onDrop"])]),(0,x.Wm)(r,{type:"bottom","get-child-payload":t.getCardPayload("bottom"),ports:t.ports.bottom.children,onDrop:t.onWireDrop},null,8,["get-child-payload","ports","onDrop"])])),_:1})}var Jc=o(6523);function Qc(t,e,o,n,i,s){const r=(0,x.up)("port-handle"),a=(0,x.up)("port-wire"),c=(0,x.up)("builder-editable-label"),l=(0,x.up)("Draggable"),u=(0,x.up)("Container");return(0,x.wg)(),(0,x.j4)(u,{orientation:t.orientation,"animation-duration":500,"group-name":t.type,class:(0,C.C_)(`builder-drop-zone builder-drop-zone--${t.orientation}`),onDrop:t.onDrop,onDragEnter:t.onDragEnter,onDragLeave:t.onDragLeave,"should-accept-drop":()=>!0,"get-child-payload":t.getChildPayload,"get-ghost-parent":t.getGhostParent},{default:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.ports,(e=>((0,x.wg)(),(0,x.j4)(l,{key:e.id,tag:{value:"div",props:{class:`builder-drop-zone__io builder-drop-zone__io--${t.type}`}}},{default:(0,x.w5)((()=>[(0,x.Wm)(c,{modelValue:e.name,"onUpdate:modelValue":t=>e.name=t},{default:(0,x.w5)((()=>[(0,x.Wm)(a,{type:t.type},{default:(0,x.w5)((()=>[(0,x.Wm)(r)])),_:1},8,["type"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["tag"])))),128))])),_:1},8,["orientation","group-name","class","onDrop","onDragEnter","onDragLeave","should-accept-drop","get-child-payload","get-ghost-parent"])}const tl={class:"builder-editable-label"},el=["value"];function ol(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",tl,[(0,x._)("div",{tabindex:0,class:(0,C.C_)([{"builder-editable-label__read-only--hidden":!t.isReadOnly},"builder-editable-label__read-only"]),onFocus:e[0]||(e[0]=(...e)=>t.onFocus&&t.onFocus(...e))},(0,C.zw)(t.modelValue),35),t.isReadOnly?(0,x.kq)("",!0):((0,x.wg)(),(0,x.iD)("input",{key:0,class:"builder-editable-label__textbox",type:"text",ref:"inputRef",value:t.modelValue,onInput:e[1]||(e[1]=(...e)=>t.onInput&&t.onInput(...e)),onBlur:e[2]||(e[2]=e=>t.isReadOnly=!0)},null,40,el)),(0,x.WI)(t.$slots,"default")])}var nl=(0,x.aZ)({name:"BuilderEditableLabel",props:{modelValue:{type:String,default:"node"}},setup(t,{emit:e}){const o=(0,P.iH)(!0),n=(0,P.iH)();function i(){o.value=!1,(0,x.Y3)((()=>{n.value&&(n.value.focus(),n.value.select())}))}function s(t){const{value:o}=t.target;e("update:modelValue",o)}return{isReadOnly:o,inputRef:n,onFocus:i,onInput:s}}});const il=(0,nt.Z)(nl,[["render",ol]]);var sl=il,rl=(0,x.aZ)({name:"BuilderDropZone",components:{BuilderEditableLabel:sl,Container:Jc.Container,Draggable:Jc.Draggable,PortHandle:$t,PortWire:pe},emits:{drop:(t,e)=>!(!t||!e)},props:{ports:{type:Array,default:()=>[]},getChildPayload:{type:Function,required:!0},type:{type:String,required:!0}},computed:{orientation(){return["left","right"].includes(this.type)?"vertical":"horizontal"}},setup(t,{emit:e}){const o=/--([a-z]+)/gi;let n="";function i(t){document.querySelectorAll(".smooth-dnd-ghost, .smooth-dnd-ghost div").forEach((e=>{const i=e.className.match(o);i&&(n=i.pop()||""),e.className=e.className.replace(o,t)}))}function s(){i(`--${t.type}`)}function r(){i(n)}function a(o){e("drop",t.type,o)}function c(){return document.querySelector(".modal")}return{onDragEnter:s,onDragLeave:r,onDrop:a,getGhostParent:c}}});const al=(0,nt.Z)(rl,[["render",Qc]]);var cl=al;const ll=(t,e)=>{const{removedIndex:o,addedIndex:n,payload:i}=e;if(null===o&&null===n)return t;const s=[...t];let r=i;return null!==o&&(r=s.splice(o,1)[0]),null!==n&&s.splice(n,0,r),s};var ul=(0,x.aZ)({name:"Builder",components:{BuilderDropZone:cl,BuilderEditableLabel:sl,Container:Jc.Container},emits:["update:modelValue"],props:{modelValue:{type:Object,required:!0}},setup(t,{emit:e}){const o=(0,P.iH)({left:{children:[]},top:{children:[]},right:{children:[]},bottom:{children:[]}});function n(){const n=["left","top","right","bottom"];t.modelValue.portIds=[],Object.keys(o.value).forEach((e=>{const i=e,{children:s}=o.value[i];s.forEach((e=>{e.orientation=n.indexOf(i),t.modelValue.portIds.push(e.id)}))})),e("update:modelValue",t.modelValue)}function i(t,e){const i=Object.assign({},o.value[t]);o.value[t].children=ll(i.children,e),n()}function s(t){return e=>o.value[t].children[e]}return t.modelValue.portIds.forEach((e=>{const n=t.modelValue.integratedCircuit?.ports[e];n&&o.value[n.type===Cn.Input?"left":"right"].children.push(n)})),{item:t.modelValue,ports:o,onWireDrop:i,getCardPayload:s}}});const dl=(0,nt.Z)(ul,[["render",Xc]]);var pl=dl;const hl={key:0,class:"modal"},ml={class:"modal__inner"},gl={class:"modal__title"},fl={class:"modal__title-text"},vl={class:"modal__content"},yl={key:0,class:"modal__buttons"};function bl(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.j4)(I.uT,{name:"modal",appear:""},{default:(0,x.w5)((()=>[t.modelValue?((0,x.wg)(),(0,x.iD)("div",hl,[(0,x._)("div",ml,[(0,x._)("div",gl,[(0,x._)("div",fl,(0,C.zw)(t.title),1),(0,x._)("button",{title:"Close",onClick:e[0]||(e[0]=e=>t.$emit("update:modelValue",!1)),class:"modal__close"},[(0,x.Wm)(r,{icon:t.faClose},null,8,["icon"])])]),(0,x._)("div",vl,[(0,x.WI)(t.$slots,"default")]),t.$slots["buttons"]?((0,x.wg)(),(0,x.iD)("div",yl,[(0,x.WI)(t.$slots,"buttons")])):(0,x.kq)("",!0)])])):(0,x.kq)("",!0)])),_:3})}var wl=(0,x.aZ)({name:"Modal",components:{Icon:hn},props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:""}},setup(){const t=(0,P.iH)(!1);return{faClose:sn.YIN,show:t}}});const Il=(0,nt.Z)(wl,[["render",bl]]);var xl=Il;function Cl(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("button",{class:(0,C.C_)(["modal-button",{"modal-button--inverted":t.inverted}]),role:"button"},(0,C.zw)(t.text),3)}var Sl=(0,x.aZ)({name:"ModalButton",props:{text:{type:String,required:!0},disabled:{type:Boolean,default:!1},inverted:{type:Boolean,default:!1}}});const Dl=(0,nt.Z)(Sl,[["render",Cl]]);var _l=Dl,Pl=(0,x.aZ)({name:"BuilderView",components:{Builder:pl,Modal:xl,ModalButton:_l},setup(){const{isBuilderOpen:t,model:e,save:o,close:n}=cr(),i=(0,P.iH)(!1);return i.value=!0,{item:e,isBuilderOpen:t,save:o,close:n,isOpen:i}}});const Ol=(0,nt.Z)(Pl,[["render",Yc]]);var Zl=Ol,kl=(0,x.aZ)({name:"App",components:{Document:jr,Toolbar:ra,TabItem:Na,TabHost:$a,Toolbox:Za,Oscilloscope:pc,StatusBar:Fc,MainView:qc,BuilderView:Zl},setup(){const t=ur(),{activeDocument:e,activeDocumentId:o,documents:n,hasOpenDocuments:i,isFullscreen:s,isDialogOpen:r,isBuilderOpen:a,isToolboxOpen:c}=(0,w.Jk)(t),l=(0,P.iH)(!1);function u(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),l.value=!0}async function d(e){e.stopPropagation(),e.preventDefault();const o=e.dataTransfer?.files;if(o)for(let n=0;n<o.length;n++)await t.openDocumentFromPath(o[n].path);l.value=!1}function p(){l.value=!1}function h(t){t.ctrlKey&&"R"===t.key.toUpperCase()&&window.location.reload()}function m(){}return i.value||t.openTestDocuments(),(0,x.m0)((()=>window.api.setApplicationMenu(Tc()))),(0,x.m0)((()=>{document.title=t.activeDocument?`${t.activeDocument.displayName} - Aristotle`:"Aristotle"})),window.api.onBeforeClose(t.closeAll),window.api.onOpenFile(t.openDocumentFromPath),(0,x.bv)((()=>{document.addEventListener("keydown",h),document.addEventListener("dragover",u),document.addEventListener("dragleave",p),document.addEventListener("drop",d)})),(0,x.Jd)((()=>{document.removeEventListener("keydown",h),document.removeEventListener("dragover",u),document.removeEventListener("dragleave",p),document.removeEventListener("drop",d)})),{activeDocument:e,activeDocumentId:o,documents:n,hasOpenDocuments:i,isDropping:l,isFullscreen:s,isDialogOpen:r,isBuilderOpen:a,isToolboxOpen:c,onContextMenu:m,toggleFullscreen:t.toggleFullscreen,activateDocument:t.activateDocument,closeDocument:t.closeDocument,switchDocument:t.switchDocument,openIntegratedCircuit:t.openIntegratedCircuit}},data(){return{horizontal:!1,lastPosition:0,toolboxWidth:20,oscilloscopeHeight:80,isMobile:Hc}}});const Bl=(0,nt.Z)(kl,[["render",_]]);var El=Bl;window.api||(window.api={showContextMenu(){},setApplicationMenu(){},showOpenFileDialog(){return[]},showSaveFileDialog(){return""},showMessageBox(){return 0},beep(){},quit(){},copy(){},paste(){return""},onBeforeClose(){},onOpenFile(){},openFile(){return""},saveFile(){},setFullscreen(){},getFilePaths(){return[]}}),(0,I.ri)(El).use((0,w.WB)()).mount("#app")}},e={};function o(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(s.exports,s,s.exports,o),s.loaded=!0,s.exports}o.m=t,function(){var t=[];o.O=function(e,n,i,s){if(!n){var r=1/0;for(u=0;u<t.length;u++){n=t[u][0],i=t[u][1],s=t[u][2];for(var a=!0,c=0;c<n.length;c++)(!1&s||r>=s)&&Object.keys(o.O).every((function(t){return o.O[t](n[c])}))?n.splice(c--,1):(a=!1,s<r&&(r=s));if(a){t.splice(u--,1);var l=i();void 0!==l&&(e=l)}}return e}s=s||0;for(var u=t.length;u>0&&t[u-1][2]>s;u--)t[u]=t[u-1];t[u]=[n,i,s]}}(),function(){o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,{a:e}),e}}(),function(){o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){o.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={826:0};o.O.j=function(e){return 0===t[e]};var e=function(e,n){var i,s,r=n[0],a=n[1],c=n[2],l=0;if(r.some((function(e){return 0!==t[e]}))){for(i in a)o.o(a,i)&&(o.m[i]=a[i]);if(c)var u=c(o)}for(e&&e(n);l<r.length;l++)s=r[l],o.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return o.O(u)},n=self["webpackChunkaristotle"]=self["webpackChunkaristotle"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=o.O(void 0,[998],(function(){return o(2020)}));n=o.O(n)})();
//# sourceMappingURL=index.ea910c36.js.map