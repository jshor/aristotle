(function(){"use strict";var t={4971:function(t,e,o){var n={};o.r(n),o.d(n,{copy:function(){return ts},cut:function(){return Qi},paste:function(){return es}});var i={};o.r(i),o.d(i,{commitPreviewedConnection:function(){return is},connect:function(){return as},createConnection:function(){return rs},cycleConnectionPreviews:function(){return ss},destroyConnection:function(){return ls},disconnect:function(){return cs},setConnectionPreview:function(){return os},unsetConnectionPreview:function(){return ns}});var s={};o.r(s),o.d(s,{clearBaseItems:function(){return ms},clearStatelessInfo:function(){return hs},createImage:function(){return ps},loadDocument:function(){return us},print:function(){return ds}});var r={};o.r(r),o.d(r,{addFreeportItem:function(){return vs},connectFreeport:function(){return ws},createFreeport:function(){return ys},disconnectFreeport:function(){return bs}});var a={};o.r(a),o.d(a,{destroyGroup:function(){return Cs},group:function(){return Is},ungroup:function(){return xs}});var l={};o.r(l),o.d(l,{addItem:function(){return _s},insertItemAtPosition:function(){return Ds},removeElement:function(){return Ps},resetItemValue:function(){return Os},setInputCount:function(){return Zs},setProperties:function(){return ks}});var c={};o.r(c),o.d(c,{panDelta:function(){return Bs},panTo:function(){return Ms},panToCenter:function(){return Es}});var u={};o.r(u),o.d(u,{addPort:function(){return Ns},monitorPort:function(){return $s},removePort:function(){return js},setActivePortId:function(){return Ts},setConnectablePortIds:function(){return Fs},setPortValue:function(){return Ls},togglePortMonitoring:function(){return Ws},unmonitorPort:function(){return Vs}});var d={};o.r(d),o.d(d,{centerAll:function(){return Rs},dragItem:function(){return qs},moveSelectionPosition:function(){return Hs},setItemPosition:function(){return Us},setPortRelativePosition:function(){return As},setSelectionPosition:function(){return Gs}});var p={};o.r(p),o.d(p,{rotate:function(){return Js}});var h={};o.r(h),o.d(h,{createSelection:function(){return nr},deleteSelection:function(){return lr},deselectAll:function(){return or},deselectItem:function(){return Qs},recycleSelection:function(){return ar},selectAll:function(){return er},selectItem:function(){return tr},selectItemConnections:function(){return ir},setSelectionState:function(){return rr},updateSelectionList:function(){return sr}});var m={};o.r(m),o.d(m,{clearOscilloscope:function(){return br},closeOscilloscope:function(){return vr},onError:function(){return dr},onSimulationUpdate:function(){return ur},openOscilloscope:function(){return fr},resetCircuit:function(){return pr},stepThroughCircuit:function(){return hr},toggleDebugger:function(){return mr},toggleOscillatorRecording:function(){return cr},toggleOscilloscope:function(){return gr}});var g={};o.r(g),o.d(g,{setGroupBoundingBox:function(){return Sr},setItemBoundingBox:function(){return Cr},setItemSize:function(){return xr},setViewerSize:function(){return Ir},updateCanvasSize:function(){return wr}});var f={};o.r(f),o.d(f,{setSnapBoundaries:function(){return _r}});var v={};o.r(v),o.d(v,{applyState:function(){return Mr},cacheState:function(){return Zr},commitCachedState:function(){return kr},commitState:function(){return Pr},redo:function(){return Or},undo:function(){return Dr}});var b={};o.r(b),o.d(b,{bringForward:function(){return zr},bringToFront:function(){return jr},incrementZIndex:function(){return Tr},sendBackward:function(){return Er},sendToBack:function(){return Nr},setZIndex:function(){return Fr}});var y={};o.r(y),o.d(y,{incrementZoom:function(){return Vr},setZoom:function(){return Rr}});var w=o(8262),I=o(9963),x=o(6252),C=o(3577);const S={key:1};function _(t,e,o,n,i,s){const r=(0,x.up)("mobile-header"),a=(0,x.up)("mobile-pullout-heading"),l=(0,x.up)("mobile-preferences"),c=(0,x.up)("mobile-pullout"),u=(0,x.up)("mobile-document-tab-item"),d=(0,x.up)("mobile-popout-menu"),p=(0,x.up)("toolbar"),h=(0,x.up)("toolbox"),m=(0,x.up)("tab-item"),g=(0,x.up)("document"),f=(0,x.up)("tab-host"),v=(0,x.up)("oscilloscope"),b=(0,x.up)("status-bar"),y=(0,x.up)("main-view"),w=(0,x.up)("builder-view"),I=(0,x.up)("theme");return(0,x.wg)(),(0,x.j4)(I,{dark:t.experience.darkMode.value},{default:(0,x.w5)((()=>[(0,x._)("div",{class:(0,C.C_)(["app__dropzone",{"app__dropzone--active":t.isDropping}])},null,2),t.activeDocumentId&&t.activeDocument?((0,x.wg)(),(0,x.j4)(y,{key:0,"is-blurred":t.isDialogOpen,onContextmenu:t.onContextMenu},{top:(0,x.w5)((()=>[t.isMobile?((0,x.wg)(),(0,x.iD)(x.HY,{key:0},[(0,x.Wm)(r,{onSelect:e[0]||(e[0]=e=>t.isDocumentSelectOpen=!0),onOpen:e[1]||(e[1]=e=>t.isSettingsOpen=!0),"document-name":t.activeDocument.displayName,"document-count":3},null,8,["document-name"]),(0,x.Wm)(c,{modelValue:t.isSettingsOpen,"onUpdate:modelValue":e[3]||(e[3]=e=>t.isSettingsOpen=e)},{default:(0,x.w5)((()=>[(0,x.Wm)(a,{onClose:e[2]||(e[2]=e=>t.isSettingsOpen=!1)}),(0,x.Wm)(l)])),_:1},8,["modelValue"]),(0,x.Wm)(d,{modelValue:t.isDocumentSelectOpen,"onUpdate:modelValue":e[4]||(e[4]=e=>t.isDocumentSelectOpen=e)},{default:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.documents,((e,o)=>((0,x.wg)(),(0,x.j4)(u,{key:o,label:e.displayName,dirty:e.store().isDirty,active:t.activeDocumentId===o,onActivate:e=>t.activateDocument(o),onClose:e=>t.closeDocument(o)},null,8,["label","dirty","active","onActivate","onClose"])))),128))])),_:1},8,["modelValue"])],64)):(0,x.kq)("",!0),((0,x.wg)(),(0,x.j4)(p,{key:t.activeDocumentId,store:t.activeDocument.store},null,8,["store"])),(0,x.Wm)(h,{"is-open":t.isToolboxOpen,store:t.activeDocument.store},null,8,["is-open","store"])])),middle:(0,x.w5)((()=>[(0,x.Wm)(f,null,(0,x.Nv)({default:(0,x.w5)((()=>[((0,x.wg)(),(0,x.j4)(g,{key:t.activeDocumentId,store:t.activeDocument.store,onSwitch:t.switchDocument,onOpenIntegratedCircuit:t.openIntegratedCircuit},null,8,["store","onSwitch","onOpenIntegratedCircuit"]))])),_:2},[t.isMobile?void 0:{name:"tabs",fn:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.documents,((e,o)=>((0,x.wg)(),(0,x.j4)(m,{key:o,label:e.displayName,active:t.activeDocumentId===o,dirty:e.store().isDirty,onActivate:e=>t.activateDocument(o),onClose:e=>t.closeDocument(o)},null,8,["label","active","dirty","onActivate","onClose"])))),128))]))}]),1024)])),bottom:(0,x.w5)((()=>[((0,x.wg)(),(0,x.j4)(v,{key:t.activeDocumentId,store:t.activeDocument.store},null,8,["store"])),t.isMobile?(0,x.kq)("",!0):((0,x.wg)(),(0,x.j4)(b,{key:t.activeDocumentId,store:t.activeDocument.store,"is-fullscreen":t.isFullscreen,onFullscreen:t.toggleFullscreen},null,8,["store","is-fullscreen","onFullscreen"]))])),_:1},8,["is-blurred","onContextmenu"])):((0,x.wg)(),(0,x.iD)("div",S," no documents open "+(0,C.zw)(t.isDropping),1)),t.isBuilderOpen?((0,x.wg)(),(0,x.j4)(w,{key:2})):(0,x.kq)("",!0)])),_:1},8,["dark"])}var D=o(1436),O=o(2262);const P={class:"builder-canvas"};function Z(t,e,o,n,i,s){const r=(0,x.up)("builder"),a=(0,x.up)("modal-button"),l=(0,x.up)("modal");return(0,x.wg)(),(0,x.j4)(l,{modelValue:t.isBuilderOpen,"onUpdate:modelValue":[e[1]||(e[1]=e=>t.isBuilderOpen=e),t.close],title:"Build Circuit"},{buttons:(0,x.w5)((()=>[(0,x.Wm)(a,{text:"Cancel",onClick:t.close,inverted:""},null,8,["onClick"]),(0,x.Wm)(a,{text:"Save",onClick:t.save},null,8,["onClick"])])),default:(0,x.w5)((()=>[(0,x._)("div",P,[(0,x.Wm)(r,{modelValue:t.item,"onUpdate:modelValue":e[0]||(e[0]=e=>t.item=e)},null,8,["modelValue"])])])),_:1},8,["modelValue","onUpdate:modelValue"])}const k={class:"builder__center"};function M(t,e,o,n,i,s){const r=(0,x.up)("builder-drop-zone"),a=(0,x.up)("builder-editable-label"),l=(0,x.up)("container");return(0,x.wg)(),(0,x.j4)(l,{class:"builder"},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{type:"top","get-child-payload":t.getCardPayload("top"),ports:t.ports.top.children,onDrop:t.onWireDrop},null,8,["get-child-payload","ports","onDrop"]),(0,x._)("div",k,[(0,x.Wm)(r,{type:"left","get-child-payload":t.getCardPayload("left"),ports:t.ports.left.children,onDrop:t.onWireDrop},null,8,["get-child-payload","ports","onDrop"]),(0,x.Wm)(a,{modelValue:t.item.name,"onUpdate:modelValue":e[0]||(e[0]=e=>t.item.name=e)},null,8,["modelValue"]),(0,x.Wm)(r,{type:"right","get-child-payload":t.getCardPayload("right"),ports:t.ports.right.children,onDrop:t.onWireDrop},null,8,["get-child-payload","ports","onDrop"])]),(0,x.Wm)(r,{type:"bottom","get-child-payload":t.getCardPayload("bottom"),ports:t.ports.bottom.children,onDrop:t.onWireDrop},null,8,["get-child-payload","ports","onDrop"])])),_:1})}var B=o(6523);function E(t,e,o,n,i,s){const r=(0,x.up)("port-handle"),a=(0,x.up)("port-wire"),l=(0,x.up)("builder-editable-label"),c=(0,x.up)("Draggable"),u=(0,x.up)("Container");return(0,x.wg)(),(0,x.j4)(u,{orientation:t.orientation,"animation-duration":500,"group-name":t.type,class:(0,C.C_)(`builder-drop-zone builder-drop-zone--${t.orientation}`),onDrop:t.onDrop,onDragEnter:t.onDragEnter,onDragLeave:t.onDragLeave,"should-accept-drop":()=>!0,"get-child-payload":t.getChildPayload,"get-ghost-parent":t.getGhostParent},{default:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.ports,(e=>((0,x.wg)(),(0,x.j4)(c,{key:e.id,tag:{value:"div",props:{class:`builder-drop-zone__io builder-drop-zone__io--${t.type}`}}},{default:(0,x.w5)((()=>[(0,x.Wm)(l,{modelValue:e.name,"onUpdate:modelValue":t=>e.name=t},{default:(0,x.w5)((()=>[(0,x.Wm)(a,{type:t.type},{default:(0,x.w5)((()=>[(0,x.Wm)(r)])),_:1},8,["type"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["tag"])))),128))])),_:1},8,["orientation","group-name","class","onDrop","onDragEnter","onDragLeave","should-accept-drop","get-child-payload","get-ghost-parent"])}o(6699);const z={class:"builder-editable-label"},N=["value"];function j(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",z,[(0,x._)("div",{tabindex:0,class:(0,C.C_)([{"builder-editable-label__read-only--hidden":!t.isReadOnly},"builder-editable-label__read-only"]),onFocus:e[0]||(e[0]=(...e)=>t.onFocus&&t.onFocus(...e))},(0,C.zw)(t.modelValue),35),t.isReadOnly?(0,x.kq)("",!0):((0,x.wg)(),(0,x.iD)("input",{key:0,class:"builder-editable-label__textbox",type:"text",ref:"inputRef",value:t.modelValue,onInput:e[1]||(e[1]=(...e)=>t.onInput&&t.onInput(...e)),onBlur:e[2]||(e[2]=e=>t.isReadOnly=!0)},null,40,N)),(0,x.WI)(t.$slots,"default")])}var T=(0,x.aZ)({name:"BuilderEditableLabel",props:{modelValue:{type:String,default:"node"}},setup(t,{emit:e}){const o=(0,O.iH)(!0),n=(0,O.iH)();function i(){o.value=!1,(0,x.Y3)((()=>{n.value&&(n.value.focus(),n.value.select())}))}function s(t){const{value:o}=t.target;e("update:modelValue",o)}return{isReadOnly:o,inputRef:n,onFocus:i,onInput:s}}}),F=o(3744);const L=(0,F.Z)(T,[["render",j]]);var W=L;const $={class:"port-handle"};function V(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",$,[(0,x._)("div",{class:(0,C.C_)(["port-handle__display",{"port-handle__display--active":t.active}])},[(0,x._)("div",{class:"port-handle__hue",style:(0,C.j5)({backgroundColor:t.backgroundColor})},null,4)],2)])}var R=(0,x.aZ)({name:"PortHandle",props:{active:{type:Boolean,default:!1},hue:{type:Number,default:0}},setup(t){const e=(0,x.Fl)((()=>t.hue>0?`hsla(${t.hue}, var(--lightness), var(--saturation), 0.8)`:"var(--color-bg-secondary)"));return{backgroundColor:e}}});const A=(0,F.Z)(R,[["render",V]]);var U=A;const q={class:"wire__port"};function H(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(`wire wire--${t.type}`)},[(0,x._)("div",{class:(0,C.C_)(`wire__connector wire__connector--${t.type}`)},null,2),(0,x._)("div",q,[(0,x.WI)(t.$slots,"default")])],2)}var G=(0,x.aZ)({name:"PortWire",props:{type:{type:String,default:"top"}}});const Y=(0,F.Z)(G,[["render",H]]);var K=Y,X=(0,x.aZ)({name:"BuilderDropZone",components:{BuilderEditableLabel:W,Container:B.Container,Draggable:B.Draggable,PortHandle:U,PortWire:K},emits:{drop:(t,e)=>!(!t||!e)},props:{ports:{type:Array,default:()=>[]},getChildPayload:{type:Function,required:!0},type:{type:String,required:!0}},computed:{orientation(){return["left","right"].includes(this.type)?"vertical":"horizontal"}},setup(t,{emit:e}){const o=/--([a-z]+)/gi;let n="";function i(t){document.querySelectorAll(".smooth-dnd-ghost, .smooth-dnd-ghost div").forEach((e=>{const i=e.className.match(o);i&&(n=i.pop()||""),e.className=e.className.replace(o,t)}))}function s(){i(`--${t.type}`)}function r(){i(n)}function a(o){e("drop",t.type,o)}function l(){return document.querySelector(".modal")}return{onDragEnter:s,onDragLeave:r,onDrop:a,getGhostParent:l}}});const J=(0,F.Z)(X,[["render",E]]);var Q,tt=J;(function(t){t[t["Output"]=0]="Output",t[t["Input"]=1]="Input"})(Q||(Q={}));var et=Q;const ot=(t,e)=>{const{removedIndex:o,addedIndex:n,payload:i}=e;if(null===o&&null===n)return t;const s=[...t];let r=i;return null!==o&&(r=s.splice(o,1)[0]),null!==n&&s.splice(n,0,r),s};var nt=(0,x.aZ)({name:"Builder",components:{BuilderDropZone:tt,BuilderEditableLabel:W,Container:B.Container},emits:["update:modelValue"],props:{modelValue:{type:Object,required:!0}},setup(t,{emit:e}){const o=(0,O.iH)({left:{children:[]},top:{children:[]},right:{children:[]},bottom:{children:[]}});function n(){const n=["left","top","right","bottom"];t.modelValue.portIds=[],Object.keys(o.value).forEach((e=>{const i=e,{children:s}=o.value[i];s.forEach((e=>{e.orientation=n.indexOf(i),t.modelValue.portIds.push(e.id)}))})),e("update:modelValue",t.modelValue)}function i(t,e){const i=Object.assign({},o.value[t]);o.value[t].children=ot(i.children,e),n()}function s(t){return e=>o.value[t].children[e]}return t.modelValue.portIds.forEach((e=>{const n=t.modelValue.integratedCircuit?.ports[e];n&&o.value[n.type===et.Input?"left":"right"].children.push(n)})),{item:t.modelValue,ports:o,onWireDrop:i,getCardPayload:s}}});const it=(0,F.Z)(nt,[["render",M]]);var st,rt=it,at=o(3465),lt=o.n(at),ct=o(5934);(function(t){t["Buffer"]="Buffer",t["CircuitNode"]="CircuitNode",t["Freeport"]="Freeport",t["InputNode"]="InputNode",t["IntegratedCircuit"]="IntegratedCircuit",t["LogicGate"]="LogicGate",t["OutputNode"]="OutputNode"})(st||(st={}));var ut,dt=st;(function(t){t[t["Left"]=0]="Left",t[t["Top"]=1]="Top",t[t["Right"]=2]="Right",t[t["Bottom"]=3]="Bottom"})(ut||(ut={}));var pt,ht=ut;function mt(t,e,o,n,i,s=[]){return{id:t,name:"",type:e,subtype:o,portIds:s.map((({id:t})=>t)),groupId:null,rotation:0,boundingBox:{top:0,left:0,right:n,bottom:i},position:{x:0,y:0},zIndex:0,width:n,height:i,isSelected:!1,properties:{name:{type:"text",label:"Name",value:""}}}}(function(t){t["None"]="None",t["CustomCircuit"]="CustomCircuit",t["Switch"]="Switch",t["PushButton"]="PushButton",t["Clock"]="Clock",t["Lightbulb"]="Lightbulb",t["DigitDisplay"]="DigitDisplay",t["Buffer"]="Buffer",t["Not"]="Not",t["Tristate"]="Tristate",t["And"]="And",t["Or"]="Or",t["Nand"]="Nand",t["Nor"]="Nor",t["Xnor"]="Xnor",t["Xor"]="Xor"})(pt||(pt={}));var gt=pt;function ft(t,e,o,n,i=gt.CustomCircuit){const{ports:s,items:r,connections:a,groups:l}=lt()(t),c=mt((0,ct.Z)(),dt.IntegratedCircuit,i,o,n);return Object.values(r).forEach((t=>{const e=t.portIds.map((t=>s[t]));let o=0;const n=e.reduce(((t,e)=>void 0===t||t===e.type?e.type:null),void 0);if("number"!==typeof n)return;const i=n===et.Input?ht.Right:ht.Left;e.filter((t=>t.type===n)).forEach((r=>{const a=(0,ct.Z)(),l=t.properties.name?.value||t.name;s[a]={...lt()(r),type:n===et.Input?et.Output:et.Input,name:e.length>1?`${l} ${o++}`:l,id:a,elementId:t.id,orientation:i,value:0},t.portIds.push(a),c.portIds.push(a)})),t.type=dt.Buffer})),c.name=e,c.integratedCircuit={items:r,connections:a,ports:s,groups:l,serializedState:JSON.stringify({items:t.items,connections:t.connections,ports:t.ports,groups:t.groups})},c}var vt=o(8764),bt=o(5733),yt=o.n(bt);class wt{static async open(t){const e=new(yt()),o=window.api.openFile(t),{files:n}=await e.loadAsync(o),i=await n.content.async("text");return i}static async writeBlob(t,e){const o=await e.arrayBuffer(),n=vt.lW.from(o);window.api.saveFile(t,n)}static async save(t,e){const o=new(yt());o.file("content",JSON.stringify(e));const n=await o.generateAsync({type:"blob"});this.writeBlob(t,n)}}function It(t,e={}){let{items:o,connections:n,ports:i,groups:s}=lt()(t);function r(t){return Object.values(t).forEach((o=>{const n=o.id,i=(0,ct.Z)();e[n]=i,t[i]=lt()(o),delete t[n]})),t}function a(t,o){return Object.values(t).forEach((t=>{t.groupId=null!==t.groupId?e[t.groupId]:null})),Object.values(o).forEach((t=>{t.groupId=null!==t.groupId?e[t.groupId]:null})),{connections:t,items:o}}function l(t){return Object.values(t).forEach((o=>{const n=o.id,i=(0,ct.Z)();e[n]=i,t[i]=lt()(o),t[i].id=i,t[i].source=e[t[i].source],t[i].target=e[t[i].target],delete t[n]})),t}function c(t){return Object.values(t).forEach((o=>{t[o.id].connectionChainId=e[t[o.id].connectionChainId]})),t}function u(t){return Object.values(t).forEach((o=>{const n=o.id,i=(0,ct.Z)();e[n]=i,t[i]=lt()(o),o.integratedCircuit?t[i].integratedCircuit={serializedState:o.integratedCircuit.serializedState,...It(lt()(o.integratedCircuit),e)}:t[i].id=i,t[i].portIds=o.portIds.map((t=>e[t])),delete t[n]})),t}function d(t){return Object.values(t).forEach((o=>{t[o.id].elementId=e[o.elementId]})),t}function p(t){return Object.values(t).forEach((o=>{const n=o.id,i=(0,ct.Z)();e[n]=i,t[i]=lt()(o),t[i].id=i,delete t[n]})),t}return i=p(i),o=u(o),i=d(i),n=l(n),n=c(n),s=r(s),{...a(n,o),ports:i,groups:s}}function xt(t){if(!t.integratedCircuit)return t;const{items:e}=It({items:{[t.id]:t},connections:{},ports:{},groups:{}}),o=Object.values(e)[0];return o.id=(0,ct.Z)(),o}var Ct={mapStandardCircuitIds:It,mapIntegratedCircuitIds:xt};const St=(0,w.Q_)("integratedCircuit",{state:()=>({isBuilderOpen:!1,model:null,factories:{},resolve:()=>{}}),actions:{launchBuilder(t){return this.isBuilderOpen=!0,this.model=ft(t,"My integrated circuit",400,400),new Promise((t=>{this.resolve=t}))},async loadLibrary(){const t=window.api.getFilePaths("../../Desktop","aicx");for(let e=0;e<t.length;e++)await this.loadCircuit(t[e])},async loadCircuit(t){try{const e=await wt.open(t),o=JSON.parse(e);this.factories[o.name]=()=>{const t=Ct.mapIntegratedCircuitIds(o),e=t.portIds.map((e=>t.integratedCircuit?.ports[e]));return{item:t,ports:e}}}catch(e){console.log(e),window.api.showMessageBox({message:`Could not load ${t} into the integrated circuit library. The file is not a valid Aristotle circuit.`,title:"Error",type:"error"})}},async save(){if(this.model){try{const t=`${this.model.name}.aicx`,e=window.api.showSaveFileDialog([{name:"Aristotle Integrated Circuit (*.aicx)",extensions:["aicx"]}],t);if(!e)return;await wt.save(e,this.model),await this.loadCircuit(e),window.api.showMessageBox({message:"Integrated circuit successfully created. You can find it in the toolbox.",title:"Success",type:"info"})}catch(t){window.api.showMessageBox({message:"An error occurred while trying to save the integrated circuit.",title:"Error",type:"error"})}this.close()}},close(){this.resolve(),this.isBuilderOpen=!0}}}),_t={key:0,class:"modal"},Dt={class:"modal__inner"},Ot={class:"modal__title"},Pt={class:"modal__title-text"},Zt={class:"modal__content"},kt={key:0,class:"modal__buttons"};function Mt(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.j4)(I.uT,{name:"modal",appear:""},{default:(0,x.w5)((()=>[t.modelValue?((0,x.wg)(),(0,x.iD)("div",_t,[(0,x._)("div",Dt,[(0,x._)("div",Ot,[(0,x._)("div",Pt,(0,C.zw)(t.title),1),(0,x._)("button",{title:"Close",onClick:e[0]||(e[0]=e=>t.$emit("update:modelValue",!1)),class:"modal__close"},[(0,x.Wm)(r,{icon:t.faClose},null,8,["icon"])])]),(0,x._)("div",Zt,[(0,x.WI)(t.$slots,"default")]),t.$slots["buttons"]?((0,x.wg)(),(0,x.iD)("div",kt,[(0,x.WI)(t.$slots,"buttons")])):(0,x.kq)("",!0)])])):(0,x.kq)("",!0)])),_:3})}const Bt=["viewBox"],Et=["d"];function zt(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",viewBox:`0 0 ${t.width} ${t.height}`},[(0,x._)("path",{fill:"currentColor",d:t.svgPath},null,8,Et)],8,Bt)}var Nt=(0,x.aZ)({name:"Icon",props:{icon:{type:Object,required:!0}},setup(t){const e=(0,x.Fl)((()=>t.icon.icon[0])),o=(0,x.Fl)((()=>t.icon.icon[1])),n=(0,x.Fl)((()=>t.icon.icon[4]));return{width:e,height:o,svgPath:n}}});const jt=(0,F.Z)(Nt,[["render",zt]]);var Tt=jt,Ft=(0,x.aZ)({name:"Modal",components:{Icon:Tt},props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:""}},setup(){const t=(0,O.iH)(!1);return{faClose:D.YIN,show:t}}});const Lt=(0,F.Z)(Ft,[["render",Mt]]);var Wt=Lt;function $t(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("button",{class:(0,C.C_)(["modal-button",{"modal-button--inverted":t.inverted}]),role:"button"},(0,C.zw)(t.text),3)}var Vt=(0,x.aZ)({name:"ModalButton",props:{text:{type:String,required:!0},disabled:{type:Boolean,default:!1},inverted:{type:Boolean,default:!1}}});const Rt=(0,F.Z)(Vt,[["render",$t]]);var At=Rt,Ut=(0,x.aZ)({name:"BuilderView",components:{Builder:rt,Modal:Wt,ModalButton:At},setup(){const{isBuilderOpen:t,model:e,save:o,close:n}=St(),i=(0,O.iH)(!1);return i.value=!0,{item:e,isBuilderOpen:t,save:o,close:n,isOpen:i}}});const qt=(0,F.Z)(Ut,[["render",Z]]);var Ht,Gt=qt;function Yt(t,e,o,n,i,s){const r=(0,x.up)("item"),a=(0,x.up)("connection"),l=(0,x.up)("group"),c=(0,x.up)("editor");return(0,x.wg)(),(0,x.j4)(c,{ref:"editor",zoom:t.store.zoomLevel,"grid-size":t.grid.showGrid.value?t.grid.gridSize.value:0,tabindex:0,offset:{x:t.store.canvas.left,y:t.store.canvas.top},style:(0,C.j5)({"--color-on":t.colors.onColor.value,"--color-off":t.colors.offColor.value,"--color-hi-i":t.colors.unknownColor.value}),width:t.store.canvas.right-t.store.canvas.left,height:t.store.canvas.bottom-t.store.canvas.top,onPan:t.store.panTo,onDeselect:t.store.deselectAll,onSelection:t.store.createSelection,onZoom:t.store.setZoom,onContextmenu:t.onContextMenu,onResize:t.store.setViewerSize},{default:(0,x.w5)((()=>[(0,x._)("div",{tabindex:0,onFocus:e[0]||(e[0]=e=>t.store.recycleSelection(!1))},null,32),t.store.hasLoaded?((0,x.wg)(!0),(0,x.iD)(x.HY,{key:0},(0,x.Ko)(t.store.baseItems,(e=>((0,x.wg)(),(0,x.iD)(x.HY,null,["type"in e?((0,x.wg)(),(0,x.j4)(r,{tabindex:0,store:t.storeDefinition,id:e.id,key:e.id,"is-selected":e.isSelected,flash:t.store.isDebugging&&t.store.isCircuitEvaluated,"z-index":e.zIndex+1e3,onContextmenu:t.onContextMenu},null,8,["store","id","is-selected","flash","z-index","onContextmenu"])):((0,x.wg)(),(0,x.j4)(a,{tabindex:0,store:t.storeDefinition,id:e.id,key:`c${e.id}`,"is-selected":e.isSelected,"is-preview":t.store.connectionPreviewId===e.id,flash:t.store.isDebugging&&t.store.isCircuitEvaluated,"z-index":e.zIndex,onContextmenu:t.onContextMenu},null,8,["store","id","is-selected","is-preview","flash","z-index","onContextmenu"]))],64)))),256)):(0,x.kq)("",!0),(0,x._)("div",{tabindex:0,onFocus:e[1]||(e[1]=e=>t.store.recycleSelection(!0))},null,32),((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.store.groups,(e=>((0,x.wg)(),(0,x.j4)(l,{key:e.id,id:e.id,"bounding-box":e.boundingBox,"is-selected":e.isSelected,"z-index":t.store.zIndex,zoom:t.store.zoom},null,8,["id","bounding-box","is-selected","z-index","zoom"])))),128))])),_:1},8,["zoom","grid-size","offset","style","width","height","onPan","onDeselect","onSelection","onZoom","onContextmenu","onResize"])}function Kt(t,e,o,n,i,s){const r=(0,x.up)("wire"),a=(0,x.up)("draggable");return(0,x.wg)(),(0,x.j4)(a,{style:(0,C.j5)({zIndex:t.zIndex}),position:t.position,"is-selected":t.isSelected,"allow-touch-drag":null!==t.freeportId,onTouchhold:t.onDragStart,onDrag:t.onDrag,onDragEnd:t.onDragEnd,onSelect:e[0]||(e[0]=e=>t.selectItem(t.id,e)),onDeselect:e[1]||(e[1]=e=>t.deselectItem(t.id)),onContextmenu:t.onContextMenu},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{source:t.source,target:t.target,geometry:t.geometry,"is-selected":t.isSelected,"is-preview":t.isPreview,flash:t.flash,label:"TODO",ref:"root","data-test":"wire"},null,8,["source","target","geometry","is-selected","is-preview","flash"])])),_:1},8,["style","position","is-selected","allow-touch-drag","onTouchhold","onDrag","onDragEnd","onContextmenu"])}function Xt(t,e,o,n,i,s){const r=(0,x.up)("resizable");return(0,x.wg)(),(0,x.j4)(r,{class:"draggable",ref:"draggable",style:(0,C.j5)(t.style),onMousedown:(0,I.iM)(t.onMouseDown,["left"]),onMouseup:t.onMouseUp,onTouchstart:t.onTouchStart,onTouchmove:t.onTouchMove,onTouchend:t.onTouchEnd,onTouchcancel:t.dragEnd,onFocus:t.onFocus},{default:(0,x.w5)((()=>[(0,x.WI)(t.$slots,"default")])),_:3},8,["style","onMousedown","onMouseup","onTouchstart","onTouchmove","onTouchend","onTouchcancel","onFocus"])}(function(t){t[t["Outer"]=0]="Outer",t[t["Inner"]=1]="Inner",t[t["Radial"]=2]="Radial",t[t["Grid"]=3]="Grid",t[t["None"]=4]="None"})(Ht||(Ht={}));var Jt=Ht;function Qt(t,e){return Math.round(t/e)*e}function te(t,e,o){return Math.hypot(t.x-e.x,t.y-e.y)<=o}function ee(t,e){return{x:Qt(t.left,e)-t.left,y:Qt(t.top,e)-t.top}}function oe(t,e,o){for(let n=0;n<t.length;n++){const i=t[n];if(te({x:i.left,y:i.top},{x:e.left,y:e.top},o))return{x:i.left-e.left,y:i.top-e.top}}return{x:0,y:0}}function ne(t,e,o){const n={x:0,y:0};for(let i=0;i<t.length;i++){const s=t[i],r=Math.abs(s.top-e.bottom)<=o,a=Math.abs(s.bottom-e.top)<=o,l=Math.abs(s.left-e.right)<=o,c=Math.abs(s.right-e.left)<=o;(e.left<=s.right&&e.left>=s.left||e.right>=s.left&&e.right<=s.right||e.left<=s.left&&e.right>=s.right)&&(r&&(n.y=s.top-e.bottom),a&&(n.y=s.bottom-e.top)),(e.top<=s.bottom&&e.top>=s.top||e.bottom>=s.top&&e.bottom<=s.bottom||e.top<=s.top&&e.bottom>=s.bottom)&&(l&&(n.x=s.left-e.right),c&&(n.x=s.right-e.left))}return n}function ie(t,e,o,n){switch(o){case Jt.Radial:return oe(t,e,n);case Jt.Grid:return ee(e,n);case Jt.Outer:default:return ne(t,e,n)}}function se(t,e,o,n){const i=(t,e,o)=>(o.y-t.y)*(e.x-t.x)>(e.y-t.y)*(o.x-t.x);return i(t,o,n)!==i(e,o,n)&&i(t,e,o)!==i(t,e,n)}function re(t,e,o){const n={x:o.left,y:o.top},i={x:o.right,y:o.top},s={x:o.right,y:o.bottom},r={x:o.left,y:o.bottom};return se(t,e,n,i)||se(t,e,i,s)||se(t,e,s,r)||se(t,e,r,n)}function ae(t,e){return!(t.left>=e.right||e.left>=t.right)&&!(t.top>=e.bottom||e.top>=t.bottom)}function le(t,e){return{left:t.left*e,top:t.top*e,bottom:t.bottom*e,right:t.right*e}}function ce(t){return t.left!==t.right||t.top!==t.bottom}function ue(t){return[{left:t.x,right:t.x,top:-1/0,bottom:1/0},{left:-1/0,right:1/0,top:t.y,bottom:t.y}]}function de(t){return{left:t.x,top:t.y,right:t.x,bottom:t.y}}function pe(t,e,o,n){if(e%2===0)return{left:t.x,top:t.y,bottom:n+t.y,right:o+t.x};const i=t.x+o/2,s=t.y+n/2;return{left:i-n/2,top:s-o/2,right:i+n/2,bottom:s+o/2}}function he(t){return t.reduce(((t,e)=>({left:Math.min(t.left,e.left),top:Math.min(t.top,e.top),right:Math.max(t.right,e.right),bottom:Math.max(t.bottom,e.bottom)})),{left:1/0,top:1/0,right:0,bottom:0})}function me(t){const e=t.right-t.left,o=t.bottom-t.top;return{x:e/2,y:o/2}}function ge(t,e,o){const n=me(t),i=e.right-e.left,s=e.bottom-e.top;return{x:Qt(n.x-i/2,o),y:Qt(n.y-s/2,o)}}function fe(t,...e){const o=Math[t](...e.map((({x:t})=>t))),n=Math[t](...e.map((({y:t})=>t)));return{x:o,y:n}}var ve={isInNeighborhood:te,getRadialSnapOffset:oe,getOuterSnapOffset:ne,getGridSnapPosition:ee,isLineIntersectingRectangle:re,scaleBoundingBox:le,isOneOrTwoDimensional:ce,getLinearBoundaries:ue,getPointBoundary:de,hasIntersection:ae,getBoundingBox:pe,getGroupBoundingBox:he,getBoundingBoxMidpoint:me,getCenteredScreenPoint:ge,getSnapOffset:ie,getExtremePoint:fe};const be={ref:"resizable"};function ye(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",be,[(0,x.WI)(t.$slots,"default")],512)}var we=o(1033),Ie=(0,x.aZ)({name:"Resizable",emits:{resize:t=>!0},setup(t,{emit:e}){const o=(0,O.iH)();function n([t]){e("resize",t.target.getBoundingClientRect())}const i=new we.Z(n);return(0,x.bv)((()=>{o.value&&i.observe(o.value)})),{onSizeChanged:n,resizable:o}}});const xe=(0,F.Z)(Ie,[["render",ye]]);var Ce=xe,Se=(0,x.aZ)({name:"Draggable",components:{Resizable:Ce},props:{position:{type:Object,default:()=>({x:0,y:0})},isSelected:{type:Boolean,default:!1},isMobile:{type:Boolean,default:!1},allowTouchDrag:{type:Boolean,default:!0}},emits:{dragStart:(t,e)=>!0,drag:(t,e)=>!0,dragEnd:(t,e)=>!0,select:t=>!0,deselect:()=>!0,touchhold:t=>!0},setup(t,{emit:e}){const o=(0,x.Fl)((()=>({left:`${t.position.x}px`,top:`${t.position.y}px`}))),n=(0,O.iH)();let i=0,s=!1,r=!1,a=!1,l={x:0,y:0},c={x:0,y:0},u={x:0,y:0};function d(){setTimeout((()=>{t.isSelected||e("select",!1)}))}function p({clientX:t,clientY:o}){s&&(c.x===t&&c.y===o||(c={x:t,y:o},e(a?"drag":"dragStart",c,u),a=!0,r=!0))}function h({clientX:t,clientY:e}){if(!n.value)return;const{x:o,y:i,width:r,height:l}=n.value.$el.getBoundingClientRect();c={x:t,y:e},u={x:t-(o+r/2),y:e-(i+l/2)},s=!0,a=!1}function m(){s&&(s=!1,r&&e("dragEnd",c,u))}function g(t){h(t)}function f(t){s&&(t.stopImmediatePropagation(),t.preventDefault(),p(t))}function v(t){}function b(t){r=!1,l={x:t.touches[0].clientX,y:t.touches[0].clientY},i=window.setTimeout((()=>{e("touchhold",t)}),500)}function y(e){const o={x:e.touches[0].clientX,y:e.touches[0].clientY};ve.isInNeighborhood(l,o,5)||1!==e.touches.length||(r=!0,clearTimeout(i)),t.allowTouchDrag&&(e.stopPropagation(),e.preventDefault(),s||h(e.touches[0])),s&&p(e.touches[0])}function w(){clearTimeout(i),s?m():r||(t.isSelected?e("deselect"):e("select",!0))}return(0,x.bv)((()=>{window.addEventListener("mousemove",f),window.addEventListener("mouseup",m)})),(0,x.Jd)((()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",m)})),(0,x.m0)((()=>{t.isSelected&&n.value?.$el.focus()})),{style:o,draggable:n,onMouseDown:g,onMouseUp:v,onTouchStart:b,onTouchMove:y,onTouchEnd:w,dragEnd:m,onFocus:d}}});const _e=(0,F.Z)(Se,[["render",Xt]]);var De=_e;const Oe=["width","height"],Pe=["transform","d"],Ze=["transform","d"],ke=["transform","d"],Me=["transform","d"];function Be(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("svg",{class:(0,C.C_)(["wire",{"wire--selected":t.isSelected,"wire--flash":t.flash,"wire--preview":t.isPreview}]),width:t.geometry.width,height:t.geometry.height},[(0,x._)("title",null,(0,C.zw)(t.label),1),(0,x._)("path",{class:"wire__outline",fill:"none",transform:`translate(${Math.abs(t.geometry.minX)}, ${Math.abs(t.geometry.minY)})`,d:t.geometry.path},null,8,Pe),(0,x._)("path",{class:(0,C.C_)(["wire__display",{"wire__display--on":1===t.source.value,"wire__display--off":-1===t.source.value}]),fill:"none",transform:`translate(${Math.abs(t.geometry.minX)}, ${Math.abs(t.geometry.minY)})`,d:t.geometry.path},null,10,Ze),t.isAnimated?((0,x.wg)(),(0,x.iD)("path",{key:0,class:"wire__animation",fill:"none",transform:`translate(${Math.abs(t.geometry.minX)}, ${Math.abs(t.geometry.minY)})`,d:t.geometry.path},null,8,ke)):(0,x.kq)("",!0),(0,x._)("path",{class:"wire__clickable",fill:"none",transform:`translate(${Math.abs(t.geometry.minX)}, ${Math.abs(t.geometry.minY)})`,d:t.geometry.path},null,8,Me)],10,Oe)}var Ee=(0,x.aZ)({name:"Wire",props:{isAnimated:{type:Boolean,default:!1},source:{type:Object,required:!0},target:{type:Object,required:!0},label:{type:String,default:""},isPreview:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},flash:{type:Boolean,default:!1},geometry:{type:Object,required:!0}}});const ze=(0,F.Z)(Ee,[["render",Be]]);var Ne=ze;function je(t,e=0){return(t+e%4+4)%4}const Te=15;function Fe(t,e){const o=t.position,n=e.position,{start:i,end:s}=Ve(o,n);if(i.x===s.x||i.y===s.y||s.x<=1&&i.x<=1||s.y<=1&&i.y<=1)return Le(i,s);const r=$e(t,o,n),a=$e(e,o,n);return Re(r,a,i,s)}function Le(t,e){return{path:`M ${t.x},${t.y} L ${e.x},${e.y}`,width:Math.abs(t.x-e.x)+Te,height:Math.abs(t.y-e.y)+Te,minX:-Te/2,minY:-Te/2}}function We(t,e,o){switch(t){case ht.Left:return e.y>o.y?ht.Right:ht.Left;case ht.Top:return e.x<o.x?ht.Bottom:ht.Top;case ht.Right:return e.y>o.y?ht.Left:ht.Right;case ht.Bottom:return e.x<o.x?ht.Top:ht.Bottom;default:return We(je(t),e,o)}}function $e(t,e,o){let n=je(t.orientation+t.rotation-1);return t.isFreeport&&(n=We(n,e,o),t.rotation%4!==1&&t.rotation%4!==2||(n=je(n-2))),n}function Ve(t,e){return t.x<=e.x?t.y<=e.y?{start:{x:0,y:0},end:{x:Math.floor(e.x-t.x),y:Math.floor(e.y-t.y)}}:{start:{x:0,y:Math.floor(t.y-e.y)},end:{x:Math.floor(e.x-t.x),y:0}}:t.y<=e.y?{start:{x:Math.floor(t.x-e.x),y:0},end:{x:0,y:Math.floor(e.y-t.y)}}:{start:{x:Math.floor(t.x-e.x),y:Math.floor(t.y-e.y)},end:{x:0,y:0}}}function Re(t,e,o,n){const i=o.x,s=o.y,r=n.x,a=n.y,l=Math.max(Math.abs(i-r)/2,10),c=Math.max(Math.abs(s-a)/2,10),u=[i,i+l,i,i-l][t].toFixed(3),d=[s-c,s,s+c,s][t].toFixed(3),p=[r,r+l,r,r-l][e].toFixed(3),h=[a-c,a,a+c,a][e].toFixed(3),m=["M",i.toFixed(3),s.toFixed(3),"C",u,d,p,h,r.toFixed(3),a.toFixed(3)].join(" "),g=(...t)=>t.map((t=>parseInt(t.toString(),10))),f=Math.min(...g(i,u,p,r))-Te/2,v=Math.max(...g(i,u,p,r))+Te/2,b=Math.min(...g(s,d,h,a))-Te/2,y=Math.max(...g(s,d,h,a))+Te/2,w=v-f+Te,I=y-b+Te;return{width:w,height:I,path:m,minX:f,minY:b}}function Ae(t,e=[]){const o=t();let n=[{label:"&Undo",enabled:o.canUndo,accelerator:"CommandOrControl+Z",click:o.undo},{type:"separator"},{role:"cut",enabled:o.hasSelection},{role:"copy",enabled:o.hasSelection},{role:"paste",enabled:o.hasSelection},{label:"Delete",accelerator:"Delete",enabled:o.hasSelection,click:o.deleteSelection},{type:"separator"},{role:"selectAll",enabled:o.baseItems.length>0}];return o.selectedItemIds.length>0&&(n.push({type:"separator"}),n.push({label:"&Rotate",submenu:[{label:"Rotate 90° &CW",accelerator:"CmdOrCtrl+R",click:()=>o.rotate(1)},{label:"Rotate 90° CC&W",accelerator:"CmdOrCtrl+Shift+R",click:()=>o.rotate(-1)}]})),o.hasSelection&&(n.push({type:"separator"}),n.push({label:"&Bring to Front",submenu:[{label:"&Bring to Front",click:()=>o.setZIndex(o.zIndex)},{label:"Bring &Forward",click:()=>o.incrementZIndex(1)}]}),n.push({label:"&Send to Back",submenu:[{label:"&Send to Back",click:()=>o.setZIndex(o.zIndex)},{label:"Send &Backward",click:()=>o.incrementZIndex(-1)}]})),o.canGroup&&n.push({label:"&Group",submenu:[{label:"&Group"},{label:"&Ungroup",enabled:o.canUngroup}]}),e.length>0&&(n.push({type:"separator"}),n=n.concat(e)),1===o.selectedItemIds.length&&(n.push({type:"separator"}),n.push({label:"&Item Properties"})),o.activePortId&&(n.push({type:"separator"}),n.push({type:"checkbox",label:"Show in &Oscilloscope",checked:!0})),n}function Ue(t){t();return[{label:"&Grid",submenu:[{label:"&Show grid"},{type:"separator"},{label:"Snap to &grid"},{label:"Snap to &elements"}]}]}function qe(t){return Ae(t,Ue(t).concat({type:"separator"}))}var He=(0,x.aZ)({name:"Connection",components:{Draggable:De,Wire:Ne},props:{isSelected:{type:Boolean,default:!1},id:{type:String,required:!0},zIndex:{type:Number,default:0},isPreview:{type:Boolean,default:!1},flash:{type:Boolean,default:!1},store:{type:Function,required:!0}},setup(t){const e=t.store(),o=(0,O.iH)(e.connections[t.id]),n=(0,O.iH)(),i=(0,x.Fl)((()=>e.ports[o.value.source])),s=(0,x.Fl)((()=>e.ports[o.value.target])),r=(0,x.Fl)((()=>ve.getExtremePoint("min",i.value.position,s.value.position))),a=(0,x.Fl)((()=>Fe(i.value,s.value))),l=(0,x.Fl)((()=>({y:r.value.y+a.value.minY,x:r.value.x+a.value.minX}))),c=(0,O.iH)(null);function u({touches:t}){d({x:t[0].clientX,y:t[0].clientY})}function d(t){n.value?.$el&&null===o.value.groupId&&(n.value.$el.style.opacity="0",c.value=(0,ct.Z)(),navigator.vibrate(20),e.createFreeport({itemId:c.value,inputPortId:(0,ct.Z)(),outputPortId:(0,ct.Z)(),connectionChainId:o.value.connectionChainId,sourceId:i.value.id,targetId:s.value.id,value:i.value.value}),e.setSnapBoundaries(c.value),e.dragItem(c.value,t))}async function p(t){c.value?e.dragItem(c.value,t):d(t)}function h(){c&&e.destroyConnection({source:o.value.source,target:o.value.target}),c.value=null}function m(){t.isSelected||e.selectItem(t.id),window.api.showContextMenu(qe(t.store))}return{root:n,geometry:a,position:l,onDragStart:u,onDrag:p,onDragEnd:h,onContextMenu:m,source:i,target:s,freeportId:c,selectItem:e.selectItem,deselectItem:e.deselectItem}}});const Ge=(0,F.Z)(He,[["render",Kt]]);var Ye=Ge;function Ke(t,e,o,n,i,s){const r=(0,x.up)("properties"),a=(0,x.up)("port-item"),l=(0,x.up)("circuit-component"),c=(0,x.up)("draggable");return(0,x.wg)(),(0,x.j4)(c,{style:(0,C.j5)({outline:"none",pointerEvents:"none",zIndex:t.zIndex}),position:t.item.position,"is-selected":t.isSelected,"allow-touch-drag":t.isSelected,onResize:t.onResize,onKeydown:(0,I.D2)(t.onEscapeKey,["esc"]),onDrag:t.onDrag,onDragStart:t.onDragStart,onContextmenu:t.onContextMenu,onDblclick:t.revealCustomCircuit,onTouchhold:t.revealCustomCircuit,onDragEnd:t.store.commitCachedState,onSelect:e[1]||(e[1]=e=>t.store.selectItem(t.id,e)),onDeselect:e[2]||(e[2]=e=>t.store.deselectItem(t.id)),ref:"itemRef","data-test":"item"},{default:(0,x.w5)((()=>[t.isPropertiesEnabled?((0,x.wg)(),(0,x.j4)(r,{key:0,properties:t.item.properties,id:t.id,viewport:t.viewport,onUpdate:t.store.setProperties,onFocus:e[0]||(e[0]=e=>t.store.setActivePortId(null)),onPan:t.store.panDelta,"aria-label":"Properties dialog","data-test":"properties"},null,8,["properties","id","viewport","onUpdate","onPan"])):(0,x.kq)("",!0),(0,x.Wm)(l,{type:t.item.type,subtype:t.item.subtype,name:t.item.name,ports:t.ports,properties:t.item.properties,"is-selected":t.isSelected,flash:t.flash,style:(0,C.j5)({transform:`rotate(${90*t.item.rotation}deg)`}),onSignal:t.store.setPortValue},(0,x.Nv)({_:2},[(0,x.Ko)(4,((e,o)=>({name:o,fn:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.ports.filter((t=>t.orientation===o)),(e=>((0,x.wg)(),(0,x.j4)(a,{tabindex:0,store:t.$props.store,id:e.id,key:`${e.id}_${t.portUpdates}`,title:e.name,type:e.type,position:e.position,orientation:e.orientation+t.item.rotation,"connected-port-ids":e.connectedPortIds,hue:e.isMonitored?e.hue:0,rotation:t.item.rotation,onKeypress:(0,I.D2)(t.onEscapeKey,["esc"]),onFocus:o=>t.store.setActivePortId(e.id),onBlur:o=>t.onPortBlur(e.id),onDeselect:t.focus,"data-test":"port-item"},null,8,["store","id","title","type","position","orientation","connected-port-ids","hue","rotation","onKeypress","onFocus","onBlur","onDeselect"])))),128))]))})))]),1032,["type","subtype","name","ports","properties","is-selected","flash","style","onSignal"])])),_:1},8,["style","position","is-selected","allow-touch-drag","onResize","onKeydown","onDrag","onDragStart","onContextmenu","onDblclick","onTouchhold","onDragEnd"])}function Xe(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(["circuit-component",{"circuit-component--selected":t.isSelected,"circuit-component--flash":t.flash,"circuit-component--custom":t.subtype===t.ItemSubtype.CustomCircuit}])},[((0,x.wg)(),(0,x.j4)((0,x.LL)(t.type),(0,x.dG)(t.$props,{onSignal:t.onChange}),null,16,["onSignal"])),t.type!==t.ItemType.Freeport?((0,x.wg)(),(0,x.iD)(x.HY,{key:0},(0,x.Ko)(["left","top","right","bottom"],((e,o)=>(0,x._)("div",{key:o,class:(0,C.C_)([`circuit-component__ports--${e}`,"circuit-component__ports"])},[(0,x.WI)(t.$slots,o)],2))),64)):(0,x.kq)("",!0)],2)}function Je(t,e,o,n,i,s){const r=(0,x.up)("port-handle");return(0,x.wg)(),(0,x.j4)(r)}var Qe=(0,x.aZ)({name:"Freeport",components:{PortHandle:U}});const to=(0,F.Z)(Qe,[["render",Je]]);var eo=to;const oo={class:"input-node"},no={key:0},io={key:1},so={key:2};function ro(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",oo,[(0,x._)("button",{type:"button",class:(0,C.C_)(["input-node__flipper",{"input-node__flipper--on":1===t.model,"input-node__flipper--off":-1===t.model,"input-node__flipper--high-z":0===t.model}]),tabindex:0,onMousedown:e[0]||(e[0]=(0,I.iM)(((...e)=>t.onInput&&t.onInput(...e)),["stop"])),onTouchstart:e[1]||(e[1]=(0,I.iM)(((...e)=>t.onInput&&t.onInput(...e)),["stop"]))},[1===t.model?((0,x.wg)(),(0,x.iD)("span",no,"ON")):-1===t.model?((0,x.wg)(),(0,x.iD)("span",io,"OFF")):((0,x.wg)(),(0,x.iD)("span",so,"?"))],34)])}var ao=(0,x.aZ)({name:"InputNode",props:{ports:{type:Array,default:()=>[]}},emits:{signal:t=>!0},setup(t,{emit:e}){const o=(0,O.iH)(0);function n(n){n.preventDefault(),n.stopPropagation(),o.value=1===o.value?-1:1,e("signal",{id:t.ports[0].id,value:o.value})}return(0,x.m0)((()=>{o.value=t.ports[0]?.value||0})),{model:o,onInput:n}}});const lo=(0,F.Z)(ao,[["render",ro]]);var co=lo;function uo(t,e,o,n,i,s){return(0,x.wg)(),(0,x.j4)((0,x.LL)(t.subtype),(0,C.vs)((0,x.F4)(t.$props)),null,16)}const po={class:"custom-circuit"},ho={class:"custom-circuit__center"},mo={class:"custom-circuit__name"};function go(t,e,o,n,i,s){const r=(0,x.up)("custom-circuit-port-zone");return(0,x.wg)(),(0,x.iD)("div",po,[(0,x.Wm)(r,{ports:t.ports.filter((t=>1===t.orientation)),orientation:"horizontal",type:"top"},null,8,["ports"]),(0,x._)("div",ho,[(0,x.Wm)(r,{ports:t.ports.filter((t=>0===t.orientation)),orientation:"vertical",type:"left"},null,8,["ports"]),(0,x._)("div",mo,(0,C.zw)(t.name),1),(0,x.Wm)(r,{ports:t.ports.filter((t=>2===t.orientation)),orientation:"vertical",type:"right"},null,8,["ports"])]),(0,x.Wm)(r,{ports:t.ports.filter((t=>3===t.orientation)),orientation:"horizontal",type:"bottom"},null,8,["ports"])])}function fo(t,e,o,n,i,s){const r=(0,x.up)("custom-circuit-port");return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(`custom-circuit-port-zone custom-circuit-port-zone--${t.orientation}`)},[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.ports,(e=>((0,x.wg)(),(0,x.iD)("div",{key:e.id,class:(0,C.C_)([`custom-circuit-port-zone__io--${t.type}`,"custom-circuit-port-zone__io"])},[(0,x.Wm)(r,{label:e.name,type:t.type},null,8,["label","type"])],2)))),128))],2)}const vo={class:"custom-circuit-port"},bo={class:"custom-circuit-port__label"};function yo(t,e,o,n,i,s){const r=(0,x.up)("port-wire");return(0,x.wg)(),(0,x.iD)("div",vo,[(0,x._)("div",bo,(0,C.zw)(t.label),1),(0,x.Wm)(r,{type:t.type},null,8,["type"])])}var wo=(0,x.aZ)({name:"CustomCircuitPort",components:{PortWire:K},props:{label:{type:String,default:""},type:{type:String,required:!0}}});const Io=(0,F.Z)(wo,[["render",yo]]);var xo=Io,Co=(0,x.aZ)({name:"CustomCircuitPortZone",components:{CustomCircuitPort:xo},props:{ports:{type:Array,default:()=>[]},orientation:{type:String,required:!0},type:{type:String,required:!0}}});const So=(0,F.Z)(Co,[["render",fo]]);var _o=So,Do=(0,x.aZ)({name:"CustomCircuit",components:{CustomCircuitPortZone:_o},props:{ports:{type:Array,default:()=>[]},name:{type:String,default:"circuit"}}});const Oo=(0,F.Z)(Do,[["render",go]]);var Po=Oo;const Zo={class:"digit"},ko={width:"58",height:"98"},Mo=["d"];function Bo(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",Zo,[((0,x.wg)(),(0,x.iD)("svg",ko,[(0,x._)("g",null,[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.segments,((t,e)=>((0,x.wg)(),(0,x.iD)("path",{key:e,style:(0,C.j5)(t.style),d:t.path},null,12,Mo)))),128))])]))])}const Eo={" ":[0,0,0,0,0,0,0],0:[1,1,1,1,1,1,0],1:[0,0,1,1,0,0,0],2:[0,1,1,0,1,1,1],3:[0,1,1,1,1,0,1],4:[1,0,1,1,0,0,1],5:[1,1,0,1,1,0,1],6:[1,1,0,1,1,1,1],7:[0,1,1,1,0,0,0],8:[1,1,1,1,1,1,1],9:[1,1,1,1,0,0,1],a:[1,1,1,1,0,1,1],b:[1,0,0,1,1,1,1],c:[1,1,0,0,1,1,0],d:[0,0,1,1,1,1,1],e:[1,1,0,0,1,1,1],f:[1,1,0,0,0,1,1]},zo=["M 8,10 L 12,14 L 12,42 L 8,46 L 4,42 L 4,14 L 8,10 z","M 10,8 L 14,4 L 42,4 L 46,8 L 42,12 L 14,12 L 10,8 z","M 48,10 L 52,14 L 52,42 L 48,46 L 44,42 L 44,14 L 48,10 z","M 48,50 L 52,54 L 52,82 L 48,86 L 44,82 L 44,54 L 48,50 z","M 10,88 L 14,84 L 42,84 L 46,88 L 42,92 L 14,92 L 10,88 z","M 8,50 L 12,54 L 12,82 L 8,86 L 4,82 L 4,54 L 8,50 z","M 10,48 L 14,44 L 42,44 L 46,48 L 42,52 L 14,52 L 10,48 z"];var No=(0,x.aZ)({name:"DigitDisplay",props:{ports:{type:Array,default:()=>[]}},setup(t){const e=(0,x.Fl)((()=>{const e=t.ports.map((t=>1===t.value?1:0)).join(""),o=parseInt(e,2).toString(16).toLowerCase();return Eo[o].map(((t,e)=>{const o=t?"on":"bg-tertiary";return{path:zo[e],style:{fill:`var(--color-${o})`}}}))}));return{segments:e}}});const jo=(0,F.Z)(No,[["render",Bo]]);var To=jo;const Fo={CustomCircuit:Po,DigitDisplay:To};var Lo=(0,x.aZ)({name:"IntegratedCircuit",components:Fo,props:{ports:{type:Array,default:()=>[]},subtype:{type:String,required:!0},name:{type:String,default:""}}});const Wo=(0,F.Z)(Lo,[["render",uo]]);var $o=Wo;const Vo=(0,x._)("div",{class:"logic-gate__wire"},null,-1),Ro={key:0,class:"logic-gate__wires--multiwire"},Ao=(0,x._)("div",{class:"logic-gate__wires-divider"},[(0,x._)("div",{class:"logic-gate__wire"})],-1);function Uo(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{style:(0,C.j5)({height:25*t.inputCount+"px"}),class:"logic-gate"},[(0,x._)("div",{style:(0,C.j5)({width:(t.inputCount,"100%")}),class:"logic-gate__wires"},[(0,x._)("div",{class:(0,C.C_)([{"logic-gate__wires-divider--multiwire":t.inputCount>2},"logic-gate__wires-divider"])},[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.inputCount-1,(t=>((0,x.wg)(),(0,x.iD)("div",{key:t,class:"logic-gate__wire"})))),128)),Vo],2),t.inputCount>2?((0,x.wg)(),(0,x.iD)("div",Ro)):(0,x.kq)("",!0),Ao],4),((0,x.wg)(),(0,x.j4)((0,x.LL)(t.subtype),{class:"logic-gate__component"}))],4)}const qo={class:"and",width:"100",height:"50",viewBox:"0 -1 100 50"},Ho=(0,x._)("path",{transform:"translate(20, 0)",class:"and__element",d:"M 0 0 V 48 H 24 C 36 48 48 36 48 24 C 48 12 36 0 24 0 Z"},null,-1),Go={key:0,cx:"73",cy:"24",r:"5",class:"and__negation"};function Yo(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("svg",qo,[Ho,t.isNegated?((0,x.wg)(),(0,x.iD)("circle",Go)):(0,x.kq)("",!0)])}var Ko=(0,x.aZ)({name:"And",props:{isNegated:{type:Boolean,default:!1}}});const Xo=(0,F.Z)(Ko,[["render",Yo]]);var Jo=Xo;const Qo={width:"100",height:"50",viewBox:"0 -1 100 50",class:"or"},tn=(0,x._)("path",{transform:"translate(10, 0)",fill:"#fff",d:"M 0 0 C 12 12 12 36 0 48 H 0 H 24 C 48 48 60 36 72 24 C 60 12 48 0 24 0 Z",class:"or__element"},null,-1),en={key:0,fill:"none",d:"M 0 0 C 12 12 12 36 0 48",class:"or__tail"},on={key:1,cx:"88",cy:"24",r:"5",class:"or__negation"};function nn(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("svg",Qo,[tn,t.isXor?((0,x.wg)(),(0,x.iD)("path",en)):(0,x.kq)("",!0),t.isNegated?((0,x.wg)(),(0,x.iD)("circle",on)):(0,x.kq)("",!0)])}var sn=(0,x.aZ)({name:"Or",props:{isNegated:{type:Boolean,default:!1},isXor:{type:Boolean,default:!1}}});const rn=(0,F.Z)(sn,[["render",nn]]);var an=rn;function ln(t,e,o,n,i,s){const r=(0,x.up)("or");return(0,x.wg)(),(0,x.j4)(r,{"is-negated":!0})}var cn=(0,x.aZ)({name:"Nor",components:{Or:an}});const un=(0,F.Z)(cn,[["render",ln]]);var dn=un;function pn(t,e,o,n,i,s){const r=(0,x.up)("buffer");return(0,x.wg)(),(0,x.j4)(r,{"is-negated":!0})}const hn={class:"buffer",width:"100",height:"50",viewBox:"0 -1 100 50"},mn=(0,x._)("path",{class:"buffer__element",transform:"translate(40, 0)",stroke:"#000","stroke-width":"2",fill:"#fff",d:"M 0 0 V 48 L 36 24 Z"},null,-1),gn={key:0,class:"buffer__negation",stroke:"#000","stroke-width":"2",cx:"88",cy:"24",r:"5",fill:"#fff"};function fn(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("svg",hn,[mn,t.isNegated?((0,x.wg)(),(0,x.iD)("circle",gn)):(0,x.kq)("",!0)])}var vn=(0,x.aZ)({name:"Buffer",props:{isNegated:{type:Boolean,default:!1}}});const bn=(0,F.Z)(vn,[["render",fn]]);var yn=bn,wn=(0,x.aZ)({name:"Not",components:{Buffer:yn}});const In=(0,F.Z)(wn,[["render",pn]]);var xn=In;function Cn(t,e,o,n,i,s){const r=(0,x.up)("and");return(0,x.wg)(),(0,x.j4)(r,{"is-negated":!0})}var Sn=(0,x.aZ)({name:"Nand",components:{And:Jo}});const _n=(0,F.Z)(Sn,[["render",Cn]]);var Dn=_n;function On(t,e,o,n,i,s){const r=(0,x.up)("or");return(0,x.wg)(),(0,x.j4)(r,{"is-negated":!0,"is-xor":!0})}var Pn=(0,x.aZ)({name:"Xnor",components:{Or:an}});const Zn=(0,F.Z)(Pn,[["render",On]]);var kn=Zn;function Mn(t,e,o,n,i,s){const r=(0,x.up)("or");return(0,x.wg)(),(0,x.j4)(r,{"is-xor":!0})}var Bn=(0,x.aZ)({name:"Xor",components:{Or:an}});const En=(0,F.Z)(Bn,[["render",Mn]]);var zn=En,Nn=(0,x.aZ)({name:"LogicGate",components:{And:Jo,Or:an,Nor:dn,Not:xn,Nand:Dn,Xnor:kn,Xor:zn},props:{properties:{type:Object,default:()=>({})},subtype:{subtype:String,required:!0}},setup(t){const e=(0,x.Fl)((()=>t.properties.inputCount?.value||2));return{inputCount:e}}});const jn=(0,F.Z)(Nn,[["render",Uo]]);var Tn=jn;function Fn(t,e,o,n,i,s){return(0,x.wg)(),(0,x.j4)((0,x.LL)(t.subtype),(0,C.vs)((0,x.F4)(t.$props)),null,16)}const Ln=["title"];function Wn(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(["lightbulb",`lightbulb--${t.modifier}`]),title:t.ports[0]?.value},null,10,Ln)}var $n=(0,x.aZ)({name:"Lightbulb",props:{ports:{type:Array,default:()=>[]}},setup(t){const e=(0,x.Fl)((()=>{switch(t.ports[0]?.value){case 1:return"on";case-1:return"off";default:return"high-z"}}));return{modifier:e}}});const Vn=(0,F.Z)($n,[["render",Wn]]);var Rn=Vn;const An={Lightbulb:Rn};var Un=(0,x.aZ)({name:"OutputNode",components:An,props:{ports:{type:Array,default:()=>[]},subtype:{type:String,required:!0}}});const qn=(0,F.Z)(Un,[["render",Fn]]);var Hn=qn;const Gn={Freeport:eo,InputNode:co,IntegratedCircuit:$o,LogicGate:Tn,OutputNode:Hn};var Yn=(0,x.aZ)({name:"CircuitComponent",components:Gn,emits:{signal:t=>!0},props:{isSelected:{type:Boolean,default:!1},flash:{type:Boolean,default:!1},type:{type:String,required:!0},subtype:{type:String,required:!0},name:{type:String,default:""},ports:{type:Array,default:()=>[]},properties:{type:Object,default:()=>({})}},setup(t,{emit:e}){return{onChange(t){e("signal",t)},ItemType:dt,ItemSubtype:gt}}});const Kn=(0,F.Z)(Yn,[["render",Xe]]);var Xn=Kn;const Jn=["aria-hidden"],Qn={class:"properties__heading",role:"title"},ti=(0,x.Uk)(" Properties "),ei=["for"],oi=["onUpdate:modelValue","id"],ni=["value"],ii=["onUpdate:modelValue","id"],si=["onUpdate:modelValue","min","max","type","id"];function ri(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.iD)("div",{onContextmenu:e[3]||(e[3]=(...e)=>t.stopPropagation&&t.stopPropagation(...e)),onMousedown:e[4]||(e[4]=(...e)=>t.stopPropagation&&t.stopPropagation(...e)),onMouseup:e[5]||(e[5]=(...e)=>t.stopPropagation&&t.stopPropagation(...e)),onKeydown:e[6]||(e[6]=(0,I.D2)(((...e)=>t.onKeyDown&&t.onKeyDown(...e)),["esc"])),class:"properties"},[t.isOpen?((0,x.wg)(),(0,x.iD)("div",{key:0,class:"properties__dialog",ref:"propertiesRef","aria-hidden":!t.isOpen},[(0,x._)("div",Qn,[ti,(0,x.Wm)(r,{tabindex:0,icon:t.faClose,onClick:t.close,role:"button",class:"properties__close"},null,8,["icon","onClick"])]),((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.model,((o,n)=>((0,x.wg)(),(0,x.iD)("div",{key:n,class:"properties__entry"},[(0,x._)("label",{for:`${t.id}_${n}`,class:"properties__label"},(0,C.zw)(o.label),9,ei),o.options?(0,x.wy)(((0,x.wg)(),(0,x.iD)("select",{key:0,"onUpdate:modelValue":t=>o.value=t,id:`${t.id}_${n}`,class:"properties__input",onChange:e[0]||(e[0]=(...e)=>t.onChange&&t.onChange(...e))},[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(o.options,((t,e)=>((0,x.wg)(),(0,x.iD)("option",{key:e,value:t},(0,C.zw)(e),9,ni)))),128))],40,oi)),[[I.bM,o.value]]):"boolean"===o.type?(0,x.wy)(((0,x.wg)(),(0,x.iD)("input",{key:1,"onUpdate:modelValue":t=>o.value=t,id:`${t.id}_${n}`,type:"checkbox",class:"properties__input",onChange:e[1]||(e[1]=(...e)=>t.onChange&&t.onChange(...e))},null,40,ii)),[[I.e8,o.value]]):(0,x.wy)(((0,x.wg)(),(0,x.iD)("input",{key:2,"onUpdate:modelValue":t=>o.value=t,min:o.min,max:o.max,type:o.type,id:`${t.id}_${n}`,class:"properties__input",onChange:e[2]||(e[2]=(...e)=>t.onChange&&t.onChange(...e))},null,40,si)),[[I.YZ,o.value]])])))),128))],8,Jn)):((0,x.wg)(),(0,x.j4)(r,{key:1,onKeydown:(0,I.D2)(t.openProperties,["space"]),onClick:t.openProperties,tabindex:0,icon:t.faWrench,class:"properties__icon"},null,8,["onKeydown","onClick","icon"]))],32)}var ai=(0,x.aZ)({name:"Properties",components:{Icon:Tt},props:{properties:{type:Object,default:()=>({})},id:{type:String,default:""},viewport:{type:Object,required:!0}},emits:{update:(t,e)=>!0,pan:(t,e)=>!0},setup(t,{emit:e}){const o=(0,O.iH)(),n=(0,O.iH)(!1),i=(0,O.iH)(lt()(t.properties));function s(t){n.value=!1,t.preventDefault()}function r(t){s(t),o.value?.focus()}function a(t){t.stopPropagation()}function l(){e("update",t.id,i.value)}function c(){n.value=!0,(0,x.Y3)((()=>{if(!o.value)return;const{bottom:n,right:i}=o.value.getBoundingClientRect(),s=Math.max(i-t.viewport.right,0),r=Math.max(n-t.viewport.bottom,0);(s>0||r>0)&&e("pan",{x:-s,y:-r},!0)}))}return(0,x.YP)(t.properties,(t=>{i.value=lt()(t)}),{deep:!0}),{faClose:D.YIN,faWrench:D.klh,model:i,isOpen:n,propertiesRef:o,close:s,onKeyDown:r,onChange:l,openProperties:c,stopPropagation:a}}});const li=(0,F.Z)(ai,[["render",ri]]);var ci=li;function ui(t,e,o,n,i,s){const r=(0,x.up)("port-handle"),a=(0,x.up)("draggable"),l=(0,x.up)("port-pivot");return(0,x.wg)(),(0,x.j4)(l,{rotation:t.rotation,onBlur:t.onBlur,onKeydown:[(0,I.D2)(t.onEscapeKey,["esc"]),e[0]||(e[0]=(0,I.D2)((e=>t.store.cycleConnectionPreviews(t.id)),["space"])),(0,I.D2)(t.store.commitPreviewedConnection,["enter"])],onResize:t.onResize,onContextmenu:e[1]||(e[1]=e=>t.store.setActivePortId(t.id))},{default:(0,x.w5)((()=>[t.isFreeport?((0,x.wg)(),(0,x.j4)(r,{key:1,type:t.type,hue:t.hue,active:t.store.activePortId===t.id||t.store.connectablePortIds.includes(t.id)},null,8,["type","hue","active"])):((0,x.wg)(),(0,x.j4)(a,{key:0,onDragStart:t.onDragStart,onDrag:t.onDrag,onDragEnd:t.onDragEnd,onTouchhold:t.onTouchHold,onDblclick:t.onDoubleClick,tabindex:-1},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{type:t.type,hue:t.hue,active:t.store.activePortId===t.id||t.store.connectablePortIds.includes(t.id),"touch-friendly":""},null,8,["type","hue","active"])])),_:1},8,["onDragStart","onDrag","onDragEnd","onTouchhold","onDblclick"]))])),_:1},8,["rotation","onBlur","onKeydown","onResize"])}function di(t,e,o,n,i,s){const r=(0,x.up)("resizable");return(0,x.wg)(),(0,x.j4)(r,{class:"port-pivot",style:(0,C.j5)({transform:`rotate(-${90*t.rotation}deg)`}),onKeydown:e[0]||(e[0]=(0,I.D2)((e=>t.$emit("connect")),["space"]))},{default:(0,x.w5)((()=>[(0,x.WI)(t.$slots,"default")])),_:3},8,["style"])}var pi=(0,x.aZ)({name:"PortPivot",components:{Resizable:Ce},props:{rotation:{type:Number,default:0}}});const hi=(0,F.Z)(pi,[["render",di]]);var mi=hi,gi=(0,x.aZ)({name:"PortItem",components:{PortHandle:U,PortPivot:mi,Draggable:De,Resizable:Ce},props:{id:{type:String,default:""},rotation:{type:Number,default:0},position:{type:Object,default:()=>({x:0,y:0})},isFreeport:{type:Boolean,default:!1},type:{type:Number,default:0},orientation:{type:Number,default:0},hue:{type:Number,default:0},connectedPortIds:{type:Object,default:[]},store:{type:Function,required:!0}},setup(t,{emit:e}){const o=t.store(),n=Jt.Radial;let i=null,s="",r=!1;function a(t){t.preventDefault(),t.stopPropagation(),e("deselect",t)}function l(){o.unsetConnectionPreview(),o.cachedState=null}function c(){i={itemId:(0,ct.Z)()},s=(0,ct.Z)(),r=!1,t.type===et.Input?(i.outputPortId=s,i.targetId=t.id):(i.inputPortId=s,i.sourceId=t.id)}function u({x:e,y:n}){null!==i&&(r||(o.createFreeport(i,!1),o.setConnectablePortIds({portId:t.id,isDragging:!0}),o.setSnapBoundaries(s)),o.dragItem(i.itemId,{x:e,y:n},Jt.Radial))}function d(){null!==i&&(i.inputPortId?o.connectFreeport({portId:i.inputPortId,sourceId:t.id}):i.outputPortId&&o.connectFreeport({portId:i.outputPortId,targetId:t.id}))}function p(e){e.stopPropagation(),e.preventDefault(),navigator.vibrate(100),o.togglePortMonitoring(t.id)}function h(e){o.setPortRelativePosition(e,t.id)}function m(e){e.stopPropagation(),e.preventDefault(),o.togglePortMonitoring(t.id)}return{store:o,snapMode:n,onDragStart:c,onDrag:u,onDragEnd:d,onEscapeKey:a,onBlur:l,onTouchHold:p,onResize:h,onDoubleClick:m,PortType:et}}});const fi=(0,F.Z)(gi,[["render",ui]]);var vi=fi,bi=JSON.parse('{"groups":{},"connections":{"switch1_nor1_conn":{"id":"switch1_nor1_conn","connectionChainId":"switch1_nor1_conn","source":"switchOutputPort1","target":"nor1InputPort1","isSelected":false,"groupId":null,"zIndex":7},"switch2_nor2_conn":{"id":"switch2_nor2_conn","connectionChainId":"switch2_nor2_conn","source":"switchOutputPort2","target":"nor2InputPort1","isSelected":false,"groupId":null,"zIndex":8},"nor1_nor2_conn":{"id":"nor1_nor2_conn","connectionChainId":"nor1_nor2_conn","source":"nor1OutputPort1","target":"nor2InputPort2","isSelected":false,"groupId":null,"zIndex":9},"nor2_nor1_conn":{"id":"nor2_nor1_conn","connectionChainId":"nor2_nor1_conn","source":"nor2OutputPort1","target":"nor1InputPort2","isSelected":false,"groupId":null,"zIndex":10},"nor1_lightbulb1_conn":{"id":"nor1_lightbulb1_conn","connectionChainId":"nor1_lightbulb1_conn","source":"nor1OutputPort1","target":"lightbulbInputPort1","isSelected":false,"groupId":null,"zIndex":11},"nor2_lightbulb2_conn":{"id":"nor2_lightbulb2_conn","connectionChainId":"nor2_lightbulb2_conn","source":"nor2OutputPort1","target":"lightbulbInputPort2","isSelected":false,"groupId":null,"zIndex":12}},"ports":{"nor1InputPort1":{"id":"nor1InputPort1","elementId":"nor1","name":"Input Port 1","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"nor1InputPort2":{"id":"nor1InputPort2","elementId":"nor1","name":"Input Port 2","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"nor1OutputPort1":{"id":"nor1OutputPort1","elementId":"nor1","name":"Output Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":0,"rotation":0,"orientation":2,"value":0,"isFreeport":false},"nor2InputPort1":{"id":"nor2InputPort1","elementId":"nor2","name":"Input Port 1","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"nor2InputPort2":{"id":"nor2InputPort2","elementId":"nor2","name":"Input Port 2","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"nor2OutputPort1":{"id":"nor2OutputPort1","elementId":"nor2","name":"Output Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":0,"rotation":0,"orientation":2,"value":0,"isFreeport":false},"switchOutputPort1":{"id":"switchOutputPort1","elementId":"switch1","name":"Output Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":0,"rotation":0,"orientation":2,"value":0,"isFreeport":false},"switchOutputPort2":{"id":"switchOutputPort2","elementId":"switch2","name":"Output Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":0,"rotation":0,"orientation":2,"value":0,"isFreeport":false},"lightbulbInputPort1":{"id":"lightbulbInputPort1","elementId":"lightbulb1","name":"Input Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false},"lightbulbInputPort2":{"id":"lightbulbInputPort2","elementId":"lightbulb2","name":"Input Port","connectedPortIds":[],"position":{"x":0,"y":0},"type":1,"rotation":0,"orientation":0,"value":0,"isFreeport":false}},"items":{"nor1":{"id":"nor1","type":"LogicGate","subtype":"Nor","portIds":["nor1InputPort1","nor1InputPort2","nor1OutputPort1"],"position":{"x":300,"y":300},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"inputCount":{"label":"Input count","value":2,"type":"number","min":2}},"groupId":null,"zIndex":1,"width":100,"height":150},"nor2":{"id":"nor2","type":"LogicGate","subtype":"Nor","portIds":["nor2InputPort2","nor2InputPort1","nor2OutputPort1"],"position":{"x":300,"y":500},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"inputCount":{"label":"Input count","value":2,"type":"number","min":2}},"groupId":null,"zIndex":2,"width":120,"height":51},"switch1":{"id":"switch1","type":"InputNode","subtype":"Clock","portIds":["switchOutputPort1"],"position":{"x":100,"y":300},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"name":{"label":"Name","value":"","type":"text"},"interval":{"label":"Interval","value":1000,"type":"number","min":100,"step":100},"startValue":{"label":"Start value","value":-1,"type":"number","options":{"True":1,"Hi-Z":0,"False":-1}}},"groupId":null,"zIndex":3,"width":40,"height":40},"switch2":{"id":"switch2","type":"InputNode","subtype":"Switch","portIds":["switchOutputPort2"],"position":{"x":100,"y":500},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"name":{"label":"Name","value":"","type":"text"},"startValue":{"label":"Start value","value":1,"type":"number","options":{"True":1,"Hi-Z":0,"False":-1}}},"groupId":null,"zIndex":4,"width":40,"height":40},"lightbulb1":{"id":"lightbulb1","type":"OutputNode","subtype":"Lightbulb","portIds":["lightbulbInputPort1"],"position":{"x":700,"y":300},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"name":{"label":"Name","value":"","type":"text"}},"groupId":null,"zIndex":5,"width":40,"height":40},"lightbulb2":{"id":"lightbulb2","type":"OutputNode","subtype":"Lightbulb","portIds":["lightbulbInputPort2"],"position":{"x":700,"y":500},"boundingBox":{"left":0,"top":0,"right":0,"bottom":0},"rotation":0,"isSelected":false,"properties":{"name":{"label":"Name","value":"","type":"text"}},"groupId":null,"zIndex":6,"width":40,"height":40}}}'),yi=o(2482);class wi{constructor(t,e){(0,yi.Z)(this,"node",void 0),(0,yi.Z)(this,"id",void 0),this.node=t,this.id=e}}var Ii=wi;const xi={TRUE:1,FALSE:-1,UNKNOWN:0};var Ci=xi;class Si{constructor(t,e=[]){(0,yi.Z)(this,"inputValues",{}),(0,yi.Z)(this,"outputs",[]),(0,yi.Z)(this,"isValueChanged",!0),(0,yi.Z)(this,"forceContinue",!1),(0,yi.Z)(this,"name",void 0),(0,yi.Z)(this,"value",Ci.UNKNOWN),(0,yi.Z)(this,"newValue",Ci.UNKNOWN),(0,yi.Z)(this,"events",[]),(0,yi.Z)(this,"setValue",(t=>{this.newValue=t})),(0,yi.Z)(this,"invokeEvent",((t,e,o)=>{this.events.forEach((n=>{n.eventType===t&&n.callback(e,o)}))})),(0,yi.Z)(this,"eval",(()=>this.value)),(0,yi.Z)(this,"valueCount",(t=>Object.values(this.inputValues).filter((e=>e===t)).length)),(0,yi.Z)(this,"updateOutputs",(t=>{const e=[];this.outputs.forEach((({node:o,id:n})=>{o.update(t,n),e.push(n)})),this.invokeEvent("change",t,e)})),(0,yi.Z)(this,"update",((t,e)=>{this.inputValues[e]=t,this.newValue=this.eval(),this.invokeEvent("change",this.newValue,this.outputs.map((({id:t})=>t)))})),(0,yi.Z)(this,"propagate",(()=>{let t=[];return this.value!==this.newValue&&(this.isValueChanged=!0,this.value=this.newValue,this.updateOutputs(this.newValue),this.outputs.forEach((({node:e})=>{e.forceContinue?t=t.concat(e.propagate()):t.push(e)}))),t})),(0,yi.Z)(this,"reset",(()=>{this.value=Ci.UNKNOWN,this.newValue=Ci.UNKNOWN,this.invokeEvent("change",this.newValue,this.outputs.map((({id:t})=>t)))})),(0,yi.Z)(this,"on",((t,e)=>{this.events.push({eventType:t,callback:e})})),(0,yi.Z)(this,"getProjectedValue",(()=>this.eval()||this.newValue||this.value)),this.name=t,this.inputValues=e.reduce(((t,e)=>({...t,[e]:Ci.UNKNOWN})),{})}}var _i=Si;class Di extends _i{constructor(...t){super(...t),(0,yi.Z)(this,"reset",(()=>{}))}}var Oi=Di;class Pi extends _i{constructor(...t){super(...t),(0,yi.Z)(this,"update",(t=>{this.newValue!==t&&(this.newValue=t,this.invokeEvent("change",this.newValue,[]))}))}}var Zi=Pi;class ki{constructor(){(0,yi.Z)(this,"queue",[]),(0,yi.Z)(this,"nodes",[]),(0,yi.Z)(this,"inputNodes",[]),(0,yi.Z)(this,"addNode",(t=>{t instanceof Oi&&(this.inputNodes.push(t),this.enqueue(t)),this.nodes.push(t)})),(0,yi.Z)(this,"removeNode",(t=>{if(t instanceof Oi){const e=this.inputNodes.findIndex((({name:e})=>e===t.name));-1!==e&&this.inputNodes.splice(e,1)}const e=this.nodes.findIndex((({name:e})=>e===t.name));-1!==e&&(this.removeNodeOutputs(t),this.nodes.splice(e,1)),this.next()})),(0,yi.Z)(this,"addConnection",((t,e,o,n=Ci.UNKNOWN)=>{t.outputs.push(new Ii(e,o)),t.value=n,n||this.enqueue(t)})),(0,yi.Z)(this,"removeConnection",((t,e,o=Ci.UNKNOWN)=>{t.outputs.concat().forEach((({node:n,id:i},s)=>{e===n&&(e.update(o,i),t.outputs.splice(s,1),this.enqueue(e))}))})),(0,yi.Z)(this,"removeNodeOutputs",(t=>{for(let e=0;e<t.outputs.length;e++)this.removeConnection(t,t.outputs[e].node)})),(0,yi.Z)(this,"enqueue",((...t)=>{t.forEach((t=>{~this.queue.indexOf(t)||this.queue.push(t)}))})),(0,yi.Z)(this,"dequeue",(t=>{const e=this.queue.indexOf(t);~e&&this.queue.splice(e,1)})),(0,yi.Z)(this,"reset",(()=>{this.nodes.forEach((t=>t.reset()))})),(0,yi.Z)(this,"next",(()=>{let t=!1,e=[];while(this.queue.length>0){const o=this.queue.shift();o&&(e=e.concat(o.propagate()),this.dequeue(o),o.isValueChanged&&(t=!0),o.forceContinue&&(this.enqueue(...e),e=[]))}t&&this.enqueue(...e)})),(0,yi.Z)(this,"isComplete",(()=>{let t=!0;return 0===this.queue.length||(this.queue.forEach((e=>{const o=e.getProjectedValue();o===e.value||e instanceof Zi||(t=!1)})),t&&(this.queue=[]),t)}))}}var Mi=ki;class Bi extends _i{constructor(...t){super(...t),(0,yi.Z)(this,"eval",(()=>this.valueCount(Ci.TRUE)?Ci.FALSE:this.valueCount(Ci.UNKNOWN)?Ci.UNKNOWN:Ci.TRUE))}}var Ei=Bi;class zi extends _i{constructor(...t){super(...t),(0,yi.Z)(this,"eval",(()=>this.valueCount(Ci.TRUE)?Ci.TRUE:this.valueCount(Ci.UNKNOWN)?Ci.UNKNOWN:Ci.FALSE))}}var Ni=zi;class ji extends _i{constructor(...t){super(...t),(0,yi.Z)(this,"forceContinue",!0),(0,yi.Z)(this,"update",(t=>{const e=Object.keys(this.inputValues).pop();e&&(this.inputValues[e]=t,this.newValue=this.eval())})),(0,yi.Z)(this,"eval",(()=>Object.values(this.inputValues).pop()||Ci.UNKNOWN))}}var Ti=ji;var Fi=o(4279);class Li{constructor(t,e,o,n){(0,yi.Z)(this,"id",void 0),(0,yi.Z)(this,"name",void 0),(0,yi.Z)(this,"width",0),(0,yi.Z)(this,"lastY",0),(0,yi.Z)(this,"segments",[]),(0,yi.Z)(this,"hue",0),(0,yi.Z)(this,"initialize",(t=>{const e={x:1,y:1};1===t?(e.y=0,this.lastY=1):(e.y=1,this.lastY=0),this.addSegment(e),this.updateWidth()})),(0,yi.Z)(this,"reset",(()=>{this.segments=[],this.width=0,this.initialize(1===this.lastY?0:1)})),(0,yi.Z)(this,"update",(t=>{this.drawPulseConstant()})),(0,yi.Z)(this,"addSegment",(t=>{const e=this.segments[this.segments.length-1];!e&&t.x>0?this.segments.push({x:0,y:t.y}):e&&e.x!==t.x&&e.y!==t.y&&this.segments.pop(),this.segments.push(t),this.updateWidth()})),(0,yi.Z)(this,"drawPulseChange",(t=>{const{x:e}=this.segments[this.segments.length-1],o=t===Ci.TRUE?0:1;this.updateWidth(),this.addSegment({x:e,y:o})})),(0,yi.Z)(this,"drawPulseConstant",(()=>{const t=this.segments[this.segments.length-1],e=this.lastY!==t.y?t:this.segments.pop();e&&(this.updateWidth(),this.addSegment({x:e.x+1,y:e.y})),this.lastY=t.y})),(0,yi.Z)(this,"truncateSegments",(t=>{if(t>this.width)return;const e=this.width-t;let o=0;for(let n=0;n<this.segments.length;n++){const{x:t,y:i}=this.segments[n];if(t>e){o=t-e,this.segments.splice(0,n),this.segments.unshift({x:0,y:i});break}}for(let n=1;n<this.segments.length;n++){const{x:t,y:o}=this.segments[n];this.segments[n]={x:t-e,y:o}}this.updateWidth()})),(0,yi.Z)(this,"updateWidth",(()=>{this.width=this.segments.slice(-1)[0]?.x||0})),this.id=t,this.name=e,this.hue=n,this.initialize(o)}}class Wi{constructor(t,e,o){(0,yi.Z)(this,"id",(0,ct.Z)()),(0,yi.Z)(this,"name",void 0),(0,yi.Z)(this,"signal",0),(0,yi.Z)(this,"interval",0),(0,yi.Z)(this,"lastUpdate",void 0),(0,yi.Z)(this,"emitter",new Fi.TinyEmitter),(0,yi.Z)(this,"isStopped",!1),(0,yi.Z)(this,"on",((t,e)=>{this.emitter.on(t,e)})),(0,yi.Z)(this,"stop",(()=>{this.isStopped=!0})),(0,yi.Z)(this,"start",(()=>{this.isStopped=!1})),(0,yi.Z)(this,"update",(t=>{!this.isStopped&&t>=this.lastUpdate+this.interval&&(this.signal=-1===this.signal?1:-1,this.lastUpdate=t,this.emitter.emit("change",this.signal))})),this.name=t,this.signal=o,this.interval=e,this.lastUpdate=-e}}class $i{constructor(){(0,yi.Z)(this,"isPaused",!0),(0,yi.Z)(this,"waves",{}),(0,yi.Z)(this,"refreshRate",20),(0,yi.Z)(this,"lastUpdateTime",Date.now()),(0,yi.Z)(this,"timeMsElapsed",0),(0,yi.Z)(this,"timeMsOffset",0),(0,yi.Z)(this,"emitter",new Fi.TinyEmitter),(0,yi.Z)(this,"start",(()=>{if(!this.isPaused)return;const t=this.lastUpdateTime%this.refreshRate;this.lastUpdateTime=Date.now()+t,this.isPaused=!1,this.tick()})),(0,yi.Z)(this,"stop",(()=>{this.isPaused=!0})),(0,yi.Z)(this,"clear",(()=>{Object.values(this.waves).forEach((t=>{t instanceof Li&&t.reset()}))})),(0,yi.Z)(this,"computeWaveGeometry",(t=>{const e={},o=t=>t.map((({x:t,y:e})=>`${t},${e}`));for(const n in t)if(t[n]instanceof Li){const i=t[n],s=o(i.segments);e[n]={points:s.join(" "),width:i.width,hue:i.hue}}return e})),(0,yi.Z)(this,"on",((t,e)=>{this.emitter.on(t,e)})),(0,yi.Z)(this,"broadcast",(()=>{const t=window.screen.width,e=1e3/this.refreshRate,o=t/e;this.timeMsElapsed>=this.timeMsOffset+o/2*1e3&&(this.timeMsOffset=this.timeMsElapsed,Object.values(this.waves).forEach((e=>{e instanceof Li&&e.truncateSegments(t)}))),this.emitter.emit("change",this.computeWaveGeometry(this.waves))})),(0,yi.Z)(this,"tick",(()=>{if(this.isPaused)return;const t=Date.now(),e=1e4;let o=!1;if(t>=this.lastUpdateTime+e)return this.stop(),void this.start();while(t>=this.lastUpdateTime+this.refreshRate){const e=Math.min(this.refreshRate,t-this.lastUpdateTime);o=!0,this.timeMsElapsed+=e,this.lastUpdateTime+=e,this.update()}o&&this.broadcast(),requestAnimationFrame(this.tick)})),(0,yi.Z)(this,"update",(()=>{Object.values(this.waves).forEach((t=>t.update(this.timeMsElapsed)))})),(0,yi.Z)(this,"add",(t=>{this.waves.hasOwnProperty(t.id)||(this.waves[t.id]=t,0===this.timeMsElapsed&&this.broadcast())})),(0,yi.Z)(this,"remove",(({id:t})=>{delete this.waves[t],0===Object.keys(this.waves).length&&(this.stop(),this.clear())}))}}class Vi extends _i{constructor(...t){super(...t),(0,yi.Z)(this,"eval",(()=>Object.values(this.inputValues).reduce(((t,e)=>t&&e===Ci.TRUE),!0)?Ci.TRUE:Ci.FALSE))}}var Ri=Vi;class Ai extends _i{constructor(...t){super(...t),(0,yi.Z)(this,"eval",(()=>Object.values(this.inputValues).reduce(((t,e)=>t||e===Ci.FALSE),!1)?Ci.TRUE:Ci.FALSE))}}var Ui=Ai;class qi extends _i{constructor(...t){super(...t),(0,yi.Z)(this,"eval",(()=>{const t=Object.values(this.inputValues).pop();switch(t){case Ci.TRUE:return Ci.FALSE;case Ci.FALSE:return Ci.TRUE;default:return Ci.UNKNOWN}}))}}var Hi=qi;function Gi(t,e,o){switch(t){case gt.And:return new Ri(e,o);case gt.Nand:return new Ui(e,o);case gt.Or:return new Ni(e,o);case gt.Nor:return new Ei(e,o);case gt.Not:return new Hi(e,o);default:return new Ei(e,o)}}function Yi({id:t,type:e,subtype:o},n){switch(e){case dt.CircuitNode:return new _i(t,n);case dt.InputNode:return new Oi(t,n);case dt.LogicGate:return Gi(o,t,n);case dt.Buffer:case dt.Freeport:return new Ti(t,n);default:return new Zi(t,n)}}var Ki={getLogicGateNode:Gi,getCircuitNode:Yi};class Xi{constructor(t,e,o){(0,yi.Z)(this,"nodes",{}),(0,yi.Z)(this,"waves",{}),(0,yi.Z)(this,"clocks",{}),(0,yi.Z)(this,"valueMap",{}),(0,yi.Z)(this,"circuit",new Mi),(0,yi.Z)(this,"oscillator",new $i),(0,yi.Z)(this,"emitter",new Fi.TinyEmitter),(0,yi.Z)(this,"oscillogram",{}),(0,yi.Z)(this,"canContinue",!1),(0,yi.Z)(this,"nextState",null),(0,yi.Z)(this,"isDebug",!1),(0,yi.Z)(this,"nextValueMap",{}),(0,yi.Z)(this,"addElements",((t,e,o)=>{t.forEach((t=>this.addNode(t,o))),e.forEach((t=>this.addConnection(t.source,t.target)))})),(0,yi.Z)(this,"onChange",(t=>{this.emitter.on("change",t)})),(0,yi.Z)(this,"onError",(t=>{this.emitter.on("error",t)})),(0,yi.Z)(this,"emit",(()=>{this.emitter.emit("change",this.valueMap)})),(0,yi.Z)(this,"step",((t=0)=>{this.circuit.next();const e=this.circuit.queue.length>0;t>1e3&&this.emitter.emit("error","INFINITE_LOOP"),e&&this.step(++t),this.isDebug||this.emit()})),(0,yi.Z)(this,"toggleClocks",(t=>{Object.values(this.clocks).forEach((e=>e[t]()))})),(0,yi.Z)(this,"start",(()=>{this.isDebug||this.toggleClocks("start"),this.oscillator.start()})),(0,yi.Z)(this,"stop",(()=>{this.toggleClocks("stop"),this.oscillator.stop()})),(0,yi.Z)(this,"startDebugging",(()=>{this.isDebug=!0,this.computeNextState(),this.toggleClocks("stop")})),(0,yi.Z)(this,"stopDebugging",(()=>{this.isDebug=!1,this.advanceDebuggerStep(),this.nextState=null,this.toggleClocks("start")})),(0,yi.Z)(this,"advanceDebuggerStep",(()=>{if(!this.isDebug)return this.step();const t=Object.keys(this.nextValueMap);t.length>0?t.forEach((t=>this.updatePortValue(t,this.nextValueMap[t]))):this.nextState&&(this.valueMap=JSON.parse(this.nextState)),this.nextValueMap={},this.computeNextState(),this.emit()})),(0,yi.Z)(this,"computeNextState",(()=>{const t=JSON.stringify(this.valueMap);this.circuit.next();const e=JSON.stringify(this.valueMap);this.nextState=t!==e?e:null,this.canContinue=null!==this.nextState})),(0,yi.Z)(this,"updatePortValue",((t,e)=>{this.nodes[t].setValue(e),this.circuit.enqueue(this.nodes[t]),this.waves[t]?.drawPulseChange(e)})),(0,yi.Z)(this,"enqueuePortValueChange",((t,e)=>{this.nextValueMap[t]=e,this.canContinue=Object.keys(this.nextValueMap).reduce(((t,e)=>t||this.valueMap[e]!==this.nextValueMap[e]),!1)})),(0,yi.Z)(this,"setPortValue",((t,e)=>{if(this.isDebug)return this.enqueuePortValueChange(t,e);this.nodes[t]&&this.nodes[t].value!==e&&(this.updatePortValue(t,e),this.step())})),(0,yi.Z)(this,"addIntegratedCircuit",(t=>{if(!t.integratedCircuit)return;const{items:e,connections:o,ports:n}=t.integratedCircuit;Object.values(e).forEach((t=>{this.addNode(t,n)})),Object.values(o).forEach((t=>{this.addConnection(t.source,t.target)}))})),(0,yi.Z)(this,"addNode",((t,e,o=!1)=>{if(0===t.portIds.length)return;if(t.integratedCircuit)return this.addIntegratedCircuit(t);const n=t.portIds.filter((t=>e[t].type===et.Input)),i=t.portIds.filter((t=>e[t].type===et.Output)),s=Ki.getCircuitNode(t,n);o&&(s.forceContinue=!0),t.portIds.forEach((t=>this.addPort(t,s))),s.on("change",((t,e)=>{e.concat(i).forEach((e=>{this.valueMap[e]=t,this.waves[e]?.drawPulseChange(t)}))})),t.type===dt.InputNode&&t.subtype===gt.Clock&&this.addClock(i[0],t.properties.interval?.value),this.circuit.addNode(s),t.portIds.forEach((t=>{const o=e[t];o.isMonitored&&this.monitorPort(t,o.value,o.hue)}))})),(0,yi.Z)(this,"removeNode",(t=>{const e=t=>t.integratedCircuit?Object.values(t.integratedCircuit.items).reduce(((t,o)=>o.integratedCircuit?t.concat(e(o)).concat(o.portIds):t.concat(o.portIds)),[]):[];t.portIds.concat(e(t)).forEach((t=>{const e=this.nodes[t];e&&(this.circuit.removeNode(e),this.removePort(t))})),this.emit()})),(0,yi.Z)(this,"addClock",((t,e=1e3)=>{this.clocks[t]=new Wi(t,e,1),this.clocks[t].on("change",(e=>{this.setPortValue(t,e)})),this.oscillator.add(this.clocks[t])})),(0,yi.Z)(this,"setClockInterval",((t,e)=>{this.clocks[t]&&(this.clocks[t].interval=e)})),(0,yi.Z)(this,"addPort",((t,e)=>{this.nodes[t]=e})),(0,yi.Z)(this,"removePort",(t=>{this.clocks[t]&&this.oscillator.remove(this.clocks[t]),this.unmonitorPort(t),delete this.nodes[t],delete this.valueMap[t],delete this.clocks[t],delete this.waves[t]})),(0,yi.Z)(this,"addConnection",((t,e,o)=>{this.nodes[t]&&this.nodes[e]&&(this.circuit.addConnection(this.nodes[t],this.nodes[e],e,o),this.advanceDebuggerStep())})),(0,yi.Z)(this,"removeConnection",((t,e,o)=>{this.nodes[t]&&this.nodes[e]&&(this.circuit.removeConnection(this.nodes[t],this.nodes[e],o),this.advanceDebuggerStep())})),(0,yi.Z)(this,"monitorPort",((t,e,o)=>{this.waves[t]||(this.waves[t]=new Li(t,t,e,o),this.oscillator.add(this.waves[t]))})),(0,yi.Z)(this,"unmonitorPort",(t=>{this.waves[t]&&(this.oscillator.remove(this.waves[t]),this.oscillator.broadcast()),delete this.waves[t],delete this.oscillator.waves[t],delete this.oscillogram[t]})),this.addElements(t,e,o)}}const Ji=()=>({undoStack:[],redoStack:[],simulation:new Xi([],[],{}),oscillogram:{},itemNames:[],zoomLevel:1,zIndex:1,oscilloscopeHeight:200,isOscilloscopeOpen:!1,isOscilloscopeRecording:!0,isCircuitEvaluated:!1,isDebugging:!1,isDirty:!1,hasLoaded:!1,isPrinting:!1,isCreatingImage:!1,animatePan:!1,debugger:{timeout:0,hasUpdated:!1},viewport:new DOMRect,canvas:{top:0,left:0,bottom:0,right:0},snapBoundaries:[],connectablePortIds:[],selectedConnectionIds:[],selectedItemIds:[],selectedPortIndex:-1,cachedState:null,activeFreeportId:null,activePortId:null,connectionPreviewId:null,items:{},connections:{},ports:{},groups:{}});function Qi(){this.copy(),this.deleteSelection()}function ts(){if(!this.hasSelection)return;const t={},e={};this.selectedItemIds.forEach((o=>{t[o]=this.items[o],t[o].portIds.forEach((t=>{e[t]=this.ports[t]}))}));const o=Object.values(this.connections).reduce(((t,o)=>(e[o.source]&&e[o.target]&&(t[o.id]=o),t)),{}),n=Object.values(this.groups).filter((({isSelected:t})=>t)).reduce(((t,e)=>({...t,[e.id]:e})),{}),i={items:t,ports:e,connections:o,groups:n,pasteCount:1};window.api.copy(JSON.stringify(i))}function es(){try{const t=window.api.paste(),e=JSON.parse(t),o=Ct.mapStandardCircuitIds(e);this.commitState(),this.deselectAll(),Object.keys(o.ports).forEach((t=>{o.ports[t].value=0})),Object.values(o.items).forEach((t=>{t.position.x+=20*e.pasteCount,t.position.y+=20*e.pasteCount,t.isSelected=!1,this.addItem({item:t,ports:o.ports}),this.setSelectionState({id:t.id,value:!0})})),Object.values(o.connections).forEach((t=>this.connect(t))),Object.values(o.groups).forEach((t=>{this.groups[t.id]=t,this.setGroupBoundingBox(t.id),this.setSelectionState({id:t.id,value:!0})}));const n={...JSON.parse(t),pasteCount:e.pasteCount+1};window.api.copy(JSON.stringify(n))}catch(t){console.log("ERROR: ",t)}}function os(t){if(this.activePortId&&t){let e=this.activePortId,o=t;this.ports[this.activePortId].type===et.Input&&(e=t,o=this.activePortId);const n=(0,ct.Z)();this.unsetConnectionPreview(),this.connect({source:e,target:o,id:n}),this.connectionPreviewId=n}}function ns(){this.connectionPreviewId&&this.disconnect(this.connections[this.connectionPreviewId]),this.connectionPreviewId=null}function is(){if(this.connectionPreviewId){const{source:t,target:e}=this.connections[this.connectionPreviewId];this.disconnect({source:t,target:e}),this.commitState(),this.connect({source:t,target:e}),this.connectionPreviewId=null}}function ss(t){t&&t!==this.activePortId&&this.setActivePortId(t);let e=this.selectedPortIndex+1;e<=0&&(e=0),e>=this.connectablePortIds.length&&(e=-1);const o=this.connectablePortIds[e];o&&!this.ports[t]?.connectedPortIds.includes(o)?this.setConnectionPreview(o):(0===this.connectablePortIds.length&&window.api.beep(),this.unsetConnectionPreview()),this.selectedPortIndex=e}function rs(t){const e=t.id||(0,ct.Z)();this.connections[e]={...t,id:e,connectionChainId:t.connectionChainId||e,groupId:null,zIndex:++this.zIndex,isSelected:!1},this.ports[t.source].connectedPortIds.push(t.target),this.ports[t.target].connectedPortIds.push(t.source)}function as(t){this.createConnection(t),this.simulation.addConnection(t.source,t.target),this.simulation.circuit.next()}function ls({source:t,target:e}){const o=Object.values(this.connections).find((o=>o.source===t&&o.target===e));if(o){const n=this.ports[t].connectedPortIds.findIndex((t=>t===e)),i=this.ports[e].connectedPortIds.findIndex((e=>e===t));this.ports[t].connectedPortIds.splice(n,1),this.ports[e].connectedPortIds.splice(i,1),delete this.connections[o.id]}}function cs({source:t,target:e}){this.simulation.removeConnection(t,e),this.simulation.circuit.next(),this.destroyConnection({source:t,target:e})}function us(t){const e=JSON.parse(t),o=e.integratedCircuit?JSON.stringify(e.integratedCircuit):t;this.applyState(o),this.resetCircuit()}function ds(){this.isPrinting=!0}function ps(){this.isCreatingImage=!0}function hs(){this.unsetConnectionPreview(),this.connectablePortIds=[],this.selectedConnectionIds=[],this.selectedItemIds=[],this.selectedPortIndex=-1,this.cachedState=null,this.activePortId=null,this.connectionPreviewId=null}function ms(t,e,o){const n=t.reduce(((t,e)=>t.concat(this.items[e].portIds)),[]),i=new Set;Object.values(this.connections).forEach((({source:t,target:e,connectionChainId:o})=>{(n.includes(t)||n.includes(e))&&i.add(o)}));const s=Object.values(this.connections).filter((({connectionChainId:t})=>i.has(t))).concat(e.map((t=>this.connections[t])));s.forEach((t=>{this.disconnect(t),this.ports[t.source]?.isFreeport&&this.removeElement(this.ports[t.source].elementId)})),t.forEach(this.removeElement),o.forEach((t=>{delete this.groups[t]}))}function gs(t,e,o,n,i){return{id:e,orientation:o,name:i,position:{x:0,y:0},type:n,rotation:0,elementId:t,value:0,hue:0,isMonitored:!1,isFreeport:!1,connectedPortIds:[]}}const fs=(0,w.Q_)({id:"preferences",state:()=>({colors:{onColor:{type:"color",label:"High state",value:"#0000ff",description:"When a signal is present."},offColor:{type:"color",label:"Low state",value:"#c0c0c0",description:"When no signal is present."},unknownColor:{type:"color",label:"Unknown state",value:"#ff0000",description:"High impedance (Hi-Z)."}},snapping:{snapToGrid:{type:"boolean",label:"Snap to grid",value:!1,description:"Snap elements to the grid lines.",excludes:["snapToAlign"]},snapToAlign:{type:"boolean",label:"Snap to align",value:!0,description:"Snap elements together.",excludes:["snapToGrid"]},snapTolerance:{type:"number",label:"Snap tolerance",value:15,description:"Maximum distance from a dragging object to snap to another element."}},grid:{showGrid:{type:"boolean",label:"Show grid",value:!0,description:"Display a grid on the canvas."},gridSize:{type:"number",label:"Grid size",value:20,description:"Distance between grid lines.",excludes:["snapToAlign"]}},simulation:{startPaused:{type:"boolean",label:"Pause on startup",value:!0,description:"Start simulation paused."}},experience:{vibration:{type:"boolean",label:"Vibration",value:!0,description:"Haptic feedback on gestures.",mobileOnly:!0},autosave:{type:"boolean",label:"Auto-save",value:!0,description:"Automatically save your work.",desktopOnly:!0},darkMode:{type:"boolean",label:"Dark mode",value:!0}}}),actions:{async writeSettings(){},async updateSettings(t){await this.writeSettings()}}});function vs({itemId:t,inputPortId:e,outputPortId:o,value:n=0}){const i=[];o&&(this.ports[o]=gs(t,o,ht.Left,et.Output,o),this.ports[o].value=n,this.ports[o].isFreeport=!0,i.push(this.ports[o])),e&&(this.ports[e]=gs(t,e,ht.Right,et.Input,e),this.ports[e].value=n,this.ports[e].isFreeport=!0,i.push(this.ports[e])),this.items[t]=mt(t,dt.Freeport,gt.None,1,1,i),this.items[t].zIndex=this.zIndex++,this.simulation.addNode(this.items[t],this.ports,!0)}function bs(t){const e=this.items[t];let o="",n="";Object.values(this.connections).forEach((t=>{t.target===e.portIds[1]&&(o=t.source),t.source===e.portIds[0]&&(n=t.target)})),o&&this.disconnect({source:o,target:e.portIds[1]}),n&&this.disconnect({source:e.portIds[0],target:n}),o&&n&&this.connect({source:o,target:n})}function ys(t,e=!0){if(this.items[t.itemId])return;t.sourceId&&t.targetId&&this.commitState(),this.deselectAll(),this.addFreeportItem(t),this.setItemBoundingBox(t.itemId),this.activeFreeportId=t.itemId;let o=[];t.sourceId&&t.inputPortId&&o.push({source:t.sourceId,target:t.inputPortId}),t.targetId&&t.outputPortId&&o.push({source:t.outputPortId,target:t.targetId}),o.forEach((o=>{this.createConnection({...o,connectionChainId:t.connectionChainId}),e&&this.simulation.addConnection(o.source,o.target,this.ports[o.source].value)})),t.sourceId&&t.targetId&&this.simulation.removeConnection(t.sourceId,t.targetId,this.ports[t.sourceId].value),t.sourceId&&t.targetId&&(this.deselectAll(),this.setSelectionState({id:t.itemId,value:!0}),this.incrementZIndex(1)),this.simulation.circuit.next()}function ws({sourceId:t,targetId:e,portId:o}){const n=this.ports[o],i=fs().snapping.snapTolerance.value,s=Object.values(this.ports).find((t=>t.id!==o&&this.connectablePortIds.includes(t.id)&&ve.isInNeighborhood(t.position,n.position,i)));s?t?(this.disconnect({source:t,target:o}),this.connect({source:t,target:s.id})):e&&(this.disconnect({source:o,target:e}),this.connect({source:s.id,target:e})):this.disconnect({source:t||o,target:e||o});const r=Object.values(this.items).find((({portIds:t})=>t.includes(o)));r&&this.removeElement(r.id),this.clearStatelessInfo()}function Is(){this.commitState();const t=(0,ct.Z)(),e=Object.values(this.items).filter((({isSelected:t})=>t)),o=e.reduce(((t,e)=>t.concat(e.portIds)),[]),n=Object.values(this.connections).filter((t=>o.includes(t.source)&&o.includes(t.target)&&t.isSelected));e.forEach((t=>t.groupId&&this.destroyGroup(t.groupId))),n.forEach((t=>t.groupId&&this.destroyGroup(t.groupId)));const i=[...e,...n].reduce(((t,e)=>Math.max(e.zIndex,t)),0),s={id:t,itemIds:e.map((({id:t})=>t)),connectionIds:n.map((({id:t})=>t)),isSelected:!0,boundingBox:{left:0,top:0,right:0,bottom:0},position:{x:0,y:0},zIndex:i};this.groups[t]=s,s.itemIds.forEach((t=>{this.items[t].groupId=s.id})),s.connectionIds.forEach((t=>{this.connections[t].groupId=s.id})),this.setZIndex(i),this.setGroupBoundingBox(t)}function xs(){this.commitState();for(const t in this.groups)this.groups[t].isSelected&&this.destroyGroup(t)}function Cs(t){const e=this.groups[t];e.itemIds.forEach((t=>{this.items[t].groupId=null,this.selectedItemIds.push(t)})),e.connectionIds.forEach((t=>{this.connections[t].groupId=null,this.selectedConnectionIds.push(t)})),delete this.groups[t]}function Ss(t,e,o,n){return{x:(o.x-e.x-t.left)/n,y:(o.y-e.y-t.top)/n}}function _s({item:t,ports:e}){const o=t.integratedCircuit?.ports||e;t.portIds.forEach((t=>{const e=o[t];e&&(this.ports[e.id]=e,e.isMonitored&&this.monitorPort(e.id))}));let n=t.name,i=0;while(this.itemNames.includes(n))n=`${t.name} ${++i}`;t.name=n,this.items[t.id]=t,this.items[t.id].zIndex=++this.zIndex,this.simulation.addNode(t,this.ports),this.resetItemValue(t),this.setProperties(t.id,t.properties),this.setItemBoundingBox(t.id)}function Ds({item:t,ports:e},o=null){if(!o){const t=ve.getBoundingBoxMidpoint(this.viewport);o={x:t.x+this.viewport.left,y:t.y+this.viewport.top}}const n=Ss(this.canvas,this.viewport,o,this.zoomLevel);n.x-=t.width/2,n.y-=t.height/2,t.position=n,this.commitState(),this.addItem({item:t,ports:e.reduce(((t,e)=>({...t,[e.id]:e})),{})}),this.setItemBoundingBox(t.id),this.setSelectionState({id:t.id,value:!0})}function Os(t){const e=t.properties?.startValue;if(!e)return;const o=e.value;t.portIds.forEach((t=>this.setPortValue({id:t,value:o})))}function Ps(t){const e=this.items[t];if(!e)return;e.type===dt.Freeport&&this.disconnectFreeport(t),this.simulation.removeNode(e);const o=[...e.portIds];o.forEach((t=>this.removePort(t))),delete this.items[t]}function Zs(t,e){const o=this.items[t],n=o.properties.inputCount.value;if(n>e)this.items[t].portIds.filter((t=>this.ports[t].type===et.Input)).slice(e).forEach((t=>this.removePort(t)));else for(let i=n;i<e;i++){const e=(0,ct.Z)();this.addPort(t,{id:e,name:"",connectedPortIds:[],type:et.Input,elementId:t,virtualElementId:t,orientation:ht.Left,isFreeport:!1,isMonitored:!1,hue:0,position:{x:0,y:0},rotation:0,value:0})}}function ks(t,e){const o=this.items[t];for(const n in e){const i=e[n];if(o.properties[n].value!==i.value){switch(this.commitState(),n){case"inputCount":this.setInputCount(t,i.value);break;case"interval":this.simulation.setClockInterval(o.portIds.slice(-1)[0],i.value);break}this.items[t].properties[n].value=i.value}}}function Ms(t,e=!1){this.panDelta({x:t.x-this.canvas.left,y:t.y-this.canvas.top},e)}function Bs(t,e=!1){this.animatePan=e;const o={...this.canvas},n=(e=0)=>{const i=t=>1-(1-t)*(1-t),s=i(e/100),r=t.x*s,a=t.y*s;this.canvas.left=o.left+r,this.canvas.right=o.right+r,this.canvas.top=o.top+a,this.canvas.bottom=o.bottom+a,e<100&&this.animatePan?requestAnimationFrame(n.bind(this,e+5)):this.animatePan=!1};e?requestAnimationFrame(n.bind(this,0)):(this.canvas.left+=t.x,this.canvas.right+=t.x,this.canvas.top+=t.y,this.canvas.bottom+=t.y)}function Es(){const t=ve.getBoundingBoxMidpoint(this.canvas),e={x:this.viewport.width/2-t.x,y:this.viewport.height/2-t.y};this.panTo(e)}function zs(t,e,o){const{connectionIds:n,freeportIds:i}=Object.values(t).reduce((({connectionIds:t,freeportIds:n},i)=>{if(o===i.connectionChainId){const o=e[i.source],s=e[i.target];t.add(i.id),o?.isFreeport&&n.add(o.elementId),s?.isFreeport&&n.add(s.elementId)}return{connectionIds:t,freeportIds:n}}),{connectionIds:new Set,freeportIds:new Set});return{connectionIds:Array.from(n),freeportIds:Array.from(i)}}function Ns(t,e){const o=Object.values(this.simulation.nodes).find((({name:e})=>this.items[t].portIds.includes(e)));this.ports[e.id]=e,this.items[t].portIds.push(e.id),o?this.simulation.addPort(e.id,o):this.simulation.addNode(this.items[t],this.ports)}function js(t){if(!this.items[this.ports[t]?.elementId])return;Object.values(this.connections).filter((({source:e,target:o})=>e===t||o===t)).forEach((t=>{const{connectionIds:e,freeportIds:o}=zs(Object.values(this.connections),this.ports,t.connectionChainId);e.forEach((t=>this.disconnect(this.connections[t]))),o.forEach((t=>{this.items[t].portIds.forEach((t=>{delete this.ports[t],this.simulation.removePort(t)})),delete this.items[t]}))})),this.simulation.removePort(t);const e=this.ports[t].elementId,o=this.items[e].portIds.indexOf(t);-1!==o&&this.items[e].portIds.splice(o,1),delete this.ports[t]}function Ts(t){this.activePortId!==t&&(t?this.setConnectablePortIds({portId:t}):this.connectablePortIds=[],this.activePortId=t,this.selectedPortIndex=-1)}function Fs({portId:t,isDragging:e}){const o=this.ports[t];if(o.isFreeport)return;const n=Object.values(this.connections).reduce(((t,e)=>t.concat([e.source,e.target])),[]);e&&n.splice(-2);const i=o.type===et.Output?t=>t.type===et.Input&&!t.isFreeport&&!n.includes(t.id)&&t.elementId!==o.elementId:t=>t.type===et.Output&&!t.isFreeport&&!n.includes(o.id)&&t.elementId!==o.elementId;this.connectablePortIds=Object.values(this.ports).filter(i).map((({id:t})=>t))}function Ls({id:t,value:e}){this.simulation.setPortValue(t,e),this.isDebugging&&(this.isCircuitEvaluated=!this.simulation.canContinue)}function Ws(t){this.ports[t].isMonitored?this.unmonitorPort(t):this.monitorPort(t)}function $s(t){const e=this.ports[t];e.hue=e.hue||~~(360*Math.random()),e.isMonitored=!0,this.simulation.monitorPort(t,e.value,e.hue),this.isOscilloscopeOpen=!0}function Vs(t){const e=this.ports[t];e.isMonitored=!1,this.simulation.unmonitorPort(t),this.isOscilloscopeOpen=Object.keys(this.oscillogram).length>0}function Rs(){const{grid:t}=fs(),e=t.gridSize.value,o=Object.values(this.items).map((({boundingBox:t})=>t)),n=ve.getGroupBoundingBox(o),{x:i,y:s}=ve.getCenteredScreenPoint(this.canvas,n,e),r=i-n.left,a=s-n.top;Object.values(this.items).forEach((t=>{this.setItemPosition({id:t.id,position:{x:t.position.x+r,y:t.position.y+a}})}))}function As(t,e){const o=this.ports[e];o.position=Ss(this.canvas,this.viewport,t,this.zoom)}function Us({id:t,position:e}){const o=this.items[t],n={x:e.x-o.position.x,y:e.y-o.position.y};this.items[t].position=e,this.setItemBoundingBox(t),o.portIds.forEach((t=>{const e=this.ports[t];this.ports[t].position={x:e.position.x+n.x,y:e.position.y+n.y}}))}function qs(t,e,o){const{snapping:n,grid:i}=fs(),{x:s,y:r}=Ss(this.canvas,this.viewport,e,this.zoom),{width:a,height:l,rotation:c}=this.items[t],u=ve.getBoundingBox({x:s,y:r},c,a,l),d=(()=>o||(n.snapToGrid.value?Jt.Grid:n.snapToAlign.value?Jt.Outer:Jt.None))(),p=(()=>{switch(d){case Jt.Grid:return i.gridSize.value;case Jt.Outer:case Jt.Radial:return n.snapTolerance.value;default:return 0}})(),h=ve.getSnapOffset(this.snapBoundaries,u,o||d,p);this.setSelectionPosition({id:t,position:{x:s+h.x,y:r+h.y}})}function Hs(t){const e=this.selectedItemIds[0];if(e){const o=this.items[e],n={x:o.position.x+t.x,y:o.position.y+t.y};this.commitState(),this.setSelectionPosition({id:e,position:n})}}function Gs({id:t,position:e}){const o=this.items[t],n={x:e.x-o.position.x,y:e.y-o.position.y},i=new Set;if(this.setSelectionState({id:t,value:!0}),o.type===dt.Freeport)return this.setItemPosition({id:t,position:e});this.selectedItemIds.forEach((t=>{const e=this.items[t],o={x:e.position.x+n.x,y:e.position.y+n.y};e.groupId&&i.add(e.groupId),this.setItemPosition({id:t,position:o})})),i.forEach(this.setGroupBoundingBox)}function Ys(t,e=0){return(t+e%4+4)%4}function Ks(t,e,o){const n=t.right-t.left,i=t.bottom-t.top,s=t.left+n/2,r=t.top+i/2,a=e.position.x,l=e.position.y,c=a+e.width/2,u=l+e.height/2,d=Math.hypot(s-c,r-u),p=Math.atan2(u-r,c-s),h=90*o*(Math.PI/180)+p,m=d*Math.cos(h)+s,g=d*Math.sin(h)+r;return{x:m-e.width/2,y:g-e.height/2}}var Xs={rotate:Ys,getGroupedItemRotatedPosition:Ks};function Js(t){this.commitState();const e=Object.values(this.items).filter((({isSelected:t})=>t)),o=e.map((({boundingBox:t})=>t)),n=ve.getGroupBoundingBox(o),i=new Set;e.forEach((e=>{const o=Xs.rotate(e.rotation+t);e.groupId&&i.add(e.groupId),this.items[e.id].rotation=o,this.items[e.id].portIds.forEach((t=>{this.ports[t].rotation=o})),this.setItemPosition({id:e.id,position:Xs.getGroupedItemRotatedPosition(n,e,t)})})),i.forEach((t=>{this.setGroupBoundingBox(t)}))}function Qs(t){this.setSelectionState({id:t,value:!1})}function tr(t,e=!1){e||this.deselectAll(),this.setSelectionState({id:t,value:!0})}function er(){this.clearStatelessInfo();for(let t in this.connections)this.connections[t].isSelected=!0,this.selectedConnectionIds.push(t);for(let t in this.items)this.items[t].isSelected=!0,this.selectedItemIds.push(t)}function or(){this.clearStatelessInfo();for(let t in this.connections)this.connections[t].isSelected=!1,this.selectedConnectionIds=[];for(let t in this.items)this.items[t].isSelected=!1,this.selectedItemIds.push(t),this.selectedItemIds=[]}function nr(t){if(!ve.isOneOrTwoDimensional(t))return;const e=Object.keys(this.items).filter((e=>ve.hasIntersection(t,this.items[e].boundingBox))),o=Object.keys(this.connections).filter((e=>{const o=this.connections[e],n=this.ports[o.source],i=this.ports[o.target];return ve.isLineIntersectingRectangle(n.position,i.position,t)}));e.concat(o).forEach((t=>{this.updateSelectionList({id:t,isSelected:!0})})),this.selectItemConnections(e)}function ir(t){const e=t.reduce(((t,e)=>t.concat(this.items[e].portIds)),[]);for(let o in this.connections){const t=this.connections[o];e.includes(t.source)&&e.includes(t.target)&&this.updateSelectionList({id:o,isSelected:!0})}}function sr({id:t,isSelected:e}){const o=(t,o)=>{const n=this[o].findIndex((e=>e===t));e&&-1===n&&this[o].push(t),e||-1===n||this[o].splice(n,1)};if(this.items[t])this.items[t].isSelected=e,o(t,"selectedItemIds");else if(this.connections[t]){const{connectionChainId:n}=this.connections[t],{connectionIds:i,freeportIds:s}=zs(Object.values(this.connections),this.ports,n);i.forEach((t=>{this.connections[t].isSelected=e,o(t,"selectedConnectionIds")})),s.forEach((t=>{this.items[t].isSelected=e,o(t,"selectedItemIds")}))}}function rr({id:t,value:e}){const o=this.items[t]||this.connections[t],n=e;if(o&&o.isSelected!==n)if(o.groupId){const{itemIds:t,connectionIds:e}=this.groups[o.groupId];t.concat(e).forEach((t=>{this.updateSelectionList({id:t,isSelected:n})})),this.updateSelectionList({id:o.groupId,isSelected:n})}else this.updateSelectionList({id:t,isSelected:n})}function ar(t){const e=t?this.baseItems[0]:this.baseItems.slice(-1)[0];e&&(this.deselectAll(),this.setSelectionState({id:e.id,value:!0}))}function lr(){this.hasSelection&&(this.commitState(),this.clearBaseItems(this.selectedItemIds,this.selectedConnectionIds,this.selectedGroupIds.filter((t=>null!==t))),this.deselectAll())}function cr(){this.simulation.oscillator.isPaused?this.simulation.oscillator.start():this.simulation.oscillator.stop(),this.isOscilloscopeRecording=!this.simulation.oscillator.isPaused}function ur(t){for(const e in t)if(this.ports[e]){const o=this.ports[e],n=this.items[o.elementId];n&&o.value!==t[e]&&(this.debugger.hasUpdated=!0),o.value=t[e]}this.isCircuitEvaluated=!this.simulation.canContinue,clearTimeout(this.debugger.timeout),this.debugger.timeout=window.setTimeout((()=>{!this.debugger.hasUpdated&&this.simulation.canContinue&&this.isDebugging&&(this.debugger.hasUpdated=!1,this.simulation.advanceDebuggerStep())}))}function dr(t){window.api.showMessageBox({message:"An infinite loop was detected! Entering debugger mode.",type:"error"}),this.isDebugging=!0,this.simulation.startDebugging()}function pr(){const t=Object.values(this.items),e=Object.values(this.connections);Object.values(this.ports).forEach((t=>{t.value=0})),this.simulation.stop(),this.simulation=new Xi(t,e,this.ports),this.simulation.onChange(this.onSimulationUpdate),this.simulation.onError(this.onError),this.simulation.oscillator.on("change",(t=>{this.oscillogram=t})),Object.values(this.items).forEach((({properties:t,portIds:e})=>{t?.startValue&&e.forEach((e=>this.setPortValue({id:e,value:t.startValue.value})))})),this.simulation.start(),this.isDebugging&&(this.simulation.startDebugging(),this.isCircuitEvaluated=!this.simulation.canContinue)}function hr(){this.debugger.hasUpdated=!1,this.simulation.advanceDebuggerStep(),this.isCircuitEvaluated=!this.simulation.canContinue}function mr(){this.isDebugging?this.simulation.stopDebugging():this.simulation.startDebugging(),this.isDebugging=!this.isDebugging}function gr(){this.isOscilloscopeOpen?this.closeOscilloscope():this.openOscilloscope()}function fr(){Object.values(this.ports).forEach((t=>{t.isMonitored&&this.simulation.monitorPort(t.id,t.value,t.hue)})),this.isOscilloscopeOpen=!0}function vr(t){this.isOscilloscopeOpen&&(Object.keys(this.ports).forEach(this.simulation.unmonitorPort),this.simulation.oscillator.clear(),this.isOscilloscopeOpen=!1,t&&(this.oscilloscopeHeight=t))}function br(){this.simulation.oscillator.clear()}const yr=.1;function wr(){const t=Object.values(this.items).map((t=>t.boundingBox)),e=ve.getGroupBoundingBox(t),o=e.right-e.left,n=e.bottom-e.top,i=this.canvas.right-this.canvas.left,s=this.canvas.bottom-this.canvas.top;(o>i||n>s)&&(this.canvas={left:0,top:0,right:2*o,bottom:2*n},this.centerAll(),this.panToCenter()),setTimeout((()=>{this.setZoom({zoom:Math.min(this.viewport.width/o,this.viewport.height/n,1)})}))}function Ir(t){this.viewport=t,this.canvas.right=screen.width/yr,this.canvas.bottom=screen.height/yr,!this.hasLoaded&&t.width>0&&t.height>0&&(this.hasLoaded=!0,this.updateCanvasSize(),this.centerAll(),this.panToCenter())}function xr({rect:t,id:e}){const o=this.items[e],n=t.width/this.zoomLevel,i=t.height/this.zoomLevel,s=o.position.x+o.width/2,r=o.position.y+o.height/2,a=s-n/2,l=r-i/2;this.items[e].position={x:a,y:l},this.items[e].width=n,this.items[e].height=i,this.setItemBoundingBox(e),this.items[e].groupId&&this.setGroupBoundingBox(this.items[e].groupId)}function Cr(t){if(!this.items[t])return;const{position:e,rotation:o,width:n,height:i}=this.items[t];this.items[t].boundingBox=ve.getBoundingBox(e,o,n,i)}function Sr(t){if(!this.groups[t])return;const e=this.groups[t].itemIds.map((t=>this.items[t].boundingBox));this.groups[t].boundingBox=ve.getGroupBoundingBox(e)}function _r(t){this.snapBoundaries=(()=>{if(this.connectablePortIds.length)return this.connectablePortIds.filter((e=>e!==t)).map((t=>ve.getPointBoundary(this.ports[t].position)));const e=this.items[t];if(e&&!e.groupId){if(e.type!==dt.Freeport)return Object.values(this.items).filter((e=>e.id!==t&&e.type!==dt.Freeport)).map((t=>t.boundingBox));if(e.portIds.length>1)return Object.values(this.connections).reduce(((t,o)=>e.portIds.includes(o.source)?t.concat(ve.getLinearBoundaries(this.ports[o.target].position)):e.portIds.includes(o.target)?t.concat(ve.getLinearBoundaries(this.ports[o.source].position)):t),[])}return[]})()}function Dr(){const t=this.undoStack.slice(-1).pop();t&&(this.redoStack.push(JSON.stringify({connections:this.connections,items:this.items,ports:this.ports,groups:this.groups})),this.applyState(t),this.undoStack.pop(),this.isDirty=!0)}function Or(){const t=this.redoStack.slice(-1).pop();t&&(this.undoStack.push(JSON.stringify({connections:this.connections,items:this.items,ports:this.ports,groups:this.groups})),this.applyState(t),this.redoStack.pop(),this.isDirty=!0)}function Pr(){this.cacheState(),this.commitCachedState()}function Zr(){this.cachedState=JSON.stringify({connections:this.connections,items:this.items,ports:this.ports,groups:this.groups})}function kr(){this.cachedState&&(this.undoStack.push(this.cachedState.toString()),this.cachedState=null,this.redoStack=[],this.isDirty=!0)}function Mr(t){const e=JSON.parse(t),{items:o,connections:n,ports:i,groups:s}=e;function r(t,e){const o=Object.keys(t),n=Object.keys(e);return o.filter((t=>!n.includes(t)))}const a=r(this.items,o),l=r(this.connections,n),c=r(o,this.items),u=r(n,this.connections);this.clearBaseItems(a,l,[]),this.ports=i,this.items=o,this.groups=s,c.forEach((t=>{this.addItem({item:o[t],ports:i})})),u.forEach((t=>this.connect(n[t]))),this.stepThroughCircuit()}function Br(t,e){return t.zIndex>e.zIndex?1:t.zIndex<e.zIndex?-1:0}function Er(){this.commitState(),this.incrementZIndex(-1)}function zr(){this.commitState(),this.incrementZIndex(1)}function Nr(){this.commitState(),this.setZIndex(1)}function jr(){this.commitState(),this.setZIndex(this.zIndex)}function Tr(t){const e=Object.values(this.items),o=Object.values(this.connections),n=e.concat(o).sort(Br),i=n.filter((({isSelected:t})=>t)).map((({id:t})=>t));t>0&&i.reverse();const s=[];i.forEach((e=>{const o=n.findIndex((t=>t.id===e)),i=o+t;if(i<0||i>=n.length)s.push(n[o].id);else if(!s.includes(n[i]?.id)){const t=n[o];n.splice(o,1),n.splice(i,0,t)}})),n.forEach(((t,e)=>{t.zIndex=e+1})),this.zIndex=Object.keys(n).length}function Fr(t){const e=Object.values(this.items),o=Object.values(this.connections);let n=e.concat(o).sort(Br);const i=n.filter((({isSelected:t})=>t));for(let s=0;s<n.length;s++)n[s].isSelected&&(n.splice(s,1),s--);n.splice(t-1,0,...i),n.forEach(((t,e)=>{t.zIndex=e+1})),this.zIndex=Object.keys(n).length}const Lr=.1,Wr=2,$r=.1;function Vr(t=1){this.setZoom({zoom:this.zoomLevel+$r*t})}function Rr({zoom:t,point:e}){t<Lr&&(t=Lr),t>Wr&&(t=Wr),t=Math.round(100*t)/100,e||(e=ve.getBoundingBoxMidpoint(this.viewport),e.x+=this.viewport.left,e.y+=this.viewport.top);const o=Ss(this.canvas,this.viewport,e,this.zoomLevel),n={x:o.x*t,y:o.y*t},i={x:e.x-this.viewport.x,y:e.y-this.viewport.y};this.panTo({x:Math.round(Math.min(i.x-n.x,0)),y:Math.round(Math.min(i.y-n.y,0))}),this.zoomLevel=t}const Ar=t=>(0,w.Q_)({id:t,state:Ji,getters:{baseItems(t){return Object.values(t.connections).concat(Object.values(t.items)).sort(Br)},zoom(t){return t.zoomLevel},hasSelection(t){return t.selectedItemIds.length>0||t.selectedConnectionIds.length>0},hasSelectedItems(t){return t.selectedItemIds.length>0},selectedGroupIds(t){const e=new Set;return t.selectedItemIds.forEach((o=>e.add(t.items[o]?.groupId))),Array.from(e)},canGroup(){return this.selectedGroupIds.length>1||null===[].slice.call(this.selectedGroupIds)[0]},canUngroup(){return!![].slice.call(this.selectedGroupIds).find((t=>!!t))},canUndo(t){return t.undoStack.length>0},canRedo(t){return t.redoStack.length>0}},actions:{...n,...i,...s,...r,...a,...l,...c,...u,...d,...p,...h,...m,...f,...g,...v,...b,...y}});function Ur(t){return t.split("\\").pop()?.split("/").pop()||""}const qr=(0,w.Q_)({id:"root",state:()=>({documents:{},clipboard:null,activeDocumentId:null,canExit:!1,isFullscreen:!1,isBuilderOpen:!1,isToolboxOpen:!1,isSettingsOpen:!1,isDocumentSelectOpen:!1}),getters:{hasOpenDocuments(t){return Object.keys(t.documents).length>0},activeDocument(t){return t.activeDocumentId?t.documents[t.activeDocumentId]:null},isDialogOpen(t){return t.isBuilderOpen}},actions:{async launchIntegratedCircuitBuilder(){const t=St(),e=this.activeDocument;if(e){this.isBuilderOpen=!0;try{await t.launchBuilder(e.store().$state);const o=e.store(),n=Ct.mapIntegratedCircuitIds(t.model);o.insertItemAtPosition({item:n,ports:[]}),o.setItemBoundingBox(n.id),o.setSelectionState({id:n.id,value:!0})}catch(o){window.api.showMessageBox({message:"That's okay."})}this.isBuilderOpen=!1}},openIntegratedCircuit(t){t.integratedCircuit&&this.openDocument("",t.integratedCircuit.serializedState,t.id,t.name)},async saveImage(t){if(this.activeDocument)try{const e=this.activeDocument.displayName.replace(/\.[^/.]+$/,""),o=`${e}.png`,n=window.api.showSaveFileDialog([{name:"PNG Image",extensions:[".png"]}],o);if(!n)return;await wt.writeBlob(n,t)}catch(e){console.log("ERROR: ",e),window.api.showMessageBox({message:"An error occurred while trying to save the image.",title:"Error",type:"error"})}},newDocument(){const t=(0,ct.Z)(),e=Ar(t),o=e();o.resetCircuit(),this.documents[t]={fileName:"Untitled Circuit",displayName:"Untitled Circuit",store:e},this.activateDocument(t)},async closeAll(){if(this.activeDocumentId){const t=await this.closeDocument(this.activeDocumentId);return await new Promise((t=>setTimeout(t))),!!t&&this.closeAll()}return!0},printActiveDocument(){this.activeDocument&&(this.activeDocument.store().isPrinting=!0)},async closeDocument(t){const e=this.documents[t],o=e.store();let n=!0;if(this.activateDocument(t),o.isDirty){const t=window.api.showMessageBox({message:`Save changes to ${e.fileName}?`,title:"Confirm",buttons:["Yes","No","Cancel"]});if(0===t&&(n=await this.saveActiveDocument()),2===t)return!1}this.activeDocumentId=null,o.simulation.stop(),o.$reset(),o.$dispose(),delete this.documents[t];const i=Object.keys(this.documents).pop();return i&&this.activateDocument(i),n},async saveActiveDocument(t=!1){try{if(!this.activeDocument)return!0;if(!this.activeDocument.filePath||t){const t=this.activeDocument.fileName||`${this.activeDocument.fileName}.alfx`,e=window.api.showSaveFileDialog([{name:"Aristotle Logic Circuit (*.alfx)",extensions:["alfx"]}],t);if(!e)return!0;if(e){const t=Ur(e);this.activeDocument.filePath=e,this.activeDocument.fileName=t,this.activeDocument.displayName=t}}if(!this.activeDocument.filePath)return!0;const e=this.activeDocument.store();return wt.save(this.activeDocument.filePath,{items:e.items,connections:e.connections,groups:e.groups,ports:e.ports}),e.isDirty=!1,!0}catch(e){return window.api.showMessageBox({message:"An error occurred while trying to save the file.",title:"Error",type:"error"}),!1}},async selectDocument(){const t=window.api.showOpenFileDialog([{name:"Aristotle Logic Circuit (*.alfx)",extensions:["alfx"]},{name:"Aristotle Integrated Circuit (*.aicx)",extensions:["aicx"]}]);for(let e=0;e<t.length;e++)await this.openDocumentFromPath(t[e])},async openDocumentFromPath(t){try{const e=await wt.open(t);e&&this.openDocument(t,e,(0,ct.Z)())}catch(e){console.log(e),window.api.showMessageBox({message:`Could not open ${t}. The file is not a valid Aristotle circuit.`,title:"Error",type:"error"})}},openDocument(t,e,o,n=""){if(this.documents[o])return this.activateDocument(o);const i=Ar(o),s=i(),r=Ur(t);s.loadDocument(e),this.documents[o]={fileName:r,filePath:/^.*.aicx$/i.test(t)?void 0:t,displayName:n||r,store:i},this.activateDocument(o)},switchDocument(t){const e=Object.keys(this.documents),o=e.findIndex((t=>this.activeDocumentId===t));let n=o+t;0!==e.length&&(-1===o||n>=e.length?n=0:n<0&&(n=e.length-1),this.activateDocument(e[n]))},pauseActivity(){this.activeDocument?.store().simulation.stop()},resumeActivity(){this.activeDocument?.store().simulation.start()},activateDocument(t){this.pauseActivity(),this.activeDocumentId=t,this.resumeActivity()},openTestDocuments(){this.openDocument("flip-flop.alfx",JSON.stringify(bi),(0,ct.Z)(),"flip-flop.alfx"),St().loadLibrary()},navigateDocumentList(t){const e=Object.keys(this.documents),o=e.findIndex((t=>t===this.activeDocumentId));let n=o+t;n<0&&(n=e.length-1),n>=e.length&&(n=0),this.activateDocument(e[n])},toggleFullscreen(){this.isFullscreen=!this.isFullscreen,window.api.setFullscreen(this.isFullscreen)},toggleToolbox(){this.isToolboxOpen=!this.isToolboxOpen}}});var Hr=(0,x.aZ)({name:"Item",components:{CircuitComponent:Xn,Draggable:De,PortItem:vi,Properties:ci},props:{zIndex:{type:Number,default:1},isSelected:{type:Boolean,default:!1},id:{type:String,required:!0},flash:{type:Boolean,default:!1},store:{type:Function,required:!0}},setup(t,{emit:e}){const o=t.store(),n=(0,x.Fl)((()=>o.items[t.id])),i=(0,x.Fl)((()=>o.viewport)),s=(0,O.iH)(),r=(0,O.iH)(0);(0,x.YP)((()=>n.value?.rotation),(()=>r.value++)),(0,x.YP)((()=>n.value?.properties.inputCount?.value),(()=>r.value++));const a=(0,x.Fl)((()=>o.items[t.id].portIds.map((t=>o.ports[t])))),l=(0,x.Fl)((()=>t.isSelected&&1===o.selectedItemIds.length&&n.value.type!==dt.Freeport));function c(){s.value?.$el.focus()}function u(){n.value?.subtype===gt.CustomCircuit&&qr().openIntegratedCircuit(n.value)}function d(){o.cacheState(),o.setSnapBoundaries(t.id)}function p(e,i){o.dragItem(t.id,{x:e.x-i.x-n.value.width/2*o.zoomLevel,y:e.y-i.y-n.value.height/2*o.zoomLevel})}function h(t){document.activeElement===s.value?.$el?s.value.$el.blur():t.preventDefault()}function m(t){o.activePortId===t&&o.setActivePortId(null)}function g(e){o.setItemSize({id:t.id,rect:e})}function f(){t.isSelected||o.selectItem(t.id),window.api.showContextMenu(qe(t.store))}return{item:n,itemRef:s,store:o,ports:a,viewport:i,isPropertiesEnabled:l,portUpdates:r,focus:c,onDrag:p,onDragStart:d,onEscapeKey:h,onResize:g,onPortBlur:m,onContextMenu:f,revealCustomCircuit:u,ItemSubtype:gt,ItemType:dt}}});const Gr=(0,F.Z)(Hr,[["render",Ke]]);var Yr=Gr;function Kr(t,e,o,n,i,s){const r=(0,x.up)("selector"),a=(0,x.up)("resizable");return(0,x.wg)(),(0,x.j4)(a,{onMousewheel:t.onMouseWheel,onMousedown:(0,I.iM)(t.onMouseDown,["right"]),onTouchstart:t.onTouchStart,onTouchmove:t.onTouchMove,onTouchend:t.onTouchEnd,onResize:e[0]||(e[0]=e=>t.$emit("resize",e)),class:"editor"},{default:(0,x.w5)((()=>[(0,x._)("div",{style:(0,C.j5)(t.style),class:"editor__grid"},[(0,x.Wm)(r,{zoom:t.zoom,onSelectionStart:t.onSelectionStart,onSelectionEnd:t.onSelectionEnd,ref:"selector"},null,8,["zoom","onSelectionStart","onSelectionEnd"]),(0,x.WI)(t.$slots,"default")],4)])),_:3},8,["onMousewheel","onMousedown","onTouchstart","onTouchmove","onTouchend"])}function Xr(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{onMousedown:e[0]||(e[0]=(0,I.iM)(((...e)=>t.onMouseDown&&t.onMouseDown(...e)),["left","self"])),class:"selector",ref:"selector"},[t.hasSelection?((0,x.wg)(),(0,x.iD)("div",{key:0,style:(0,C.j5)(t.style),class:"selector__selection"},null,4)):(0,x.kq)("",!0)],544)}var Jr=(0,x.aZ)({name:"Selector",emits:{selectionStart:t=>!0,selectionEnd:t=>!0},props:{zoom:{type:Number,default:1}},setup(t,{emit:e}){const o=(0,O.iH)({x:0,y:0}),n=(0,O.iH)({x:0,y:0}),i=(0,O.iH)(null),s=(0,O.iH)(!1),r=()=>({left:Math.min(o.value.x,n.value.x),top:Math.min(o.value.y,n.value.y),width:Math.abs(o.value.x-n.value.x),height:Math.abs(o.value.y-n.value.y)}),a=(0,x.Fl)((()=>{const t=r();return{left:`${t.left}px`,top:`${t.top}px`,width:`${t.width}px`,height:`${t.height}px`}}));function l(e){if(!i.value)return{x:0,y:0};const{top:o,left:n}=i.value.getBoundingClientRect(),s=(e.x-n)/t.zoom,r=(e.y-o)/t.zoom;return{x:s,y:r}}function c(){const{left:t,top:o,width:n,height:i}=r();e("selectionEnd",{left:t,top:o,bottom:i+o,right:t+n})}function u(t){const i=l(t);s.value=!0,o.value=i,n.value=i,e("selectionStart",t)}function d(t){s.value&&(n.value=l(t))}function p(){s.value&&(c(),s.value=!1,o.value.x=0,o.value.y=0,n.value.x=0,n.value.y=0)}return(0,x.bv)((()=>{window.addEventListener("mousemove",d),window.addEventListener("mouseup",p)})),(0,x.Jd)((()=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",p)})),{selector:i,hasSelection:s,style:a,onMouseDown:u}}});const Qr=(0,F.Z)(Jr,[["render",Xr]]);var ta=Qr,ea=(0,x.aZ)({name:"Editor",emits:{resize:t=>!0,pan:(t,e)=>!0,selection:t=>!0,deselect:()=>!0,zoom:t=>!0,contextmenu:t=>!0},components:{Selector:ta,Resizable:Ce},props:{zoom:{type:Number,default:1},gridSize:{type:Number,default:0},width:{type:Number,default:0},height:{type:Number,default:0},offset:{type:Object,default:()=>({x:0,y:0})},animatePan:{type:Boolean,default:!1}},setup(t,{emit:e}){let o={x:0,y:0},n={x:0,y:0},i={y:0,x:0},s=0,r=0,a=!1,l=0,c=1;const u=(0,O.iH)(null),d=(0,x.Fl)((()=>({backgroundSize:`${t.gridSize}px ${t.gridSize}px`,transform:`scale(${t.zoom})`,left:`${t.offset.x}px`,top:`${t.offset.y}px`,width:`${t.width}px`,height:`${t.height}px`})));function p({touches:t}){const e=t[0].clientX-t[1].clientX,o=t[0].clientY-t[1].clientY;return Math.hypot(e,o)}function h(e,l){a=!0,o={x:e-t.offset.x,y:l-t.offset.y},i={x:e,y:l},n={x:e,y:l},s=0,r=0}function m(t,i){if(a){const a=n.x-t,l=n.y-i;e("pan",{x:Math.min(t-o.x,0),y:Math.min(i-o.y,0)}),s=Math.hypot(a,l),r=Math.atan2(l,a),n={x:t,y:i}}}function g(){const o=2,n=s*Math.cos(r)*o,i=s*Math.sin(r)*o;e("pan",{x:Math.min(t.offset.x-n,0),y:Math.min(t.offset.y-i,0)},!0)}function f(t){h(t.x,t.y),t.preventDefault(),t.stopPropagation()}function v(t){m(t.x,t.y)}function b(t){a&&(a=!1,2===t.button&&ve.isInNeighborhood(t,i,5)?e("contextmenu",t):g())}function y(e){const{clientX:o,clientY:n}=e.touches[0];e.targetTouches.length>1?(l=p(e),c=t.zoom):h(o,n),e.preventDefault(),e.stopPropagation()}function w(t){const{clientX:o,clientY:n}=t.touches[0];if(t.preventDefault(),t.stopPropagation(),t.targetTouches.length>1&&t.changedTouches.length>1){const i=p(t),s=Math.max(Math.min(c*(i/l),4),.1),r={x:(o+t.touches[1].clientX)/2,y:(n+t.touches[1].clientY)/2};e("zoom",{zoom:s,point:r})}else 0===l&&m(o,n)}function I(t){t.target===u.value?.$el&&e("deselect"),a&&g(),a=!1,l=0}function C(o){const{deltaY:n,x:i,y:s,shiftKey:r}=o;if(!r)return;const a=n<0?1:-1,l=t.zoom+a/10;e("zoom",{zoom:l,point:{x:i,y:s}})}function S(t){t.shiftKey||e("deselect")}function _(t){e("selection",t)}return(0,x.bv)((()=>{window.addEventListener("mousemove",v),window.addEventListener("mouseup",b)})),(0,x.Jd)((()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",b)})),{selector:u,style:d,onTouchStart:y,onTouchMove:w,onTouchEnd:I,onMouseDown:f,onMouseMove:v,onMouseWheel:C,onSelectionStart:S,onSelectionEnd:_}}});const oa=(0,F.Z)(ea,[["render",Kr]]);var na=oa;function ia(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(["group",{"group--is-selected":t.isSelected}]),tabindex:-1,style:(0,C.j5)({position:"absolute",left:`${t.boundingBox.left}px`,top:`${t.boundingBox.top}px`,width:t.boundingBox.right-t.boundingBox.left+"px",height:t.boundingBox.bottom-t.boundingBox.top+"px",zIndex:t.zIndex})},null,6)}var sa=(0,x.aZ)({name:"Group",props:{boundingBox:{type:Object,required:!0},id:{type:String,required:!0},isSelected:{type:Boolean,default:!1},zIndex:{type:Number,default:0},zoom:{type:Number,default:1}}});const ra=(0,F.Z)(sa,[["render",ia]]);var aa=ra,la=o(9306),ca=o.n(la);function ua(t,e,o,n,i="printer-friendly"){const s=e.cloneNode(!0),r=o.right-o.left+2*n,a=o.bottom-o.top+2*n;for(let l=0;l<s.children.length;l++){const t=s.children[l],e=parseInt(t.style.left.replace("px",""),10)+n,i=parseInt(t.style.top.replace("px",""),10)+n;t.style.left=e-o.left+"px",t.style.top=i-o.top+"px"}return s.style["zoom"]=t.toString(),s.style.width=`${r}px`,s.style.height=`${a}px`,s.style.position="relative",s.style.top="0",s.style.left="0",s.style.background="none",i&&s.classList.add(i),{printArea:s,width:r,height:a}}function da(t,e){const o=document.createElement("iframe");o.name="print",o.style.width="1px",o.style.height="1px",o.style.opacity="0",o.style.position="absolute",o.style.top="0px",o.style.left="0px",document.body.appendChild(o);const n=o.contentWindow;if(n){const o=document.createElement("style");o.appendChild(document.createTextNode(`\n      @page {\n        size: ${e.map((t=>`${t}in`)).join(" ")};\n        margin: 0in;\n      }\n    `)),n.document.head.append(o),n.document.body.appendChild(t)}return o}async function pa(t,e){document.body.appendChild(t);const o=await ca()[e](t);return t.remove(),o}async function ha(t){return new Promise((e=>{setTimeout((()=>{if(!t)return e();t.addEventListener("afterprint",(()=>e())),t.print()}))}))}async function ma(t,e,o){const{printArea:n,width:i,height:s}=ua(1/t,e,o,20),r=await ga.createImage(n,"toPng"),a=[8.5,11],l=96*Math.min(...a),c=96*Math.max(...a),u=new Image;let d=1;if(u.src=r,i>l||i>c||s>l||s>c){const t=i>s;d=t?c/i:c/s,t&&a.reverse()}u.style.width=`${Math.floor(i*d)}px`,u.style.height=`${Math.floor(s*d)}px`;const p=ga.createPrintFrame(u,a);await ga.printWindow(p?.contentWindow),p?.remove()}const ga={createPrintArea:ua,createPrintFrame:da,createImage:pa,printImage:ma,printWindow:ha};var fa=ga,va=(0,x.aZ)({name:"Document",components:{Group:aa,Editor:na,Connection:Ye,Item:Yr},props:{store:{type:Function,required:!0}},setup(t){const e=t.store(),o=qr(),n=(0,O.iH)(),i=(0,O.iH)(0),{colors:s,grid:r}=(0,w.Jk)(fs());let a=1,l={};function c(t){if(n.value){const o=Object.values(e.items).map((({boundingBox:t})=>t)),i=ve.getGroupBoundingBox(o),s=n.value.$el.querySelector(".editor__grid");t(s,i)}}async function u(){c((async(t,o)=>{await fa.printImage(e.zoom,t,o),e.isPrinting=!1}))}async function d(){c((async(t,n)=>{const{printArea:i}=fa.createPrintArea(1/e.zoom,t,n,20,""),s=await fa.createImage(i,"toBlob");await o.saveImage(s),e.isCreatingImage=!1}))}function p(t){return function(o){o.target instanceof HTMLInputElement||(e[t](),o.preventDefault())}}function h(t){if(!(t.target instanceof HTMLInputElement))switch(t.key){case"Escape":return e.deselectAll();case"a":return t.ctrlKey&&e.selectAll();default:return f(t)}}function m(t){l[t.key]=!1,a=1}function g(e){window.api.showContextMenu(qe(t.store)),e.preventDefault(),e.stopPropagation()}function f(t){const o=(()=>{switch(t.key){case"ArrowLeft":return{x:-1,y:0};case"ArrowUp":return{x:0,y:-1};case"ArrowRight":return{x:1,y:0};case"ArrowDown":return{x:0,y:1}}})();if(o){const t=Math.min(a,10);e.moveSelectionPosition({x:o.x*t,y:o.y*t}),a*=1.05}}function v(){l={}}return(0,x.m0)((()=>{e.isPrinting&&u(),e.isCreatingImage&&d()})),(0,x.bv)((()=>{document.addEventListener("keydown",h),document.addEventListener("keyup",m),document.addEventListener("cut",p("cut")),document.addEventListener("copy",p("copy")),document.addEventListener("paste",p("paste")),window.addEventListener("blur",v)})),(0,x.Jd)((()=>{document.removeEventListener("keydown",h),document.removeEventListener("keyup",m),document.addEventListener("cut",p("cut")),document.addEventListener("copy",p("copy")),document.addEventListener("paste",p("paste")),window.removeEventListener("blur",v)})),{store:e,editor:n,updates:i,colors:s,grid:r,storeDefinition:t.store,onKeyDown:h,onKeyUp:m,onContextMenu:g,clearKeys:v}}});const ba=(0,F.Z)(va,[["render",Yt]]);var ya=ba;function wa(t,e,o,n,i,s){const r=(0,x.up)("mobile-button"),a=(0,x.up)("property-form"),l=(0,x.up)("mobile-collapsible-panel");return(0,x.wg)(),(0,x.iD)(x.HY,null,[(0,x.Wm)(r,{icon:t.faFile,label:"New Circuit"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faCodeBranch,label:"Load Circuit"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faMicrochip,label:"Import integrated circuit"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faImage,label:"Export image"},null,8,["icon"]),(0,x.Wm)(l,{title:"Colors",icon:t.faPalette},{default:(0,x.w5)((()=>[(0,x.Wm)(a,{modelValue:t.colors,"onUpdate:modelValue":e[0]||(e[0]=e=>t.colors=e),id:"section1"},null,8,["modelValue"])])),_:1},8,["icon"]),(0,x.Wm)(l,{title:"Grid",icon:t.faTableCells},{default:(0,x.w5)((()=>[(0,x.Wm)(a,{modelValue:t.grid,"onUpdate:modelValue":e[1]||(e[1]=e=>t.grid=e),id:"section1"},null,8,["modelValue"])])),_:1},8,["icon"]),(0,x.Wm)(l,{title:"Snapping",icon:t.faMagnet},{default:(0,x.w5)((()=>[(0,x.Wm)(a,{modelValue:t.snapping,"onUpdate:modelValue":e[2]||(e[2]=e=>t.snapping=e),id:"section1"},null,8,["modelValue"])])),_:1},8,["icon"]),(0,x.Wm)(l,{title:"Simulation",icon:t.faGears},{default:(0,x.w5)((()=>[(0,x.Wm)(a,{modelValue:t.simulation,"onUpdate:modelValue":e[3]||(e[3]=e=>t.simulation=e),id:"section1"},null,8,["modelValue"])])),_:1},8,["icon"]),(0,x.Wm)(l,{title:"Experience",icon:t.faWandMagicSparkles},{default:(0,x.w5)((()=>[(0,x.Wm)(a,{modelValue:t.experience,"onUpdate:modelValue":e[4]||(e[4]=e=>t.experience=e),id:"section1"},null,8,["modelValue"])])),_:1},8,["icon"])],64)}const Ia={class:"mobile-button"},xa={class:"mobile-button__label"};function Ca(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.iD)("div",Ia,[(0,x.Wm)(r,{icon:t.icon,class:"mobile-button__icon"},null,8,["icon"]),(0,x._)("div",xa,(0,C.zw)(t.label),1),t.chevron?((0,x.wg)(),(0,x.j4)(r,{key:0,icon:t.faChevronDown,class:(0,C.C_)([{"mobile-button__icon--open":t.isOpen},"mobile-button__icon--chevron"])},null,8,["icon","class"])):(0,x.kq)("",!0)])}var Sa=(0,x.aZ)({name:"MobileButton",components:{Icon:Tt},props:{label:{type:String,default:""},icon:{type:Object,required:!0},chevron:{type:Boolean,default:!1},isOpen:{type:Boolean,default:!1}},setup(){return{faChevronDown:D.ptq}}});const _a=(0,F.Z)(Sa,[["render",Ca]]);var Da=_a;const Oa={class:"mobile-collapsible-panel"},Pa={ref:"content"};function Za(t,e,o,n,i,s){const r=(0,x.up)("mobile-button");return(0,x.wg)(),(0,x.iD)("div",Oa,[(0,x.Wm)(r,{label:t.title,icon:t.icon,"is-open":t.isOpen,onClick:t.toggle,chevron:""},null,8,["label","icon","is-open","onClick"]),(0,x._)("div",{class:"mobile-collapsible-panel__content",style:(0,C.j5)({height:t.height})},[(0,x._)("div",Pa,[(0,x._)("div",{class:(0,C.C_)(["mobile-collapsible-panel__inner",{"mobile-collapsible-panel__inner--open":t.isOpen}])},[(0,x.WI)(t.$slots,"default")],2)],512)],4)])}var ka=(0,x.aZ)({name:"MobileCollapsiblePanel",components:{MobileButton:Da},props:{title:{type:String,default:""},icon:{type:Object,required:!0}},setup(){const t=(0,O.iH)("0"),e=(0,O.iH)(),o=(0,O.iH)(!1);function n(){t.value=o.value?e.value?.clientHeight+"px":"0px"}function i(){o.value=!o.value,n()}return(0,x.bv)((()=>n())),{faChevronDown:D.ptq,isOpen:o,height:t,content:e,toggle:i}}});const Ma=(0,F.Z)(ka,[["render",Za]]);var Ba=Ma;const Ea={class:"property-form"},za=["for"],Na=["onUpdate:modelValue","id","disabled"],ja=["value"],Ta={key:1,class:"property-form__switch"},Fa=["onUpdate:modelValue","min","max","type","id","disabled"],La={key:3,class:"property-form__description"};function Wa(t,e,o,n,i,s){const r=(0,x.up)("property-switch");return(0,x.wg)(),(0,x.iD)("div",Ea,[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.model,((o,n)=>((0,x.wg)(),(0,x.iD)("div",{key:n,class:"property-form__entry"},[(0,x._)("label",{for:`${t.id}_${n}`,class:(0,C.C_)([{"property-form__label--disabled":o.disabled},"property-form__label"])},(0,C.zw)(o.label),11,za),o.options?(0,x.wy)(((0,x.wg)(),(0,x.iD)("select",{key:0,"onUpdate:modelValue":t=>o.value=t,id:`${t.id}_${n}`,disabled:o.disabled,class:"property-form__input",onChange:e[0]||(e[0]=(...e)=>t.onChange&&t.onChange(...e))},[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(o.options,((t,e)=>((0,x.wg)(),(0,x.iD)("option",{key:e,value:t},(0,C.zw)(e),9,ja)))),128))],40,Na)),[[I.bM,o.value]]):"boolean"===o.type?((0,x.wg)(),(0,x.iD)("div",Ta,[(0,x.Wm)(r,{modelValue:o.value,"onUpdate:modelValue":[t=>o.value=t,e=>t.onSwitch(n)],modelModifiers:{boolean:!0},id:`${t.id}_${n}`,disabled:o.disabled},null,8,["modelValue","onUpdate:modelValue","id","disabled"])])):(0,x.wy)(((0,x.wg)(),(0,x.iD)("input",{key:2,"onUpdate:modelValue":t=>o.value=t,min:o.min,max:o.max,type:o.type,id:`${t.id}_${n}`,disabled:o.disabled,class:"property-form__input",onChange:e[1]||(e[1]=(...e)=>t.onChange&&t.onChange(...e))},null,40,Fa)),[[I.YZ,o.value]]),o.description?((0,x.wg)(),(0,x.iD)("small",La,(0,C.zw)(o.description),1)):(0,x.kq)("",!0)])))),128))])}const $a=["id","disabled"];function Va(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("label",{class:(0,C.C_)(["property-switch",{"property-switch--on":t.model,"property-switch--disabled":t.disabled}])},[(0,x.wy)((0,x._)("input",{"onUpdate:modelValue":e[0]||(e[0]=e=>t.model=e),id:t.id,disabled:t.disabled,type:"checkbox",class:"property-switch__input",onInput:e[1]||(e[1]=e=>t.$emit("update:modelValue",!t.model))},null,40,$a),[[I.e8,t.model]]),(0,x._)("div",{class:(0,C.C_)(["property-switch__trigger",{"property-switch__trigger--on":t.model}])},null,2)],2)}var Ra=(0,x.aZ)({name:"PropertyForm",props:{modelValue:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},id:{type:String,default:""}},emits:{"update:modelValue":t=>!0},setup(t,{emit:e}){const o=(0,O.iH)(t.modelValue);return(0,x.YP)((()=>t.modelValue),(()=>{o.value=t.modelValue})),{model:o}}});const Aa=(0,F.Z)(Ra,[["render",Va]]);var Ua=Aa;const qa=!0;var Ha=qa,Ga=(0,x.aZ)({name:"PropertyForm",components:{Icon:Tt,PropertySwitch:Ua},props:{modelValue:{type:Object,default:()=>({})},id:{type:String,default:""}},setup(t,{emit:e}){const o=t=>Object.keys(t).filter((e=>Ha?!t[e].desktopOnly:!t[e].mobileOnly)).reduce(((e,o)=>({...e,[o]:lt()(t[o])})),{}),n=(0,O.iH)(o(t.modelValue));function i(t){const e=n.value[t];e.excludes?.forEach((t=>{e.value&&"boolean"===n.value[t].type&&(n.value[t].value=!1)})),s()}function s(){e("update:modelValue",n.value)}return(0,x.YP)((()=>t.modelValue),(t=>{n.value=o(t)}),{deep:!0}),{model:n,close:close,onSwitch:i,onChange:s}}});const Ya=(0,F.Z)(Ga,[["render",Wa]]);var Ka=Ya,Xa=(0,x.aZ)({components:{MobileButton:Da,MobileCollapsiblePanel:Ba,PropertyForm:Ka},name:"MobilePreferences",setup(){const t=fs(),{colors:e,grid:o,snapping:n,simulation:i,experience:s}=(0,w.Jk)(t),{updateSettings:r}=t;return{faFile:D.gMD,faCodeBranch:D.mh3,faGears:D.Obi,faImage:D.VmB,faMagnet:D.mlU,faMicrochip:D.zvy,faPalette:D.q2v,faTableCells:D.DaQ,faWandMagicSparkles:D.Z30,colors:e,grid:o,snapping:n,simulation:i,experience:s,updateSettings:r}}});const Ja=(0,F.Z)(Xa,[["render",wa]]);var Qa=Ja;const tl={key:0};function el(t,e,o,n,i,s){const r=(0,x.up)("oscilloscope-title-bar"),a=(0,x.up)("oscilloscope-timeline"),l=(0,x.up)("oscilloscope-viewer");return t.isOscilloscopeOpen?((0,x.wg)(),(0,x.j4)(l,{key:0,modelValue:t.oscilloscopeHeight,"onUpdate:modelValue":e[0]||(e[0]=e=>t.oscilloscopeHeight=e),"collapse-height":40,onCollapse:t.closeOscilloscope},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{clearable:t.hasWaves,"is-recording":t.isOscilloscopeRecording,onClear:t.clearOscilloscope,onToggle:t.toggleOscillatorRecording},null,8,["clearable","is-recording","onClear","onToggle"]),t.hasWaves?((0,x.wg)(),(0,x.j4)(a,{key:1,oscillogram:t.oscillogram},null,8,["oscillogram"])):((0,x.wg)(),(0,x.iD)("div",tl," no waves to observe "))])),_:1},8,["modelValue","onCollapse"])):(0,x.kq)("",!0)}const ol={class:"oscilloscope-timeline"},nl={class:"oscilloscope-timeline__list",ref:"list"},il=["width","viewBox"],sl=["points","stroke"];function rl(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",ol,[(0,x._)("div",nl,[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.oscillogram,((t,e)=>((0,x.wg)(),(0,x.iD)("div",{key:e,style:(0,C.j5)({color:`hsla(${t.hue}, var(--lightness), var(--saturation), 0.8)`}),class:"oscilloscope-timeline__label"},(0,C.zw)(e),5)))),128))],512),(0,x._)("div",{class:"oscilloscope-timeline__display",ref:"timeline",onWheel:e[0]||(e[0]=(...e)=>t.onWheel&&t.onWheel(...e))},[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.oscillogram,((e,o)=>((0,x.wg)(),(0,x.iD)("div",{style:(0,C.j5)({width:`${t.totalWidth}px`}),key:o,class:"oscilloscope-timeline__item"},[(0,x._)("div",{style:(0,C.j5)({width:`${e.width}px`}),class:"oscilloscope-timeline__svg"},[((0,x.wg)(),(0,x.iD)("svg",{width:e.width,viewBox:`0 0 ${e.width} 1`,preserveAspectRatio:"none"},[(0,x._)("polyline",{points:e.points,stroke:`hsla(${e.hue}, var(--lightness), var(--saturation), 0.8)`,"stroke-width":"2",fill:"none","vector-effect":"non-scaling-stroke"},null,8,sl)],8,il))],4)],4)))),128))],544)])}var al=(0,x.aZ)({name:"OscilloscopeTimeline",props:{oscillogram:{type:Object,required:!0}},computed:{totalWidth(){return Object.values(this.oscillogram).reduce(((t,{width:e})=>Math.max(e,t)),0)}},mounted(){const t=this.$refs.timeline,e=this.$refs.list;this.scrollToNextInterval(),e.addEventListener("scroll",this.onTimelineScroll),t.addEventListener("scroll",this.onTimelineScroll)},beforeUnmount(){const t=this.$refs.timeline,e=this.$refs.list;e.removeEventListener("scroll",this.onTimelineScroll),t.removeEventListener("scroll",this.onTimelineScroll)},methods:{onWheel(t){const e=this.$refs.timeline;e.scrollTop+=t.deltaY/10,t.preventDefault()},scrollToNextInterval(){const t=this.$refs.timeline;t.scrollLeft=t.scrollWidth},onTimelineScroll(){const t=this.$refs.list,e=this.$refs.timeline;e&&(t.scrollTop=e.scrollTop)}},watch:{oscillogram:{handler(){this.scrollToNextInterval()},deep:!0}}});const ll=(0,F.Z)(al,[["render",rl]]);var cl=ll;const ul={class:"oscilloscope-title-bar"},dl=(0,x._)("div",{class:"oscilloscope-title-bar__title"},"Oscilloscope",-1),pl={class:"oscilloscope-title-bar__actions"},hl=["disabled"];function ml(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.iD)("div",ul,[dl,(0,x._)("div",pl,[(0,x._)("button",{class:"oscilloscope-title-bar__button",title:"Close",onClick:e[0]||(e[0]=e=>t.$emit("close"))},[(0,x.Wm)(r,{icon:t.faClose},null,8,["icon"])]),(0,x._)("button",{class:"oscilloscope-title-bar__button",title:"Clear oscilloscope",disabled:!t.clearable,onClick:e[1]||(e[1]=e=>t.$emit("clear"))},[(0,x.Wm)(r,{icon:t.faBan},null,8,["icon"])],8,hl),(0,x._)("button",{class:"oscilloscope-title-bar__button",title:"Close",onClick:e[2]||(e[2]=e=>t.$emit("toggle"))},[(0,x.Wm)(r,{icon:t.isRecording?t.faPause:t.faPlay},null,8,["icon"])])])])}var gl=(0,x.aZ)({name:"OscilloscopeTitleBar",components:{Icon:Tt},props:{clearable:{type:Boolean,default:!0},isRecording:{type:Boolean,default:!0}},setup(){return{faBan:D.gPx,faClose:D.YIN,faPause:D.XQY,faPlay:D.zc}}});const fl=(0,F.Z)(gl,[["render",ml]]);var vl=fl;function bl(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{ref:"viewer",class:"oscilloscope-viewer",style:(0,C.j5)({height:`${t.height}px`})},[(0,x._)("div",{class:"oscilloscope-viewer__touch-resizer",onTouchstart:e[1]||(e[1]=(...e)=>t.onTouchStart&&t.onTouchStart(...e)),onTouchmove:e[2]||(e[2]=(...e)=>t.onTouchMove&&t.onTouchMove(...e)),onTouchcancel:e[3]||(e[3]=(...e)=>t.onMouseUp&&t.onMouseUp(...e)),onTouchend:e[4]||(e[4]=(...e)=>t.onMouseUp&&t.onMouseUp(...e))},[(0,x._)("div",{class:"oscilloscope-viewer__mouse-resizer",onMousedown:e[0]||(e[0]=(...e)=>t.onMouseDown&&t.onMouseDown(...e))},null,32)],32),(0,x.WI)(t.$slots,"default")],4)}var yl=(0,x.aZ)({name:"OscilloscopeViewer",props:{collapseHeight:{type:Number,default:20},modelValue:{type:Number,required:!0}},setup(t,{emit:e}){const o=(0,O.iH)(t.modelValue),n=(0,O.iH)();let i=0,s=0,r=!1;function a(t){i=o.value,s=t.clientY,r=!0}function l(t){a(t.touches[0])}function c(a){if(!r||!n.value)return;const l=n.value.parentElement?.getBoundingClientRect();o.value+=Math.min(s-a.clientY,l?.height||1/0),s=a.clientY,o.value<=t.collapseHeight?e("collapse",i):e("update:modelValue",o.value)}function u(t){c(t.touches[0])}function d(){r=!1}return(0,x.bv)((()=>{window.addEventListener("mousemove",c),window.addEventListener("mouseup",d)})),(0,x.Ah)((()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d)})),{onMouseDown:a,onMouseUp:d,onTouchStart:l,onTouchMove:u,height:o,viewer:n}}});const wl=(0,F.Z)(yl,[["render",bl]]);var Il=wl,xl=(0,x.aZ)({name:"Oscilloscope",components:{OscilloscopeTimeline:cl,OscilloscopeTitleBar:vl,OscilloscopeViewer:Il},props:{store:{type:Function,required:!0}},setup(t){const e=t.store(),{oscilloscopeHeight:o,isOscilloscopeOpen:n,isOscilloscopeRecording:i,oscillogram:s}=(0,w.Jk)(e),{clearOscilloscope:r,closeOscilloscope:a,toggleOscillatorRecording:l}=e,c=(0,x.Fl)((()=>Object.keys(e.oscillogram).length>0));return{hasWaves:c,oscillogram:s,oscilloscopeHeight:o,isOscilloscopeOpen:n,isOscilloscopeRecording:i,clearOscilloscope:r,closeOscilloscope:a,toggleOscillatorRecording:l}}});const Cl=(0,F.Z)(xl,[["render",el]]);var Sl=Cl;const _l={key:0},Dl={key:1},Ol={key:2};function Pl(t,e,o,n,i,s){const r=(0,x.up)("icon"),a=(0,x.up)("status-bar-button"),l=(0,x.up)("status-bar-zoom"),c=(0,x.up)("status-bar-viewer");return(0,x.wg)(),(0,x.j4)(c,null,{left:(0,x.w5)((()=>[t.isPrinting?((0,x.wg)(),(0,x.iD)("span",_l,"Printing...")):t.isCreatingImage?((0,x.wg)(),(0,x.iD)("span",Dl,"Rendering image...")):((0,x.wg)(),(0,x.iD)("span",Ol,"Ready"))])),right:(0,x.w5)((()=>[(0,x.Wm)(a,{title:"Zoom out",disabled:t.store.zoomLevel<=.1,onClick:e[0]||(e[0]=e=>t.store.incrementZoom(-1))},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{icon:t.faMinus},null,8,["icon"])])),_:1},8,["disabled"]),(0,x.Wm)(l,{type:"range",class:"status-bar__range",min:0,step:10,max:200,zoom:t.store.zoomLevel,onZoom:e[1]||(e[1]=e=>t.store.setZoom({zoom:e}))},null,8,["zoom"]),(0,x.Wm)(a,{title:"Zoom in",disabled:t.store.zoomLevel>=2,onClick:e[2]||(e[2]=e=>t.store.incrementZoom(1))},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{icon:t.faPlus},null,8,["icon"])])),_:1},8,["disabled"]),(0,x.Wm)(a,{width:"3em",onClick:e[3]||(e[3]=e=>t.store.setZoom({zoom:1}))},{default:(0,x.w5)((()=>[(0,x.Uk)((0,C.zw)(t.zoomPercent)+"% ",1)])),_:1}),(0,x.Wm)(a,{title:"Toggle fullscreen",onClick:e[4]||(e[4]=e=>t.$emit("fullscreen"))},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{icon:t.isFullscreen?t.faCompress:t.faExpand},null,8,["icon"])])),_:1})])),_:1})}const Zl=["disabled","title"];function kl(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("button",{class:"status-bar-button",disabled:t.disabled,title:t.title,style:(0,C.j5)({width:t.width})},[(0,x.WI)(t.$slots,"default")],12,Zl)}var Ml=(0,x.aZ)({name:"StatusBarButton",props:{disabled:{type:Boolean,default:!1},title:{type:String,default:""},width:{type:String,default:"2em"}}});const Bl=(0,F.Z)(Ml,[["render",kl]]);var El=Bl;const zl={class:"status-bar-viewer"},Nl={class:"status-bar-viewer__left"},jl={class:"status-bar-viewer__right"};function Tl(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",zl,[(0,x._)("div",Nl,[(0,x.WI)(t.$slots,"left")]),(0,x._)("div",jl,[(0,x.WI)(t.$slots,"right")])])}var Fl=(0,x.aZ)({name:"StatusBarViewer"});const Ll=(0,F.Z)(Fl,[["render",Tl]]);var Wl=Ll;const $l=["step","min","max","value"];function Vl(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("input",{type:"range",class:"status-bar-zoom",step:t.step,min:t.min,max:t.max,value:t.value,onInput:e[0]||(e[0]=(...e)=>t.onInput&&t.onInput(...e))},null,40,$l)}var Rl=(0,x.aZ)({name:"StatusBarZoom",components:{Icon:Tt},props:{zoom:{type:Number,required:!0},min:{type:Number,default:0},max:{type:Number,default:200},step:{type:Number,default:10}},setup(t,{emit:e}){const o=(0,x.Fl)((()=>Math.round(100*t.zoom)));function n(t){const o=t.target,n=parseFloat(o.value);e("zoom",n/100)}return{onInput:n,value:o}}});const Al=(0,F.Z)(Rl,[["render",Vl]]);var Ul=Al,ql=(0,x.aZ)({name:"StatusBar",components:{Icon:Tt,StatusBarButton:El,StatusBarViewer:Wl,StatusBarZoom:Ul},props:{store:{type:Function,required:!0},isFullscreen:{type:Boolean,default:!1}},setup(t){const e=t.store(),o=(0,x.Fl)((()=>e.isPrinting)),n=(0,x.Fl)((()=>e.isCreatingImage)),i=(0,x.Fl)((()=>Math.round(100*e.zoomLevel)));return{store:e,isPrinting:o,isCreatingImage:n,zoomPercent:i,faMinus:D.Kl4,faPlus:D.r8p,faExpand:D.TL5,faCompress:D.Qj4}}});const Hl=(0,F.Z)(ql,[["render",Pl]]);var Gl=Hl;const Yl={class:"toolbar"},Kl={class:"toolbar__fixed"},Xl={class:"toolbar__left"},Jl={class:"toolbar__right"};function Ql(t,e,o,n,i,s){const r=(0,x.up)("toolbar-button"),a=(0,x.up)("toolbar-separator"),l=(0,x.up)("scroll-fade");return(0,x.wg)(),(0,x.iD)("div",Yl,[(0,x._)("div",Kl,[(0,x.Wm)(r,{icon:t.faScrewdriverWrench,text:"Toolbox","is-toolbox":"",onClick:t.rootStore.toggleToolbox,active:t.rootStore.isToolboxOpen},null,8,["icon","onClick","active"]),(0,x.Wm)(a)]),(0,x.Wm)(l,{class:"toolbar__scrollable"},{default:(0,x.w5)((()=>[(0,x._)("div",Xl,[(0,x.Wm)(r,{icon:t.faFolderOpen,text:"Open"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faFile,text:"New"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faSave,text:"Save"},null,8,["icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{onClick:t.documentStore.undo,disabled:!t.documentStore.canUndo,icon:t.faReply,text:"Undo"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(r,{onClick:t.documentStore.redo,disabled:!t.documentStore.canRedo,icon:t.faShare,text:"Redo"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{onClick:e[0]||(e[0]=e=>t.documentStore.rotate(1)),disabled:!t.documentStore.hasSelectedItems,icon:t.faRotateForward,text:"Rotate"},null,8,["disabled","icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{onClick:t.documentStore.group,disabled:!t.documentStore.canGroup,icon:t.faObjectGroup,text:"Group"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(r,{onClick:t.documentStore.ungroup,disabled:!t.documentStore.canUngroup,icon:t.faObjectUngroup,text:"Ungroup"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{icon:t.faScissors,text:"Cut"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faCopy,text:"Copy"},null,8,["icon"]),(0,x.Wm)(r,{icon:t.faPaste,text:"Paste"},null,8,["icon"]),(0,x.Wm)(r,{onClick:t.documentStore.deleteSelection,disabled:!t.documentStore.hasSelection,icon:t.faBan,text:"Delete"},null,8,["onClick","disabled","icon"]),(0,x.Wm)(a),(0,x.Wm)(r,{onClick:t.rootStore.launchIntegratedCircuitBuilder,icon:t.faMicrochip,text:"Export"},null,8,["onClick","icon"])]),(0,x._)("div",Jl,[(0,x.Wm)(r,{icon:t.faBug,active:t.documentStore.isDebugging,onClick:t.documentStore.toggleDebugger,text:"Debug"},null,8,["icon","active","onClick"]),(0,x.Wm)(a),(0,x.Wm)(r,{icon:t.faArrowsRotate,onClick:t.documentStore.resetCircuit,text:"Reset"},null,8,["icon","onClick"]),(0,x.Wm)(r,{icon:t.faForwardStep,disabled:!t.documentStore.isDebugging||t.documentStore.isCircuitEvaluated,onClick:t.documentStore.stepThroughCircuit,text:"Next"},null,8,["icon","disabled","onClick"]),(0,x.Wm)(a),(0,x.Wm)(r,{icon:t.faWaveSquare,disabled:t.documentStore.isDebugging,active:!t.documentStore.isDebugging&&t.documentStore.isOscilloscopeOpen,onClick:t.documentStore.toggleOscilloscope,text:"Analyze"},null,8,["icon","disabled","active","onClick"])])])),_:1})])}var tc=o(6024);const ec={class:"toolbar-button__text"};function oc(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.iD)("button",{tabindex:0,class:(0,C.C_)([{"toolbar-button--active":t.active&&!t.isToolbox,"toolbar-button--toolbox":t.active&&t.isToolbox,"toolbar-button--disabled":t.disabled},"toolbar-button"]),role:"button",onClick:e[0]||(e[0]=(...e)=>t.onClick&&t.onClick(...e))},[t.icon?((0,x.wg)(),(0,x.j4)(r,{key:0,icon:t.icon,class:"toolbar-button__icon"},null,8,["icon"])):((0,x.wg)(),(0,x.j4)(r,{key:1,icon:t.faUser,class:"toolbar-button__icon"},null,8,["icon"])),(0,x._)("div",ec,(0,C.zw)(t.text),1)],2)}var nc=(0,x.aZ)({name:"ToolbarButton",components:{Icon:Tt},data(){return{faUser:D.ILF}},emits:{click:t=>!0},props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},isToolbox:{type:Boolean,default:!1},icon:{type:Object,default:null},text:{type:String,default:""}},setup(t,{emit:e}){function o(o){o.stopPropagation(),o.preventDefault(),t.disabled||e("click",o)}return{onClick:o}}});const ic=(0,F.Z)(nc,[["render",oc]]);var sc=ic;const rc={class:"toolbar-separator"};function ac(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",rc)}var lc=(0,x.aZ)({name:"ToolbarSeparator"});const cc=(0,F.Z)(lc,[["render",ac]]);var uc=cc;function dc(t,e,o,n,i,s){const r=(0,x.up)("resizable");return(0,x.wg)(),(0,x.j4)(r,{ref:"scroll",class:(0,C.C_)(["scroll-fade",{"scrollbar-fade--show-scrollbar":!t.hideScrollbar}]),style:(0,C.j5)(`--mask-image-content: linear-gradient(to right, ${t.gradientStyle})`),onScroll:t.onChange,onResize:t.onChange},{default:(0,x.w5)((()=>[(0,x.WI)(t.$slots,"default")])),_:3},8,["class","style","onScroll","onResize"])}var pc=(0,x.aZ)({name:"ScrollFade",components:{Resizable:Ce},props:{hideScrollbar:{type:Boolean,default:!1}},setup(){const t="transparent, black var(--mask-width)",e="black calc(100% - var(--mask-width)), transparent",o=(0,O.iH)(),n=(0,O.iH)("");function i(o){const{scrollWidth:i,scrollLeft:s,clientWidth:r}=o;if(i>r){const o=[];return s>0&&o.push(t),s+r<i&&o.push(e),n.value=o.join(", "),o.join(", ")}return"transparent transparent"}function s(){o.value&&(n.value=i(o.value.$el))}return{onChange:s,gradientStyle:n,scroll:o}}});const hc=(0,F.Z)(pc,[["render",dc]]);var mc=hc,gc=(0,x.aZ)({name:"Toolbar",components:{ToolbarButton:sc,ToolbarSeparator:uc,ScrollFade:mc},data(){return{faScrewdriverWrench:D.eDR,faFolderOpen:tc.cC_,faFile:tc.gMD,faSave:tc.r6l,faScissors:D.EQg,faCopy:tc.kZ_,faPaste:tc.O4,faObjectGroup:tc.tU8,faObjectUngroup:tc.B7S,faRotateBackward:D.ptP,faRotateForward:D.fbl,faReply:D.Lh7,faShare:D.zBy,faMicrochip:D.zvy,faBan:D.gPx,faArrowsRotate:D.T80,faBug:D.QLU,faForwardStep:D.Jwg,faWaveSquare:D.fQK}},props:{store:{type:Function,required:!0}},setup(t){const e=qr(),o=t.store(),n=(0,x.Fl)((()=>o.simulation.circuit.isComplete()));return{rootStore:e,documentStore:o,isComplete:n}}});const fc=(0,F.Z)(gc,[["render",Ql]]);var vc=fc;function bc(t,e,o,n,i,s){const r=(0,x.up)("toolbox-item"),a=(0,x.up)("toolbox-layout");return(0,x.wg)(),(0,x.j4)(a,{"is-open":t.isOpen},(0,x.Nv)({_:2},[(0,x.Ko)(t.factories,((e,o)=>({name:o,fn:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(e,((e,o)=>((0,x.wg)(),(0,x.j4)(r,{factory:e,key:o,label:o,zoom:t.zoom,onDrop:t.onDrop},null,8,["factory","label","zoom","onDrop"])))),128))]))})))]),1032,["is-open"])}const yc={class:"toolbox-item__parent"},wc={class:"toolbox-item__label"};function Ic(t,e,o,n,i,s){const r=(0,x.up)("circuit-component"),a=(0,x.up)("resizable"),l=(0,x.up)("draggable");return(0,x.wg)(),(0,x.j4)(l,{class:"toolbox-item",tabindex:0,onTouchhold:t.onDragStart,onDrag:t.onDrag,onDragEnd:t.onDragEnd,onClick:e[2]||(e[2]=e=>t.$emit("drop",t.factory)),"allow-touch-drag":t.isDragging},{default:(0,x.w5)((()=>[(0,x._)("div",yc,[(0,x.Wm)(a,{class:"toolbox-item__preview",ref:"preview",onResize:e[1]||(e[1]=e=>t.onSizeChanged(e,"preview"))},{default:(0,x.w5)((()=>[(0,x.Wm)(a,{class:"toolbox-item__inner",ref:"selectable",style:(0,C.j5)({zoom:t.zoom}),onResize:e[0]||(e[0]=e=>t.onSizeChanged(e,"selectable"))},{default:(0,x.w5)((()=>[(0,x.Wm)(r,{type:t.item.type,subtype:t.item.subtype,ports:t.ports,properties:t.item.properties},null,8,["type","subtype","ports","properties"])])),_:1},8,["style"])])),_:1},512)]),(0,x._)("div",wc,(0,C.zw)(t.item.name||t.item.subtype),1)])),_:1},8,["onTouchhold","onDrag","onDragEnd","allow-touch-drag"])}var xc=(0,x.aZ)({name:"ToolboxItem",components:{CircuitComponent:Xn,Draggable:De,Resizable:Ce},emits:{drop:(t,e)=>!0},props:{factory:{type:Function,required:!0},zoom:{type:Number,default:1}},setup(t,{emit:e}){const o=(0,O.iH)(),n=(0,O.iH)(!1),i=(0,O.iH)(1),{item:s,ports:r}=t.factory(),a={selectable:new DOMRect,preview:new DOMRect};let l=null;function c(t,e){a[e]=t;const o=a.selectable,n=a.preview,s=Math.max(o.width/n.width,o.height/n.height);i.value=Math.min(1/s,1)}function u(){const e=a.selectable;l=o.value?.$el.cloneNode(!0),l.style.position="absolute",l.style["zoom"]=`${t.zoom}`,l.style.width=`${e.width}px`,l.style.height=`${e.height}px`,n.value=!0,navigator.vibrate(20)}function d({x:e,y:o}){if(!l)return u();document.body.contains(l)||document.body.appendChild(l);const{width:n,height:i}=l.getBoundingClientRect();l.style.left=(e-n/2*t.zoom)/t.zoom+"px",l.style.top=(o-i/2*t.zoom)/t.zoom+"px"}function p(o){l&&(l.remove(),l=null,n.value=!1,e("drop",t.factory,o))}return{onDragStart:u,onDrag:d,onDragEnd:p,onSizeChanged:c,item:s,ports:r,zoom:i,selectable:o,isDragging:n}}});const Cc=(0,F.Z)(xc,[["render",Ic]]);var Sc=Cc;const _c=["onClick"];function Dc(t,e,o,n,i,s){const r=(0,x.up)("scroll-fade");return(0,x.wg)(),(0,x.iD)("div",{ref:"toolbox",class:(0,C.C_)(["toolbox-layout",{"toolbox-layout--open":t.isOpen}]),style:(0,C.j5)({height:`${t.height}px`})},[(0,x.Wm)(r,{class:"toolbox-layout__categories","hide-scrollbar":!0},{default:(0,x.w5)((()=>[((0,x.wg)(!0),(0,x.iD)(x.HY,null,(0,x.Ko)(t.categories,(e=>((0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(["toolbox-layout__badge",{"toolbox-layout__badge--active":e===t.selected}]),key:e,onClick:o=>t.select(e)},(0,C.zw)(e),11,_c)))),128))])),_:1}),(0,x.Wm)(r,{class:"toolbox-layout__items"},{default:(0,x.w5)((()=>[(0,x.WI)(t.$slots,t.selected)])),_:3})],6)}var Oc=(0,x.aZ)({name:"Toolbox",components:{ScrollFade:mc},props:{isOpen:{type:Boolean,default:!1}},setup(t,{slots:e}){const o=(0,O.iH)(null),n=(0,O.iH)(null),i=(0,x.Fl)((()=>Object.keys(e))),s=(0,x.Fl)((()=>t.isOpen?n.value?.scrollHeight:0));function r(t){o.value=t}return r(i.value[0]),{categories:i,selected:o,select:r,height:s,toolbox:n}}});const Pc=(0,F.Z)(Oc,[["render",Dc]]);var Zc=Pc;const kc=(t,e,o,n={})=>{const i=(0,ct.Z)(),s=[gs(i,(0,ct.Z)(),ht.Right,et.Output,"Output Port")],r=mt(i,dt.InputNode,t,e,o,s);return r.properties={...r.properties,...n,startValue:{label:"Start value",value:-1,type:"number",options:{True:1,"Hi-Z":0,False:-1}}},{item:r,ports:s}};var Mc=kc;const Bc=()=>Mc(gt.Clock,60,60,{interval:{label:"Interval",value:1e3,type:"number",min:100,step:100}});var Ec=Bc;function zc(){const t=[],e=Array(4).fill("").reduce(((e,o,n)=>{const i=(0,ct.Z)(),s=(0,ct.Z)(),r=gs(s,i,ht.Left,et.Output,`Input Port ${n+1}`),a=mt(s,dt.InputNode,gt.Switch,0,0,[r]);return t.push(r),{connections:{},groups:{},items:{...e.items,[s]:a},ports:{...e.ports,[i]:r}}}),{connections:{},ports:{},items:{},groups:{}}),o=ft(e,"Digit Display",40,40,gt.DigitDisplay);return{item:o,ports:t}}function Nc(){const t=(0,ct.Z)(),e=[gs(t,(0,ct.Z)(),ht.Left,et.Input,"Input Port")],o=mt(t,dt.OutputNode,gt.Lightbulb,40,40,e);return{item:o,ports:e}}function jc(t,e,o,n=2){const i=(0,ct.Z)(),s=Array(n).fill("").map(((t,e)=>gs(i,(0,ct.Z)(),0,1,`Input Port ${e}`))).concat(gs(i,(0,ct.Z)(),2,0,"Output Port")),r=mt(i,dt.LogicGate,t,e,o,s);return r.properties={...r.properties,inputCount:{label:"Input count",value:n,type:"number",min:n},showInOscilloscope:{label:"Show in oscilloscope",value:!1,type:"boolean"}},{item:r,ports:s}}var Tc={[dt.InputNode]:{[gt.Switch]:Mc.bind(void 0,gt.Switch,60,60),[gt.Clock]:Ec},[dt.OutputNode]:{[gt.Lightbulb]:Nc,[gt.DigitDisplay]:zc},[dt.LogicGate]:{[gt.And]:jc.bind(void 0,gt.And,140,50),[gt.Nand]:jc.bind(void 0,gt.Nand,140,50),[gt.Xnor]:jc.bind(void 0,gt.Xnor,140,50),[gt.Nor]:jc.bind(void 0,gt.Nor,140,50),[gt.Or]:jc.bind(void 0,gt.Or,140,50),[gt.Not]:jc.bind(void 0,gt.Not,140,50,1)}},Fc=(0,x.aZ)({name:"Toolbox",components:{ScrollFade:mc,ToolboxItem:Sc,ToolboxLayout:Zc},props:{store:{type:Function,required:!0},isOpen:{type:Boolean,default:!1}},setup(t){const e=t.store(),o=St(),n=(0,x.Fl)((()=>e.zoom)),i=(0,x.Fl)((()=>o.factories));function s(t,o){e.insertItemAtPosition(t(),o)}return{factories:{...Tc,[dt.IntegratedCircuit]:i.value},zoom:n,onDrop:s}}});const Lc=(0,F.Z)(Fc,[["render",bc]]);var Wc=Lc;const $c={class:"main-view__top"},Vc={class:"main-view__middle"},Rc={class:"main-view__bottom"};function Ac(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(["main-view",{"main-view--blurred":t.isBlurred}])},[(0,x._)("div",$c,[(0,x.WI)(t.$slots,"top")]),(0,x._)("div",Vc,[(0,x.WI)(t.$slots,"middle")]),(0,x._)("div",Rc,[(0,x.WI)(t.$slots,"bottom")])],2)}var Uc=(0,x.aZ)({name:"MainView",props:{isBlurred:{type:Boolean,default:!1}}});const qc=(0,F.Z)(Uc,[["render",Ac]]);var Hc=qc;function Gc(t,e,o,n,i,s){const r=(0,x.up)("mobile-popout-menu-item");return(0,x.wg)(),(0,x.j4)(r,{label:`${t.label}${t.dirty?"*":""}`,icon:t.faMicrochip,active:t.active,onClick:e[0]||(e[0]=e=>t.$emit("activate")),onClose:e[1]||(e[1]=e=>t.$emit("close"))},null,8,["label","icon","active"])}const Yc={class:"mobile-popout-menu-item"},Kc={class:"mobile-popout-menu-item__label"};function Xc(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.iD)("div",Yc,[(0,x.Wm)(r,{icon:t.icon,class:"mobile-popout-menu-item__icon"},null,8,["icon"]),(0,x._)("div",Kc,(0,C.zw)(t.label),1),t.closable?((0,x.wg)(),(0,x.j4)(r,{key:0,icon:t.faClose,class:"mobile-popout-menu-item__icon",onClick:e[0]||(e[0]=e=>t.$emit("close"))},null,8,["icon"])):(0,x.kq)("",!0)])}var Jc=(0,x.aZ)({components:{Icon:Tt},name:"MobileFileName",emits:{close:()=>!0},props:{label:{type:String,required:!0},icon:{type:Object,required:!0},closable:{type:Boolean,default:!0}},setup(){return{faClose:D.YIN}}});const Qc=(0,F.Z)(Jc,[["render",Xc]]);var tu=Qc,eu=(0,x.aZ)({components:{MobilePopoutMenuItem:tu},name:"MobileDocumentTabItem",emits:{activate:()=>!0,close:()=>!0},props:{label:{type:String,required:!0},dirty:{type:Boolean,default:!1},active:{type:Boolean,default:!1}},setup(){return{faMicrochip:D.zvy}}});const ou=(0,F.Z)(eu,[["render",Gc]]);var nu=ou;const iu={class:"mobile-header"},su={class:"mobile-header__heading"};function ru(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.iD)("div",iu,[(0,x._)("div",{class:"mobile-header__button",onClick:e[0]||(e[0]=e=>t.$emit("open"))},[(0,x.Wm)(r,{icon:t.faBars},null,8,["icon"])]),(0,x._)("div",su,[(0,x._)("span",{class:"mobile-header__document-name",onClick:e[1]||(e[1]=e=>t.$emit("select"))},(0,C.zw)(t.documentName),1),t.documentCount>1?((0,x.wg)(),(0,x.iD)("span",{key:0,class:"mobile-header__badge",onClick:e[2]||(e[2]=e=>t.$emit("select"))},(0,C.zw)(t.documentCount),1)):(0,x.kq)("",!0)])])}var au=(0,x.aZ)({components:{Icon:Tt},name:"MobileHeader",emits:{select:()=>!0,open:()=>!0},props:{documentName:{type:String,required:!0},documentCount:{type:Number,default:1}},setup(){return{faBars:D.xiG,faPlusSquare:tc.CPW}}});const lu=(0,F.Z)(au,[["render",ru]]);var cu=lu;const uu={key:0,class:"mobile-popout-menu"},du={class:"mobile-popout-menu__content"};function pu(t,e,o,n,i,s){return(0,x.wg)(),(0,x.j4)(I.uT,{name:"mobile-popout-menu"},{default:(0,x.w5)((()=>[t.modelValue?((0,x.wg)(),(0,x.iD)("div",uu,[(0,x._)("div",{class:"mobile-popout-menu__overlay",onClick:e[0]||(e[0]=(0,I.iM)((e=>t.$emit("update:modelValue",!1)),["self"]))},[(0,x._)("div",du,[(0,x.WI)(t.$slots,"default")])])])):(0,x.kq)("",!0)])),_:3})}var hu=(0,x.aZ)({name:"MobilePopoutMenu",props:{modelValue:{type:Boolean,required:!0}}});const mu=(0,F.Z)(hu,[["render",pu]]);var gu=mu;const fu={key:0,class:"mobile-pullout"},vu={class:"mobile-pullout__content"};function bu(t,e,o,n,i,s){return(0,x.wg)(),(0,x.j4)(I.uT,{name:"mobile-pullout"},{default:(0,x.w5)((()=>[t.modelValue?((0,x.wg)(),(0,x.iD)("div",fu,[(0,x._)("div",{class:"mobile-pullout__overlay",onClick:e[0]||(e[0]=e=>t.$emit("update:modelValue",!1))}),(0,x._)("div",vu,[(0,x.WI)(t.$slots,"default")])])):(0,x.kq)("",!0)])),_:3})}var yu=(0,x.aZ)({name:"MobilePullout",props:{modelValue:{type:Boolean,required:!0}}});const wu=(0,F.Z)(yu,[["render",bu]]);var Iu=wu;const xu={class:"mobile-pullout-heading"},Cu=(0,x._)("img",{src:"logo.svg",class:"mobile-pullout-heading__logo"},null,-1),Su={class:"mobile-pullout-heading__brand"},_u=(0,x._)("div",{class:"mobile-pullout-heading__title"}," Aristotle ",-1),Du={class:"mobile-pullout-heading__subtitle"};function Ou(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.iD)("div",xu,[Cu,(0,x._)("div",Su,[_u,(0,x._)("div",Du," v"+(0,C.zw)(t.version),1)]),(0,x.Wm)(r,{icon:t.faClose,class:"mobile-pullout-heading__close",onClick:e[0]||(e[0]=e=>t.$emit("close"))},null,8,["icon"])])}var Pu=(0,x.aZ)({name:"MobilePulloutHeading",components:{Icon:Tt},props:{version:{type:String,default:"1.0.0"}},emits:{close:()=>!0},setup(){return{faClose:D.YIN}}});const Zu=(0,F.Z)(Pu,[["render",Ou]]);var ku=Zu;const Mu={class:"tab-item__icon"},Bu={class:"tab-item__label"};function Eu(t,e,o,n,i,s){const r=(0,x.up)("icon");return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)([{"tab-item--active":t.active,"tab-item--dirty":t.dirty},"tab-item"]),onMousedown:e[1]||(e[1]=e=>t.$emit("activate")),onTouchstart:e[2]||(e[2]=e=>t.$emit("activate"))},[(0,x._)("div",Mu,[(0,x.Wm)(r,{icon:t.faCodeBranch},null,8,["icon"])]),(0,x._)("div",Bu,(0,C.zw)(t.label)+(0,C.zw)(t.dirty?"*":""),1),(0,x._)("div",{class:"tab-item__icon tab-item__icon--close",onClick:e[0]||(e[0]=(0,I.iM)((e=>t.$emit("close")),["stop"]))},[(0,x.Wm)(r,{icon:t.faClose},null,8,["icon"])])],34)}var zu=(0,x.aZ)({name:"TabItem",components:{Icon:Tt},props:{active:{type:Boolean,default:!1},label:{type:String,required:!0},dirty:{type:Boolean,default:!1}},setup(){return{faClose:D.YIN,faCodeBranch:D.mh3}}});const Nu=(0,F.Z)(zu,[["render",Eu]]);var ju=Nu;const Tu={class:"tab-host"},Fu={class:"tab-host__list"};function Lu(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",Tu,[(0,x._)("div",Fu,[(0,x.WI)(t.$slots,"tabs")]),(0,x.WI)(t.$slots,"default")])}var Wu=(0,x.aZ)({name:"TabHost"});const $u=(0,F.Z)(Wu,[["render",Lu]]);var Vu=$u;function Ru(t,e,o,n,i,s){return(0,x.wg)(),(0,x.iD)("div",{class:(0,C.C_)(["theme",{"theme--dark":t.dark}])},[(0,x.WI)(t.$slots,"default")],2)}var Au=(0,x.aZ)({name:"Theme",props:{dark:{type:Boolean,default:!1}}});const Uu=(0,F.Z)(Au,[["render",Ru]]);var qu=Uu;function Hu(){const t=qr(),e=null!==t.activeDocumentId,o=Object.keys(t.documents),n=t.activeDocument?.store(),i=[{label:"&New Circuit",accelerator:"CommandOrControl+N",click:t.newDocument},{type:"separator"},{label:"&Open Circuit",accelerator:"CommandOrControl+O",click:t.selectDocument},{label:"Open &Integrated Circuit",accelerator:"CommandOrControl+Shift+O",click:t.selectDocument},{type:"separator"},{label:"Save",enabled:e,accelerator:"CommandOrControl+S",click:()=>t.saveActiveDocument()},{label:"Save As...",enabled:e,accelerator:"CommandOrControl+Shift+S",click:()=>t.saveActiveDocument(!0)},{label:"Save All",enabled:e,accelerator:"CommandOrControl+Shift+A",click:()=>console.log("root store save all")},{type:"separator"},{label:"Print",enabled:e,accelerator:"CommandOrControl+P",click:()=>n?.print()},{type:"separator"},{label:"Export...",enabled:e,submenu:[{label:"Integrated Circuit",accelerator:"CommandOrControl+Shift+E",click:()=>console.log("export IC")},{label:"PNG Image",accelerator:"CommandOrControl+Shift+I",click:()=>n?.createImage()}]},{type:"separator"},{label:"Preferences",submenu:[{label:"Global Preferences",accelerator:"CommandOrControl+,",click:()=>console.log("global prefs")},{label:"Document Preferences",accelerator:"CommandOrControl+Shift+,",click:()=>console.log("doc prefs")}]}];if(Object.keys(t.documents).length>1){const e=[{label:"Previous File",accelerator:"Ctrl+Shift+Tab",click:()=>t.switchDocument(-1)},{label:"Next File",accelerator:"Ctrl+Tab",click:()=>t.switchDocument(1)},{type:"separator"}];for(let n=0;n<o.length;n++)e.push({type:"checkbox",label:t.documents[o[n]].displayName,checked:t.activeDocumentId===o[n],click:()=>t.activateDocument(o[n])});i.push({type:"separator"}),i.push({label:"Switch to...",submenu:e})}return i.push({type:"separator"}),i.push({label:"Close Document",accelerator:"CmdOrCtrl+W",enabled:e,click:()=>t.closeDocument(t.activeDocumentId)}),i.push({type:"separator"}),i.push({label:"Exit",accelerator:"CmdOrCtrl+Q",click:()=>window.close()}),i}function Gu(t){const e=t(),o=[];let n=!1;for(let s=1;s<=8;s++){const t=25*s/100,i=e.zoomLevel===t;n=n||i,o.push({type:"checkbox",checked:i,label:100*t+"%",accelerator:1===t?"CommandOrControl+0":void 0,click:()=>e.setZoom({zoom:t})})}n||o.unshift({type:"checkbox",checked:!0,label:"Custom"});const i=[{label:"&Zoom In",accelerator:"CommandOrControl+=",enabled:e.zoomLevel<2,click:()=>e.incrementZoom(1)},{label:"&Zoom Out",accelerator:"CommandOrControl+-",enabled:e.zoomLevel>.1,click:()=>e.incrementZoom(-1)},{label:"&Zoom...",submenu:o},{type:"separator"},{label:"&Pan to Center",accelerator:"CommandOrControl+;",click:e.panToCenter},{type:"separator"}];return i.concat(Ue(t))}function Yu(){const t=qr();if(t.isDialogOpen)return[{label:"File",submenu:[{label:"Exit"}]}];const e=[{label:"File",submenu:Hu()}];return t.activeDocument&&(e.push({label:"Edit",submenu:Ae(t.activeDocument.store)}),e.push({label:"View",submenu:Gu(t.activeDocument.store).concat([{type:"separator"},{type:"checkbox",click:t.toggleFullscreen,checked:t.isFullscreen,accelerator:"F11",label:"Fullscreen"}])})),e}var Ku=(0,x.aZ)({name:"App",components:{BuilderView:Gt,Document:ya,Oscilloscope:Sl,MainView:Hc,MobileDocumentTabItem:nu,MobileHeader:cu,MobilePopoutMenu:gu,MobilePopoutMenuItem:tu,MobilePreferences:Qa,MobilePullout:Iu,MobilePulloutHeading:ku,StatusBar:Gl,TabItem:ju,TabHost:Vu,Theme:qu,Toolbar:vc,Toolbox:Wc},setup(){const t=qr(),{experience:e}=(0,w.Jk)(fs()),{activeDocument:o,activeDocumentId:n,documents:i,hasOpenDocuments:s,isFullscreen:r,isDialogOpen:a,isBuilderOpen:l,isToolboxOpen:c,isSettingsOpen:u,isDocumentSelectOpen:d}=(0,w.Jk)(t),p=(0,O.iH)(!1);function h(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),p.value=!0}async function m(e){e.stopPropagation(),e.preventDefault();const o=e.dataTransfer?.files;if(o)for(let n=0;n<o.length;n++)await t.openDocumentFromPath(o[n].path);p.value=!1}function g(){p.value=!1}function f(t){t.ctrlKey&&"R"===t.key.toUpperCase()&&window.location.reload()}function v(){}return s.value||t.openTestDocuments(),(0,x.m0)((()=>window.api.setApplicationMenu(Yu()))),(0,x.m0)((()=>{document.title=t.activeDocument?`${t.activeDocument.displayName} - Aristotle`:"Aristotle"})),window.api.onBeforeClose(t.closeAll),window.api.onOpenFile(t.openDocumentFromPath),(0,x.bv)((()=>{document.addEventListener("keydown",f),document.addEventListener("dragover",h),document.addEventListener("dragleave",g),document.addEventListener("drop",m)})),(0,x.Jd)((()=>{document.removeEventListener("keydown",f),document.removeEventListener("dragover",h),document.removeEventListener("dragleave",g),document.removeEventListener("drop",m)})),{faFile:D.gMD,activeDocument:o,activeDocumentId:n,documents:i,experience:e,hasOpenDocuments:s,isDropping:p,isFullscreen:r,isDialogOpen:a,isBuilderOpen:l,isToolboxOpen:c,isSettingsOpen:u,isDocumentSelectOpen:d,onContextMenu:v,toggleFullscreen:t.toggleFullscreen,activateDocument:t.activateDocument,closeDocument:t.closeDocument,switchDocument:t.switchDocument,openIntegratedCircuit:t.openIntegratedCircuit}},data(){return{horizontal:!1,lastPosition:0,toolboxWidth:20,oscilloscopeHeight:80,isMobile:Ha}}});const Xu=(0,F.Z)(Ku,[["render",_]]);var Ju=Xu;window.api||(window.api={showContextMenu(){},setApplicationMenu(){},showOpenFileDialog(){return[]},showSaveFileDialog(){return""},showMessageBox(){return 0},beep(){},quit(){},copy(){},paste(){return""},onBeforeClose(){},onOpenFile(){},openFile(){return""},saveFile(){},setFullscreen(){},getFilePaths(){return[]}}),(0,I.ri)(Ju).use((0,w.WB)()).mount("#app")}},e={};function o(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(s.exports,s,s.exports,o),s.loaded=!0,s.exports}o.m=t,function(){var t=[];o.O=function(e,n,i,s){if(!n){var r=1/0;for(u=0;u<t.length;u++){n=t[u][0],i=t[u][1],s=t[u][2];for(var a=!0,l=0;l<n.length;l++)(!1&s||r>=s)&&Object.keys(o.O).every((function(t){return o.O[t](n[l])}))?n.splice(l--,1):(a=!1,s<r&&(r=s));if(a){t.splice(u--,1);var c=i();void 0!==c&&(e=c)}}return e}s=s||0;for(var u=t.length;u>0&&t[u-1][2]>s;u--)t[u]=t[u-1];t[u]=[n,i,s]}}(),function(){o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,{a:e}),e}}(),function(){o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){o.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={826:0};o.O.j=function(e){return 0===t[e]};var e=function(e,n){var i,s,r=n[0],a=n[1],l=n[2],c=0;if(r.some((function(e){return 0!==t[e]}))){for(i in a)o.o(a,i)&&(o.m[i]=a[i]);if(l)var u=l(o)}for(e&&e(n);c<r.length;c++)s=r[c],o.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return o.O(u)},n=self["webpackChunkaristotle"]=self["webpackChunkaristotle"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=o.O(void 0,[998],(function(){return o(4971)}));n=o.O(n)})();
//# sourceMappingURL=index.19e5e59e.js.map